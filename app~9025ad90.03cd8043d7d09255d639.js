(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{1722:function(e,t,a){"use strict";a.d(t,"a",(function(){return y}));a(59),a(1002);var o,r,n,l=a(9),i=a(31),s=a(83),c=a(104),d=a(1),p=a(32),u=a(29),m=a(7),b=function(e,t,a,o){var r,n=arguments.length,l=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,a):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,o);else for(var i=e.length-1;i>=0;i--)(r=e[i])&&(l=(n<3?r(l):n>3?r(t,a,l):r(t,a))||l);return n>3&&l&&Object.defineProperty(t,a,l),l},v=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},g=function(e,t){return function(a,o){t(a,o,e)}};let y=class{constructor(e,t,a){this.store=e,this.tsModelApi=t,this.tsModelAction=a}getServiceOrdersOfList(e,t){const{authdata:a}=Object(p.a)(this.store.getState());return 0!==e?this.tsModelApi.getMultiple({authdata:null!=a?a:"",query:"filter=portCall.key(IN)"+e,type:d.a.serviceorder,fields:{portCall:"*"}}).then(e=>e).catch(()=>[]).finally(t):Promise.reject()}getServiceOrdersOfPortCall(e,t){const{authdata:a}=Object(p.a)(this.store.getState());return this.tsModelApi.getMultiple({authdata:null!=a?a:"",query:"filter=portCall.key(EQ)"+e,type:d.a.serviceorder,fields:{externalReferenceNo:"*",orderDate:"*",businessPartner:{businessPartnerName:"*"},status:{statusTypeDesc:"*"},portCall:{ownedByVoyage:{vessel:{vesselName:"*"},voyageHeader:{referenceNo:"*"}},eventLogs:{eventLogDate:"*",event:{eventCode:"*"}}},serviceOrderLines:{serviceCode:{description:"*"},isCharterersCost:"*",isOwnersCost:"*",amountRevised:"*",amountEstimate:"*",amountFinal:"*"}}}).then(e=>e).catch(()=>[]).finally(t)}updatePortCall(e,t,a){return this.tsModelAction.updateSingleAction({key:e,data:t,type:d.a.portcall,fields:a})}};y=b([Object(l.injectable)(),g(0,Object(l.inject)(m.a.Store)),g(1,Object(l.inject)(s.a.ITSModelApi)),g(2,Object(l.inject)(m.a.ITSModelActionsAsync)),v("design:paramtypes",["function"==typeof(o=void 0!==i.Store&&i.Store)?o:Object,"function"==typeof(r=void 0!==c.ITSModelApi&&c.ITSModelApi)?r:Object,"function"==typeof(n=void 0!==u.ITSModelActionsAsync&&u.ITSModelActionsAsync)?n:Object])],y)},1725:function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));a(59);var o,r,n,l=a(9),i=a(1),s=a(7),c=a(29),d=a(235),p=a(83),u=a(104),m=a(32),b=a(31),v=function(e,t,a,o){var r,n=arguments.length,l=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,a):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,o);else for(var i=e.length-1;i>=0;i--)(r=e[i])&&(l=(n<3?r(l):n>3?r(t,a,l):r(t,a))||l);return n>3&&l&&Object.defineProperty(t,a,l),l},g=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},y=function(e,t){return function(a,o){t(a,o,e)}},f=function(e,t,a,o){return new(a||(a=Promise))((function(r,n){function l(e){try{s(o.next(e))}catch(e){n(e)}}function i(e){try{s(o.throw(e))}catch(e){n(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(l,i)}s((o=o.apply(e,t||[])).next())}))};let h=class{constructor(e,t,a){this.store=e,this.tsmodelActions=t,this.objectApi=a}updatePort(e,t){this.tsmodelActions.updateSingleAction({key:e,data:t,type:i.a.port,fields:d.b})}createPort(e){return f(this,void 0,void 0,(function*(){if(e){const{authdata:t}=Object(m.a)(this.store.getState()),a=yield this.createWpoint(e);e=yield this.objectApi.post({authdata:t||"",data:this.generatePostablePort(e,a),fields:d.b,type:i.a.port})}return e}))}createWpoint(e){return f(this,void 0,void 0,(function*(){const{authdata:t}=Object(m.a)(this.store.getState());return yield this.objectApi.post({authdata:t||"",data:this.generatePostableWpoint(e),fields:{},type:i.a.wpoint})}))}generatePostablePort(e,t){var a,o,r,n;return e?{portName:e.portName,country:null===(a=e.country)||void 0===a?void 0:a.key,timezone:null===(o=e.timezone)||void 0===o?void 0:o.key,bunkerCategoryAe:null===(r=e.bunkerCategoryAe)||void 0===r?void 0:r.key,bunkerCategoryMe:null===(n=e.bunkerCategoryMe)||void 0===n?void 0:n.key,isOpenLoopRestricted:e.isOpenLoopRestricted,longitude:e.longitude,latitude:e.latitude,locationCode:e.locationCode,wpoint:t.key}:{undefined:void 0}}generatePostableWpoint(e){return e?{wpointLongitude:e.longitude,wpointLatitude:e.latitude,wpointType:"P"}:{undefined:void 0}}};h=v([Object(l.injectable)(),y(0,Object(l.inject)(s.a.Store)),y(1,Object(l.inject)(s.a.ITSModelActionsAsync)),y(2,Object(l.inject)(p.a.ITSModelApi)),g("design:paramtypes",["function"==typeof(o=void 0!==b.Store&&b.Store)?o:Object,"function"==typeof(r=void 0!==c.ITSModelActionsAsync&&c.ITSModelActionsAsync)?r:Object,"function"==typeof(n=void 0!==u.ITSModelApi&&u.ITSModelApi)?n:Object])],h)},1871:function(e,t,a){"use strict";a.d(t,"a",(function(){return Gt}));a(109),a(10),a(11);var o=a(1817),r=a.n(o),n=a(0),l=a.n(n),i=a(170),s=a(97),c=a(973),d=a(82),p=a(15),u=a(100),m=a.n(u),b=a(40),v=a(35),g=a(5),y=a(67),f=a(6),h=a(152),O=a(3),C=a(1275),P=a(66),R=a(30),D=a(20),j=a(21),E=a(1),T=a(23),k=a(184),S=a(279),L=a(27);function w({userLocale:e,reactKeyPrefix:t,portCall:a,user:o}){const[r,i]=Object(f.a)([O.a.IInternationalization,D.a.IPortCallDrawerController]),[c,d]=Object(n.useState)(!1),[u,w]=Object(n.useState)(),I=Object(n.useRef)(!1),A=Object(s.h)(),x=Object(s.g)(),N=r.getLanguageFile(),F=Object(T.a)(j.a.getTSModelsBuilt,E.a.bunkerorder,k.a,S.a),M=Object(n.useMemo)(()=>I.current?F:[],[F]),K=Object(n.useCallback)(()=>d(!c),[c]),_=Object(n.useCallback)(()=>i.loadBunkerOrders(a.key,()=>I.current=!0),[i,a.key]);Object(n.useEffect)(_,[_]);const B=Object(n.useMemo)(()=>(null!=M?M:[]).map(e=>{var t,a,o;const r=h.b.getBunkerOrderStatus(e);return{content:[{rawValue:r,content:l.a.createElement(b.a,{label:r,labelColour:b.b.Grey,"data-cell-value":r})},null!==(a=null===(t=e.bunkerSupplier)||void 0===t?void 0:t.businessPartnerName)&&void 0!==a?a:"",e.bunkeredDate,null!==(o=e.externalReferenceNo)&&void 0!==o?o:""],id:e.key}}),[M]),U=Object(n.useMemo)(()=>[{content:N.common.status,contentType:g.a.ELEMENT},{content:N.model.supplier,contentType:g.a.TEXT},{content:N.model.bunkeredDate,contentType:g.a.DATE,dateTimeFormatOptions:v.a.shortLocalizedDate},{content:N.model.externalReference,contentType:g.a.TEXT}],[N.common.status,N.model.bunkeredDate,N.model.externalReference,N.model.supplier]),H=Object(n.useMemo)(()=>[{disabled:!Object(P.a)([R.a.BunkerOrderPOST],o),icon:m.a,iconButtonProps:{color:"primary","aria-label":N.bo.createBunkerOrder},label:N.bo.createBunkerOrder,onClick:K,reactKeyPrefix:t}],[o,N.bo.createBunkerOrder,K,t]);return I.current?l.a.createElement(l.a.Fragment,null,l.a.createElement(y.a,{headers:U,userLocale:e,reactKeyPrefix:t+"portCallBunkerOrders",title:N.menu.bunkerOrders,data:B,onRowClick:e=>{w(void 0),L.a.openDrawer(e,p.a.bunkerOrderDrawer,A,x)},customisation:{responsive:!0},primaryActions:H,preSelectedRow:u}),c&&l.a.createElement(C.a,{reactKeyPrefix:t+"createBunkerOrderModal",onClose:K,preSelectedPortCallKey:a.key,disablePortCallSelector:!0,deselectPortCall:!1,openDrawerAfterCreate:!0,onCloseModalOnCreate:_,setPreselectedBunkerOrderKey:w,createFromPortCallDrawer:!0})):l.a.createElement(l.a.Fragment,null)}var I=a(136);function A(e){const[t,a]=Object(f.a)([O.a.IInternationalization,D.a.IPortCallDrawerController]),{menu:o}=t.getLanguageFile(),{portCall:r,userLocale:i,reactKeyPrefix:s,openReport:c}=e,d=Object(n.useRef)(!1),p=Object(T.a)(j.a.getTSModelsBuilt,E.a.positionreport,k.f,S.e),u=d.current?p:[],m=Object(n.useCallback)(()=>{a.loadPositionReports(r.key,()=>d.current=!0)},[a,r.key]);Object(n.useEffect)(()=>{m()},[m]);const b=Object(n.useMemo)(()=>{const e=[];if(u)for(const t of u)if(t.vesselReportType&&t.vesselReportType.vesselReportTypeCode){const a=[t.reportDateLocal?t.reportDateLocal:"",t.vesselReportType?t.vesselReportType.vesselReportTypeName:""];e.push({content:a,id:t.key})}return e},[u]),v=Object(n.useMemo)(()=>{const{common:e,model:a}=t.getLanguageFile();return[{content:e.date,contentType:g.a.DATE},{content:a.reportType,contentType:g.a.TEXT}]},[t]);return d.current?l.a.createElement(y.a,{headers:v,userLocale:i,reactKeyPrefix:s+"portCallReports",title:o.vesselReports,data:b,onRowClick:c,pagination:{enabled:!0,rowsPerPage:[10]},defaultComparator:I.a,customisation:{responsive:!0}}):l.a.createElement(l.a.Fragment,null)}var x=a(2511),N=a(28),F=a(63),M=a(146),K=a(295),_=a(19),B=a(85);var U=a(37),H=a(12),V=a(44),W=a(50),G=a(7),z=a(78),q=a(81);const $=l.a.memo((function(e){const{deps:[t],showModal:a,portCall:o,userLocale:r,onClose:i,onConfirm:s,reactKeyPrefix:c}=e,d=t.lang(),[p,u]=Object(n.useState)({distanceSailed:o.distanceActual,arrivalDate:W.a.getEventLogDate(o.eventLogs,"ARR"),robDl:o.dlRobArrival,robDo:o.doRobArrival,robFl:o.flRobArrival,robFo:o.foRobArrival,robFw:void 0});Object(n.useEffect)(()=>{u({distanceSailed:o.distanceActual,arrivalDate:W.a.getEventLogDate(o.eventLogs,"ARR"),robDl:o.dlRobArrival,robDo:o.doRobArrival,robFl:o.flRobArrival,robFo:o.foRobArrival,robFw:void 0})},[o,a]);const m=Object(n.useCallback)((e,t,a)=>{u(Object.assign(Object.assign({},p),{[e]:t}))},[p]),b=Object(n.useCallback)(()=>function(e,t,a,o,r){const n=o.getLanguageFile(),l=t.arrivalDate<t.previousDepartureDate,i={reactKeyPrefix:e,disableUpdate:!0,fieldOptions:[{dateInputProps:{showTime:!0,error:l,clearable:!1},fieldName:"eventLogDate",formHelperText:l?n.portCall.arrivalHelperText:void 0,label:n.model.eta,onUpdateOverride:e=>r("arrivalDate",e),overrideObject:new M.a({eventLogDate:t.arrivalDate}),overrideType:E.a.eventlog},{fieldName:"distanceSailed",InputProps:{endAdornment:F.a.NauticalMile},numberInputProps:{validation:[{type:B.a.RANGE,min:0}],onChange:e=>r("distanceSailed",e)},label:n.model.actualDistanceSailedSinceDeparture},{fieldName:"robFo",InputProps:{endAdornment:F.a.Weight},label:n.model.foRob,numberInputProps:{maskSettings:N.a.mask1,validation:[{type:B.a.RANGE,min:0}],onChange:e=>r("robFo",e)}},{fieldName:"robDo",InputProps:{endAdornment:F.a.Weight},label:n.model.mgoRob,numberInputProps:{maskSettings:N.a.mask1,validation:[{type:B.a.RANGE,min:0}],onChange:e=>r("robDo",e)}},{fieldName:"robFl",InputProps:{endAdornment:F.a.Weight},label:n.model.lsfoRob,numberInputProps:{maskSettings:N.a.mask1,validation:[{type:B.a.RANGE,min:0}],onChange:e=>r("robFl",e)}},{fieldName:"robDl",InputProps:{endAdornment:F.a.Weight},label:n.model.lsmgoRob,numberInputProps:{maskSettings:N.a.mask1,validation:[{type:B.a.RANGE,min:0}],onChange:e=>r("robDl",e)}},{fieldName:"robFw",InputProps:{endAdornment:F.a.Weight},label:n.model.fwRob,numberInputProps:{maskSettings:N.a.mask1,validation:[{type:B.a.RANGE,min:0}],onChange:e=>r("robFw",e)}}],object:new K.a(Object.assign({},t)),type:E.a.positionreport,userLocale:a,smartResponse:!0};return Object(_.a)(i)}(c,p,r,t,m),[c,p,r,t,m]);return l.a.createElement(V.a,{reactKeyPrefix:c,title:d.portCall.registerArrival,open:a,onCloseModal:i,maxWidth:"xs",fullWidth:!0,confirmBtnName:d.common.confirm,onConfirm:()=>{const{distanceSailed:e,arrivalDate:t,robDl:a,robDo:r,robFl:n,robFo:l,robFw:i}=p,c=Object(q.a)(o,"port.timezone.timezoneName"),d=Object(x.a)(new Date,c),u={eventLogs:[{eventLogDate:z.a.getLocalDate(null!=t?t:new Date),event:"ARR"}],distanceSailed:e,portCall:{key:o.key},reportDateLocal:z.a.getDateStringWithoutUTC(d),vesselReportType:"ARR",robDl:a,robDo:r,robFl:n,robFo:l,robFw:i};null!==t&&s(u)},disableConfirmBtn:!(()=>{const{arrivalDate:e,robDl:t,robDo:a,robFl:o,robFo:r,robFw:n}=p;let l=[t,a,o,r,n].every(e=>void 0===e||e>=0);return e&&(l=l&&!!e),l})()},l.a.createElement(U.a,{reactKeyPrefix:c+"register-arrival-modal",items:b(),breakpoints:H.e}))})),X=Object(f.b)([O.a.IInternationalization,G.a.Store],$);const Q=l.a.memo((function(e){const{deps:[t],showModal:a,portCall:o,userLocale:r,onClose:i,onConfirm:s,reactKeyPrefix:c}=e,d=t.lang(),[p,u]=Object(n.useState)({berthedDate:W.a.getEventLogDate(o.eventLogs,"BRT"),departureDate:W.a.getEventLogDate(o.eventLogs,"DEP"),robDl:o.dlRobDeparture,robDo:o.doRobDeparture,robFl:o.flRobDeparture,robFo:o.foRobDeparture,robFw:void 0});Object(n.useEffect)(()=>{u({berthedDate:W.a.getEventLogDate(o.eventLogs,"BRT"),departureDate:W.a.getEventLogDate(o.eventLogs,"DEP"),robDl:o.dlRobDeparture,robDo:o.doRobDeparture,robFl:o.flRobDeparture,robFo:o.foRobDeparture,robFw:void 0})},[o,a]);const m=Object(n.useCallback)((e,t)=>{u(Object.assign(Object.assign({},p),{[e]:t}))},[p]),b=Object(n.useCallback)(()=>function(e,t,a,o,r){const n=o.getLanguageFile(),l=t.berthedDate>t.departureDate,i={disableUpdate:!0,fieldOptions:[{dateInputProps:{showTime:!0,error:l,clearable:!1},fieldName:"eventLogDate",formHelperText:l?n.portCall.departureHelperText:void 0,label:n.model.etd,onUpdateOverride:e=>r("departureDate",e),overrideObject:new M.a({eventLogDate:t.departureDate}),overrideType:E.a.eventlog},{fieldName:"robFo",InputProps:{endAdornment:F.a.Weight},label:n.model.foRob,numberInputProps:{validation:[{type:B.a.RANGE,min:0}],maskSettings:N.a.mask1,onChange:e=>r("robFo",e)}},{fieldName:"robDo",InputProps:{endAdornment:F.a.Weight},label:n.model.mgoRob,numberInputProps:{validation:[{type:B.a.RANGE,min:0}],maskSettings:N.a.mask1,onChange:e=>r("robDo",e)}},{fieldName:"robFl",InputProps:{endAdornment:F.a.Weight},label:n.model.lsfoRob,numberInputProps:{validation:[{type:B.a.RANGE,min:0}],maskSettings:N.a.mask1,onChange:e=>r("robFl",e)}},{fieldName:"robDl",InputProps:{endAdornment:F.a.Weight},label:n.model.lsmgoRob,numberInputProps:{validation:[{type:B.a.RANGE,min:0}],maskSettings:N.a.mask1,onChange:e=>r("robDl",e)}},{fieldName:"robFw",InputProps:{endAdornment:F.a.Weight},label:n.model.fwRob,numberInputProps:{validation:[{type:B.a.RANGE,min:0}],maskSettings:N.a.mask1,onChange:e=>r("robFw",e)}}],object:new K.a(Object.assign({},t)),type:E.a.positionreport,userLocale:a,reactKeyPrefix:e,smartResponse:!0};return Object(_.a)(i)}(c,p,r,t,m),[c,p,r,t,m]);return l.a.createElement(V.a,{reactKeyPrefix:c,title:d.portCall.registerDeparture,open:a,onCloseModal:i,maxWidth:"xs",fullWidth:!0,confirmBtnName:d.common.confirm,onConfirm:()=>{const{departureDate:e,robDl:t,robDo:a,robFl:r,robFo:n,robFw:l}=p,i=o.key,c=Object(q.a)(o,"port.timezone.timezoneName"),d=Object(x.a)(new Date,c),u={eventLogs:[{eventLogDate:z.a.getLocalDate(null!=e?e:new Date),event:"DEP"}],portCall:{key:i},reportDateLocal:z.a.getDateStringWithoutUTC(d),vesselReportType:"DEP",robDl:t,robDo:a,robFl:r,robFo:n,robFw:l};e&&s(u)},disableConfirmBtn:!(()=>{const{berthedDate:e,departureDate:t,robDl:a,robDo:o,robFl:r,robFo:n,robFw:l}=p;let i=[a,o,r,n,l].every(e=>void 0===e||e>=0);if(e&&t){const a=e<=t;i=i&&a}return i})()},l.a.createElement(U.a,{reactKeyPrefix:"register-departure-modal",items:b(),breakpoints:H.e}))})),Y=Object(f.b)([O.a.IInternationalization],Q);var J=a(345),Z=a(18);const ee=l.a.memo((function(e){const{deps:[t],showModal:a,portCall:o,userLocale:r,onClose:i,onConfirm:s,reactKeyPrefix:c}=e,d=t.lang(),[p,u]=Object(n.useState)(ae(o)),[m,b]=Object(n.useState)({isHoursInServiceValid:!0,isAverageWindForceValid:!0});Object(n.useEffect)(()=>{u(ae(o))},[a,o]);const v=Object(n.useCallback)((e,t,a)=>{"hoursInService"===e&&void 0!==a?b(Object.assign(Object.assign({},m),{isHoursInServiceValid:a})):"averageWindForce"===e&&void 0!==a&&b(Object.assign(Object.assign({},m),{isAverageWindForceValid:a})),u(Object.assign(Object.assign({},p),{[e]:t}))},[m,p]),g=Object(n.useCallback)(()=>function(e,t,a,o,r){const n=o.getLanguageFile(),l=t.arrivalDate<=t.reportDateLocal,i=l?void 0:n.portCall.dateLaterThanArrival,s=t.estimatedTimeOfBerthing,c=t.estimatedTimeOfDeparture,d=new Date>c,p=s>c;let u=p?n.portCall.etbHelperText:void 0,m=p?n.portCall.etdHelperText:d?n.portCall.futureDate:void 0;const b=t.arrivalDate<=s,v=t.arrivalDate<=c;b||(u=n.portCall.dateLaterThanArrival),v||(m=n.portCall.dateLaterThanArrival);const g=p,y=p||d,f={disableUpdate:!0,fieldOptions:[{dateInputProps:{showTime:!0,clearable:!1,error:!l},fieldName:"eventLogDate",formHelperText:i,label:n.portCall.timeOfReportInPort,onUpdateOverride:e=>r("reportDateLocal",e),overrideObject:new M.a({eventLogDate:t.reportDateLocal}),overrideType:E.a.eventlog},{dateInputProps:{showTime:!0,error:g||!b,clearable:!1},fieldName:"eventLogDate",formHelperText:u,label:n.model.timeOfBerthing,onUpdateOverride:e=>r("estimatedTimeOfBerthing",e),overrideObject:new M.a({eventLogDate:s}),overrideType:E.a.eventlog},{dateInputProps:{showTime:!0,error:y||!v,clearable:!1},fieldName:"eventLogDate",formHelperText:m,label:n.model.etdLong,onUpdateOverride:e=>r("estimatedTimeOfDeparture",e),overrideObject:new M.a({eventLogDate:c}),overrideType:E.a.eventlog},{InputProps:{endAdornment:F.a.HRS},fieldName:"hoursInService",label:n.model.hoursInService,numberInputProps:{validation:[{type:B.a.RANGE,max:25,min:0}],maskSettings:N.a.mask7,onChange:(e,t)=>r("hoursInService",e,t)}},{fieldName:"weather",label:n.positionReport.weather,typeaheadProps:{objectPaths:["weatherDescription"],type:E.a.weather,shouldPreload:!0},onUpdateOverride:e=>r("weather",e)},{fieldName:"windDirection",label:n.ais.windDirection,typeaheadProps:{objectPaths:["directionDesc"],type:E.a.direction,shouldPreload:!0},onUpdateOverride:e=>r("windDirection",e)},{fieldName:"averageWindForce",label:n.model.averageWindForce,numberInputProps:{validation:[{type:B.a.RANGE,max:12,min:0}],maskSettings:N.a.mask3,onChange:(e,t)=>r("averageWindForce",e,t)}}],object:new K.a(Object.assign({},t)),type:E.a.positionreport,userLocale:a,reactKeyPrefix:e};return Object(_.a)(f)}(c,p,r,t,v),[c,p,r,t,v]),y=Object(n.useCallback)(()=>{var e;return function(e,t,a,o,r,n){const l=r.lang();return Object(_.a)({disableUpdate:!0,fieldOptions:[{fieldName:"remark",label:l.model.comments,onUpdateOverride:e=>{n("genericRemark",e)},overrideObject:new Z.a({remark:a}),overrideType:E.a.remark,textInputProps:{multiline:!0}}],object:new K.a(Object.assign({},t)),type:E.a.positionreport,userLocale:o,reactKeyPrefix:e,smartResponse:!0})}(c,new K.a(o),null!==(e=p.genericRemark)&&void 0!==e?e:"",r,t,v)},[c,o,p.genericRemark,r,t,v]),f=Object(n.useCallback)(()=>{const e=[{eventLogDate:p.estimatedTimeOfBerthing?z.a.getLocalDate(p.estimatedTimeOfBerthing):void 0,event:"BRT"},{eventLogDate:p.estimatedTimeOfDeparture?z.a.getLocalDate(p.estimatedTimeOfDeparture):void 0,event:"DEP"}],t=["arrivalDate","estimatedTimeOfDeparture","estimatedTimeOfBerthing"];null===p.genericRemark&&t.push("genericRemark");const a=Object(J.a)(p,t);s(Object.assign(Object.assign({},a),{eventLogs:e}))},[s,p]);return l.a.createElement(V.a,{reactKeyPrefix:c,title:d.portCall.registerInPortReport,open:a,onCloseModal:i,maxWidth:"md",fullWidth:!0,confirmBtnName:d.common.confirm,onConfirm:f,disableConfirmBtn:!oe(m,p)},l.a.createElement(U.a,{reactKeyPrefix:c+"inPortReportModal",items:g(),breakpoints:H.d}),l.a.createElement(U.a,{reactKeyPrefix:c+"inPortReportModalRemark",items:y(),breakpoints:H.e}))})),te=Object(f.b)([O.a.IInternationalization],ee);function ae(e){const t=e.eventLogs?e.eventLogs:[];let a=new Date,o=new Date,r=new Date;for(const e of t)e.event&&("ARR"===e.event.eventCode?a=e.eventLogDate?e.eventLogDate:new Date:"DEP"===e.event.eventCode?o=e.eventLogDate?e.eventLogDate:new Date:"BRT"===e.event.eventCode&&(r=e.eventLogDate?e.eventLogDate:new Date));const n=new Date;return n.setHours(12,0),{arrivalDate:a,estimatedTimeOfBerthing:r,estimatedTimeOfDeparture:o,averageWindForce:void 0,genericRemark:null,hoursInService:0,portCall:e,reportDateLocal:n}}function oe(e,t){let a=e.isAverageWindForceValid&&e.isHoursInServiceValid;const{arrivalDate:o}=t,r=t.estimatedTimeOfBerthing,n=t.estimatedTimeOfDeparture;if(r&&n){const e=r<=n;a=a&&e}if(o){const e=o<=t.reportDateLocal,r=o<=t.estimatedTimeOfBerthing,n=o<=t.estimatedTimeOfDeparture;a=a&&e&&r&&n}return a}var re=a(549);var ne=a(181);const le=l.a.memo((function(e){const{deps:[t,a],showModal:o,portCall:r,userLocale:i,noonReports:s,onClose:c,onConfirm:d,reactKeyPrefix:p}=e,u=t.lang(),{voyage:m}=r,[b,v]=Object(n.useState)(se(r,s)),[g,y]=Object(n.useState)({isAverageWindForceValid:!0,isAverageSeaStateValid:!0});Object(n.useEffect)(()=>{v(se(r,s))},[s,r,a]);const f=Object(n.useCallback)((e,t,a)=>{"averageWindForce"===e&&void 0!==a?y(Object.assign(Object.assign({},g),{isAverageWindForceValid:a})):"averageSeaState"===e&&void 0!==a&&y(Object.assign(Object.assign({},g),{isAverageSeaStateValid:a})),v(Object.assign(Object.assign({},b),{[e]:t}))},[b,v,g,y]),h=Object(n.useCallback)(()=>function(e,t,a,o,r){const n=o.getLanguageFile(),i=t.eta<t.previousDepartureDate,s=i?n.portCall.arrivalHelperText:void 0,c={reactKeyPrefix:e,disableUpdate:!0,fieldOptions:[{dateInputProps:{showTime:!0,clearable:!1},fieldName:"eventLogDate",label:n.portCall.timeOfReportNoon,onUpdateOverride:e=>r("reportDateLocal",e),overrideObject:new M.a({eventLogDate:t.reportDateLocal}),formControlProps:{required:!0},overrideType:E.a.eventlog},{fieldName:"latitude",overrideComponent:l.a.createElement(re.a,{reactKeyPrefix:e+"latitude",isLatitude:!0,key:"noonReportLatitude",onBlur:e=>r("latitude",e),formControlProps:{required:!0}})},{fieldName:"longitude",overrideComponent:l.a.createElement(re.a,{reactKeyPrefix:e+"longitude",isLatitude:!1,key:"noonReportLatitude",onBlur:e=>r("longitude",e),formControlProps:{required:!0}})},{fieldName:"windDirection",typeaheadProps:{shouldPreload:!0},onUpdateOverride:e=>r("windDirection",e)},{fieldName:"averageWindForce",numberInputProps:{validation:[{type:B.a.RANGE,max:12,min:0}],maskSettings:N.a.mask3,onChange:(e,t)=>r("averageWindForce",e,t)}},{fieldName:"seaDirection",typeaheadProps:{shouldPreload:!0},onUpdateOverride:e=>r("seaDirection",e)},{fieldName:"averageSeaState",numberInputProps:{validation:[{type:B.a.RANGE,max:9,min:0}],maskSettings:N.a.mask3,onChange:(e,t)=>r("averageSeaState",e,t)}},{fieldName:"weather",typeaheadProps:{objectPaths:["weatherDescription"],shouldPreload:!0},onUpdateOverride:e=>r("weather",e)},{InputProps:{endAdornment:F.a.NauticalMile},fieldName:"distanceSailed",numberInputProps:{onChange:e=>r("distanceSailed",e)}},{label:n.model.hoursInService,fieldName:"hoursInService",dateInputProps:{showTime:!0,clearable:!1},InputProps:{endAdornment:F.a.HRS},onUpdateOverride:e=>r("hoursInService",e)},{InputProps:{endAdornment:F.a.Knot},fieldName:"speedMadeGood",numberInputProps:{maskSettings:N.a.mask2,onChange:e=>r("speedMadeGood",e)}},{InputProps:{endAdornment:F.a.NauticalMile},fieldName:"distanceToNextPort",numberInputProps:{onChange:e=>r("distanceToNextPort",e)}},{dateInputProps:{showTime:!0,error:i,clearable:!1},fieldName:"eventLogDate",formHelperText:s,label:n.model.etaLong,onUpdateOverride:e=>r("eta",e),overrideObject:new M.a({eventLogDate:t.eta}),overrideType:E.a.eventlog},{InputProps:{endAdornment:F.a.RPM},fieldName:"rpmFromLastPort",label:n.positionReport.mainEngineRPM,numberInputProps:{onChange:e=>r("rpmFromLastPort",e)}},{fieldName:"robFo",label:n.model.foRob,numberInputProps:{validation:[{type:B.a.RANGE,min:0}],maskSettings:N.a.mask1,onChange:e=>r("robFo",e)}},{fieldName:"robDo",label:n.model.mgoRob,numberInputProps:{validation:[{type:B.a.RANGE,min:0}],maskSettings:N.a.mask1,onChange:e=>r("robDo",e)}},{fieldName:"robFl",label:n.model.lsfoRob,numberInputProps:{validation:[{type:B.a.RANGE,min:0}],maskSettings:N.a.mask1,onChange:e=>r("robFl",e)}},{fieldName:"robDl",label:n.model.lsmgoRob,numberInputProps:{validation:[{type:B.a.RANGE,min:0}],maskSettings:N.a.mask1,onChange:e=>r("robDl",e)}},{fieldName:"robFw",label:n.model.fwRob,numberInputProps:{validation:[{type:B.a.RANGE,min:0}],maskSettings:N.a.mask1,onChange:e=>r("robFw",e)}}],object:new K.a(Object.assign({},t)),type:E.a.positionreport,userLocale:a};return Object(_.a)(c)}(p,b,i,t,f),[p,b,i,t,f]),O=Object(n.useCallback)(()=>{var e;return function(e,t,a,o,r,n){const l=r.lang();return Object(_.a)({disableUpdate:!0,fieldOptions:[{fieldName:"remark",label:l.model.comments,onUpdateOverride:e=>{n("genericRemark",e)},overrideObject:new Z.a({remark:a}),overrideType:E.a.remark,textInputProps:{multiline:!0}}],object:new K.a(Object.assign({},t)),type:E.a.positionreport,userLocale:o,reactKeyPrefix:e,smartResponse:!0})}(p,b,null!==(e=b.genericRemark)&&void 0!==e?e:"",i,t,f)},[p,b,i,t,f]),C=Object(n.useMemo)(()=>{const e=Object(q.a)(m,"vessel.vesselName",u.common.na),t=Object(q.a)(m,"voyageHeader.referenceNo",u.common.na);return u.portCall.registerNoonReport+" - "+e+" - "+t},[m,u]);return l.a.createElement(V.a,{reactKeyPrefix:p,title:C,open:o,onCloseModal:c,maxWidth:"md",fullWidth:!0,confirmBtnName:u.common.confirm,onConfirm:()=>{const e=["previousDepartureDate"];null===b.genericRemark&&e.push("genericRemark");const t=Object(J.a)(b,e);d(Object.assign({},t))},disableConfirmBtn:!ce(g,b)},l.a.createElement(U.a,{reactKeyPrefix:"noonReportModal",items:h(),breakpoints:H.d}),l.a.createElement(U.a,{reactKeyPrefix:"noonReportModalRemark",items:O(),breakpoints:H.e}))})),ie=Object(f.b)([O.a.IInternationalization,G.a.ITSModelActionsAsync],le);function se(e,t){var a,o;return{averageSeaState:void 0,averageWindForce:void 0,distanceSailed:void 0,distanceToNextPort:void 0,eta:W.a.getEventLogDate(e.eventLogs,"ARR"),genericRemark:null,hoursInService:null===(a=t[0])||void 0===a?void 0:a.hoursInService,latitude:void 0,longitude:void 0,previousDepartureDate:e.previousPortCall?ne.a.getEventLogDate(e.previousPortCall.eventLogs,"DEP"):void 0,reportDateLocal:null===(o=t[0])||void 0===o?void 0:o.reportDateLocal,robDl:void 0,robDo:void 0,robFl:void 0,robFo:void 0,robFw:void 0,rpmFromLastPort:void 0,seaDirection:void 0,speedMadeGood:void 0,weather:void 0,windDirection:void 0}}function ce(e,t){const{eta:a,robDl:o,robDo:r,robFl:n,robFo:l,robFw:i,latitude:s,longitude:c,previousDepartureDate:d,reportDateLocal:p}=t,u=void 0!==s&&void 0!==c;let m=e.isAverageSeaStateValid&&e.isAverageWindForceValid&&p;if(d&&a){const e=a>d;m=m&&e}return m&&u&&[o,r,n,l,i].every(e=>void 0===e||e>=0)}var de=a(47),pe=a(68),ue=a(32),me=a(1237),be=a(42),ve=a(462),ge=a(209);const ye={xs:6,sm:4,md:4,lg:3,xl:2},fe=({reactKeyPrefix:e,portCall:t})=>{var a,o,r,n,i,s,c,d,p,u,m,b,g,y,h,C;const[P]=Object(f.a)([O.a.IInternationalization]),R=P.getLanguageFile(),{model:D,common:j,vessel:E}=R,k=(null!==(a=Object(T.a)(be.a.getUserLocale))&&void 0!==a?a:v.f[0]).isoCode,S=t.daysAtSea?(t.dlAtSea+t.doAtSea+t.flAtSea+t.foAtSea)/t.daysAtSea:0,L=P.formatNumber(S,{maxDecimals:2,minDecimals:2,locale:k}),w=P.formatNumber(null!==(o=t.daysAtSea)&&void 0!==o?o:0,{maxDecimals:2,minDecimals:2,locale:k}),I=P.formatNumber(null!==(r=t.distance)&&void 0!==r?r:0,{maxDecimals:0,locale:k}),A=P.formatNumber(null!==(n=t.speed)&&void 0!==n?n:0,{maxDecimals:2,minDecimals:2,locale:k}),x=P.formatNumber(null!==(i=t.daysInPort)&&void 0!==i?i:0,{maxDecimals:2,minDecimals:2,locale:k}),N=P.formatNumber(null!==(s=t.portCostCurrency)&&void 0!==s?s:0,{maxDecimals:0,locale:k}),M=P.formatNumber(null!==(d=null===(c=t.voyage)||void 0===c?void 0:c.tcResultDay)&&void 0!==d?d:0,{maxDecimals:0,locale:k}),K=null!==(m=null===(u=null===(p=t.voyage)||void 0===p?void 0:p.voyageCurrency)||void 0===u?void 0:u.currencyCode)&&void 0!==m?m:"",_=P.formatNumber(null!==(g=null===(b=t.voyage)||void 0===b?void 0:b.tcResult)&&void 0!==g?g:0,{maxDecimals:0,locale:k}),B=P.formatNumber(null!==(y=t.euEtsEmissions)&&void 0!==y?y:0,{maxDecimals:2,minDecimals:2,locale:k}),U=[{primaryTitle:{text:D.tce},primaryText:{text:`${M} ${K}`,tooltip:D.tcEquivalent},secondaryTitle:{text:D.contrib},secondaryText:{text:`${_} ${K}`,tooltip:D.totalContribution}},{primaryTitle:{text:j.atSea},primaryText:{text:`${w} ${j.daysLowercase}`,tooltip:D.daysAtSea},secondaryTitle:{text:D.estDistance},secondaryText:{text:`${I} ${F.a.NauticalMile}`,tooltip:D.estimatedDistance}},{primaryTitle:{text:j.averageSpeed},primaryText:{text:`${A} ${F.a.Knot}`,tooltip:D.speed},secondaryTitle:{text:j.averageCons},secondaryText:{text:`${L} ${F.a.Weight}`,tooltip:E.consumption}},{primaryTitle:{text:j.inPort},primaryText:{text:`${x}  ${j.daysLowercase}`,tooltip:D.daysInPort},secondaryTitle:{text:j.euetsEmissions},secondaryText:{text:`${B} ${F.a.Weight}`,tooltip:D.totalEmissions}},{primaryTitle:{text:D.portCost},primaryText:{text:`${N}  ${null!==(C=null===(h=t.currency)||void 0===h?void 0:h.currencyCode)&&void 0!==C?C:F.a.Currency}`,tooltip:D.portCost}}];return l.a.createElement(ge.a,{data:U,reactKeyPrefix:e+"tile-group",breakpoints:ye,sx:{flexBasis:{md:100/U.length+"%"},maxWidth:{md:100/U.length+"%"}}})};var he=a(130),Oe=a(213),Ce=a(187),Pe=a(180),Re=a(38),De=a(1627),je=a(1330),Ee=a(96),Te=a(86),ke=a(95),Se=a(1309),Le=a(57),we=a(92);const Ie={portCalls:{availableForCargo:"*",arrivalFixed:"*",berthedFixed:"*",daysInPort:"*",departureFixed:"*",bunkerReduction:"*",daysAtSea:"*",daysExtraAtSea:"*",dlAtSea:"*",dlRobArrival:"*",dlRobDeparture:"*",euEtsEmissions:"*",eventLogs:{eventLogDate:"*",event:{eventCode:"*"}},foAtSea:"*",foRobArrival:"*",foRobDeparture:"*",ownedByVoyage:{ballastConsumption:"*",co2Ballast:"*",daysBallast:"*",daysTotal:"*",daysTotalAtSea:"*",dlConsumption:"*",euEtsEmissions:"*",foConsumption:"*",ladenEuEtsEmission:"*",milesBallast:"*",milesLoaded:"*",tcResultDay:"*",tcHireNet:"*",percentExtraAtSea:"*",partOfSchedule:{eventLogs:{eventLogDate:"*",event:{eventCode:"*"}}},voyageHeader:{dlRobVoyageStart:"*",foRobVoyageStart:"*",voyageEndDate:"*"}},portCallRoutes:{days:"*",seaMargin:"*"},speed:"*"}},Ae=(e,t)=>e&&t&&(Object(Se.a)(e,t)||z.a.isSameDateAndTime(e,t)),xe=(e,t,a)=>l.a.createElement(Le.b,{reactKeyPrefix:e+"waiting",label:a,value:t,disabled:!0,InputProps:{endAdornment:"d"},inputProps:{style:{textAlign:"right"}},key:"textInput_disabled_"+a}),Ne=(e,t)=>{var a;return null!==(a=Object(je.a)(null==t?void 0:t.eventLogs,t=>{var a;return(null===(a=t.event)||void 0===a?void 0:a.eventCode)===e}))&&void 0!==a?a:new M.a({})};function Fe(e,t,a,o,r,n,l){var i,s,c,d,u,m;const{common:b,model:v}=r.getLanguageFile(),{arrivalFixed:g,berthedFixed:y,departureFixed:f,previousPortCall:h,voyage:O}=t,C=Object(q.a)(t,"reasonForCall.reasonForCallDesc",""),D=!Object(P.c)([ke.a.VESSEL],o),j=W.a.getEventLogDateFromPC(t,"ARR"),T=W.a.getEventLogDateFromPC(t,"BRT"),k=null!==(s=null===(i=null==O?void 0:O.voyageHeader)||void 0===i?void 0:i.voyageStartDate)&&void 0!==s?s:null,S=Object(De.a)(null!=T?T:0,null!=j?j:0)/60/24-t.daysExtraInPort,w=r.formatNumber(S>0?S:0,{minDecimals:2,maxDecimals:2,locale:a.isoCode}),I={ARR:Ne("ARR",t),BRT:Ne("BRT",t),DEP:Ne("DEP",t)},A={ARR:[k,null!==(c=Ne("DEP",h).eventLogDate)&&void 0!==c?c:new Date(0)],BRT:[j],DEP:[T]},x=(e,t)=>{A[t].every(Ae.bind(null,e))?((e,t)=>{we.a.getUpdateFieldFunction({fieldToSet:"eventLogDate",fields:Ie,key:e,type:E.a.eventlog})(t)})(I[t].key,e):l()},F=["L","D"].includes(null===(d=t.reasonForCall)||void 0===d?void 0:d.reasonForCall)?[{fieldName:"laytimeUsed",label:""+C,disabled:!0,numberInputProps:{maskSettings:N.a.mask2},InputProps:{endAdornment:"d"}}]:[],M={reactKeyPrefix:e,fieldOptions:[{fieldName:"eventLogDate",label:v.arrival,breakpoints:H.i,overrideObject:I.ARR,overrideType:E.a.eventlog,onUpdateOverride:e=>x(e,"ARR"),dateInputProps:{showTime:!0,showShortDate:!0,fullWidth:!1},secondaryFieldOption:{fieldName:"arrivalFixed",label:b.fixed,formControlLabelProps:{classes:n,labelPlacement:"top",checked:g}}},{fieldName:"agent",label:v.agent,breakpoints:H.i,typeaheadProps:{shouldPreload:!0,objectPaths:Te.b.businessPartner,query:Ee.a},openObject:{permissions:[R.a.BusinessPartnerGET],onOpen:L.a.openDrawer.bind(null,null!==(m=null===(u=t.agent)||void 0===u?void 0:u.key)&&void 0!==m?m:-1,p.a.businessPartnerDrawer)}},{fieldName:"eventLogDate",label:v.berthed,breakpoints:H.i,overrideObject:I.BRT,overrideType:E.a.eventlog,onUpdateOverride:e=>x(e,"BRT"),dateInputProps:{showTime:!0,showShortDate:!0},secondaryFieldOption:{fieldName:"berthedFixed",label:b.fixed,formControlLabelProps:{classes:n,labelPlacement:"top",checked:y}}},{fieldName:"eventLogDate",label:v.departure,breakpoints:H.i,overrideObject:I.DEP,overrideType:E.a.eventlog,onUpdateOverride:e=>x(e,"DEP"),dateInputProps:{showTime:!0,showShortDate:!0},secondaryFieldOption:{fieldName:"departureFixed",label:b.fixed,formControlLabelProps:{classes:n,labelPlacement:"top",checked:f}}},{overrideComponent:xe(e,w,b.waiting)},{fieldName:"daysExtraInPort",label:b.extra,disabled:t.berthedFixed||t.departureFixed,numberInputProps:{maskSettings:N.a.mask2},InputProps:{endAdornment:"d"}},...F,{fieldName:"daysInPort",label:b.total,disabled:!0,breakpoints:F.length?H.f:H.i,numberInputProps:{maskSettings:N.a.mask2},InputProps:{endAdornment:"d"}},{fieldName:"portCostCurrency",label:v.portCost,disabled:!D||t.isPcFixed,numberInputProps:{maskSettings:N.a.mask2}},{fieldName:"currency",label:v.currency,typeaheadProps:{objectPaths:["currencyCode"],shouldPreload:!0}},{fieldName:"isPcFixed",label:b.useCostFromServiceOrders,breakpoints:H.h,disabled:!D},{fieldName:"master",label:b.master,breakpoints:H.h},{fieldName:"portCaptain",label:v.portCaptain,breakpoints:H.h}],userLocale:a,object:t,type:E.a.portcall,smartResponse:!0};return Object(_.a)(M)}var Me=a(245);const Ke=Object(Oe.a)(e=>Object(Ce.a)({container:{backgroundColor:Object(Me.a)(e.palette.primary.main,.05),borderRadius:"10px",padding:e.spacing(2)},containerBunkersTable:{width:"100%"},containerTitle:{flexDirection:"column"},divider:{marginBottom:e.spacing(3),marginTop:e.spacing(3)},portCallButton:{paddingLeft:e.spacing(1)},prevPortButton:{cursor:"pointer",paddingRight:e.spacing(1)},seaPassageArrow:{verticalAlign:"middle"},table:{paddingTop:"20px"},title:{display:"flex",justifyContent:"space-between",paddingBottom:"20px",width:"100%"},titleChip:{marginLeft:"auto"}})),_e=Object(Oe.a)(e=>Object(Ce.a)({label:{fontSize:".786rem",color:Re.b.bergenRain.secondary[7]},labelPlacementTop:{marginLeft:0,marginRight:0,transform:"translate(0, -1.5px)"}})),Be=Object(Oe.a)(e=>Object(Ce.a)({title:{display:"flex",justifyContent:"space-between",width:"100%",margin:"1px"}}));function Ue(e){const[t]=Object(f.a)([O.a.IInternationalization]),a=_e({}),{portCall:o,reactKeyPrefix:r,user:i,userLocale:s,callback:c}=e,d=Be({}),{model:p}=t.getLanguageFile(),u=Ke({}),m=Object(q.a)(o,"port.portName",""),v=Object(q.a)(o,"reasonForCall.reasonForCallDesc",""),g=Object(q.a)(o,"terminal.terminalName"),y=g?"- "+g:"",h=Object(n.useMemo)(()=>Fe(r,o,s,i,t,a,c),[c,a,t,o,r,i,s]),C=l.a.createElement("div",{className:d.title},l.a.createElement("div",{className:u.containerTitle},l.a.createElement(he.a,{variant:"subtitle1"},p.port.toUpperCase()),l.a.createElement(he.a,{variant:"h4"},m," ",y))),P=l.a.createElement(b.a,{className:a.titleChip,label:v,priority:b.c.NoPriority});return o?l.a.createElement(Pe.a,{title:C,headerElements:P,reactKeyPrefix:r+"-main-details-section",headerElementsPosition:"right"},l.a.createElement(U.a,{reactKeyPrefix:r+"main-details-colspec",key:"port_call_main_details_horizontal_list_fields",items:h,breakpoints:H.f})):null}var He=a(71),Ve=(a(163),a(51)),We=a(250),Ge=a.n(We);const ze={maxDecimals:3,minDecimals:3};var qe;!function(e){e.DOLS="DO LS",e.DO="DO",e.FOLS="FO LS",e.FO="FO"}(qe||(qe={}));const $e=e=>Object.keys(qe).indexOf(e);var Xe=a(323),Qe=a(1325),Ye=a(123);const Je={rob:{display:"flex",alignItems:"center",flexDirection:"row",justifyContent:"end"}};function Ze(e){const[t]=Object(f.a)([O.a.IInternationalization]),{model:a,common:o}=t.getLanguageFile(),{reactKeyPrefix:r,portCall:i,userLocale:s}=e,[c,d]=Object(n.useState)(!1),[p,u]=Object(n.useState)(-1),[m,b]=Object(n.useState)(null!=i?i:new pe.a({})),h=Object(n.useMemo)(()=>(e=>{const{model:t}=e.getLanguageFile(),a=ze;return[{content:"",contentType:g.a.TEXT},{content:t.consumptionAtSea,contentType:g.a.NUMBER,numberFormatOptions:a},{content:t.arrivalRob,contentType:g.a.ELEMENT,numberFormatOptions:a},{content:t.bunkered,contentType:g.a.NUMBER,numberFormatOptions:a},{content:t.unitPrice,contentType:g.a.NUMBER,numberFormatOptions:{minDecimals:2,maxDecimals:2}},{content:t.bunkeredDate,contentType:g.a.DATE,dateTimeFormatOptions:v.a.shortLocalizedDate},{content:t.consumptionInPort,contentType:g.a.NUMBER,numberFormatOptions:a},{content:t.departureRob,contentType:g.a.ELEMENT,numberFormatOptions:a},{content:"",contentType:g.a.ELEMENT}]})(t),[t]),C=Object(n.useMemo)(()=>((e,t,a)=>{const{model:o}=e.getLanguageFile(),r={fo:o.fo,do:o.mgo,fl:o.lsfo,dl:o.lsmgo},n=e=>{const o=Object(q.a)(t,e+"RobArrival"),n=Object(q.a)(t,e+"RobArrivalFixed"),i=Object(q.a)(t,e+"RobDeparture"),s=Object(q.a)(t,e+"RobDepartureFixed");return[r[e],Object(q.a)(t,e+"AtSea"),{rawValue:o,content:a(o,n)},Object(q.a)(t,e+"Bunkered"),Object(q.a)(t,e+"BunkerPrice"),Object(q.a)(t,e+"BunkeredDate"),Object(q.a)(t,e+"InPort"),{rawValue:i,content:a(i,s)},{content:l.a.createElement(Ge.a,{key:"bunker-type-edit-icon-"+e}),rawValue:null}]};return[{content:n("fo"),id:Object.keys(qe).indexOf("FO")},{content:n("do"),id:Object.keys(qe).indexOf("DO")},{content:n("fl"),id:Object.keys(qe).indexOf("FOLS")},{content:n("dl"),id:Object.keys(qe).indexOf("DOLS")}]})(t,i,(e,t)=>l.a.createElement(Xe.a,{sx:Je.rob},l.a.createElement(he.a,{display:"inline",variant:"subtitle2",color:"textSecondary"},Ye.a.formatNumberLocalized(e,s.isoCode,{maxDecimals:3,minDecimals:3})),l.a.createElement(Qe.a,{sx:{p:e=>e.spacing(0,.5)},checked:t,color:"primary",disabled:!0}))),[t,i,s.isoCode]),P=Object(n.useCallback)(()=>{d(e=>!e)},[]),R=Object(n.useCallback)(e=>{i&&(b(i),u(Number(e)),P())},[i,P]),D=Object(n.useCallback)(()=>{b(i||new pe.a({})),u(-1),P()},[P,i]),j={reactKeyPrefix:r+"edit-port-call-bunkers-modal",open:c,title:o.editBunkers,onCloseModal:D},T=Object(n.useCallback)((e,t)=>{e.includes("Fixed")?b(Object.assign(Object.assign({},m),{[e.replace("Fixed","")]:Object(q.a)(i,e.replace("Fixed",""),void 0),[e]:t})):b(Object.assign(Object.assign({},m),{[e]:t}))},[i,m]),S=Object(n.useCallback)(e=>{b(Object.assign(Object.assign({},m),{[e+"Fixed"]:!0}))},[m]),L=Object(n.useCallback)(()=>m&&p>-1?((e,t,a,o,r,n,l)=>{const{common:i,model:s}=r.getLanguageFile();let c="";switch(t){case $e("DOLS"):c="dl";break;case $e("DO"):c="do";break;case $e("FOLS"):c="fl";break;case $e("FO"):c="fo"}const d={object:e,fieldOptions:[{breakpoints:H.h,fieldName:c+"RobArrival",label:s.arrivalRob,numberInputProps:{maskSettings:N.a.mask1,validation:[{type:B.a.RANGE,min:0}],onChange:e=>l(c+"RobArrival",e)},InputProps:{endAdornment:i.mt},onUpdateOverride:e=>{n(c+"RobArrival",e)},secondaryFieldOption:{fieldName:c+"RobArrivalFixed",label:i.fixed,formControlLabelProps:{labelPlacement:"top"},onUpdateOverride:e=>{n(c+"RobArrivalFixed",e)}}},{breakpoints:H.h,fieldName:c+"RobDeparture",label:s.departureRob,numberInputProps:{maskSettings:N.a.mask1,validation:[{type:B.a.RANGE,min:0}],onChange:e=>l(c+"RobDeparture",e)},onUpdateOverride:e=>{n(c+"RobDeparture",e)},secondaryFieldOption:{fieldName:c+"RobDepartureFixed",label:i.fixed,formControlLabelProps:{labelPlacement:"top"},onUpdateOverride:e=>{n(c+"RobDepartureFixed",e)}}}],type:E.a.portcall,userLocale:a,reactKeyPrefix:o};return Object(_.a)(d)})(m,p,s,r,t,T,S):[],[m,p,s,r,t,T,S]),w={objToUpdate:i,type:E.a.portcall,fields:k.c},A=Object(n.useCallback)(()=>((e,t)=>{let a=Object.keys(qe)[t]?Object.keys(qe)[t].toLowerCase():"";"fols"===a?a="fl":"dols"===a&&(a="dl");const o=Object(q.a)(e,a+"RobArrivalFixed",void 0),r=Object(q.a)(e,a+"RobDepartureFixed",void 0);return{[a+"RobArrival"]:o?Object(q.a)(e,a+"RobArrival",void 0):void 0,[a+"RobArrivalFixed"]:o,[a+"RobDeparture"]:r?Object(q.a)(e,a+"RobDeparture",void 0):void 0,[a+"RobDepartureFixed"]:r}})(m,p),[p,m]),x=l.a.createElement(he.a,{variant:"h4"},a.bunkers);return i?l.a.createElement(Pe.a,{title:x,reactKeyPrefix:r+"-bunkers-table-section"},l.a.createElement(y.a,{defaultComparator:Object(I.e)(),data:C,headers:h,userLocale:s,onRowClick:R,reactKeyPrefix:r+"portCallDrawerBunkersTable",hideToolbar:!0,customisation:{responsive:!1,disableSorting:!0}}),l.a.createElement(Ve.a,{modalProps:j,getColSpec:L,overrideGetData:A,updateProps:w})):null}var et=a(214);a(118);function tt(e,t,a,o){const[r]=Object(f.a)([O.a.IInternationalization]),{model:n,vessel:l}=r.getLanguageFile(),i=Object(q.a)(t,"voyage.vessel.speeds",[]),s=Object(q.a)(t,"voyage.speeds",[]),c=i.concat(s);let d=[],p=[];c&&(d=c.filter(e=>t.isBallast===e.isBallast).sort((function(e,t){return e.speed-t.speed})),p=c.filter(e=>!t.isBallast===e.isLoaded).sort((function(e,t){return e.speed-t.speed})));const u=(e,t)=>{o(e,t)};return Object(_.a)({fieldOptions:[{fieldName:"speedRef",label:n.speedOrder,typeaheadProps:{defaultSelectedOptions:t.speedRef,options:(d.length>0||p.length>0)&&t.isBallast?d:p,resolver:e=>e.speed+" "+F.a.Knot+", "+e.foConsumption+" "+F.a.Weight,noOptionsMessage:()=>l.noSpeedOption}},{disabled:!0,fieldName:"speed",InputProps:{endAdornment:F.a.Knot},numberInputProps:{maskSettings:N.a.mask2}},{disabled:!0,fieldName:"distance",InputProps:{endAdornment:F.a.NauticalMile},numberInputProps:{maskSettings:N.a.mask2}},{fieldName:"distanceActual",InputProps:{endAdornment:F.a.NauticalMile},numberInputProps:{maskSettings:N.a.mask2}},{fieldName:"percentExtraAtSea",disabled:t.arrivalFixed||0===t.distance,numberInputProps:{maskSettings:N.a.mask2},InputProps:{endAdornment:"%"},onUpdateOverride:u.bind(null,"percentExtraAtSea")},{fieldName:"daysExtraAtSea",disabled:t.arrivalFixed||0===t.distance,numberInputProps:{maskSettings:N.a.mask2},onUpdateOverride:u.bind(null,"daysExtraAtSea")}],object:t,parentData:{key:t.key,type:E.a.portcall},type:E.a.portcall,userLocale:a,reactKeyPrefix:e,smartResponse:!0})}var at=a(218),ot=a(258),rt=a.n(ot);function nt(e){var t,a,o,r;const{portCall:i,userLocale:s,reactKeyPrefix:c}=e,[d]=Object(f.a)([D.a.IPortCallDrawerController]),[p]=Object(f.a)([O.a.IInternationalization]),{model:u}=p.getLanguageFile(),m=Ke({}),v=Object(q.a)(i,"port.portName"),g=Object(n.useCallback)((e,t)=>{d.updatePortCall(i,e,t)},[d,i]),y=Object(n.useCallback)(()=>{i.previousPortCall&&e.onClickPrevPortCall(i.previousPortCall.key)},[i.previousPortCall,e]),h=1===i.portCallSequence?null===(a=null===(t=i.voyage)||void 0===t?void 0:t.ballastPort)||void 0===a?void 0:a.portName:null===(r=null===(o=i.previousPortCall)||void 0===o?void 0:o.port)||void 0===r?void 0:r.portName,C=Object(n.useMemo)(()=>h?l.a.createElement(l.a.Fragment,null,l.a.createElement(at.a,{title:1!==i.portCallSequence?u.openPreviousPortCall:""},l.a.createElement(he.a,{variant:"h4",onClick:y,display:"inline",className:m.prevPortButton},h)),l.a.createElement(rt.a,{className:m.seaPassageArrow})):"",[m.prevPortButton,m.seaPassageArrow,u.openPreviousPortCall,y,i.portCallSequence,h]),P=l.a.createElement("div",null,l.a.createElement(he.a,{variant:"subtitle1"},u.seaPassage.toUpperCase()),l.a.createElement(Xe.a,{display:"flex"},h&&C,v&&l.a.createElement(he.a,{variant:"h4",display:"inline",className:m.portCallButton},v))),R=l.a.createElement(b.a,{className:m.titleChip,label:i.isBallast?u.ballast:u.laden,labelColour:i.isBallast?b.b.DarkYellow:b.b.Green,key:"seaPassageChip"});return i?l.a.createElement(Pe.a,{title:P,reactKeyPrefix:c+"-sea-passage-section",headerElements:R,headerElementsPosition:"right",marginBottom:!0},l.a.createElement(U.a,{breakpoints:H.h,items:tt(c,i,s,g),reactKeyPrefix:"portcall-at-sea"})):l.a.createElement(l.a.Fragment,null)}var lt=a(852);const it=({reactKeyPrefix:e,i:t,portCall:a,userLocale:o,user:r,restrictedAreas:i})=>{var c,d,u,m;const b=Object(s.g)(),v=Object(s.h)(),{common:g,alerts:y}=t.getLanguageFile(),f=Object(n.useMemo)(()=>function(e,t,a,o){return Object(_.a)({fieldOptions:[{fieldName:"comments",label:o.lang().model.comment}],object:t,type:E.a.portcall,userLocale:a,reactKeyPrefix:e,smartResponse:!0})}(e,a,o,t),[t,a,e,o]),[h,O]=Object(n.useState)(!1),C=Object(n.useCallback)(()=>{O(e=>!e)},[]),P=Object(n.useCallback)(()=>{C()},[C]),R={latitude:null!==(d=null===(c=a.port)||void 0===c?void 0:c.latitude)&&void 0!==d?d:50,longitude:null!==(m=null===(u=a.port)||void 0===u?void 0:u.longitude)&&void 0!==m?m:-50};return l.a.createElement(l.a.Fragment,null,l.a.createElement(fe,{reactKeyPrefix:e,portCall:a}),l.a.createElement(et.a,{container:!0,spacing:2},l.a.createElement(et.a,{item:!0,xs:12},l.a.createElement(Ze,{reactKeyPrefix:e+"bunkers-table",portCall:a,userLocale:o,key:"portCallDrawerBunkersTable"})),l.a.createElement(et.a,{item:!0,sm:6,xs:12},l.a.createElement(nt,{reactKeyPrefix:e+"sea-passage",portCall:a,userLocale:o,onClickPrevPortCall:e=>{L.a.openDrawer(e,p.a.portCallDrawer,v,b)}}),a.voyage&&l.a.createElement(lt.a,{voyage:a.voyage,enableZoom:!0,hideMapControls:!0,mapId:"portCall_map",worldCopyJump:!0,reactKeyPrefix:e+"-map",restrictedAreas:i,startingPosition:R,userLocale:o})),l.a.createElement(et.a,{item:!0,sm:6,xs:12},l.a.createElement(Ue,{reactKeyPrefix:e+"main-details",portCall:a,userLocale:o,user:r,callback:P}),l.a.createElement(He.a,{marginTop:!0},l.a.createElement(U.a,{reactKeyPrefix:e+"comments-colspec",key:"port_call_main_details_horizontal_list_comments",items:f,breakpoints:H.e})))),h&&l.a.createElement(V.a,{reactKeyPrefix:e+"date-warning-modal",open:h,title:g.invalidDates,onCloseModal:C,hideConfirmBtn:!0,cancelBtnName:g.close},y.invalidDate))},st=l.a.memo(it);a(59);var ct=a(215),dt=a(1329),pt=a(75);function ut(e,t,a){var o,r,n,l,i,s,c,d,p;const u=null!==(n=null===(r=null===(o=a.cargo)||void 0===o?void 0:o.charterer)||void 0===r?void 0:r.businessPartnerName)&&void 0!==n?n:null,m=Ye.a.formatNumber(a.cargoQuantity,{locale:t.isoCode}),b=m&&(null===(l=a.cargo)||void 0===l?void 0:l.cargoMeasurement)?`${m} ${a.cargo.cargoMeasurement.measurementCode}`:m,v=null!==(c=null===(s=null===(i=a.cargo)||void 0===i?void 0:i.commodity)||void 0===s?void 0:s.commodityDesc)&&void 0!==c?c:null,g=null!==(p=null===(d=a.terminal)||void 0===d?void 0:d.terminalName)&&void 0!==p?p:null;return[{label:e.lang().model.charterer,value:u},{label:e.lang().model.quantity,value:b},{label:e.lang().model.commodity,value:v},{label:e.lang().model.terminal,value:g}]}var mt=a(2485),bt=a(325),vt=a(168),gt=a(89),yt=(a(93),a(466));function ft(e,t,a,o,r,{reasonForStoppageType:n,disabled:l}){const i=r.getLanguageFile(),s={disableUpdate:!0,fieldOptions:[{fieldName:"notToCountStartDate",label:i.common.fromDate,onUpdateOverride:a.bind(null,"notToCountStartDate"),dateInputProps:{error:Object(yt.a)(t),showTime:!0,required:!0},formHelperText:Object(yt.a)(t)?r.lang().validation.notValidDateRange:void 0,formControlProps:{required:!0},disabled:l},{fieldName:"notToCountEndDate",label:i.common.toDate,onUpdateOverride:a.bind(null,"notToCountEndDate"),dateInputProps:{error:Object(yt.a)(t),showTime:!0},formHelperText:Object(yt.a)(t)?r.lang().validation.notValidDateRange:void 0,formControlProps:{required:!0},disabled:l},{fieldName:"reasonForStoppage",label:i.model.reasonForStoppage,formControlProps:{required:!0},typeaheadProps:{shouldPreload:!0,query:"filter=reasonForStoppageType(EQ)"+n},disabled:l,onUpdateOverride:a.bind(null,"reasonForStoppage")},{fieldName:"reasonForDelay",label:i.common.description,onUpdateOverride:a.bind(null,"reasonForDelay"),InputProps:{maxRows:4,multiline:!0},disabled:l}],object:new bt.a(t),type:E.a.nottocount,userLocale:o,reactKeyPrefix:e,smartResponse:!0};return Object(_.a)(s)}const ht={getHeaders:function(e){const{common:t,model:a}=e.lang();return[{content:t.fromDate,contentType:g.a.TEXT},{content:t.toDate,contentType:g.a.TEXT},{content:t.description,contentType:g.a.TEXT},{content:a.totalTime,contentType:g.a.TEXT}]},getRow:function(e,t,a){var o,r,n,l;const i=e.minutesNotToCount*e.percentToCount/100,s=null!==(o=e.reasonForDelay)&&void 0!==o?o:null===(r=e.reasonForStoppage)||void 0===r?void 0:r.reasonForStoppageDesc,c=!!a&&Object(je.a)(a,{notToCounts:[{key:e.key}]});return{content:[z.a.formatDayOfWeekDateTime(e.notToCountStartDate,t),z.a.formatDayOfWeekDateTime(e.notToCountEndDate,t),c?`${s} (${null===(l=null===(n=c.cargo)||void 0===n?void 0:n.commodity)||void 0===l?void 0:l.commodityDesc})`:""+s,z.a.formatMinutesDuration(i)],id:e.key}}};function Ot({userLocale:e,i:t,cargoPorts:a,notToCounts:o,reactKeyPrefix:r,portCallKey:i,disabled:s=!1}){const[c]=Object(f.a)([G.a.ITSModelActionsAsync]),[d,p]=Object(n.useState)(),[u,b]=Object(n.useState)(),[v,g]=Object(n.useState)(),[h,O]=Object(n.useState)(!1),C=t.getLanguageFile(),P=Object(n.useCallback)(()=>{O(!1),b(void 0),p(void 0)},[]),R=Object(n.useCallback)(()=>{1===a.length&&b(a[0]),O(!0)},[a]),D=Object(n.useCallback)(e=>{var t;const r=Object(je.a)(a,{notToCounts:[{key:e}]}),n=Object(je.a)(null!==(t=null==r?void 0:r.notToCounts)&&void 0!==t?t:o,{key:e});p(n),b(r),R()},[a,o,R]),j=Object(n.useMemo)(()=>[{disabled:s,icon:m.a,iconButtonProps:{color:"primary","aria-label":C.portCall.addStoppage},label:C.portCall.addStoppage,onClick:()=>{R()},reactKeyPrefix:r+"-primary-actions"}],[s,C.portCall.addStoppage,R,r]),T=Object(n.useCallback)(()=>{u&&c.loadSingleAction({key:u.key,fields:{notToCounts:k.b.notToCounts},type:E.a.cargoport})},[u,c]),L=Object(n.useCallback)(()=>{i&&c.loadMultipleAction({query:"filter=portCall(EQ)"+i,identifier:S.c,fields:k.d,type:E.a.nottocount})},[i,c]),w={type:E.a.nottocount,callback:(e,t)=>{i?L():T(),t&&g(t.key)}},I={type:E.a.nottocount,callback:()=>{P()},smartResponse:!0},A=Object(n.useMemo)(()=>ht.getHeaders(t),[t]),x=Object(n.useMemo)(()=>{var t;return Object(dt.a)(null!==(t=null!=o?o:Object(mt.a)(a,"notToCounts"))&&void 0!==t?t:[],"notToCountStartDate").map(t=>ht.getRow(t,e,a))},[a,o,e]),N=Object(n.useMemo)(()=>d?C.portCall.editStoppage:C.portCall.addStoppage,[C.portCall.addStoppage,C.portCall.editStoppage,d]);return l.a.createElement(l.a.Fragment,null,l.a.createElement(y.a,{customisation:{disableSorting:!0},data:x,headers:A,reactKeyPrefix:r+"-port-log-stoppages-table",title:o?void 0:C.common.stoppages,userLocale:e,onRowClick:D,primaryActions:j,preSelectedRow:v}),l.a.createElement(Ve.a,{allowDelete:!!d&&!s,breakpoints:H.h,enableCopy:!1,getColSpec:ft,isConfirmDisabled:({notToCountEndDate:e,notToCountStartDate:t,reasonForStoppage:a})=>!t||!e||!a||s,propertiesToSet:{percentToCount:100},selectedObject:d,overrideGetData:e=>{const t=Object(gt.a)(new bt.a(e));return e.cargoPort||e.portCall?t:o&&i?Object(vt.f)(t,["source","portCall"],i):u?Object(vt.f)(t,["source","cargoPort"],u.key):void 0},contextData:{reasonForStoppageType:o?"PC":"CP",disabled:s},modalProps:{reactKeyPrefix:r+"-port-log-stoppages-create-edit-modal",title:N,open:h,confirmBtnName:d?C.common.save:C.common.add,onCloseModal:P,onDelete:()=>{o?L():T(),P()}},createProps:d?void 0:w,updateProps:d?I:void 0}))}var Ct=a(2379),Pt=a(2380),Rt=a(2530),Dt=a(272),jt=a.n(Dt);const Et=({reactKeyPrefix:e,summary:t,children:a,breakpoints:o})=>l.a.createElement(Ct.a,{sx:{mb:2},id:e+"-expansion-panel"},l.a.createElement(Pt.a,{expandIcon:l.a.createElement(jt.a,null),"aria-controls":"panel1a-content",id:"panel1a-header"},l.a.createElement(U.a,{reactKeyPrefix:e+"expansion-panel-item",items:t,breakpoints:o})),l.a.createElement(Rt.a,null,a)),Tt={xs:6,sm:4,md:4,lg:2,xl:2},kt=({reactKeyPrefix:e,notToCounts:t,userLocale:a,portCallKey:o,cargoPorts:r})=>{const[n]=Object(f.a)([O.a.IInternationalization]);return l.a.createElement("div",null,r.length>0&&l.a.createElement(pt.a,{title:""+n.lang().model.cargoPortStoppages,key:"-port-call-cargo-ports"}),Object(dt.a)(r,"terminal.terminalName").map(t=>l.a.createElement(Et,{key:t.key,reactKeyPrefix:`${e}-car\n                    go-port-list-item-${t.key}`,summary:ut(n,a,t),breakpoints:Tt},l.a.createElement(Ot,{reactKeyPrefix:e+"-port-log-cargo-port-time-sheet",cargoPorts:[t],i:n,userLocale:a,disabled:!!t.laytimeCalculation}))),l.a.createElement(pt.a,{title:""+n.lang().model.portCallStoppages,key:e+"-port-call-time-sheet",sx:{mt:4}}),l.a.createElement(Ot,{reactKeyPrefix:e+"-port-log-port-call-time-sheet",cargoPorts:r,notToCounts:t,i:n,userLocale:a,portCallKey:o}))},St=Object(Oe.a)(e=>Object(Ce.a)({nonClickCell:{borderRight:"1px solid "+e.palette.grey[300]},cell:{borderRight:"1px solid "+e.palette.grey[300],"&:not(:first-child):hover":{backgroundColor:e.palette.grey[100],cursor:"pointer"}}}));var Lt=function(e,t,a,o){return new(a||(a=Promise))((function(r,n){function l(e){try{s(o.next(e))}catch(e){n(e)}}function i(e){try{s(o.throw(e))}catch(e){n(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(l,i)}s((o=o.apply(e,t||[])).next())}))};const wt=({userLocale:e,portCall:t,reactKeyPrefix:a})=>{const[o,r]=Object(n.useState)(!1),[i,s]=Object(n.useState)(),[c,d]=Object(n.useState)(),[p,u]=Object(n.useState)(),[m,b]=Object(n.useState)([]),[v,h]=Object(n.useState)(""),C=Object(n.useRef)(!1),[P,R]=Object(n.useState)(null),L=St({}),[w,I]=Object(f.a)([O.a.IInternationalization,D.a.IPortCallDrawerController]),A=Object(n.useCallback)(({eventCode:e,eventLog:a,cargoPortKey:o})=>{var n;u(t.cargoPorts.find(e=>e.key===o)),s(a),R(null!==(n=null==a?void 0:a.eventLogDate)&&void 0!==n?n:new Date),h(e),d(o),r(!0)},[null==t?void 0:t.cargoPorts]),x=Object(n.useCallback)(e=>Lt(void 0,void 0,void 0,(function*(){const t=yield I.getAllEvents(e);b(null!=t?t:[])})),[I]),N=Object(T.a)(j.a.getTSModelsBuilt,E.a.cargoport,k.b,S.b),F=Object(T.a)(j.a.getTSModelsBuilt,E.a.nottocount,k.d,S.c),M=Object(n.useCallback)(()=>I.loadCargoPorts(t.key,()=>C.current=!0),[I,t.key]),K=Object(n.useCallback)(()=>I.loadNotToCounts(t.key,()=>C.current=!0),[I,t.key]),_=C.current?N:[],B=null!=F?F:[];Object(n.useEffect)(()=>{var e,a,o,r;M(),K(),x(null===(r=null===(o=null===(a=null===(e=t.voyage)||void 0===e?void 0:e.vessel)||void 0===a?void 0:a.vesselType)||void 0===o?void 0:o.vesselCategory)||void 0===r?void 0:r.vesselCategoryCode)},[M,K]);const U=Object(n.useMemo)(()=>((e,t,a,o)=>{var r,n,l,i,s;const{model:c}=t.getLanguageFile(),d=[{content:c.event,contentType:g.a.TEXT,className:a},{content:c.portCall,contentType:g.a.DATE,className:a}];for(const c of e){const{cargo:e,cargoQuantity:p,terminal:u}=c,m=t.formatNumber(null!=p?p:0,{maxDecimals:3,locale:o.isoCode});d.push({content:[null===(r=null==e?void 0:e.charterer)||void 0===r?void 0:r.businessPartnerName,null===(n=null==e?void 0:e.commodity)||void 0===n?void 0:n.commodityDesc,null!==(l=null==u?void 0:u.terminalName)&&void 0!==l?l:null,`${null!=m?m:0} ${null!==(s=null===(i=null==e?void 0:e.cargoMeasurement)||void 0===i?void 0:i.measurementCode)&&void 0!==s?s:""}`].join("\n"),contentType:g.a.DATE,className:a})}return d})(null!=_?_:[],w,L.nonClickCell,e),[_,L.nonClickCell,w,e]),H=Object(n.useMemo)(()=>((e,t,a,o,r)=>a.map(({key:a,eventDesc:n,eventType:l,eventCode:i})=>{var s,c;const d=t.find(e=>{var t;return"PC"===(null===(t=e.event)||void 0===t?void 0:t.eventType)&&e.event.eventCode===i}),p=[n+("PC"===l?` (${l})`:"")],u="PC"===l;return p.push({rawValue:null!==(s=null==d?void 0:d.eventLogDate)&&void 0!==s?s:null,content:null!==(c=null==d?void 0:d.eventLogDate)&&void 0!==c?c:null,className:u?r:void 0,onClick:u?()=>o({eventLog:d,eventCode:i}):void 0}),e.forEach(e=>{var t;const a=e.eventLogs.find(e=>{var t;return(null===(t=e.event)||void 0===t?void 0:t.eventCode)===i});p.push({rawValue:null==a?void 0:a.eventLogDate,content:null!==(t=null==a?void 0:a.eventLogDate)&&void 0!==t?t:null,className:u?void 0:r,onClick:u?void 0:()=>o({eventLog:a,eventCode:i,cargoPortKey:e.key})})}),{content:p,id:a}}))(null!=_?_:[],t.eventLogs,m,A,L.cell),[m,_,L.cell,A,t.eventLogs]),W=Object(n.useCallback)(()=>{r(!1)},[]),G=Object(n.useCallback)(()=>{var e;if(i)I.updateEventLog(i.key,P);else{const a=null===(e=null==_?void 0:_.find(e=>e.key===c))||void 0===e?void 0:e.eventLogs;I.createEventLogs({cargoPortKey:c,eventCode:v},c?void 0:t.key,c?null!=a?a:[]:t.eventLogs,P,m,p,t)}u(void 0),W()},[i,W,I,P,_,c,v,t.key,t.eventLogs,m,p]);return C.current?l.a.createElement(l.a.Fragment,null,l.a.createElement(y.a,{headers:U,userLocale:e,reactKeyPrefix:a+"-event-log-list",data:H,customisation:{responsive:!1,disableSorting:!0,disableToolbar:!0}}),l.a.createElement(V.a,{reactKeyPrefix:a+"-event-log-date-modal",fullWidth:!0,maxWidth:"xs",onCloseModal:W,open:o,title:w.lang().model.logDateAndTime,onClose:W,onConfirm:G,confirmBtnName:w.lang().common.save},l.a.createElement(ct.a,{showTime:!0,reactKeyPrefix:a+"-edit-event-log-date",value:P,locale:e,onBlur:R})),l.a.createElement(kt,{reactKeyPrefix:a,notToCounts:null!=B?B:[],userLocale:e,cargoPorts:null!=_?_:[],portCallKey:t.key})):l.a.createElement(l.a.Fragment,null)};var It=a(105);const[At]=Object(f.a)([O.a.IInternationalization]),xt=[{content:At.lang().model.daReference,contentType:g.a.TEXT},{content:At.lang().model.supplier,contentType:g.a.TEXT},{content:At.lang().common.orderDate,contentType:g.a.DATE,dateTimeFormatOptions:v.a.shortLocalizedDate},{content:At.lang().model.currency,contentType:g.a.TEXT},{alignHeaderContent:g.c.LEFT,content:At.lang().common.amount,contentType:g.a.NUMBER},{alignHeaderContent:g.c.LEFT,content:At.lang().common.status,contentType:g.a.ELEMENT}];var Nt=a(1289);const Ft=({reactKeyPrefix:e,userLocale:t,portCall:a})=>{const[o,r]=Object(f.a)([O.a.IInternationalization,D.a.IPortCallDrawerController]),i=Object(s.h)(),c=Object(s.g)(),{model:d,common:u}=o.getLanguageFile(),v=Object(n.useRef)(!1),[g,h]=Object(n.useState)(!1),[C,P]=Object(n.useState)(),R=Object(T.a)(j.a.getTSModelsBuilt,E.a.serviceorder,k.e,S.d);Object(n.useEffect)(()=>{a.key&&r.loadPortCallPortServicesOrders(a.key,()=>v.current=!0)},[a.key,r]);const w=Object(n.useCallback)(()=>{h(!g)},[g]),I=Object(n.useMemo)(()=>[{disabled:!1,icon:m.a,iconButtonProps:{color:"primary","aria-label":u.create+" "+d.serviceOrder},label:u.create+" "+d.serviceOrder,onClick:w,reactKeyPrefix:e}],[u.create,w,d.serviceOrder,e]),A=Object(n.useMemo)(()=>{var e;return null!==(e=null==R?void 0:R.map(e=>(e=>{var t,a,o,r;const n=Object(q.a)(e,"status.statusTypeDesc",""),i=l.a.createElement(b.a,{label:n,priority:It.a.getStatusPriority(n,E.a.serviceorder)});return{content:[e.externalReferenceNo,null!==(a=null===(t=e.businessPartner)||void 0===t?void 0:t.businessPartnerName)&&void 0!==a?a:"",e.orderDate,null!==(r=null===(o=e.currency)||void 0===o?void 0:o.currencyCode)&&void 0!==r?r:"",e.amount,{rawValue:n,content:i}],id:e.key}})(e)))&&void 0!==e?e:[]},[R]);return v.current?l.a.createElement(l.a.Fragment,null,l.a.createElement(y.a,{reactKeyPrefix:e+"-service-orders-table",userLocale:t,headers:xt,data:A,onRowClick:e=>{P(void 0),L.a.openDrawer(e,p.a.serviceOrderDrawer,i,c)},defaultComparator:Mt,customisation:{responsive:!0},title:o.lang().menu.serviceOrders,primaryActions:I,preSelectedRow:C}),g&&l.a.createElement(Nt.a,{reactKeyPrefix:e+"-create-service-order",showModal:g,closeDialog:w,preSelectedPortCall:a,onCreate:()=>r.loadPortCallPortServicesOrders(a.key),setPreselectedServiceOrderKey:P})):l.a.createElement(l.a.Fragment,null)};function Mt(e,t){return e[2]<t[2]?g.b.LESS_THAN:e[2]>t[2]?g.b.GREATER_THAN:g.b.EQUAL}var Kt=a(831),_t=a(1818),Bt=a(131),Ut=a(107),Ht=a(48);const Vt="doc-common-components-drawer-port-call-drawer";class Wt extends l.a.PureComponent{constructor(e){super(e),this.state=Object.assign(Object.assign({},e.state),{showRegisterArrival:!1,showRegisterDeparture:!1,showRegisterInPortReport:!1,showRegisterNoonReport:!1,showChangeVoyage:!1}),this.showRegisterArrivalModal=this.showRegisterArrivalModal.bind(this),this.hideRegisterArrivalModal=this.hideRegisterArrivalModal.bind(this),this.showRegisterDepartureModal=this.showRegisterDepartureModal.bind(this),this.hideRegisterDepartureModal=this.hideRegisterDepartureModal.bind(this),this.showRegisterNoonReportModal=this.showRegisterNoonReportModal.bind(this),this.hideRegisterNoonReportModal=this.hideRegisterNoonReportModal.bind(this),this.showRegisterInPortReportModal=this.showRegisterInPortReportModal.bind(this),this.hideRegisterInPortReportModal=this.hideRegisterInPortReportModal.bind(this),this.confirmRegisterInPortReport=this.confirmRegisterInPortReport.bind(this),this.showChangeVoyage=this.showChangeVoyage.bind(this),this.confirmArrival=this.confirmArrival.bind(this),this.confirmDeparture=this.confirmDeparture.bind(this),this.confirmRegisterNoonReport=this.confirmRegisterNoonReport.bind(this),this.confirmCallback=this.confirmCallback.bind(this),this.confirmCallbackPositionReport=this.confirmCallbackPositionReport.bind(this),this.getDefaultInPortReport=this.getDefaultInPortReport.bind(this),this.getActionsMenu=this.getActionsMenu.bind(this),this.loadPositionReports=this.loadPositionReports.bind(this),this.loadNoonReports=this.loadNoonReports.bind(this),this.hideChangeVoyage=this.hideChangeVoyage.bind(this),this.portCallId=this.getPortCallId(e.match),this.loadPortCall=this.loadPortCall.bind(this),this.onClickReport=this.onClickReport.bind(this),this.loadPortCall()}UNSAFE_componentWillReceiveProps(e){const t=this.getPortCallId(e.match);t&&this.portCallId!==t&&(this.portCallId=t,this.loadPortCall()),this.setState(Object.assign({},e.state))}componentWillUnmount(){const{dispatchAction:e,deps:[t]}=this.props;e(t.setAction(null))}loadPortCall(){const{dispatchAction:e,deps:[t,a]}=this.props;this.portCallId&&(e(t.setAction(this.portCallId)),a.loadSingleAction({fields:k.c,key:this.portCallId,type:E.a.portcall,headers:Object(Ht.b)()?Bt.a.serializeCache:void 0}))}loadNoonReports(){var e,t,a;const{portCall:o}=this.state,r=null!==(a=null===(t=null===(e=null==o?void 0:o.voyage)||void 0===e?void 0:e.vessel)||void 0===t?void 0:t.key)&&void 0!==a?a:void 0,{deps:[,n]}=this.props;r&&n.loadMultipleAction({fields:{hoursInService:"*",reportDateLocal:"*"},type:E.a.positionreport,query:`filter=portCall.voyage.vessel.key(EQ)${r}&filter=vesselReportType.vesselReportTypeCode(EQ)NOON&sort=reportDateLocal(DS)`,pageItemLimit:1,pageNumber:1,overwriteKeysOnLoad:!0,identifier:"NOON_REPORTS_IDENTIFIER"})}loadPositionReports(){const{deps:[,e]}=this.props;e.loadMultipleAction({fields:k.f,identifier:S.e,overwriteKeysOnLoad:!0,query:"filter=portCall(EQ)"+this.portCallId,type:E.a.positionreport})}getPortCallId(e){return e&&e.params&&e.params.drawerId?parseInt(e.params.drawerId,10):void 0}hideRegisterArrivalModal(){this.setState({showRegisterArrival:!1})}confirmArrival(e){const{portCall:t}=this.state,{deps:[,,,a]}=this.props,o=Object(ue.a)(a.getState()).authdata||"";a.dispatch(Object(i.showLoading)()),Object(c.c)(t||new pe.a({}),o,e,this.confirmCallback),this.hideRegisterArrivalModal()}confirmDeparture(e){const{portCall:t}=this.state,{deps:[,,,a]}=this.props,o=Object(ue.a)(a.getState()).authdata||"";a.dispatch(Object(i.showLoading)()),Object(c.c)(t||new pe.a({}),o,e,this.confirmCallback),this.hideRegisterDepartureModal()}confirmRegisterNoonReport(e){const{portCall:t}=this.state,{deps:[,,,a]}=this.props,o=Object(ue.a)(a.getState()).authdata||"";a.dispatch(Object(i.showLoading)()),Object(c.b)(t||new pe.a({}),o,e,this.confirmCallbackPositionReport),this.hideRegisterNoonReportModal()}confirmRegisterInPortReport(e){const{portCall:t}=this.state,{deps:[,,,a]}=this.props,o=Object(ue.a)(a.getState()).authdata||"";a.dispatch(Object(i.showLoading)()),Object(c.a)(t||new pe.a({}),o,e,this.confirmCallbackPositionReport),this.hideRegisterInPortReportModal()}confirmCallback(e){var t,a;const{deps:[,o,,r]}=this.props;this.portCallId&&(this.loadPositionReports(),this.loadPortCall()),(null===(a=null===(t=this.state.portCall)||void 0===t?void 0:t.voyage)||void 0===a?void 0:a.key)&&o.loadSingleAction({type:E.a.voyage,fields:Ut.n,key:this.state.portCall.voyage.key}),r.dispatch(Object(i.hideLoading)())}confirmCallbackPositionReport(e){const{deps:[,t,,a]}=this.props;this.portCallId&&(this.loadPositionReports(),this.loadPortCall()),a.dispatch(Object(i.hideLoading)())}showRegisterArrivalModal(){this.setState({showRegisterArrival:!0})}hideRegisterDepartureModal(){this.setState({showRegisterDeparture:!1})}showRegisterDepartureModal(){this.setState({showRegisterDeparture:!0})}showRegisterNoonReportModal(){this.loadNoonReports(),this.setState({showRegisterNoonReport:!0})}hideRegisterNoonReportModal(){this.setState({showRegisterNoonReport:!1})}showRegisterInPortReportModal(){this.setState({showRegisterInPortReport:!0})}hideRegisterInPortReportModal(){this.setState({showRegisterInPortReport:!1})}onClickReport(e){L.a.openDrawer(e,p.a.positionReportDrawer,this.props.location,this.props.history)}showChangeVoyage(){this.setState({showChangeVoyage:!0})}hideChangeVoyage(){this.setState({showChangeVoyage:!1})}getPortCallDrawerTitle(e){const{deps:[,,t]}=this.props,{common:a}=t.getLanguageFile();return(e.voyage&&e.voyage.vessel&&e.voyage.vessel.vesselName?e.voyage.vessel.vesselName+" - ":a.na+" - ")+(e.ownedByVoyage&&e.ownedByVoyage.voyageHeader&&e.ownedByVoyage.voyageHeader.referenceNo?e.ownedByVoyage.voyageHeader.referenceNo+" - ":a.na+" - ")+(e.port&&e.port.portName?e.port.portName:a.na)}getTabs(){const{deps:[,,e]}=this.props,{common:t,menu:a,model:o}=e.getLanguageFile(),{portCall:r,userLocale:n,user:i,restrictedAreas:s}=this.state,c=Object(P.c)([ke.a.VESSEL],i);return r?[{id:"overview",content:()=>l.a.createElement(st,{reactKeyPrefix:Vt+"-overview",i:e,portCall:r,userLocale:n,user:i,restrictedAreas:s}),label:t.overview},{id:"service-orders",content:()=>l.a.createElement(Ft,{reactKeyPrefix:Vt+"port-service-orders",userLocale:n,portCall:r}),label:a.serviceOrders,hidden:c},{id:"bunker-orders",content:()=>l.a.createElement(w,{reactKeyPrefix:Vt+"bunker-orders",userLocale:n,portCall:r,user:i}),label:a.bunkerOrders},{id:"vessel-reports",content:()=>l.a.createElement(A,{portCall:r,reactKeyPrefix:Vt+"reports",userLocale:n,openReport:this.onClickReport}),label:a.vesselReports},{id:"port-log",content:()=>l.a.createElement(wt,{reactKeyPrefix:Vt+"-port-log",portCall:r,userLocale:n}),label:o.portLog}]:[]}getDefaultInPortReport(){const{portCall:e}=this.state;return new K.a({portCall:Object.assign({},e)})}getActionsMenu(){const{deps:[,,e]}=this.props,{model:t}=e.getLanguageFile();return[{data:[{disabled:!1,onClick:this.showRegisterNoonReportModal,text:e.getLanguageFile().portCall.registerNoonReport},{disabled:!1,onClick:this.showRegisterArrivalModal,text:e.getLanguageFile().portCall.registerArrival},{disabled:!1,onClick:this.showRegisterInPortReportModal,text:e.getLanguageFile().portCall.registerInPortReport},{disabled:!1,onClick:this.showRegisterDepartureModal,text:e.getLanguageFile().portCall.registerDeparture}],icon:r.a,tooltipText:t.registerReports}]}render(){const{portCall:e,userLocale:t,noonReports:a}=this.state;if(this.portCallId&&e){const{deps:[,,o]}=this.props,{model:r,common:n}=o.getLanguageFile(),i=[{disabled:W.a.isStatusNotValidForChangeVoyage(e),onClick:this.showChangeVoyage,text:n.changeVoyage}];return l.a.createElement(d.a,{size:"medium",reactKeyPrefix:Vt,status:{overrideStatusLabel:l.a.createElement(ve.a,{portCall:e})},drawerKey:this.portCallId,drawerRoute:p.a.portCallDrawer,key:p.a.portCallDrawer+this.portCallId,subject:r.portCall,actionsMenu:this.getActionsMenu(),secondaryActions:i,subjectLoaded:this.portCallId===e.key,subjectName:this.getPortCallDrawerTitle(e),tsModelType:E.a.portcall,tabs:this.getTabs(),tabId:this.props.match.params.tabId},l.a.createElement(X,{reactKeyPrefix:Vt+"register-arrival-modal",showModal:this.state.showRegisterArrival,portCall:e,userLocale:t,onClose:this.hideRegisterArrivalModal,onConfirm:this.confirmArrival}),l.a.createElement(Y,{reactKeyPrefix:Vt+"register-departure-modal",showModal:this.state.showRegisterDeparture,portCall:e,userLocale:t,onClose:this.hideRegisterDepartureModal,onConfirm:this.confirmDeparture}),l.a.createElement(ie,{reactKeyPrefix:Vt+"noon-report-modal",showModal:this.state.showRegisterNoonReport,portCall:e,userLocale:t,noonReports:a,onClose:this.hideRegisterNoonReportModal,onConfirm:this.confirmRegisterNoonReport}),l.a.createElement(te,{reactKeyPrefix:Vt+"in-port-report-modal",showModal:this.state.showRegisterInPortReport,portCall:e,userLocale:t,onClose:this.hideRegisterInPortReportModal,onConfirm:this.confirmRegisterInPortReport}),this.state.showChangeVoyage&&l.a.createElement(_t.a,{reactKeyPrefix:Vt+"in-change-voyage-modal",showModal:this.state.showChangeVoyage,portCall:e,title:n.changeVoyage,onClose:this.hideChangeVoyage}))}return null}}const Gt=Object(de.a)(e=>{const t=me.a.get(e);return{portCall:j.a.getTSModelBuilt(e,E.a.portcall,t||0,k.c),userLocale:be.a.getUserLocale(e),user:Object(ue.a)(e),restrictedAreas:j.a.getAllTSModelsBuilt(e,E.a.restrictedarea,Kt.a),noonReports:j.a.getTSModelsBuilt(e,E.a.positionreport,{hoursInService:"*",reportDateLocal:"*"},"NOON_REPORTS_IDENTIFIER")}},Object(f.b)([G.a.ISelectedPortCallActions,G.a.ITSModelActionsAsync,O.a.IInternationalization,G.a.Store,D.a.IVoyageDrawerController],Object(s.k)(Wt)))},1880:function(e,t,a){"use strict";a.d(t,"a",(function(){return ve}));a(10),a(11);var o=a(0),r=a.n(o),n=a(97),l=a(6),i=a(23),s=a(68),c=a(1),d=a(21),p=a(3),u=a(82),m=a(15),b=(a(59),a(268),a(269),a(118),a(109),a(163),a(61)),v=a(24),g=a(14),y=a(4);const f=g.a.get(p.a.IInternationalization),{model:h,vessel:O}=f.getLanguageFile(),C=e=>{const t={field:"voyage.vessel.key",filterGroupCode:e,operator:y.c.IN,type:y.d.STRING};return{label:O.vesselName,filterObjectValuePath:"key",typeaheadProps:{type:c.a.vessel,objectPaths:["vesselName"],query:"filter=vesselName(NOTNULL)",shouldPreload:!0},filters:[t]}},P=e=>{const t={field:"voyage.vessel.key",filterGroupCode:e,operator:y.c.IN,type:y.d.STRING};return{label:h.dwt,filterObjectValuePath:"key",typeaheadProps:{type:c.a.vessel,objectPaths:["dwtSummer"],query:"filter=vesselName(NOTNULL)",shouldPreload:!0},filters:[t]}},R=e=>{const t={field:"reasonForCall.key",filterGroupCode:e,operator:y.c.IN,type:y.d.STRING};return{label:h.reasonForCall,filterObjectValuePath:"key",typeaheadProps:{type:c.a.reasonforcall,objectPaths:["reasonForCallDesc"],query:"filter=reasonForCall(NOTNULL)",shouldPreload:!0},filters:[t]}},D=e=>{const t={field:"currency.key",filterGroupCode:e,operator:y.c.IN,type:y.d.STRING};return{label:h.currency,filterObjectValuePath:"key",typeaheadProps:{type:c.a.currency,objectPaths:["currencyCode"],query:"filter=currencyCode(NOTNULL)",shouldPreload:!0},filters:[t]}};function j({reactKeyPrefix:e}){const t=g.a.get(p.a.IInternationalization),{model:a,vessel:o}=t.getLanguageFile();return r.a.createElement(r.a.Fragment,null,r.a.createElement(v.a,{reactKeyPrefix:e,configs:[C("PORT_COST_HISTORY_LIST_FILTER_GROUP_CODE")],type:y.b.TYPEAHEAD,filterCode:"PORT_COST_HISTORY_LIST_FILTER_GROUP_CODE_VESSEL_NAME",label:o.vesselName}),r.a.createElement(v.a,{reactKeyPrefix:e,configs:[P("PORT_COST_HISTORY_LIST_FILTER_GROUP_CODE")],type:y.b.TYPEAHEAD,filterCode:"PORT_COST_HISTORY_LIST_FILTER_GROUP_CODE_DWT",label:a.dwt}),r.a.createElement(v.a,{reactKeyPrefix:e,configs:[R("PORT_COST_HISTORY_LIST_FILTER_GROUP_CODE")],type:y.b.TYPEAHEAD,filterCode:"PORT_COST_HISTORY_LIST_FILTER_GROUP_CODE_RFC",label:a.reasonForCall,isClearable:!0}),r.a.createElement(v.a,{reactKeyPrefix:e,configs:[D("PORT_COST_HISTORY_LIST_FILTER_GROUP_CODE")],type:y.b.TYPEAHEAD,filterCode:"PORT_COST_HISTORY_LIST_FILTER_GROUP_CODE_CURRENCY",label:a.currency}))}var E=a(5),T=a(50);var k=a(473),S=a(213),L=a(187);const w=Object(S.a)(Object(L.a)(e=>({button:{borderRadius:e.spacing(.5,.5),height:e.spacing(3.25),minWidth:"fit-content",padding:e.spacing(.5,1)},direction:{flexDirection:"row",display:"flex",flexWrap:"nowrap",justifyContent:"space-around",alignItems:"center"}}))),I=r.a.memo(({reactKeyPrefix:e,onClickUseButton:t,portCost:a,i:o,currencyKey:n})=>{const{common:l}=o.getLanguageFile(),i=w({});return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:i.direction},void 0!==a?r.a.createElement(k.a,{key:e+"-use-button",variant:"outlined",color:"primary",onClick:()=>t(a,n),className:i.button},l.use):r.a.createElement(r.a.Fragment,null)))}),A=g.a.get(p.a.IInternationalization),{vessel:x,model:N,common:F}=A.getLanguageFile(),M=[{content:x.vesselName,contentType:E.a.TEXT},{content:N.dwt,contentType:E.a.NUMBER},{content:N.reasonForCall,contentType:E.a.TEXT},{content:N.eta,contentType:E.a.DATE},{content:N.daysInPort,contentType:E.a.NUMBER,numberFormatOptions:{minDecimals:2,maxDecimals:2}},{content:F.preliminary,contentType:E.a.NUMBER,numberFormatOptions:{minDecimals:2,maxDecimals:2}},{content:"",contentType:E.a.TEXT},{content:N.actual,contentType:E.a.NUMBER,numberFormatOptions:{minDecimals:2,maxDecimals:2}},{content:"",contentType:E.a.TEXT},{content:N.currency,contentType:E.a.TEXT}];var K=a(42),_=a(35),B=a(2383);function U({reactKeyPrefix:e}){return r.a.createElement(r.a.Fragment,null,r.a.createElement(B.a,{sx:{marginBottom:2,borderRadius:1},key:e+"-service-order-panel-skeleton",variant:"rectangular",height:100}))}var H=a(2379),V=a(2380),W=a(2530),G=a(272),z=a.n(G),q=a(37);const $=e=>{const{serviceOrderFields:t,children:a,reactKeyPrefix:o,expanded:n,onChange:l,breakpoints:i}=e;return r.a.createElement(H.a,{expanded:n,onChange:l,sx:{marginBottom:2}},r.a.createElement(V.a,{expandIcon:r.a.createElement(z.a,null),"aria-controls":"panel1a-content",id:"panel1a-header"},r.a.createElement(q.a,{reactKeyPrefix:o+"expansion-panel-item",items:t,breakpoints:i})),r.a.createElement(W.a,null,a))};var X=a(126),Q=a(67),Y=a(81);const J=Object(X.a)((e,t)=>[{content:e.lang().common.service,contentType:E.a.TEXT},{content:`${e.lang().common.estimated} (${t||e.lang().common.amount})`,contentType:E.a.NUMBER,numberFormatOptions:{minDecimals:2,maxDecimals:2}},{content:`${e.lang().common.revised} (${t||e.lang().common.amount})`,contentType:E.a.NUMBER,numberFormatOptions:{minDecimals:2,maxDecimals:2}},{content:`${e.lang().common.final} (${t||e.lang().common.amount})`,contentType:E.a.NUMBER,numberFormatOptions:{minDecimals:2,maxDecimals:2}},{content:e.lang().common.costOf,contentType:E.a.TEXT}]);function Z(e){const{reactKeyPrefix:t,userLocale:a,i:n,serviceOrder:l}=e,i=Object(o.useMemo)(()=>l.serviceOrderLines?l.serviceOrderLines.map(ee):[],[l.serviceOrderLines]),s=Object(Y.a)(l,"currency.currencyCode");return r.a.createElement(r.a.Fragment,null,r.a.createElement(Q.a,{data:i,headers:J(n,s),reactKeyPrefix:t+"service-order-lines-table",userLocale:a,title:n.lang().common.orderLines,pagination:{enabled:!0,rowsPerPage:[10]},customisation:{responsive:!0}}))}function ee(e){const t=g.a.get(p.a.IInternationalization);return{content:[Object(Y.a)(e,"serviceCode.description",""),e.amountEstimate,e.amountRevised,e.amountFinal,e.isCharterersCost?t.lang().model.charterer:e.isOwnersCost?t.lang().model.owner:""],id:e.key}}var te=a(105),ae=a(40),oe=a(216);function re(e,t){const[a]=Object(l.a)([p.a.IInternationalization]),{model:o,common:n}=a.lang(),i=Object(oe.b)(T.a.getEventLogDateFromPC(Object(Y.a)(e,"portCall"),"ARR"),t),s=Object(Y.a)(e,"status.statusTypeDesc",""),d=Object(oe.b)(e.orderDate,t);return[{label:o.daReference,value:Object(Y.a)(e,"externalReferenceNo","")},{label:n.date,value:d},{label:o.voyageReference,value:Object(Y.a)(e,"portCall.ownedByVoyage.voyageHeader.referenceNo","")},{label:o.eta,value:i},{label:o.agent,value:Object(Y.a)(e,"businessPartner.businessPartnerName","")},{label:n.status,value:r.a.createElement(ae.a,{label:s,priority:te.a.getStatusPriority(s,c.a.serviceorder)})}]}function ne(e){const{reactKeyPrefix:t,userLocale:a,serviceOrder:n,i:l}=e,[i,s]=Object(o.useState)(!1),c=Object(o.useCallback)((e,t)=>{s(t)},[]);return r.a.createElement($,{reactKeyPrefix:t+"-service-order-panel",expanded:i,breakpoints:{sm:2,lg:2,md:2,xl:2,xs:2},serviceOrderFields:re(n,a),onChange:c},r.a.createElement(Z,{reactKeyPrefix:t+"-panel-lines",userLocale:a,serviceOrder:n,i:l}))}var le=function(e,t,a,o){return new(a||(a=Promise))((function(r,n){function l(e){try{s(o.next(e))}catch(e){n(e)}}function i(e){try{s(o.throw(e))}catch(e){n(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(l,i)}s((o=o.apply(e,t||[])).next())}))};function ie(e){const{portCallId:t,reactKeyPrefix:a,controller:n,i:l}=e,s=Object(i.a)(K.a.getUserLocale)||_.f[0],c=Object(o.useRef)(!0),[d,p]=Object(o.useState)([]),u=Object(o.useCallback)(()=>le(this,void 0,void 0,(function*(){if(0!==t){const e=yield n.getServiceOrdersOfPortCall(t,()=>c.current=!1);p(e)}})),[n,t]);Object(o.useEffect)(()=>{u()},[u]);const m=Object(o.useMemo)(()=>d.map(e=>r.a.createElement(ne,{reactKeyPrefix:a,userLocale:s,serviceOrder:e,key:e.key,i:l})),[l,a,d,s]);return r.a.createElement(r.a.Fragment,null,c.current?r.a.createElement(U,{reactKeyPrefix:a}):r.a.createElement(r.a.Fragment,null,m))}var se=a(20),ce=a(1773),de=a(503),pe=a(412),ue=function(e,t,a,o){return new(a||(a=Promise))((function(r,n){function l(e){try{s(o.next(e))}catch(e){n(e)}}function i(e){try{s(o.throw(e))}catch(e){n(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(l,i)}s((o=o.apply(e,t||[])).next())}))};const me={portCostCurrency:"*",reasonForCall:{reasonForCall:"*",reasonForCallDesc:"*"},voyage:{vessel:{vesselName:"*",dwtSummer:"*"},voyageHeader:{voyageStatus:{statusTypeCode:"*"},isBudget:"*",preliminaryVoyage:{portCallsFromVoyage:{port:"*",portCost:"*"}}},isTc:"*"},port:{portName:"*"},eventLogs:{eventLogDate:"*",event:{eventCode:"*"}},daysInPort:"*",currency:{currencyCode:"*"}};function be(e){var t;const{portCall:a,reactKeyPrefix:i,i:s}=e,d=Object(n.g)(),u=Object(n.h)(),[m]=Object(l.a)([se.a.IPortCostHistoryDrawerController]),v=["sort=eventLogs.eventLogDate(DS)","filter=port.key(EQ)"+(null===(t=a.port)||void 0===t?void 0:t.key),"filter=voyage.voyageHeader.voyageStatus.statusTypeCode(NE)EST","filter=voyage.voyageHeader.voyageStatus.statusTypeCode(NE)SCU","filter=voyage.voyageHeader.isBudget(NE)true","filter=eventLogs.event.eventCode(EQ)ARR"].join("&"),[g,y]=Object(o.useState)([]),[f,h]=Object(o.useState)(""),[O,C]=Object(o.useState)(!1),[P,R]=Object(o.useState)(!1),[D,E]=Object(o.useState)([]),k=Object(o.useRef)(f),S=Object(o.useRef)(D),L=Object(o.useCallback)(e=>ue(this,void 0,void 0,(function*(){const t=yield m.getServiceOrdersOfList(e);y(g.concat(t))})),[m,g]);const w=Object(o.useCallback)(()=>{C(!0),R(!0)},[]);Object(o.useEffect)(()=>{""!==f&&k.current!==f&&P&&(L(f),R(!1)),k.current=f,S.current=D},[L,f,D,P]);const A=Object(o.useCallback)(e=>{if(e.length>0&&P){let e=[];if(D.length>0){const t=D.flatMap(e=>e.key),a=S.current.flatMap(e=>e.key),o=Object(ce.a)(t,a);e=0===o.length?t:o}if(e.length>0){const t=`(${e.map(e=>e.toString()).join(",")})`;h(t)}}return E(e),Object(de.a)(e,"key").sort((e,t)=>function(e,t){const a=T.a.getEventLogDateFromPC(e,"ARR"),o=T.a.getEventLogDateFromPC(t,"ARR");if(a&&o){if(a>o)return-1;if(a<o)return 1}return 0}(e,t))},[P,D]),x=Object(o.useCallback)(e=>r.a.createElement(ie,{portCallId:e,reactKeyPrefix:i,controller:m,i:s}),[m,s,i]),N=Object(o.useCallback)((e,t)=>{m.updatePortCall(a.key,e,t).then(()=>{const e=Object(pe.a)();if(e&&e.length>1){const t=e.pop();t&&t.id===a.key&&d.push(u.pathname.replace(`/${t.hash}/${t.id}`,""))}}).catch(()=>{throw new Error("Something went wrong with updating the port cost")})},[m,d,u.pathname,a.key]),F=Object(o.useMemo)(()=>e=>(({voyage:e,portCostCurrency:t,reasonForCall:a,eventLogs:o,daysInPort:n,currency:i,port:s},c)=>{var d,u,m,b,v,g,y,f,h,O;const C=o.find(e=>{var t;return"ARR"===(null===(t=e.event)||void 0===t?void 0:t.eventCode)}),[P]=Object(l.a)([p.a.IInternationalization]),R=function(e,t){if(e&&e.voyageHeader&&e.voyageHeader.preliminaryVoyage){const a=e.voyageHeader.preliminaryVoyage;if(null!==a&&a.portCallsFromVoyage&&a.portCallsFromVoyage.length>0){const e=a.portCallsFromVoyage.find(e=>{var a;return(null===(a=e.port)||void 0===a?void 0:a.key)===t});return e?e.portCost:0}}return 0}(e,null!==(d=null==s?void 0:s.key)&&void 0!==d?d:0),D=(e,t)=>{c({portCostCurrency:e,currency:t},{voyage:{partOfSchedule:{portCostCurrency:"*",currency:"*"},tcResult:"*",tcResultDay:"*",voyageResult:"*",portCost:"*"}})},j=r.a.createElement(I,{reactKeyPrefix:"port-cost-list-use-button",portCost:t,onClickUseButton:D,i:P,currencyKey:null!==(u=null==i?void 0:i.key)&&void 0!==u?u:0}),E=r.a.createElement(I,{reactKeyPrefix:"port-cost-list-use-button",portCost:R,onClickUseButton:D,i:P,currencyKey:null!==(m=null==i?void 0:i.key)&&void 0!==m?m:0});return[null!==(v=null===(b=null==e?void 0:e.vessel)||void 0===b?void 0:b.vesselName)&&void 0!==v?v:"",null!==(y=null===(g=null==e?void 0:e.vessel)||void 0===g?void 0:g.dwtSummer)&&void 0!==y?y:"",null!==(f=null==a?void 0:a.reasonForCallDesc)&&void 0!==f?f:"",null!==(h=null==C?void 0:C.eventLogDate)&&void 0!==h?h:"",null!=n?n:"",R,{content:E,rawValue:null},t,{content:j,rawValue:null},null!==(O=null==i?void 0:i.currencyCode)&&void 0!==O?O:""]})(e,N),[N]);return r.a.createElement(b.a,{fields:me,queryStr:v,listId:"PORT_COST_HISTORY_LIST_ID",reactKeyPrefix:i+"-list",tsmodelType:c.a.portcall,getColSpec:F,tableHeaders:M,quickFilters:r.a.createElement(j,{reactKeyPrefix:i+"-filters"}),quickFiltersGroupCode:"PORT_COST_HISTORY_LIST_FILTER_GROUP_CODE",renderCollapsibleRow:x,disableCollapsibleRow:e=>{return t=e,!g.flatMap(e=>{var t,a;return null!==(a=null===(t=null==e?void 0:e.portCall)||void 0===t?void 0:t.key)&&void 0!==a?a:0}).includes(t);var t},tableCustomisation:{responsive:!1},selectorMiddleware:A,onLoadedItems:w,hide:!O,pageItemLimit:15})}function ve(){var e,t;const[a]=Object(l.a)([p.a.IInternationalization]),{drawerId:b,tabId:v}=Object(n.i)(),g=Object(i.a)(d.a.getTSModelBuilt,c.a.portcall,null!=b?b:0,me)||new s.a({}),{model:y,common:f}=a.getLanguageFile(),h=Object(o.useMemo)(()=>g.key?[{id:"overview",content:()=>r.a.createElement(be,{reactKeyPrefix:"doc-common-components-drawer-port-cost-history-drawerport-cost-history-overview",portCall:g,i:a}),label:f.overview}]:[],[g,f.overview,a]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(u.a,{reactKeyPrefix:"doc-common-components-drawer-port-cost-history-drawer",subject:y.portCostHistory,subjectName:null!==(t=null===(e=g.port)||void 0===e?void 0:e.portName)&&void 0!==t?t:y.portCostHistory,subjectLoaded:!!g,drawerRoute:m.a.portCostHistoryDrawer,key:m.a.portCostHistoryDrawer+b,size:"medium",drawerKey:Number(b),tabs:h,tabId:v,tsModelType:c.a.portcall}))}},1992:function(e,t,a){"use strict";a.d(t,"a",(function(){return A}));a(10),a(11);var o=a(0),r=a.n(o),n=a(97),l=a(35),i=a(82),s=a(15),c=a(6),d=a(23),p=a(1),u=a(32),m=a(7),b=a(21),v=a(42),g=a(3),y=a(43),f=a(235),h=a(91),O=a(37),C=a(12),P=a(75),R=a(71),D=(a(109),a(28)),j=a(19);const E=(e,t,a,o,r,n)=>{const{common:l,model:i}=o.getLanguageFile(),s=[{disabled:r,fieldName:"country",label:i.country},{disabled:r,fieldName:"longitude",label:l.longitude,numberInputProps:{maskSettings:D.a.mask12}},{disabled:r,fieldName:"latitude",label:l.latitude,numberInputProps:{maskSettings:D.a.mask12}},{disabled:r,fieldName:"itdsCode",label:i.itdsCode},{disabled:r,fieldName:"locationCode",label:i.locationCode},{disabled:r,fieldName:"rpCode",label:l.rpCode},{disabled:r,fieldName:"timezone",label:i.timezoneOffset.trim().split(/\s(.*)/).splice(0,1)[0]},{disabled:r,fieldName:"wpiCode",label:i.wpiCode,numberInputProps:{maskSettings:D.a.mask9}},{disabled:r,fieldName:"zoomLevel",label:i.zoomLevel,numberInputProps:{maskSettings:D.a.mask3}},{disabled:r,fieldName:"bunkerCategoryAe",label:i.bunker+" "+l.category+" "+i.bunkerCategoryAe},{disabled:r,fieldName:"bunkerCategoryMe",label:i.bunker+" "+l.category+" "+i.bunkerCategoryMe},{disabled:r,fieldName:"portRef",label:i.port+" "+i.reference},{overrideFieldType:"boolean",label:i.isCanal,fieldName:"isCanal",onUpdateOverride:e=>{n(e?{isCanal:!0}:{isCanal:!1})},disabled:r},{overrideFieldType:"boolean",label:i.isOpenLoopRestricted,fieldName:"isOpenLoopRestricted",onUpdateOverride:e=>{n(e?{isOpenLoopRestricted:!0}:{isOpenLoopRestricted:!1})},disabled:r}],c={updateResponseFields:f.b,reactKeyPrefix:e,fieldOptions:s,userLocale:a,object:t,type:p.a.port};return Object(j.a)(c)};var T=a(20);const k=({reactKeyPrefix:e,port:t,userLocale:a,i:n,disabled:l})=>{const{common:i}=n.lang(),[s]=Object(c.a)([T.a.IMasterDataPortDrawerController]),d=Object(o.useMemo)(()=>E(e,t,a,n,l,e=>s.updatePort(t.key,e)),[e,t,a,n,l,s]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(R.a,null,r.a.createElement(P.a,{title:i.mainDetails}),r.a.createElement(O.a,{reactKeyPrefix:e+"-main-details-field-list",items:d,breakpoints:C.a})))};var S=a(208),L=a(70),w=a(150),I=a(48);const A=()=>{var e,t;const[a,O]=Object(c.a)([g.a.IInternationalization,m.a.ITSModelActions]),{model:C,common:P}=a.getLanguageFile(),{drawerId:R,tabId:D}=Object(n.i)(),j=Object(o.useMemo)(()=>window.location.hostname.includes(I.a.DATA_REPO_URL,0),[]),E=Object(d.a)(b.a.getTSModelBuilt,p.a.port,null!=R?R:0,f.b)||new h.a({}),[T,A]=Object(o.useState)(!1),x=Object(d.a)(v.a.getUserLocale)||l.f[0],N=null!==(e=Object(d.a)(u.a))&&void 0!==e?e:new y.a({});Object(o.useEffect)(()=>{R&&0!==parseInt(R)&&O.loadSingleAction({fields:f.b,key:R,type:p.a.port})},[R,O]);const F=Object(o.useMemo)(()=>!E||!j||"DATALOY"!==N.userCode,[j,E,N.userCode]),M=Object(o.useCallback)(()=>{A(!0)},[]),K=Object(o.useCallback)(()=>{A(!1)},[]),_=null!==(t=null==E?void 0:E.isObjectActive)&&void 0!==t&&t,B=Object(o.useMemo)(()=>{if(R){return[...F?[]:Object(w.a)({isActive:_,key:R,type:p.a.port,deleteTitle:C.port,allowDelete:!1}),{text:P.editPort+" "+C.name,onClick:M,disabled:F}]}return[]},[R,_,C.port,C.name,P.editPort,M,F]),U=Object(o.useMemo)(()=>E?[{id:"overview",content:()=>r.a.createElement(k,{reactKeyPrefix:"doc-common-components-drawer-master-data-port-drawerport-overview",port:E,userLocale:x,i:a,disabled:F}),label:P.overview}]:[],[E,P.overview,x,a,F]),H=Object(o.useCallback)(e=>{E&&O.updateSingleAction({data:{portName:e},fields:f.b,key:E.key,type:p.a.port})},[E,O]);return E?r.a.createElement(r.a.Fragment,null,r.a.createElement(i.a,{key:s.a.masterDataPortDrawer+R,reactKeyPrefix:"doc-common-components-drawer-master-data-port-drawer",subject:C.port,subjectName:E?E.portName:"",subjectLoaded:!!E,drawerRoute:s.a.masterDataPortDrawer,drawerKey:Number(R),secondaryActions:B,isObjectActive:E,tabs:U,tabId:D,tsModelType:p.a.port,reloadParentDrawer:()=>{}}),r.a.createElement(S.a,{reactKeyPrefix:"doc-common-components-drawer-master-data-port-draweredit-port-name-modal",title:P.editPort+""+C.name,value:E.portName,validation:L.b.PortName,showModal:T,onClose:K,onConfirm:H})):r.a.createElement(r.a.Fragment,null)}},2046:function(e,t,a){"use strict";a.d(t,"a",(function(){return F}));a(109),a(118);var o,r,n,l=a(0),i=a.n(l),s=a(97),c=a(82),d=a(15),p=a(5),u=a(67),m=a(329),b=a(47),v=a(1),g=a(50),y=a(21),f=a(1770),h=a(42),O=a(88),C=a(184),P=a(20),R=(a(2297),a(9)),D=a(31),j=a(4),E=a(16),T=a(7),k=a(29),S=a(926),L=function(e,t,a,o){var r,n=arguments.length,l=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,a):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,o);else for(var i=e.length-1;i>=0;i--)(r=e[i])&&(l=(n<3?r(l):n>3?r(t,a,l):r(t,a))||l);return n>3&&l&&Object.defineProperty(t,a,l),l},w=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},I=function(e,t){return function(a,o){t(a,o,e)}};let A=class{constructor(e,t,a){this.store=e,this.selectedPortActions=t,this.tsmodelActions=a}dispatchLoadOneYearPortCostHistory(e){const t=new Date,a=t.toJSON(),o=new Date(t.getFullYear()-1,t.getMonth(),t.getDate()).toJSON(),r=[];r.push({field:"voyage.voyageHeader.isEstimate",filterGroupCode:"PORT_DRAWER_FILTER_GROUP_CODE",operator:j.c.EQUALS,queryParamName:"voyage.voyageHeader.isEstimate",type:j.d.NUMBER,value:"0"}),r.push({field:"voyage.voyageHeader.isTemplate",filterGroupCode:"PORT_DRAWER_FILTER_GROUP_CODE",operator:j.c.EQUALS,queryParamName:"voyage.voyageHeader.isTemplate",type:j.d.NUMBER,value:"0"}),r.push({field:"voyage.voyageHeader.isUnallocated",filterGroupCode:"PORT_DRAWER_FILTER_GROUP_CODE",operator:j.c.EQUALS,queryParamName:"voyage.voyageHeader.isUnallocated",type:j.d.NUMBER,value:"0"}),r.push({field:"voyage.voyageHeader.voyageStartDate",filterGroupCode:"PORT_DRAWER_FILTER_GROUP_CODE",operator:j.c.GREATER_THAN,queryParamName:"voyage.voyageHeader.voyageStartDate",type:j.d.DATE,value:o}),r.push({field:"voyage.voyageHeader.voyageStartDate",filterGroupCode:"PORT_DRAWER_FILTER_GROUP_CODE",operator:j.c.LESS_THAN,queryParamName:"voyage.voyageHeader.voyageStartDate",type:j.d.DATE,value:a}),r.push({field:"port.key",filterGroupCode:"PORT_DRAWER_FILTER_GROUP_CODE",operator:j.c.EQUALS,queryParamName:"port.key",type:j.d.NUMBER,value:e});const n={field:"eventLogs[0].eventLogDate",groupCode:"load_portcost_history",operator:E.b.DESC,queryParamName:"eventLogs[0].eventLogDate"};this.tsmodelActions.loadMultipleAction({fields:C.g,filters:r,headers:{},identifier:"PORT_DRAWER_LIST_ID_"+e,pageItemLimit:void 0,pageNumber:void 0,sorts:[n],type:v.a.portcall})}dispatchSetSelectedPort(e){this.store.dispatch(this.selectedPortActions.setSelectedPortAction(e))}};A=L([Object(R.injectable)(),I(0,Object(R.inject)(T.a.Store)),I(1,Object(R.inject)(T.a.ISelectedPortActions)),I(2,Object(R.inject)(T.a.ITSModelActionsAsync)),w("design:paramtypes",["function"==typeof(o=void 0!==D.Store&&D.Store)?o:Object,"function"==typeof(r=void 0!==S.ISelectedPortActions&&S.ISelectedPortActions)?r:Object,"function"==typeof(n=void 0!==k.ITSModelActionsAsync&&k.ITSModelActionsAsync)?n:Object])],A);const x=[{content:"Vessel Name",contentType:p.a.TEXT},{content:"DWT",contentType:p.a.NUMBER},{content:"Reason for Call",contentType:p.a.TEXT},{content:"Arrival Date",contentType:p.a.DATE},{content:"Days in Port",contentType:p.a.NUMBER},{content:"Port Cost",contentType:p.a.NUMBER},{content:"Currency",contentType:p.a.TEXT}];class N extends l.Component{constructor(e){var t;super(e),this.internationalization=new O.a,this.lang=this.internationalization.getLanguageFile(),this.number=0,this.state=Object.assign(Object.assign({},e.state),{items:null!==(t=this.generateTableRows(e.state.portcalls))&&void 0!==t?t:[],portId:null}),this.controller=e.controller,this.getPortId=this.getPortId.bind(this),this.loadPort=this.loadPort.bind(this)}UNSAFE_componentWillMount(){this.getPortId(this.props.match)}UNSAFE_componentWillReceiveProps(e){this.getPortId(e.match),this.setState(Object.assign(Object.assign({},e.state),{items:this.generateTableRows(e.state.portcalls)}))}loadPort(){const{portId:e}=this.state;e&&(this.controller.dispatchSetSelectedPort(e),this.controller.dispatchLoadOneYearPortCostHistory(e))}getPortId(e){if(e){const t=e.params.drawerId?e.params.drawerId:"0",a=parseInt(t,10);a!==this.state.portId&&this.setState({portId:a},()=>this.loadPort())}}generateTableRows(e){if(e)return e.sort(g.a.sortByEventLogDate),e.map((e,t)=>{const a=g.a.getEventLogDate(e.eventLogs,"ARR"),o=e.voyage&&e.voyage.vessel?e.voyage.vessel.vesselName:"",r=e.voyage&&e.voyage.vessel?Math.round(e.voyage.vessel.dwtSummer):"",n=e.reasonForCall?e.reasonForCall.reasonForCall:"",{daysInPort:l}=e,i=e.voyage&&e.voyage.voyageCurrency?e.voyage.voyageCurrency.currencyCode:"";return{content:[o,r,n,a,l,Math.round(e.portCost),i],id:e.key}})}render(){const{portcalls:e,portId:t,userLocale:a}=this.state;let o="";return e&&e[0]&&e[0].port&&e[0].port.portName&&(o=e[0].port.portName),t?i.a.createElement(c.a,{reactKeyPrefix:"doc-common-components-drawer-port-drawer",subject:"Port",subjectName:o,subjectLoaded:!!e,drawerKey:t,key:d.a.portDrawer+t,drawerRoute:d.a.portDrawer,tsModelType:v.a.port,reloadParentDrawer:()=>{},tabs:[{id:"main-details",content:()=>i.a.createElement(u.a,{headers:x,data:this.state.items,reactKeyPrefix:"doc-common-components-drawer-port-drawer",title:this.lang.model.portCostHistory,userLocale:a,customisation:{responsive:!0}}),label:this.lang.common.mainDetails}],tabId:this.props.match.params.tabId}):null}}const F=Object(b.a)(e=>{const t=f.a.get(e),a=null!==t?t:0;return{filters:[],port:t,portcalls:y.a.getTSModelsBuilt(e,v.a.portcall,C.g,"PORT_DRAWER_LIST_ID_"+a),userLocale:h.a.getUserLocale(e)}},Object(m.a)(P.a.IPortDrawerController,Object(s.k)(N)))},279:function(e,t,a){"use strict";a.d(t,"d",(function(){return o})),a.d(t,"a",(function(){return r})),a.d(t,"e",(function(){return n})),a.d(t,"b",(function(){return l})),a.d(t,"c",(function(){return i}));const o="PORT_CALL_PORT_SERVICES_ORDERS_IDENTIFIER",r="PORT_CALL_BUNKER_ORDERS_IDENTIFIER ",n="PORT_CALL_POSITION_REPORTS_IDENTIFIER",l="PORT_CALL_CARGO_PORTS_IDENTIFIER",i="PORT_CALL_NOT_TO_COUNTS_IDENTIFIER"},938:function(e,t,a){"use strict";a.d(t,"b",(function(){return f}));a(59),a(10),a(11);var o,r=a(279),n=a(9),l=a(50),i=a(7),s=a(29),c=a(1),d=a(89),p=a(184),u=a(887),m=a(131),b=function(e,t,a,o){var r,n=arguments.length,l=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,a):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,o);else for(var i=e.length-1;i>=0;i--)(r=e[i])&&(l=(n<3?r(l):n>3?r(t,a,l):r(t,a))||l);return n>3&&l&&Object.defineProperty(t,a,l),l},v=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},g=function(e,t){return function(a,o){t(a,o,e)}},y=function(e,t,a,o){return new(a||(a=Promise))((function(r,n){function l(e){try{s(o.next(e))}catch(e){n(e)}}function i(e){try{s(o.throw(e))}catch(e){n(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(l,i)}s((o=o.apply(e,t||[])).next())}))};let f=class{constructor(e){this.tsmodelActions=e}updatePortCall(e,t,a){return y(this,void 0,void 0,(function*(){let o;if("percentExtraAtSea"===t){const t=l.a.calculateDaysExtraAtSea(e,a);o={percentExtraAtSea:t.percentExtraAtSea,daysExtraAtSea:t.daysExtraAtSea}}else if("daysExtraAtSea"===t){const t=l.a.calculatePercentExtraAtSea(e,a);o={percentExtraAtSea:t.percentExtraAtSea,daysExtraAtSea:t.daysExtraAtSea}}else o={[t]:a};this.tsmodelActions.updateSingleAction({data:o,key:e.key,type:c.a.portcall,headers:m.a.smartJson})}))}getAllEvents(e){return y(this,void 0,void 0,(function*(){return this.tsmodelActions.loadMultipleAction({fields:{eventCode:"*",eventDesc:"*",isLaytimeEvent:"*",eventType:"*"},query:`filter=vesselCategories.vesselCategoryCode(EQ)${null!=e?e:"BULK"}&sort=eventNo(AS)`,type:c.a.event}).then(({entities:e})=>e)}))}updateEventLog(e,t){this.tsmodelActions.updateSingleAction({key:e,type:c.a.eventlog,data:{eventLogDate:t},headers:m.a.smartJson})}createEventLogs({cargoPortKey:e,eventCode:t},a,o,r,n,l,i){var s,p;const b=n.find(e=>(null==e?void 0:e.eventCode)===t),v=null!=e?e:a,g=null==b?void 0:b.isLaytimeEvent,y=null===(s=null==l?void 0:l.laytimeCalculation)||void 0===s?void 0:s.key,f=a?(null!==(p=null==i?void 0:i.cargoPorts)&&void 0!==p?p:[]).filter(e=>e.laytimeCalculation).map(e=>{var t;return null===(t=e.laytimeCalculation)||void 0===t?void 0:t.key}):[];v&&this.tsmodelActions.updateSingleAction({key:v,type:e?c.a.cargoport:c.a.portcall,data:{eventLogs:[...Object(u.a)(o,d.a),Object.assign({eventLogDate:r,event:t},g?a&&f?{laytimeCalculations:f.map(e=>({key:e}))}:y?{laytimeCalculations:[{key:y}]}:{}:{})]},headers:m.a.smartJson})}loadPortCallPortServicesOrders(e,t){this.tsmodelActions.loadMultipleAction({fields:p.e,query:"filter=portCall.key(EQ)"+e,type:c.a.serviceorder,identifier:r.d,overwriteKeysOnLoad:!0,callback:t})}loadBunkerOrders(e,t){this.tsmodelActions.loadMultipleAction({fields:p.a,query:"filter=portCall(EQ)"+e,type:c.a.bunkerorder,overwriteKeysOnLoad:!0,identifier:r.a,callback:t})}loadPositionReports(e,t){this.tsmodelActions.loadMultipleAction({fields:p.f,query:"filter=portCall(EQ)"+e,type:c.a.positionreport,overwriteKeysOnLoad:!0,identifier:r.e,callback:t})}loadCargoPorts(e,t){this.tsmodelActions.loadMultipleAction({fields:p.b,query:"filter=portCall(EQ)"+e,type:c.a.cargoport,overwriteKeysOnLoad:!0,identifier:r.b,callback:t})}loadNotToCounts(e,t){this.tsmodelActions.loadMultipleAction({fields:p.d,query:"filter=portCall(EQ)"+e,type:c.a.nottocount,overwriteKeysOnLoad:!0,identifier:r.c,callback:t})}};f=b([Object(n.injectable)(),g(0,Object(n.inject)(i.a.ITSModelActionsAsync)),v("design:paramtypes",["function"==typeof(o=void 0!==s.ITSModelActionsAsync&&s.ITSModelActionsAsync)?o:Object])],f)}}]);