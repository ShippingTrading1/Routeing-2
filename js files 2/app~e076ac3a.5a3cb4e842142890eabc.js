(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{1197:function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return o}));const r={eventLogs:{event:{eventCode:"*"},eventLogDate:"*"},port:{portName:"*"},reasonForCall:{reasonForCallDesc:"*"},voyage:{vessel:{vesselName:"*"},voyageHeader:{referenceNo:"*"},voyageStartDateGMT:"*"}},o={voyage:{vessel:{vesselName:"*"}}}},1252:function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));var r=a(19),o=a(1),n=a(16),l=a(287),i=a(169),s=a(0),c=a.n(s);function d(e,t,a,s,d,u){var m,p;const{model:g}=d.getLanguageFile(),{entityRelease:b}=u,y=[{field:g.blClassName,groupCode:"BL_CLASS_SORT_GROUP",operator:n.b.ASC,queryParamName:"className"}],C={reactKeyPrefix:e,disableUpdate:!0,fieldOptions:[{fieldName:"blClass",label:g.blClassName,formControlProps:{required:!0},onUpdateOverride:a.bind(null,"blClass"),typeaheadProps:{objectPaths:["className"],query:b?"filter=entityRelease.releaseNumber(EQ)"+b.releaseNumber:"&"+Object(l.b)(y),type:o.a.blclass,shouldPreload:!0}},{fieldName:"table",label:g.objectName,formControlProps:{required:!0},onUpdateOverride:e=>{a("table",e),a("field",t.field)},typeaheadProps:{objectPaths:["objectName"],fields:{objectName:"*"},type:o.a.table,shouldPreload:!0}},{fieldName:"field",label:g.attributeName,formControlProps:{required:!0},onUpdateOverride:a.bind(null,"field"),typeaheadProps:{objectPaths:["attributeName"],fields:{attributeName:"*"},type:o.a.field,shouldPreload:!0,disableLoadingIndicator:!1,query:"filter=table.objectName(EQ)"+(null!==(p=null===(m=t.table)||void 0===m?void 0:m.objectName)&&void 0!==p?p:null)}},{fieldName:"isConsecutive",formControlProps:{required:!0},overrideComponent:c.a.createElement(i.a,{reactKeyPrefix:e+"isConsecutive",checked:!!t.isConsecutive&&t.isConsecutive,label:g.isConsecutive,onInputChange:a.bind(null,"isConsecutive")})}],object:t,type:o.a.blgraph,userLocale:s};return Object(r.a)(C)}},1253:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var r=a(19),o=a(1);function n(e,t,a,n,l){const{model:i}=l.getLanguageFile(),s={reactKeyPrefix:e,disableUpdate:!0,fieldOptions:[{fieldName:"className",label:i.blClassName,formControlProps:{required:!0},onUpdateOverride:a.bind(null,"className"),typeaheadProps:{objectPaths:["className"]}}],object:t,type:o.a.blclass,userLocale:n};return Object(r.a)(s)}},1254:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var r=a(19),o=a(16),n=a(1),l=a(287);function i(e,t,a,i,s,c){const{model:d}=s.getLanguageFile(),{entityRelease:u}=c,m=[{field:d.blClassName,groupCode:"BL_CLASS_SORT_GROUP",operator:o.b.ASC,queryParamName:"className"}],p={reactKeyPrefix:e,disableUpdate:!0,fieldOptions:[{fieldName:"blClass",label:d.blClassName,formControlProps:{required:!0},onUpdateOverride:a.bind(null,"blClass"),typeaheadProps:{objectPaths:["className"],query:u?"filter=entityRelease.releaseNumber(EQ)"+u.releaseNumber:"&"+Object(l.b)(m),shouldPreload:!0}}],object:t,type:n.a.blskipgraph,userLocale:i};return Object(r.a)(p)}},1275:function(e,t,a){"use strict";a.d(t,"a",(function(){return $}));a(10),a(11),a(118);var r=a(2517),o=a(2377),n=a(214),l=a(0),i=a.n(l),s=a(97),c=a(1196),d=a(83),u=a(1216),m=a(15),p=a(44),g=a(329),b=a(6),y=a(1411),C=a(47),f=a(280),h=a(1),v=a(152),P=a(32),O=a(7),k=a(21),j=a(1237),T=a(374),S=a(42),L=a(27),D=a(422),E=a(3),x=a(299),F=a(642),N=a(1197),M=a(28),w=a(37),I=a(12),A=a(19),R=a(88),B=a(86);class U extends i.a.PureComponent{constructor(e){super(e),this.internationalization=new R.a,this.lang=this.internationalization.getLanguageFile(),this.state={bunkerBroker:void 0,bunkerSupplier:void 0},this.onChangeSupplier=this.onChangeSupplier.bind(this),this.onChangeExtraCost=this.onChangeExtraCost.bind(this),this.onChangeExternalReferenceNo=this.onChangeExternalReferenceNo.bind(this),this.onChangeDelDate=this.onChangeDelDate.bind(this),this.onChangeBroker=this.onChangeBroker.bind(this),this.getNewBunkerOrderHorizontalListData=this.getNewBunkerOrderHorizontalListData.bind(this),this.getCreateBunkerOrderModalColSpec=this.getCreateBunkerOrderModalColSpec.bind(this)}getNewBunkerOrderHorizontalListData(e){if(e)return this.getCreateBunkerOrderModalColSpec(this.props.reactKeyPrefix,e,this.props.userLocale)}getCreateBunkerOrderModalColSpec(e,t,a){const{model:r}=this.lang,{bunkerBroker:o,bunkerSupplier:n}=this.state,l=v.b.getCurrency(t),i={disableUpdate:!0,fieldOptions:[{label:r.supplier,fieldName:"bunkerSupplier",typeaheadProps:{reactKeyPrefix:"bunker-order-bunker-supplier-"+t.key,objectPaths:B.b.businessPartner,defaultSelectedOptions:n,type:h.a.businesspartner,fields:B.a.businessPartner},onUpdateOverride:this.onChangeSupplier},{fieldName:"currency",disabled:!0,typeaheadProps:{shouldPreload:!0}},{fieldName:"extraCost",numberInputProps:{onChange:e=>this.onChangeExtraCost(e),maskSettings:M.a.mask2},InputProps:{endAdornment:l}},{label:r.externalReference,fieldName:"externalReferenceNo",textInputProps:{onInputChange:e=>this.onChangeExternalReferenceNo(e)}},{fieldName:"bunkerBroker",typeaheadProps:{reactKeyPrefix:"bunker-order-bunker-supplier-"+t.key,objectPaths:B.b.businessPartner,defaultSelectedOptions:o,type:h.a.businesspartner},onUpdateOverride:this.onChangeBroker},{onUpdateOverride:this.onChangeDelDate,fieldName:"bunkeredDate",label:r.bunkeredDate}],object:t,type:h.a.bunkerorder,userLocale:a,reactKeyPrefix:e};return Object(A.a)(i)}getBOHorizontalListData(){const{bunkerOrder:e}=this.props;if(e)return this.getNewBunkerOrderHorizontalListData(e)}onChangeSupplier(e){if(e){const t=new f.a(Object.assign(Object.assign({},this.props.bunkerOrder),{bunkerSupplier:e}));this.props.onChange(t),this.setState(Object.assign(Object.assign({},this.state),{bunkerSupplier:e}))}}onChangeBroker(e){if(e){const t=new f.a(Object.assign(Object.assign({},this.props.bunkerOrder),{bunkerBroker:e}));this.props.onChange(t),this.setState(Object.assign(Object.assign({},this.state),{bunkerBroker:e}))}}onChangeDelDate(e){if(e){const t=new f.a(Object.assign(Object.assign({},this.props.bunkerOrder),{bunkeredDate:e}));this.props.onChange(t)}}onChangeExtraCost(e){if(e){const t=new f.a(Object.assign(Object.assign({},this.props.bunkerOrder),{extraCost:e}));this.props.onChange(t)}}onChangeExternalReferenceNo(e){if(e){const t=new f.a(Object.assign(Object.assign({},this.props.bunkerOrder),{externalReferenceNo:e}));this.props.onChange(t)}}render(){return i.a.createElement(w.a,{reactKeyPrefix:"bunkerOrderData",items:this.getBOHorizontalListData(),breakpoints:I.d})}}var q=a(734),K=a(187);var Q=a(50),V=a(102),_=a(81),H=a(1816),W=a(20),z=a(695);class G extends i.a.Component{constructor(e){if(super(e),this.onChangeBunkerOrderLines=e=>{const{bunkerOrder:t}=this.state,a=new f.a(Object.assign(Object.assign({},t),{bunkerOrderLines:[...e]}));this.setState({bunkerOrder:a,bunkerOrderLines:[...e]})},this.onUpdateBunkerOrder=e=>{this.setState({bunkerOrder:e})},this.closeModal=()=>{const{deselectPortCall:e=!0,createFromPortCallDrawer:t}=this.props;e&&this.controller.deselectPortCall(),t||this.controller.deselectVessel(),this.props&&this.props.onClose&&this.props.onClose()},this.state=Object.assign(Object.assign({},e.state),{bunkerOrder:new f.a({key:0})}),this.i=this.props.deps[0],this.controller=e.controller,this.props.preSelectedPortCallKey){const e=this.props.preSelectedPortCallKey;e>0&&(this.controller.loadPortCallAndSetAsSelected(e),this.setDefaultBunkerOrderCurrency(e))}this.controller.loadBunkerTypes(),this.controller.loadAllBunkerStatuses(),this.onCreateBunkerOrder=this.onCreateBunkerOrder.bind(this),this.onChangePortCall=this.onChangePortCall.bind(this),this.closeModalOnCreate=this.closeModalOnCreate.bind(this),this.onChangeVessel=this.onChangeVessel.bind(this),this.setDefaultBunkerOrderCurrency=this.setDefaultBunkerOrderCurrency.bind(this)}shouldComponentUpdate(e,t){return Object(y.a)(this.props,e)||t!==this.state}UNSAFE_componentWillReceiveProps(e){let t=Object(D.b)(this.state.bunkerOrder.bunkerOrderLines,e.state.bunkerOrderLines,H.a);e.state.selectedPortCall===this.state.selectedPortCall&&e.state.selectedVessel===this.state.selectedVessel||(t=e.state.bunkerOrderLines);if(Object(y.a)(this.props,e)){const a=Object.assign(Object.assign({},e.state),{bunkerOrder:new f.a(Object.assign(Object.assign({},this.state.bunkerOrder),{bunkerOrderLines:t,bunkerOrderStatus:v.b.getStatusTypeByCode(e.state.statusTypes,v.a.Requirement),currency:this.state.bunkerOrder?this.state.bunkerOrder.currency:void 0,portCall:e.state.selectedPortCall,extraCost:e.state.selectedPortCall?e.state.selectedPortCall.bunkerExtraCost:0}))});this.setState(a)}}onChangePortCall(e){e&&(this.controller.setPortCallAndLoadBunkerOrderLines(e.key),this.setDefaultBunkerOrderCurrency(e.key))}setDefaultBunkerOrderCurrency(e){const{bunkerOrder:t}=this.state,{deps:[,a,r]}=this.props;e&&r.getSingle({authdata:Object(P.a)(a.getState()).authdata||"",overrideUrl:"Currency/BunkerOrder/"+e,fields:{currencyCode:"*"},key:"",type:h.a.currency}).then(e=>{t.currency=e,this.setState({bunkerOrder:t})})}onChangeVessel(e){this.controller.deselectPortCall(),this.controller.clearPortCallsState(),this.controller.setSelectedVessel(Object(_.a)(e,"key",0)),this.controller.loadPortCallsForVessel(Object(_.a)(e,"key",0))}getPortCallSelector(e){const{portCalls:t,selectedPortCall:a}=this.state,{model:r}=this.i.getLanguageFile(),{disablePortCallSelector:o=!1}=this.props,n=t?t.sort((e,t)=>e.key>t.key?-1:e.key===t.key?0:1):[];return i.a.createElement(V.a,{label:r.portCall,options:n,defaultSelectedOptions:a,reactKeyPrefix:this.props.reactKeyPrefix+"bunker-order-port-call-selector",disabled:!e||o,onChange:this.onChangePortCall,resolver:Q.a.getPortCallValueStr,formControlProps:{required:!0},overrideDefaultSelectedOptions:!0})}getVesselSelector(){const{model:e}=this.i.getLanguageFile(),{disablePortCallSelector:t=!1}=this.props;return i.a.createElement(V.b,{label:e.vessel,defaultSelectedOptions:this.state.selectedVessel,reactKeyPrefix:this.props.reactKeyPrefix+"bunker-order-vessel-selector",itemsToShow:10,onChange:this.onChangeVessel,type:h.a.vessel,objectPaths:["vesselName"],formControlProps:{required:!0},overrideDefaultSelectedOptions:!0,disabled:t,shouldPreload:!0})}getBunkerOrderLines(){const{userLocale:e,bunkerTypes:t,bunkerOrder:{bunkerOrderLines:a},selectedPortCall:n,user:l}=this.state,{reactKeyPrefix:s}=this.props,c=!a||a&&0===a.length?[]:a,d=0===a.length?i.a.createElement(r.a,{colSpan:a.length},i.a.createElement(o.a,null,this.i.getLanguageFile().bo.oneBunkerOrderLineRequired)):void 0;return i.a.createElement(u.a,{reactKeyPrefix:s+"bunker-order-lines",bunkerOrderLines:c,bunkerTypes:t,addButtonDisabled:!n,userLocale:e,user:l,onChange:this.onChangeBunkerOrderLines,footer:d})}onCreateBunkerOrder(){const{bunkerOrder:e,selectedPortCall:t}=this.state,{openDrawerAfterCreate:a}=this.props;if(t&&e){const r=new f.a(Object.assign(Object.assign({},e),{portCall:{key:t.key}}));this.controller.deselectPortCall(),this.controller.clearPortCallsState(),this.controller.createBunkerOrder(r,this.closeModalOnCreate,a),this.controller.setPortCallAndLoadBunkerOrderLines(t.key),this.closeModal()}}closeModalOnCreate(e,t){const{openDrawerAfterCreate:a,onCloseModalOnCreate:r,setPreselectedBunkerOrderKey:o}=this.props;r&&r(),t&&(o&&o(t.key),a&&L.a.openDrawer(t.key,m.a.bunkerOrderDrawer,this.props.location,this.props.history))}render(){const{bunkerOrder:e,selectedPortCall:t,userLocale:a,bunkerOrderLines:r,selectedVessel:o}=this.state,{reactKeyPrefix:l}=this.props,{common:s,bo:c}=this.i.getLanguageFile(),d=!t||v.b.isBOLineDataMissing(r);return i.a.createElement(p.a,{reactKeyPrefix:l,open:!0,onCloseModal:this.closeModal,maxWidth:"md",fullWidth:!0,title:c.createBunkerOrder,onConfirm:this.onCreateBunkerOrder,confirmBtnName:s.create,disableConfirmBtn:d,fullscreenOnMobile:!0},i.a.createElement(n.a,{container:!0,spacing:2},i.a.createElement(n.a,{item:!0,xs:12,sm:6},this.getVesselSelector()),i.a.createElement(n.a,{item:!0,xs:12,sm:6},this.getPortCallSelector(o?o.key:null))),i.a.createElement(U,{reactKeyPrefix:l+"h-list",bunkerOrder:e,userLocale:a,onChange:this.onUpdateBunkerOrder}),this.getBunkerOrderLines())}}const $=Object(b.b)([E.a.IInternationalization,O.a.Store,d.a.ITSModelApi],Object(C.a)(e=>{const t=j.a.getPortCall(e),a=T.a.getSelectedVessel(e),r=k.a.getTSModelsBuilt(e,h.a.bunkertype,F.a,q.a),o=Object(P.a)(e),n=S.a.getUserLocale(e),l=k.a.getTSModelsBuilt(e,h.a.statustype,x.b,q.b),i=k.a.getTSModelsBuilt(e,h.a.bunkerorderline,c.a,q.d),s=k.a.getTSModelsBuilt(e,h.a.portcall,N.a,q.e);return{bunkerOrderLines:i,bunkerTypes:r,currencies:k.a.getTSModelsBuilt(e,h.a.currency,{currencyCode:"*"}),portCalls:s,selectedPortCall:t,selectedVessel:a,statusTypes:l,user:o,userLocale:n}},Object(g.a)(W.a.ICreateBunkerOrderController,Object(s.k)(Object(z.a)(e=>Object(K.a)({footer:{marginTop:e.spacing(4)}}))(G)))))},1283:function(e,t,a){"use strict";a.d(t,"a",(function(){return B}));a(10),a(11),a(118);var r=a(214),o=a(0),n=a.n(o),l=a(20),i=a(660),s=a(6),c=a(64),d=a(74),u=a(62),m=a(50),p=a(3),g=a(575),b=a(23),y=a(44),C=a(71),f=a(37),h=a(12),v=a(42),P=a(955);function O(e,t){const{cargoPort:a,portCalls:r=[],cargo:o}=t;let n=[],l=new c.a(Object.assign(Object.assign({},a),e));return(null==o?void 0:o.voyage)&&({cp:l,pcs:n}=P.a.handleAdd(r,l,o.voyage)),{updatedPortCalls:n,updatedCargoPort:l}}const k={onChangePort:function(e){return O({port:e.value.port,terminal:e.value.terminal},e)},updatePortCalls:function(e,t){return t.filter(({key:t})=>{var a;return t<0&&t===(null===(a=e.portCall)||void 0===a?void 0:a.key)||t>0})},updateReasonForCall:function(e){return O({reasonForCall:e.value},e)}};var j=a(1228),T=a(1),S=a(81),L=a(19),D=a(28),E=a(38),x=a(186);var F=a(403),N=a(147),M=a(58),w=a(406),I=a(532),A=a(217);const R=new c.a({laytimeTermsMeasurement:Object(A.a)()});function B(e){var t,a,P;const{cargo:O,closeDialog:A,selectedCargoPort:B,showModal:U,reactKeyPrefix:q}=e,[K,Q,V,_]=Object(s.a)([p.a.IInternationalization,l.a.ICreateCargoPortController,l.a.IEditCargoPortController,l.a.ICreateEditCargoPortDNDController]),{common:H,model:W}=K.getLanguageFile(),z=Object(o.useMemo)(()=>!O.voyage,[O.voyage]),[G,$]=Object(o.useState)(null!=B?B:R),[Y,X]=Object(o.useState)(null!==(t=O.cargoPorts)&&void 0!==t?t:[]),[J,Z]=Object(o.useState)((null!==(P=new u.a(null!==(a=null==O?void 0:O.voyage)&&void 0!==a?a:{}).partOfSchedule.filter(e=>{var t,a,r,o;return(null===(t=null==e?void 0:e.voyage)||void 0===t?void 0:t.key)===(null===(a=e.ownedByVoyage)||void 0===a?void 0:a.key)&&(null===(r=null==e?void 0:e.voyage)||void 0===r?void 0:r.key)===(null===(o=O.voyage)||void 0===o?void 0:o.key)}))&&void 0!==P?P:[]).sort(m.a.sortByPortCallSequence)),ee=Object(I.a)(),te=Object(o.useMemo)(()=>M.a.getLastLoadCargoPort(O.cargoPorts),[O]),ae=Object(o.useMemo)(()=>M.a.getLastDischargeCargoPort(O.cargoPorts),[O]),re=Object(o.useCallback)(({updatedCargoPort:e,updatedPortCalls:t})=>{$(e),X(V.updateStateCargoPorts(e,O));const a=k.updatePortCalls(e,t);Z(a)},[O,V]),oe=Object(o.useCallback)((e,t)=>{const a="reasonForCall"===t?e:G.reasonForCall,r=a&&!G.key?N.a.getNextSequenceNo(Y.filter(({key:e})=>e!==G.key),a):G.cargoPortSequence;return{portCalls:J,value:e,rfc:a,cargoPort:Object.assign(Object.assign({},G),{cargoPortSequence:r}),cargoPorts:Y,isUnallocated:z,cargo:O}},[O,z,J,G,Y]),ne=Object(o.useCallback)((e,t)=>{const a=k.onChangePort(oe(t));re(a)},[re,oe]),le=Object(o.useCallback)((e,t)=>{const{updatedCargoPort:a,updatedPortCalls:r}=k.updateReasonForCall(oe(t,e));let o=0,n=new F.a({}),l=new w.a({}),i=0;"L"===t.reasonForCall&&te?({laytimeTermsValue:o,laytimeTermsMeasurement:n,laytimeTerms:l,freightRate:i}=te):"D"===t.reasonForCall&&ae&&({laytimeTermsValue:o,laytimeTermsMeasurement:n,laytimeTerms:l,freightRate:i}=ae);const s=new c.a(Object.assign(Object.assign({},a),{laytimeTermsValue:o,laytimeTermsMeasurement:0!==(null==n?void 0:n.key)?n:void 0,laytimeTerms:0!==(null==l?void 0:l.key)?l:void 0,freightRate:i}));re({updatedCargoPort:s,updatedPortCalls:r})},[ae,te,re,oe]),ie=Object(o.useCallback)(e=>{const t=_.onDragEnd(e,G,J,Y,O);t&&($(t.updatedCargoPort),X(t.updatedCargoPorts),Z(t.updatedPortCalls))},[O,_,J,G,Y]),se=Object(o.useCallback)(()=>{B?V.onConfirmEdit(B,G,O,J,Y):Q.onConfirmCreate(O,J,G,Y),A()},[O,A,Q,V,J,B,G,Y]),ce=Object(o.useMemo)(()=>({stateCargoPort:G,isUnallocated:z,selectedCargoPort:B,portCalls:J}),[z,J,B,G]),de=[7,5],ue={cargo:O,selectedCargoPort:B},me=Object(b.a)(v.a.getUserLocale),pe=Object(o.useCallback)((e,t)=>{const a={port:ne,reasonForCall:le};let r;return r="port"===e?new c.a(Object.assign(Object.assign({},G),{[e]:t.port,terminal:t.terminal})):new c.a(Object.assign(Object.assign({},G),{[e]:t})),a[e]?a[e](e,t):re({updatedCargoPort:r,updatedPortCalls:J})},[ne,le,re,J,G]),ge=function(e,t,a,r,o,n,l,i){var s,c,d,u;const{common:m,model:p}=n.getLanguageFile(),{getPortTerminalLabel:g}=x.a,{cargo:b,selectedCargoPort:y}=l,C=Object(S.a)(t,"reasonForCall.reasonForCall"),f=null!==(c=null===(s=null==b?void 0:b.cargoMeasurement)||void 0===s?void 0:s.measurementCode)&&void 0!==c?c:"",v=null!==(u=null===(d=null==b?void 0:b.freightCurrency)||void 0===d?void 0:d.currencyCode)&&void 0!==u?u:"",P=!y,O=i.map(e=>Object.assign(Object.assign({},e),{label:g(null==e?void 0:e.port,null==e?void 0:e.terminal)})),k=e=>e.label;let j;j=P?[{fieldName:"port",formControlProps:{required:!0},label:n.getLanguageFile().model.port,typeaheadProps:{defaultSelectedOptions:t.port?{label:g(t.port,t.terminal),port:t.port,terminal:t.terminal}:null,resolver:k,options:O},onUpdateOverride:a.bind(null,"port")},{fieldName:"reasonForCall",formControlProps:{required:!0},typeaheadProps:{shouldPreload:!0,fields:{reasonForCall:"*",reasonForCallDesc:"*"},query:"filter=reasonForCall(IN)(L,D)",objectPaths:["reasonForCallDesc"]},onUpdateOverride:a.bind(null,"reasonForCall")},{fieldName:"laytimeTermsValue",label:"L"===C?p.loadRate:p.dischargeRate,numberInputProps:{maskSettings:D.a.mask2},onUpdateOverride:a.bind(null,"laytimeTermsValue"),breakpoints:h.f},{fieldName:"laytimeTermsMeasurement",label:p.rule,typeaheadProps:{reactKeyPrefix:e+"-load-laytime-terms-measurement",fields:{laytimeTermsMeasurementName:"*",laytimeTermsMeasurementCode:"*"},objectPaths:["laytimeTermsMeasurementName"],shouldPreload:!0,isClearable:!1},onUpdateOverride:a.bind(null,"laytimeTermsMeasurement"),breakpoints:h.f},{fieldName:"laytimeTerms",label:"L"===C?p.loadLaytimeTerms:p.dischargeLaytimeTerms,typeaheadProps:{reactKeyPrefix:e+"-load-laytime-terms-measurement",objectPaths:["laytimeTerms"],shouldPreload:!0},onUpdateOverride:a.bind(null,"laytimeTerms"),breakpoints:h.h},{InputProps:{endAdornment:f},fieldName:"cargoQuantity",numberInputProps:{maskSettings:D.a.mask1},onUpdateOverride:a.bind(null,"cargoQuantity"),breakpoints:h.h},{InputProps:{endAdornment:v},fieldName:"freightRate",numberInputProps:{maskSettings:D.a.mask19},onUpdateOverride:a.bind(null,"freightRate"),disabled:"D"!==C,breakpoints:h.h},{fieldName:"handlingCostRate",numberInputProps:{maskSettings:D.a.mask7},onUpdateOverride:a.bind(null,"handlingCostRate"),breakpoints:h.h},{fieldName:"handlingCostCurrency",formControlProps:{required:!1},typeaheadProps:{shouldPreload:!0,objectPaths:["currencyCode"]},onUpdateOverride:a.bind(null,"handlingCostCurrency"),breakpoints:h.h},{fieldName:"hcMeasurement",formControlProps:{required:!1},label:p.handlingCostMeasurement,typeaheadProps:{objectPaths:["measurementCode"],shouldPreload:!0},onUpdateOverride:a.bind(null,"hcMeasurement"),breakpoints:h.h},{fieldName:"isHandlingCostLumpsum",label:p.isHandlingCostLumpsum,onUpdateOverride:a.bind(null,"isHandlingCostLumpsum"),breakpoints:h.h}]:[{fieldName:"port",formControlProps:{required:!0},label:n.getLanguageFile().model.port,typeaheadProps:{defaultSelectedOptions:t.port?{label:g(t.port,t.terminal),port:t.port,terminal:t.terminal}:null,resolver:k,options:O},onUpdateOverride:a.bind(null,"port")},{fieldName:"reasonForCall",disabled:!0,typeaheadProps:{shouldPreload:!0}},{InputProps:{endAdornment:f},fieldName:"cargoQuantity",numberInputProps:{maskSettings:D.a.mask1},onUpdateOverride:a.bind(null,"cargoQuantity"),secondaryFieldOption:{fieldName:"isCargoQuantityFixed",label:m.fixed,formControlLabelProps:{labelPlacement:"top",checked:t.isCargoQuantityFixed,componentsProps:{typography:{fontSize:".786rem",color:E.b.bergenRain.secondary[7]}}},onUpdateOverride:a.bind(null,"isCargoQuantityFixed")},breakpoints:h.h},{InputProps:{endAdornment:v},fieldName:"freightRate",numberInputProps:{maskSettings:D.a.mask19},onUpdateOverride:a.bind(null,"freightRate"),disabled:"D"!==C,breakpoints:h.h},{fieldName:"handlingCostRate",numberInputProps:{maskSettings:D.a.mask7},onUpdateOverride:a.bind(null,"handlingCostRate"),breakpoints:h.h},{fieldName:"handlingCostCurrency",formControlProps:{required:!1},typeaheadProps:{shouldPreload:!0,objectPaths:["currencyCode"]},onUpdateOverride:a.bind(null,"handlingCostCurrency"),breakpoints:h.h},{fieldName:"hcMeasurement",formControlProps:{required:!1},label:p.handlingCostMeasurement,typeaheadProps:{objectPaths:["measurementCode"],shouldPreload:!0},onUpdateOverride:a.bind(null,"hcMeasurement"),breakpoints:h.h},{fieldName:"isHandlingCostLumpsum",label:p.isHandlingCostLumpsum,onUpdateOverride:a.bind(null,"isHandlingCostLumpsum"),breakpoints:h.h},{fieldName:"laytimeTermsValue",label:"L"===C?p.loadRate:p.dischargeRate,numberInputProps:{maskSettings:D.a.mask7},onUpdateOverride:a.bind(null,"laytimeTermsValue"),breakpoints:h.h},{fieldName:"laytimeTermsMeasurement",label:p.rule,typeaheadProps:{fields:{laytimeTermsMeasurementCode:"*",laytimeTermsMeasurementName:"*"},objectPaths:["laytimeTermsMeasurementName"],shouldPreload:!0,isClearable:!1},onUpdateOverride:a.bind(null,"laytimeTermsMeasurement"),breakpoints:h.h},{fieldName:"laytimeTerms",label:p.laytimeTerm,typeaheadProps:{objectPaths:["laytimeTerms"],shouldPreload:!0},onUpdateOverride:a.bind(null,"laytimeTerms"),breakpoints:h.h},{fieldName:"laytimeUsed",numberInputProps:{maskSettings:D.a.mask7},onUpdateOverride:a.bind(null,"laytimeUsed"),breakpoints:h.h},{fieldName:"demurrageRate",overrideObject:t,numberInputProps:{maskSettings:D.a.mask7},onUpdateOverride:r.bind(null,"demurrageRate"),breakpoints:h.h},{fieldName:"despatchRate",numberInputProps:{maskSettings:D.a.mask7},onUpdateOverride:a.bind(null,"despatchRate"),breakpoints:h.h},..."D"===C?[{fieldName:"indexRate",label:m.indexRate,onUpdateOverride:a.bind(null,"indexRate"),breakpoints:h.h,numberInputProps:{maskSettings:D.a.mask19}},{fieldName:"tcRateIndex",label:p.tcRateIndex,typeaheadProps:{shouldPreload:!0,query:"filter=marketIndexCategory.marketIndexCategoryCode(EQ)TC&sort=marketIndexCode(AS)",objectPaths:["marketIndexCode"],fields:{marketIndexCode:"*"}},onUpdateOverride:a.bind(null,"tcRateIndex"),breakpoints:h.h}]:[],{fieldName:"isWorking",label:p.working,onUpdateOverride:a.bind(null,"isWorking"),breakpoints:h.h},{fieldName:"isFreeDespatch",label:p.isFreeDespatch,onUpdateOverride:a.bind(null,"isFreeDespatch"),breakpoints:h.h}];const F={reactKeyPrefix:e,disableUpdate:!0,fieldOptions:j,object:t,type:T.a.cargoport,userLocale:o};return Object(L.a)(F)}(q,G,pe,(e,t)=>{var a,r,o,n,l;"BULK"===(null===(l=null===(n=null===(o=null===(r=null===(a=null==G?void 0:G.cargo)||void 0===a?void 0:a.voyage)||void 0===r?void 0:r.vessel)||void 0===o?void 0:o.vesselType)||void 0===n?void 0:n.vesselCategory)||void 0===l?void 0:l.vesselCategoryCode)?re({updatedCargoPort:new c.a(Object.assign(Object.assign({},G),{[e]:t,despatchRate:t/2})),updatedPortCalls:J}):re({updatedCargoPort:new c.a(Object.assign(Object.assign({},G),{[e]:t})),updatedPortCalls:J})},me,K,ue,ee);return n.a.createElement(y.a,{reactKeyPrefix:q,title:`${B?H.edit:H.create} ${W.cargoPort}`,open:U,maxWidth:"md",fullWidth:!0,confirmBtnName:""+(B?H.save:H.create),onCloseModal:A,disableConfirmBtn:g.a.isConfirmButtonDisabled(ce,G),onConfirm:se,disableDraggable:!0},n.a.createElement(r.a,{container:!0,spacing:2},n.a.createElement(r.a,{item:!0,lg:de[0],xs:12},n.a.createElement(C.a,{heightFitsContainer:!0},n.a.createElement(f.a,{reactKeyPrefix:q+"-horizontal_list",key:q+"-horizontal_list",items:ge,breakpoints:h.e}))),n.a.createElement(r.a,{item:!0,lg:de[1],xs:12},n.a.createElement(C.a,{heightFitsContainer:!0},z?n.a.createElement(j.a,{reactKeyPrefix:q+"-cargo-port-timeline",cargo:new d.a(Object.assign(Object.assign({},O),{cargoPorts:[...Y]})),onDropped:ie,hideToolbar:!0}):n.a.createElement(i.a,{reactKeyPrefix:q+"cargo-port-port-call-timeline",voyage:new u.a(Object.assign(Object.assign({},O.voyage),{cargo:Object.assign(Object.assign({},O),{cargoPorts:[G]}),partOfSchedule:J})),selectedCargo:new d.a({cargoPorts:G.portCall?[G]:[]}),onDropped:ie,LeftContainerLayout:g.a.CargoPortsLayoutLeft,selectedCargoPort:B,enableDragOnLeftSide:!0,hideToolbar:!0})))))}},1658:function(e,t,a){"use strict";a.d(t,"a",(function(){return T}));var r,o,n,l,i=a(9),s=a(81),c=a(31),d=a(122),u=a(502),m=a(74),p=a(1),g=a(29),b=a(142),y=a(7),C=a(89),f=a(50),h=a(223),v=a(389),P=a(20),O=function(e,t,a,r){var o,n=arguments.length,l=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,a):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,r);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(l=(n<3?o(l):n>3?o(t,a,l):o(t,a))||l);return n>3&&l&&Object.defineProperty(t,a,l),l},k=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},j=function(e,t){return function(a,r){t(a,r,e)}};let T=class{constructor(e,t,a,r){this.store=e,this.tsModelActions=t,this.cargoDrawerControllerPortCall=a,this.cargoDrawerController=r}getPostableCargo(e,t){const a=f.a.getDefaultEventLogs(),r=t.cargoPorts.map(r=>{var o,n,l,i,s,c,d,u,m;const{portCall:p}=r,g=null===(o=null==r?void 0:r.reasonForCall)||void 0===o?void 0:o.reasonForCall,b=p&&p.key<0?{eventLogs:a,reasonForCall:g,port:null===(n=p.port)||void 0===n?void 0:n.key,terminal:null===(l=p.terminal)||void 0===l?void 0:l.key,voyage:null!==(s=null===(i=p.voyage)||void 0===i?void 0:i.key)&&void 0!==s?s:null===(c=t.voyage)||void 0===c?void 0:c.key}:{key:null==p?void 0:p.key};return Object.assign(Object.assign({},Object(C.a)(r)),{key:e&&r.key>0?r.key:void 0,reasonForCall:g,laytimeTermsMeasurement:null===(d=r.laytimeTermsMeasurement)||void 0===d?void 0:d.laytimeTermsMeasurementCode,laytimeTerms:null===(u=r.laytimeTerms)||void 0===u?void 0:u.key,portCall:p?Object.assign(Object.assign({},b),{portCallSequence:null===(m=r.portCall)||void 0===m?void 0:m.portCallSequence}):void 0})});return Object.assign(Object.assign({},Object(C.a)(t)),{cargoPorts:r})}createCargo(e,t,a,r,o){var n,l;const i=b.a.get(this.store.getState(),p.a.scenario),s={type:p.a.cargo},c=new m.a(Object.assign(Object.assign({},e),{voyage:t?t.key:void 0,scenarios:i&&a?[{key:Number(i)}]:[],stowageFactor:null===(n=e.commodity)||void 0===n?void 0:n.stowageFactor,weightFactor:null===(l=e.commodity)||void 0===l?void 0:l.weightFactorSo})),g=Object(u.d)(s,void 0,c,this.getPostableCargo.bind(null,r));r?this.tsModelActions.updateSingleAction({key:r.key,data:g,type:p.a.cargo,callback:(e,t)=>{o&&o(new m.a(t))},fields:d.b}):this.tsModelActions.createAction({data:g,type:p.a.cargo,callback:(e,t)=>{o&&o(new m.a(t))},fields:d.b})}isConfirmBtnDisabled(e){const{cargoMeasurement:t,cargoPorts:a,freightCurrency:r}=e;let o=!1,n=!1;return a&&a.forEach(e=>{const t=Object(s.a)(e,"reasonForCall.reasonForCall",null);t&&"L"===t?o=!0:t&&"D"===t&&(n=!0)}),!(o&&n&&t&&r)}deleteCopiedCoaTemplate(e){this.cargoDrawerController.deleteCargo(e.key)}};T=O([Object(i.injectable)(),j(0,Object(i.inject)(y.a.Store)),j(1,Object(i.inject)(y.a.ITSModelActionsAsync)),j(2,Object(i.inject)(P.a.ICargoDrawerControllerPortCall)),j(3,Object(i.inject)(P.a.ICargoDrawerController)),k("design:paramtypes",["function"==typeof(r=void 0!==c.Store&&c.Store)?r:Object,"function"==typeof(o=void 0!==g.ITSModelActionsAsync&&g.ITSModelActionsAsync)?o:Object,"function"==typeof(n=void 0!==v.ICargoDrawerControllerPortCall&&v.ICargoDrawerControllerPortCall)?n:Object,"function"==typeof(l=void 0!==h.ICargoDrawerController&&h.ICargoDrawerController)?l:Object])],T)},1660:function(e,t,a){"use strict";a.d(t,"a",(function(){return C}));a(109),a(10),a(11);var r,o=a(9),n=a(20),l=a(943),i=a(336),s=a(575),c=a(1),d=a(50),u=a(147),m=a(2386),p=a(58),g=function(e,t,a,r){var o,n=arguments.length,l=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,a):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,r);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(l=(n<3?o(l):n>3?o(t,a,l):o(t,a))||l);return n>3&&l&&Object.defineProperty(t,a,l),l},b=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},y=function(e,t){return function(a,r){t(a,r,e)}};let C=class{constructor(e){this.ctrlEditCargoPort=e}onDragEnd(e,t,a,r,o){return e.destination?"LEFT_ITEM"===e.type&&e.destination?this.leftSideDragEnd(e,t,a,o):this.rowDragEnd(e,t,a,r):void 0}leftSideDragEnd(e,t,a,r){const o=this.updateCargoPortWithPortCall(t,a,e);if(o){const e=Array.from(a).map(e=>{var a,r;return(null===(a=t.portCall)||void 0===a?void 0:a.key)===e.key?Object(m.a)(e.cargoPorts,e=>e.key===t.key):(null===(r=null==o?void 0:o.portCall)||void 0===r?void 0:r.key)===e.key&&e.cargoPorts.push(o),e});return{updatedCargoPort:o,updatedPortCalls:e,updatedCargoPorts:this.ctrlEditCargoPort.updateStateCargoPorts(o,r),isLinked:!0}}}rowDragEnd(e,t,a,r){var o;if(a.length){const o=i.a.reorderPortCallSequence(a,e,!1);if(o){const e=u.a.synchCargoPortPortCallSequences(o,r);return{updatedCargoPort:e.find(e=>e.key===t.key),updatedPortCalls:s.a.updatePortCallsWithCargoPorts(o,e),updatedCargoPorts:e}}}else{const n=this.updateUnallocatedCargoPorts(r,t.reasonForCall,e);if(n)return{updatedCargoPort:null!==(o=n.find(e=>e.key===t.key))&&void 0!==o?o:t,updatedPortCalls:a,updatedCargoPorts:n}}}updateCargoPortWithPortCall(e,t,a){var r,o;const n=a.destination?a.destination.droppableId.split("-")[1]:void 0;for(const a of t)if(void 0!==n&&a.portCallSequence===Number(n)+1&&(null===(r=e.port)||void 0===r?void 0:r.key)===(null===(o=a.port)||void 0===o?void 0:o.key)&&(!e.terminal||!a.terminal||e.terminal.key===a.terminal.key)&&d.a.compareRFC(a.reasonForCall,e.reasonForCall))return new c.a.cargoport.class(Object.assign(Object.assign({},e),{portCall:a}));return null}updateUnallocatedCargoPorts(e,t,a){var r,o;const{destination:n,source:l}=a;if(!n||!l)return;const s=e[l.index];if((null===(r=e[n.index].reasonForCall)||void 0===r?void 0:r.reasonForCall)===(null===(o=s.reasonForCall)||void 0===o?void 0:o.reasonForCall)){const t=i.a.reorder(e,l.index,n.index);return p.a.updateUnallocatedCargoPortSeq(t,null==s?void 0:s.reasonForCall)}}};C=g([Object(o.injectable)(),y(0,Object(o.inject)(n.a.IEditCargoPortController)),b("design:paramtypes",["function"==typeof(r=void 0!==l.IEditCargoPortController&&l.IEditCargoPortController)?r:Object])],C)},1852:function(e,t,a){"use strict";a.d(t,"a",(function(){return m}));a(10),a(11);var r=a(0),o=a.n(r),n=a(51),l=a(12),i=a(6),s=a(1),c=a(3),d=a(1252),u=a(879);function m({reactKeyPrefix:e,closeModal:t,showModal:a,onCreate:m,entityRelease:p}){const[g]=Object(i.a)([c.a.IInternationalization]),{common:b,model:y}=g.getLanguageFile(),C=Object(r.useCallback)(e=>Object(u.a)(e,null!=p?p:void 0),[p]);return o.a.createElement(n.a,{modalProps:{reactKeyPrefix:e+"-create-modal",maxWidth:"xs",onCloseModal:t,open:a,title:`${b.create} ${y.blGraph}`,confirmBtnName:b.create},getColSpec:d.a,breakpoints:l.e,createProps:{callback:m,type:s.a.blgraph},contextData:{entityRelease:p},isConfirmDisabled:u.b,overrideGetData:C})}},1854:function(e,t,a){"use strict";a.d(t,"a",(function(){return g}));a(10),a(11);var r=a(0),o=a.n(r),n=a(51),l=a(12),i=a(6),s=a(518),c=a(1),d=a(3),u=a(880),m=a(1253);const p=new s.a({});function g({reactKeyPrefix:e,closeModal:t,showModal:a,onCreate:s,entityRelease:g}){const[b]=Object(i.a)([d.a.IInternationalization]),{common:y,model:C}=b.getLanguageFile(),[f,h]=Object(r.useState)(p),v=Object(r.useCallback)(()=>Object(u.a)(f,null!=g?g:void 0),[f,g]),P=Object(r.useCallback)((e,t,a)=>(h(new c.a.blclass.class(Object.assign(Object.assign({},e),{[t]:a}))),new c.a.blclass.class(Object.assign(Object.assign({},e),{[t]:a}))),[]);return o.a.createElement(n.a,{modalProps:{reactKeyPrefix:e+"-create-modal",maxWidth:"xs",onCloseModal:t,open:a,title:`${y.create} ${C.blClass}`,confirmBtnName:y.create},getColSpec:m.a,breakpoints:l.e,createProps:{callback:s,type:c.a.blclass},isConfirmDisabled:u.b,overrideUpdateEntity:P,overrideGetData:v})}},1856:function(e,t,a){"use strict";a.d(t,"a",(function(){return g}));a(10),a(11);var r=a(0),o=a.n(r),n=a(51),l=a(12),i=a(6),s=a(1065),c=a(1),d=a(3),u=a(881),m=a(1254);const p=new s.a({});function g({reactKeyPrefix:e,closeModal:t,showModal:a,onCreate:s,entityRelease:g}){const[b]=Object(i.a)([d.a.IInternationalization]),{common:y,model:C}=b.getLanguageFile(),[f,h]=Object(r.useState)(p),v=Object(r.useMemo)(()=>({entityRelease:g}),[g]),P=Object(r.useCallback)(()=>Object(u.a)(f,null!=g?g:void 0),[f,g]),O=Object(r.useCallback)((e,t,a)=>(h(new c.a.blskipgraph.class(Object.assign(Object.assign({},e),{[t]:a}))),new c.a.blskipgraph.class(Object.assign(Object.assign({},e),{[t]:a}))),[]);return o.a.createElement(n.a,{modalProps:{reactKeyPrefix:e+"-create-modal",maxWidth:"xs",onCloseModal:t,open:a,title:`${y.create} ${C.blSkipGraph}`,confirmBtnName:y.create},getColSpec:m.a,breakpoints:l.e,createProps:{callback:s,type:c.a.blskipgraph},contextData:v,isConfirmDisabled:u.b,overrideUpdateEntity:O,overrideGetData:P})}},2012:function(e,t,a){"use strict";a.d(t,"a",(function(){return C}));a(10),a(11),a(109);var r=a(0),o=a.n(r),n=a(6),l=a(3),i=a(51),s=a(19),c=a(1),d=a(57),u=a(85);function m(e,t,a,r,n,l){const{model:i,fas:m,validation:p}=n.getLanguageFile(),{onChangeField:g,isScenarioNameValid:b,budgetYear:y}=l,C={reactKeyPrefix:e,disableUpdate:!0,fieldOptions:[{overrideComponent:o.a.createElement(d.b,{reactKeyPrefix:e+"-scenario-name-input",label:i.scenarioName,required:!0,autoFocus:!0,helperText:b?"":p.alreadyExists(i.scenarioName),error:!b,onInputChange:e=>g(e,"scenarioName")})},{overrideComponent:o.a.createElement(d.b,{reactKeyPrefix:e+"-budget-year-input",label:m.budgetYear,required:!0,error:!b,value:y,validation:[{type:u.a.REGEX,regex:/\d{4}/,helperText:p.notValidYear}],inputProps:{style:{textAlign:"right"}},onInputChange:e=>g(e,"budgetYear")})}],object:t,type:c.a.scenario,userLocale:r};return Object(s.a)(C)}var p=a(135),g=a(277),b=a(7),y=a(12);function C(e){const{reactKeyPrefix:t,showModal:a,onCloseModal:s,onCreate:d}=e,[u,C]=Object(r.useState)(!0),[f,h]=Object(r.useState)(""),[v,P]=Object(r.useState)((new Date).getFullYear().toString()),[O,k]=Object(n.a)([l.a.IInternationalization,b.a.ITSModelActionsAsync]),{common:j,fas:T}=O.getLanguageFile(),S=Object(r.useCallback)(()=>!(f&&v&&v.match(/\d{4}/)&&u),[v,u,f]),L=Object(r.useCallback)(([e,t])=>{e&&t&&k.loadMultipleAction({type:c.a.scenario,query:`filter=scenarioName(EQ)${t} ${e}`,callback:(e,t)=>{C(!!t&&!t.length)}})},[k]),D=Object(r.useCallback)((e,t)=>{"scenarioName"===t?(h(e),L([e,v])):"budgetYear"===t&&(P(e),L([f,e]))},[v,f,L]);return o.a.createElement(i.a,{modalProps:{reactKeyPrefix:t+"modal",maxWidth:"xs",onCloseModal:s,open:a,title:T.createNewBudgetScenario,confirmBtnName:j.create},breakpoints:y.h,propertiesToSet:new g.a({scenarioCode:Object(p.a)(),isBudget:!0}),propertiesToOverwrite:{scenarioName:`${v} ${f}`},getColSpec:m,isConfirmDisabled:S,contextData:{onChangeField:D,isScenarioNameValid:u,budgetYear:v},createProps:{callback:d,type:c.a.scenario,fields:{key:"*"}}})}},2014:function(e,t,a){"use strict";a.d(t,"a",(function(){return v}));a(10),a(11);var r=a(0),o=a.n(r),n=a(12),l=a(1),i=a(19);function s(e,t,a,r,o,n){const{common:s}=o.getLanguageFile(),c={reactKeyPrefix:e,disableUpdate:!0,fieldOptions:[{fieldName:"consignee",formControlProps:{required:!0},overrideFieldType:"object",typeaheadProps:{options:n.consigneeData,noOptionsMessage:()=>s.noOptionsFound},onUpdateOverride:a.bind(null,"consignee")},{fieldName:"notifyParty",formControlProps:{required:!0},overrideFieldType:"object",typeaheadProps:{options:n.notifyPartyData,noOptionsMessage:()=>s.noOptionsFound},onUpdateOverride:a.bind(null,"notifyParty")}],object:t,type:l.a.billoflading,userLocale:r};return Object(i.a)(c)}var c=a(876),d=a(290),u=a(51),m=a(6),p=a(21),g=a(3),b=a(136),y=a(23),C=a(1295),f=a(46),h=a(262);function v(e){const{showModal:t,closeModal:a,openDrawer:i,reactKeyPrefix:v}=e,P=Object(y.a)(p.a.getTSModelsBuilt,l.a.subcargo,d.d,d.b)||[],O=Object(y.a)(p.a.getTSModelsBuilt,l.a.subcargo,d.d,d.a)||[],[k,j]=Object(r.useState)(null),[T,S]=Object(r.useState)(null),[L,D]=Object(r.useState)(null),[E]=Object(m.a)([g.a.IInternationalization]),{model:x,common:F,cargoes:N}=E.getLanguageFile(),M=Object(r.useCallback)(()=>{Object(h.a)(d.a),a&&a()},[a]),w=Object(r.useCallback)((e,t)=>{t&&(i(t.key),f.a.next())},[i]),I=Object(r.useCallback)(e=>{k&&e&&k.key===e.key||(Object(h.a)(d.b),Object(h.a)(d.a),j(e),S(null),D(null))},[k]),A=Object(r.useCallback)((e,t,a)=>"consignee"===t?(S(a),new l.a.billoflading.class(Object.assign(Object.assign({},e),{consignee:a}))):"notifyParty"===t?(D(a),new l.a.billoflading.class(Object.assign(Object.assign({},e),{notifyParty:a}))):"subCargos"===t?new l.a.billoflading.class(Object.assign(Object.assign({},e),{subCargos:a})):new l.a.billoflading.class(Object.assign({},e)),[]),R=Object(r.useMemo)(()=>0===O.length?{consignee:T,notifyParty:L,subCargos:[]}:{consignee:T,notifyParty:L},[T,L,O.length]);Object(r.useEffect)(()=>{k&&Object(d.i)(k)},[k]),Object(r.useEffect)(()=>{k&&T&&L&&Object(d.h)(k,T,L)},[T,L,k]);const B=Object(r.useMemo)(()=>Object(d.f)(P),[P]),U=Object(r.useMemo)(()=>Object(b.b)(O,c.a.rowContentProperties),[O]),q=Object(r.useMemo)(()=>c.a.getHeaders(E),[E]);return o.a.createElement(u.a,{modalProps:{reactKeyPrefix:v+"modal",confirmBtnName:F.create,maxWidth:"md",onCloseModal:M,open:t,title:x.createBillOfLading},getColSpec:s,isConfirmDisabled:d.g,overrideUpdateEntity:A,contextData:B,propertiesToOverwrite:R,tableProps:{data:U,headers:q,reactKeyPrefix:"create-bol-sub-cargoes",selectable:!0,title:N.subCargoes},tableDataProperty:"subCargos",breakpoints:n.h,createProps:{callback:w,query:"plainObject=true",type:l.a.billoflading,fields:{key:"*"}}},o.a.createElement(C.a,{onSelectPortCall:I,reactKeyPrefix:v+"port-call-selector",fields:d.c,identifier:"create-bol-port-call-selector",getQueryStringToLoadPortCalls:d.e}))}},2016:function(e,t,a){"use strict";a.d(t,"a",(function(){return m}));a(10),a(11);var r=a(0),o=a.n(r),n=a(51),l=a(12),i=a(6),s=a(1),c=a(3),d=a(19);function u(e,t,a,r,o){const{model:n}=o.getLanguageFile(),l={reactKeyPrefix:e,disableUpdate:!0,fieldOptions:[{fieldName:"bankName",label:n.name,formControlProps:{required:!0},onUpdateOverride:a.bind(null,"bankName")}],object:t,type:s.a.bank,userLocale:r};return Object(d.a)(l)}function m(e){const[t]=Object(i.a)([c.a.IInternationalization]),{common:a}=t.getLanguageFile(),{reactKeyPrefix:d,closeModal:m,showModal:p,onCreate:g}=e,b=Object(r.useCallback)(e=>!(e&&e.bankName),[]);return o.a.createElement(n.a,{modalProps:{reactKeyPrefix:d+"-create-modal",maxWidth:"xs",onCloseModal:m,open:p,title:a.createBank,confirmBtnName:a.create},getColSpec:u,breakpoints:l.e,createProps:{callback:g,type:s.a.bank},isConfirmDisabled:b,propertiesToSet:{addresses:[{}],contactInfo:[{}]}})}},2017:function(e,t,a){"use strict";a.d(t,"a",(function(){return g}));a(10),a(11);var r=a(0),o=a.n(r),n=a(51),l=a(12),i=a(6),s=a(1),c=a(3),d=(a(93),a(57)),u=a(19),m=a(70);function p(e,t,a,r,o,n){const{common:l}=o.getLanguageFile(),i={reactKeyPrefix:e,disableUpdate:!0,fieldOptions:[{fieldName:"baselineTermDesc",label:l.description,formControlProps:{required:!0},onUpdateOverride:a.bind(null,"baselineTermDesc")},{fieldName:"baselineTermCode",label:l.code,formControlProps:{required:!0},onUpdateOverride:a.bind(null,"baselineTermCode"),textInputProps:{letterCase:d.a.UPPERCASE,validation:m.b.BaselineTermCode,onInputChange:(e,t)=>n.onChangeBaselineTerm(t)}}],object:t,type:s.a.baselineterm,userLocale:r};return Object(u.a)(i)}function g({reactKeyPrefix:e,closeModal:t,showModal:a,onCreate:d}){const[u]=Object(i.a)([c.a.IInternationalization]),{common:m}=u.getLanguageFile(),[g,b]=Object(r.useState)(!1),y=Object(r.useCallback)(e=>!(e.baselineTermCode&&e.baselineTermDesc&&g),[g]);return o.a.createElement(n.a,{modalProps:{reactKeyPrefix:e+"-create-modal",maxWidth:"xs",onCloseModal:t,open:a,title:m.createBaselineTerm,confirmBtnName:m.create},getColSpec:p,breakpoints:l.e,contextData:{onChangeBaselineTerm:b},createProps:{callback:d,type:s.a.baselineterm},isConfirmDisabled:y})}},2018:function(e,t,a){"use strict";a.d(t,"a",(function(){return g}));a(10),a(11);var r=a(0),o=a.n(r),n=a(51),l=a(12),i=a(6),s=a(1),c=a(3),d=a(57),u=a(19),m=a(70);function p(e,t,a,r,o,n){const{model:l,common:i}=o.getLanguageFile(),c={reactKeyPrefix:e,disableUpdate:!0,fieldOptions:[{fieldName:"businessUnitName",label:l.name,formControlProps:{required:!0},onUpdateOverride:a.bind(null,"businessUnitName")},{fieldName:"businessUnitCode",label:i.code,formControlProps:{required:!0},onUpdateOverride:a.bind(null,"businessUnitCode"),textInputProps:{letterCase:d.a.UPPERCASE,validation:m.b.BusinessUnitCode,onInputChange:(e,t)=>n.onChangeBusinessUnit(t)}},{fieldName:"voyageCurrency",label:l.voyageCurrency,typeaheadProps:{objectPaths:["currencyCode"]},onUpdateOverride:a.bind(null,"voyageCurrency")},{fieldName:"businessUnitLink",label:l.parentBusinessUnit,typeaheadProps:{objectPaths:["businessUnitName"]},onUpdateOverride:a.bind(null,"businessUnitLink")}],object:t,type:s.a.businessunit,userLocale:r};return Object(u.a)(c)}function g({reactKeyPrefix:e,closeModal:t,showModal:a,onCreate:d}){const[u]=Object(i.a)([c.a.IInternationalization]),{common:m}=u.getLanguageFile(),[g,b]=Object(r.useState)(!1),y=Object(r.useCallback)(e=>!(e.businessUnitCode&&e.businessUnitName&&g),[g]);return o.a.createElement(n.a,{modalProps:{reactKeyPrefix:e+"-create-modal",maxWidth:"xs",onCloseModal:t,open:a,title:m.createBusinessUnit,confirmBtnName:m.create},breakpoints:l.e,getColSpec:p,contextData:{onChangeBusinessUnit:b},createProps:{callback:d,type:s.a.businessunit},isConfirmDisabled:y})}},2062:function(e,t,a){"use strict";a.d(t,"a",(function(){return C}));var r=a(473),o=a(0),n=a.n(o),l=a(210),i=a(261),s=a(63),c=a(44),d=a(6),u=a(152),m=a(66),p=a(30),g=a(3);const b={bunkerType:void 0,bunkerTypesList:[],bunkeredQty:0,index:-1,isDirty:!1,key:void 0,maxQty:0,minQty:0,unitPrice:0};class y extends n.a.Component{constructor(e){super(e),this.state=Object.assign({},b),this.i=e.deps[0],this.lang=this.i.getLanguageFile(),this.onClickDelete=this.onClickDelete.bind(this),this.onClickCancel=this.onClickCancel.bind(this),this.onClickSave=this.onClickSave.bind(this),this.onChangeBunkerType=this.onChangeBunkerType.bind(this),this.onBlurBunkeredQty=this.onBlurBunkeredQty.bind(this),this.onChangeMinQty=this.onChangeMinQty.bind(this),this.onChangeMaxQty=this.onChangeMaxQty.bind(this),this.onChangeUnitPrice=this.onChangeUnitPrice.bind(this)}UNSAFE_componentWillReceiveProps(e){e.showDialog&&this.setState({bunkerType:e.bunkerOrderLine?e.bunkerOrderLine.bunkerType:void 0,bunkerTypesList:u.b.getBunkerTypes(e.bunkerTypes),bunkeredQty:e.bunkerOrderLine?e.bunkerOrderLine.bunkeredQuantity:0,index:e.index,maxQty:e.bunkerOrderLine?e.bunkerOrderLine.maxQuantity:0,minQty:e.bunkerOrderLine?e.bunkerOrderLine.minQuantity:0,unitPrice:e.bunkerOrderLine?e.bunkerOrderLine.unitPrice:0})}onClickCancel(){this.props.onClose()}onClickDelete(){const{bunkerOrderLine:e,onDelete:t}=this.props;e&&t(e.key)}onClickSave(){const{onConfirm:e,index:t,bunkerOrderLine:a}=this.props,{bunkerType:r,minQty:o,maxQty:n,bunkeredQty:l,unitPrice:i}=this.state,s=a&&a.key?a.key:void 0;r&&e(r,s,o,n,l,i,t)}onChangeBunkerType(e){const t=this.props.bunkerTypes.find(t=>t.bunkerTypeDesc===e);t&&this.setState({bunkerType:t,isDirty:!0})}onChangeMinQty(e){e!==this.state.minQty&&this.setState({isDirty:!0,minQty:e})}onChangeMaxQty(e){e!==this.state.maxQty&&this.setState({isDirty:!0,maxQty:e})}onBlurBunkeredQty(e){e!==this.state.bunkeredQty&&this.setState({bunkeredQty:e,isDirty:!0})}onChangeUnitPrice(e){e>-1&&e!==this.state.unitPrice&&this.setState({isDirty:!0,unitPrice:e})}getTitle(){const{index:e}=this.state;return-1===e?this.lang.bo.createBunkerOrderLine:this.lang.bo.editBunkerOrderLine}isRequiredFieldsOK(){const{bunkerType:e}=this.state;return!!e}showQtyError(){const{maxQty:e,minQty:t}=this.state;return 0!==e&&0!==t&&t>e}getSaveButton(){const{common:e}=this.i.getLanguageFile(),{isDirty:t}=this.state,a=!this.isRequiredFieldsOK()||this.showQtyError()||!t;return n.a.createElement(r.a,{id:this.props.reactKeyPrefix+"save-btn",key:"save-button",disabled:a,variant:"contained",onClick:this.onClickSave,color:"primary"},e.save)}getCancelButton(){return n.a.createElement(r.a,{id:this.props.reactKeyPrefix+"cancel-btn",key:"cancel-button",onClick:this.onClickCancel,color:"primary"},this.lang.common.cancel)}getDeleteButton(){const{isDeleteBtnDisabled:e,user:t,reactKeyPrefix:a}=this.props,{index:o}=this.state;return-1!==o?n.a.createElement(r.a,{id:a+"delete-btn",disabled:e||!Object(m.a)([p.a.BunkerOrderPOST],t),key:"delete-button",onClick:this.onClickDelete,color:"primary"},this.lang.common.delete):null}getBunkeredQuantityField(){const{userLocale:e,reactKeyPrefix:t}=this.props,{bunkeredQty:a,index:r}=this.state;return-1!==r?n.a.createElement(l.a,{reactKeyPrefix:t+"bunkeredQty",label:this.lang.model.bunkeredQty,value:a,userLocale:e,maskSettings:{decimalScale:3,fixedDecimalScale:!0},onBlur:this.onBlurBunkeredQty,InputProps:{endAdornment:s.a.Weight}}):null}render(){var e,t;const{userLocale:a,user:r,bunkerOrderLine:o,reactKeyPrefix:d}=this.props,{bunkerTypesList:u,bunkerType:g,minQty:b,maxQty:y,unitPrice:C}=this.state,f=!Object(m.a)([p.a.BunkerOrderPOST],r),h=[this.getDeleteButton(),this.getCancelButton(),this.getSaveButton()],v=this.showQtyError();return n.a.createElement(c.a,{reactKeyPrefix:d,maxWidth:"xs",fullWidth:!0,open:this.props.showDialog,onCloseModal:this.onClickCancel,title:this.getTitle(),actionButtons:h,fullscreenOnMobile:!0},n.a.createElement(i.a,{reactKeyPrefix:d+"bunkerType",label:this.lang.model.bunkerType,value:g?g.bunkerTypeDesc:"",options:u,onInputChange:this.onChangeBunkerType,formControlProps:{required:!0},disabled:f}),n.a.createElement(l.a,{reactKeyPrefix:d+"minQty",label:this.lang.model.minQty,value:b,userLocale:a,maskSettings:{decimalScale:3,fixedDecimalScale:!0},onChange:this.onChangeMinQty,InputProps:{endAdornment:s.a.Weight,disabled:f},formControlProps:{required:!0,error:v},formHelperText:v?this.lang.bo.minQtyExceedsMaxQty:void 0}),n.a.createElement(l.a,{reactKeyPrefix:d+"maxQty",label:this.lang.model.maxQty,value:y,userLocale:a,maskSettings:{decimalScale:3,fixedDecimalScale:!0},onChange:this.onChangeMaxQty,InputProps:{endAdornment:s.a.Weight,disabled:f},formControlProps:{error:v}}),this.getBunkeredQuantityField(),n.a.createElement(l.a,{reactKeyPrefix:d+"unitPrice",label:this.lang.model.unitPrice,value:C,userLocale:a,maskSettings:{decimalScale:2,fixedDecimalScale:!0},InputProps:{endAdornment:null===(t=null===(e=null==o?void 0:o.bunkerOrder)||void 0===e?void 0:e.currency)||void 0===t?void 0:t.currencyCode,disabled:f},onChange:this.onChangeUnitPrice}))}}const C=Object(d.b)([g.a.IInternationalization],y)},225:function(e,t,a){"use strict";var r;a.d(t,"c",(function(){return r})),a.d(t,"b",(function(){return o})),a.d(t,"a",(function(){return n})),function(e){e[e.Coa=0]="Coa",e[e.Budget=1]="Budget",e[e.CoaTemplateCargos=2]="CoaTemplateCargos"}(r||(r={}));const o="CREATE_FROM_CARGO_TEMPLATES_IDENTIFIER",n="CREATE_FROM_CARGO_TEMPLATES_IDENTIFIER_FILTERS"},290:function(e,t,a){"use strict";a.d(t,"c",(function(){return d})),a.d(t,"d",(function(){return u})),a.d(t,"b",(function(){return m})),a.d(t,"a",(function(){return p})),a.d(t,"g",(function(){return g})),a.d(t,"i",(function(){return b})),a.d(t,"h",(function(){return y})),a.d(t,"f",(function(){return C})),a.d(t,"e",(function(){return f}));a(10),a(11);var r=a(1),o=a(168),n=a(6),l=a(7),i=a(81),s=a(87),c=a(262);const d=Object(s.a)(["port.portName","reasonForCall.reasonForCallDesc","voyage.voyageHeader.referenceNo","terminal.terminalName"]),u=Object(s.a)(["noOfParcels","bookedQuantity","subCargoMeasurement.measurementCode","commodity.commodityName","freightRate","cargoText","consignee","notifyParty"]),m="CRT_BOL_SUB_CARGOS_ID",p="CRT_BOL_SUB_CARGOS_FILTERED_ID";function g(e){const{consignee:t,notifyParty:a,subCargos:r}=e;return!(t&&a&&r&&r.length>0)}function b(e){const[t]=Object(n.a)([l.a.ITSModelActions]);Object(c.a)(m);const a="filter=cargo.voyage.key(EQ)"+Object(i.a)(e,"voyage.key")+"&filter=cargo.cargoPorts.port.key(EQ)"+Object(i.a)(e,"port.key")+"&filter=billOfLadings%2B(NULL)";t.loadMultipleAction({fields:u,query:a,type:r.a.subcargo,identifier:m})}function y(e,t,a){const[o]=Object(n.a)([l.a.ITSModelActions]);Object(c.a)(p);const s="filter=cargo.voyage.key(EQ)"+Object(i.a)(e,"voyage.key")+"&filter=cargo.cargoPorts.port.key(EQ)"+Object(i.a)(e,"port.key")+"&filter=consignee(EQ)"+encodeURIComponent(t)+"&filter=notifyParty(EQ)"+encodeURIComponent(a)+"&filter=billOfLadings%2B(NULL)";o.loadMultipleAction({fields:u,query:s,type:r.a.subcargo,identifier:p})}function C(e){return{consigneeData:Object(o.c)(e,"consignee"),notifyPartyData:Object(o.c)(e,"notifyParty")}}function f(e){return"filter=voyage.voyageHeader.voyageStatus.statusTypeCode(IN)((OPR,NOM))&filter=voyage.voyageHeader.isTemplate(EQ)false&filter=voyage.voyageHeader.isBudget(EQ)false&filter=voyage.voyageHeader.isEstimate(EQ)false&filter=voyage.voyageHeader.isUnallocated(EQ)false&filter=reasonForCall.reasonForCall(EQ)D&filter=voyage.fleetPlanVoyages.fleetPlan.fleetPlanCode(EQ)MASTER&filter=voyage.vessel.key(EQ)"+e.key}},456:function(e,t,a){"use strict";a.d(t,"a",(function(){return X}));a(10),a(11);var r=a(2517),o=a(130),n=a(323),l=a(214),i=a(473),s=a(0),c=a.n(s),d=a(97),u=a(122),m=a(46),p=a(44),g=a(5),b=a(67),y=a(6),C=a(1),f=a(21),h=a(94),v=a(42),P=a(7),O=a(262),k=a(422),j=a(3),T=a(15),S=a(27),L=a(14),D=a(35),E=a(147),x=a(258),F=a.n(x);const N=L.a.get(j.a.IInternationalization).lang(),M=[{content:N.model.trade,contentType:g.a.TEXT},{content:N.coa.coaDate,contentType:g.a.DATE,dateTimeFormatOptions:D.a.shortLocalizedDate},{content:N.model.contractNo,contentType:g.a.TEXT},{content:N.model.charterer,contentType:g.a.TEXT},{content:N.model.commodity,contentType:g.a.TEXT},{content:N.model.portRotation,contentType:g.a.ELEMENT,alignHeaderContent:g.c.LEFT,wrap:!0},{content:N.model.cargoQuantity,contentType:g.a.NUMBER,numberFormatOptions:{minDecimals:3,maxDecimals:3}},{content:N.model.cargoText,contentType:g.a.TEXT,textLengthFactor:2,wrap:!0}];function w(e){var t,a,r,o,n,l,i,s,d,u,m,p,g,b,y,C,f;const h=null!==(l=null!==(o=null===(r=null===(a=null===(t=e.voyage)||void 0===t?void 0:t.voyageHeader)||void 0===a?void 0:a.leg)||void 0===r?void 0:r.legDesc)&&void 0!==o?o:null===(n=e.leg)||void 0===n?void 0:n.legDesc)&&void 0!==l?l:"",v=null!==(d=null===(s=null===(i=e.coaLine)||void 0===i?void 0:i.coa)||void 0===s?void 0:s.coaDate)&&void 0!==d?d:null,P=null!==(p=null===(m=null===(u=e.coaLine)||void 0===u?void 0:u.coa)||void 0===m?void 0:m.contractNo)&&void 0!==p?p:"",O=null!==(b=null===(g=e.charterer)||void 0===g?void 0:g.businessPartnerName)&&void 0!==b?b:"",k=null!==(C=null===(y=e.commodity)||void 0===y?void 0:y.commodityName)&&void 0!==C?C:"",{cargoQuantity:j,cargoText:T}=e,S=E.a.sortByCargoPortSequence(e.cargoPorts),L=c.a.createElement("div",{style:{display:"flex",flexFlow:"wrap"}},S.map((t,a)=>{var r,o;return c.a.createElement(c.a.Fragment,null,null===(r=t.port)||void 0===r?void 0:r.portName," (",null===(o=null==t?void 0:t.reasonForCall)||void 0===o?void 0:o.reasonForCall,")",a+1!==e.cargoPorts.length&&c.a.createElement(F.a,{sx:{alignSelf:"center",mx:.5,fontSize:"1.3rem",pb:1/4}}))})),D=S.map((t,a)=>{var r,o;return`${null===(r=t.port)||void 0===r?void 0:r.portName} (${null===(o=t.reasonForCall)||void 0===o?void 0:o.reasonForCall}) ${a+1!==e.cargoPorts.length?"->":""}`});return{content:[h,v,P,O,k,{content:L,rawValue:null!==(f=null==D?void 0:D.toString())&&void 0!==f?f:""},j,T],id:e.key}}var I=a(2471),A=a(24),R=a(4),B=a(86),U=a(96);const q=L.a.get(j.a.IInternationalization),K=L.a.get(j.a.IInternationalization),Q=({FILTERS_GROUP_CODE:e,reactKeyPrefix:t,sx:a=[]})=>{const{trade:r,commodity:o,charterer:n,port:l}=K.lang().model,{tradeConfig:i,chartererConfig:s,commodityConfig:d,portConfig:u}=(e=>{const{trade:t,commodity:a,charterer:r,port:o}=q.lang().model,n={field:"voyage.voyageHeader.leg.key",filterGroupCode:e,operator:R.c.IN,queryParamName:"voyage.voyageHeader.leg.key",type:R.d.STRING},l={label:t,filterObjectValuePath:"key",typeaheadProps:{type:C.a.leg,objectPaths:["legDesc"]},filters:[n]},i={field:"charterer.key",filterGroupCode:e,operator:R.c.IN,optionCode:"chartererFilter",type:R.d.STRING},s={label:r,filterObjectValuePath:"key",typeaheadProps:{type:C.a.businesspartner,objectPaths:["businessPartnerName"],query:U.b,fields:B.a.businessPartner,resolver:e=>Object(B.c)(e,B.b.businessPartner)},filters:[i]},c={field:"commodity.key",filterGroupCode:e,operator:R.c.IN,queryParamName:"commodity.key",type:R.d.STRING},d={label:a,filterObjectValuePath:"key",typeaheadProps:{type:C.a.commodity,objectPaths:["commodityName"],includeDisabledQuery:!0},filters:[c]},u={field:"cargoPorts.port.key",filterGroupCode:e,operator:R.c.IN,type:R.d.STRING};return{tradeFilter:n,tradeConfig:l,chartererFilter:i,chartererConfig:s,commodityFilter:c,commodityConfig:d,portFilter:u,portConfig:{label:o,filterObjectValuePath:"key",typeaheadProps:{type:C.a.port,objectPaths:["portName"],query:U.d},filters:[u]}}})(e);return c.a.createElement(c.a.Fragment,null,c.a.createElement(I.a,{sx:[...Array.isArray(a)?a:[a]]},c.a.createElement(A.a,{reactKeyPrefix:t+"trade",configs:[i],type:R.b.TYPEAHEAD,label:r,filterCode:e+r})),c.a.createElement(I.a,{sx:[...Array.isArray(a)?a:[a]]},c.a.createElement(A.a,{reactKeyPrefix:t+"charterer",configs:[s],type:R.b.TYPEAHEAD,label:n,filterCode:e+n})),c.a.createElement(I.a,{sx:[...Array.isArray(a)?a:[a]]},c.a.createElement(A.a,{reactKeyPrefix:t+"commodity",configs:[d],type:R.b.TYPEAHEAD,label:o,filterCode:e+o})),c.a.createElement(I.a,{sx:[...Array.isArray(a)?a:[a]]},c.a.createElement(A.a,{reactKeyPrefix:t+"port",configs:[u],type:R.b.TYPEAHEAD,label:l,filterCode:e+l})))};var V=a(1194),_=a(87);const H={chartererFields:Object(_.a)(["charterer.businessPartnerName","charterer.businessPartnerCode","charterer.businessPartnerType.businessPartnerTypeDesc"]),createCargoFromCoaFields:{bookedQuantity:"*",cargoMeasurement:{measurementCode:"*",measurementFactor:"*"},cargoText:"*",cargoType:{cargoTypeCode:"*"},charterer:{businessPartnerName:"*",businessPartnerCode:"*",businessPartnerType:{businessPartnerTypeDesc:"*"}},cargoPorts:{cargoPortSequence:"*",freightRate:"*",laytimeTerms:{laytimeTerms:"*"},laytimeTermsMeasurement:{laytimeTermsMeasurementName:"*",laytimeTermsMeasurementCode:"*"},laytimeTermsValue:"*",port:{portName:"*"},reasonForCall:{reasonForCallDesc:"*",reasonForCall:"*"},terminal:{terminalName:"*"}},cargoQuantity:"*",commodity:{commodityName:"*"},commissionAddress:"*",commissionBroker:"*",freightCurrency:{currencyCode:"*"},freightRate:"*",isWorldscale:"*",isLumpsum:"*",laycanFrom:"*",laycanTo:"*",leg:{legDesc:"*"},voyage:{portCalls:{port:{portName:"*"},portCallSequence:"*",reasonForCall:{reasonForCallDesc:"*",reasonForCall:"*"},terminal:{terminalName:"*"},vesselPcSequence:"*"}},quantityOptionPct:"*",quantityOption:{quantityOption:"*"}},defaultBudgetFilters:["voyage.voyageHeader.isBudget(EQ)true","voyage.voyageHeader.isTemplate(EQ)true","voyage.voyageHeader.budgetVersion.budgetVersionYear(EQ)"+(new Date).getFullYear()].join("&filter="),defaultCoaFilters:["isTemplate(EQ)true","coaLine.coa.coaStatus.statusTypeCode(NE)CLS","voyage(NULL)"].join("&filter="),fields:Object(_.a)(["voyage.voyageHeader.leg.legDesc","leg.legDesc","voyage.voyageHeader.pattern.patternDesc","coaLine.coa.coaDate","coaLine.coa.contractNo","charterer.businessPartnerName","commodity.commodityName","cargoPorts.reasonForCall.reasonForCall","cargoPorts.port.portName","cargoPorts.cargoPortSequence","cargoQuantity","cargoText"])};var W=a(330),z=a(240),G=a(47),$=a(225);const Y={container:{display:"flex",flexDirection:"column",height:"100%"},quickFilterItem:{marginRight:1},helperText:{fontStyle:"italic"},footer:{height:"50px",marginTop:1}};const X=Object(G.a)((function(e){return{userLocale:v.a.getUserLocale(e),cargoes:f.a.getTSModelsBuilt(e,C.a.cargo,H.fields,$.b),storedFilters:h.a.getFiltersByGroupCode(e,$.a)}}),Object(y.b)([j.a.IInternationalization,P.a.ITSModelActionsAsync,P.a.ISimpleReducerActions],(function(e){var t;const{showDialog:a,closeDialog:y,type:f,reactKeyPrefix:h,scenarioKey:v,callback:P,voyage:j,isOpenedFromFas:L=!1,shouldOpenDrawer:D=!0,overrideReturnFields:E,coa:x,useAllocateModal:F=!0,state:{userLocale:N,cargoes:I,storedFilters:A},deps:[R,B,U]}=e,q=R.getLanguageFile(),K=Object(d.g)(),_=Object(d.h)(),[G,X]=Object(s.useState)(null),[J,Z]=Object(s.useState)(1),[ee,te]=Object(s.useState)(!1),[ae,re]=Object(s.useState)(!1),[oe,ne]=Object(s.useState)(A),[le,ie]=Object(s.useState)(Object(k.a)(oe,A)),{createCargoFromCoaTemplate:se,createCargoFromBudgetTemplate:ce}=q.cargoes,de=f===$.c.Coa&&j;Object(s.useEffect)(()=>{Object(k.a)(oe,A)&&(Z(1),ie(!0),ne(A))},[oe,A]);const ue=["isTemplate(EQ)true",`coaLine.key(IN)(${[...(null!==(t=null==x?void 0:x.coaLines)&&void 0!==t?t:[]).map(e=>e.key)]})`,"voyage(NULL)"].join("&filter=");Object(s.useEffect)(()=>{if(void 0!==f){le&&Object(O.a)($.b);const{defaultBudgetFilters:e,defaultCoaFilters:t,fields:a}=H;te(!0);const r=f===$.c.Budget?e:f===$.c.Coa?t:ue;B.loadMultipleAction({fields:a,query:"filter="+r,type:C.a.cargo,identifier:$.b,filters:oe,pageItemLimit:15,pageNumber:J}).then(()=>{te(!1),ie(!1)})}},[oe,le,J,B,f]);const me=Object(s.useCallback)(e=>{U.setAction(z.a,Number(e)),S.a.openDrawer(e,T.a.cargoDrawer,_,K)},[K,_,U]),pe=Object(s.useCallback)(e=>{y(),!de&&D&&me(e.key),P&&P(e),m.a.next()},[P,y,de,me,D]),ge=Object(s.useCallback)(e=>{B.updateSingleAction({key:e.key,type:C.a.cargo,data:{voyage:null}})},[B]),be=Object(s.useCallback)((e,t)=>{B.deleteAction({key:e,type:C.a.cargo,callback:t})},[B]),ye=Object(s.useCallback)(e=>{j&&F?(Object(V.a)(e,j,j.vessel,!1,L).then(t=>{var a;t||(null===(a=e.voyage)||void 0===a?void 0:a.key)===j.key||be(e.key)}),pe(e)):e&&P&&P(e)},[P,be,L,pe,F,j]),Ce=Object(s.useMemo)(()=>I.map(w),[I]),fe=Object(s.useMemo)(()=>I.find(e=>e.key===G),[I,G]),he=Object(s.useCallback)(()=>{var e,t,a;if(G){const{createCargoFromCoaFields:r}=H;re(!0),B.copySingleAction({key:G,type:C.a.cargo,fields:null!=E?E:de?r:u.g,data:{isTemplate:!1,scenarios:v?[{key:v}]:void 0,cpDate:f===$.c.Coa&&null!==(a=null===(t=null===(e=null==fe?void 0:fe.coaLine)||void 0===e?void 0:e.coa)||void 0===t?void 0:t.coaDate)&&void 0!==a?a:null},callback:(e,t)=>{t&&(de?ye(t):(f===$.c.Budget&&ge(t),pe(t)))}})}},[G,B,E,de,v,ye,f,pe,ge,fe]),ve=Object(s.useCallback)(()=>{Object(O.a)($.b),y()},[y]),Pe=Object(s.useMemo)(()=>Q(Object.assign({FILTERS_GROUP_CODE:$.a,reactKeyPrefix:h},Y.quickFilterItem)),[h]),Oe=Object(s.useMemo)(()=>c.a.createElement(r.a,{colSpan:M.length,align:"center"},c.a.createElement(o.a,null,q.common.noResults)),[q.common.noResults]),ke=f===$.c.Budget?ce:se,je=oe.length>0&&!ee&&0===Ce.length,Te=!G&&Ce.length>0;return c.a.createElement(p.a,{reactKeyPrefix:h,title:ke,open:a,onCloseModal:ve,maxWidth:"lg",fullWidth:!0,confirmBtnName:D?q.common.create:q.common.continue,onConfirm:he,disableConfirmBtn:!G||ae},c.a.createElement(n.a,{sx:Y.container},c.a.createElement(W.a,null,Pe),c.a.createElement(b.a,{data:Ce,headers:M,footer:je&&Oe,userLocale:N,reactKeyPrefix:h+"create-cargo-from-template-table",onRowClick:X,selectable:!0,singleSelect:!0,customisation:{responsive:!0,disableToolbar:!0,disableSorting:!0,height:{type:g.d.PX,value:500}}}),c.a.createElement(n.a,{sx:Y.footer},c.a.createElement(l.a,{justifyContent:"center",container:!0},c.a.createElement(i.a,{id:h+"load-more",variant:"outlined",color:"primary",onClick:()=>{Z(J+1)},disabled:ee},q.common.loadMore)),Te&&c.a.createElement(o.a,{sx:Y.helperText},q.fas.selectTemplateByClickingRow))))})))},534:function(e,t,a){"use strict";a.d(t,"a",(function(){return V}));a(10),a(11);var r=a(0),o=a.n(r),n=a(214),l=a(97),i=a(660),s=a(44),c=a(71),d=a(6),u=a(74),m=a(101),p=a(324),g=a(151),b=a(3),y=a(37),C=a(28),f=a(1),h=a(58),v=a(19),P=a(64);const O=o.a.memo(e=>{const{cargo:t,onChange:a,userLocale:r,i:n,reactKeyPrefix:l,cargoPortState:i,contextData:s}=e,c=function(e,t,a,r,n,l,{updateCargoPortState:i}){var s,c;const{model:d}=n.getLanguageFile(),m=null!==(s=h.a.findCargoPort(t,"L"))&&void 0!==s?s:new P.a({}),p=null!==(c=h.a.findCargoPort(t,"D"))&&void 0!==c?c:new P.a({}),g={reactKeyPrefix:e,disableUpdate:!0,fieldOptions:[{fieldName:"quantityOptionPct",InputProps:{endAdornment:"%"},label:d.tolerance,numberInputProps:{maskSettings:C.a.mask6,onChange:a.bind(null,"quantityOptionPct")}},{fieldName:"quantityOption",label:d.toleranceOption,typeaheadProps:{shouldPreload:!0},onUpdateOverride:a.bind(null,"quantityOption")},{overrideComponent:o.a.createElement("span",null)},{fieldName:"laytimeTermsValue",label:d.loadRate,numberInputProps:{maskSettings:C.a.mask2},onUpdateOverride:e=>i("loadLaytimeTermsValue",e),overrideObject:new P.a(m),overrideType:f.a.cargoport},{fieldName:"laytimeTermsMeasurement",typeaheadProps:{fields:{laytimeTermsMeasurementName:"*",laytimeTermsMeasurementCode:"*"},defaultSelectedOptions:l.loadLaytimeTermsMeasurement,reactKeyPrefix:e+"-load-laytimeterms",shouldPreload:!0},label:d.rule,overrideObject:new P.a(m),overrideType:f.a.cargoport,onUpdateOverride:e=>{i("loadLaytimeTermsMeasurement",e)}},{fieldName:"laytimeTerms",typeaheadProps:{defaultSelectedOptions:l.loadLaytimeTerms,shouldPreload:!0,objectPaths:["laytimeTerms"]},label:d.loadLaytimeTerms,overrideObject:new P.a(m),overrideType:f.a.cargoport,onUpdateOverride:e=>{i("loadLaytimeTerms",e)}},{fieldName:"laytimeTermsValue",label:d.dischargeRate,numberInputProps:{maskSettings:C.a.mask2},onUpdateOverride:e=>i("dischargeLaytimeTermsValue",e),overrideObject:new P.a(p||{}),overrideType:f.a.cargoport},{fieldName:"laytimeTermsMeasurement",typeaheadProps:{fields:{laytimeTermsMeasurementName:"*",laytimeTermsMeasurementCode:"*"},defaultSelectedOptions:l.dischargeLaytimeTermsMeasurement,reactKeyPrefix:e+"-discharge-laytimeterms"},label:d.rule,overrideObject:new P.a(p),overrideType:f.a.cargoport,onUpdateOverride:e=>{i("dischargeLaytimeTermsMeasurement",e)}},{fieldName:"laytimeTerms",typeaheadProps:{defaultSelectedOptions:l.dischargeLaytimeTerms,shouldPreload:!0,objectPaths:["laytimeTerms"]},label:d.dischargeLaytimeTerms,overrideObject:new P.a(p),overrideType:f.a.cargoport,onUpdateOverride:e=>{i("dischargeLaytimeTerms",e)}},{fieldName:"laycanFrom",label:d.laydaysCommences,onUpdateOverride:a.bind(null,"laycanFrom")},{fieldName:"laycanTo",label:d.laydaysCancelling,onUpdateOverride:a.bind(null,"laycanTo")},{fieldName:"leg",label:d.trade,typeaheadProps:{shouldPreload:!0},onUpdateOverride:a.bind(null,"leg")},{fieldName:"cargoText",textInputProps:{onInputChange:a.bind(null,"cargoText"),multiline:!0,rows:4}}],object:new u.a(t),type:f.a.cargo,userLocale:r};return Object(v.a)(g)}(l,t,a,r,n,i,s);return o.a.createElement(y.a,{reactKeyPrefix:l,items:c,breakpoints:{xs:4,sm:4,md:4,lg:4,xl:4}})});var k=a(81),j=a(86),T=a(96),S=a(301),L=a(12);var D=a(47),E=a(147),x=a(186);var F=a(892),N=a(595),M=a(1228),w=a(955),I=a(62),A=a(20),R=a(956),B=a(42),U=a(532),q=a(951),K=a(331);function Q(e){const{reactKeyPrefix:t,showModal:a,onCloseModal:D,voyage:B,state:{userLocale:Q},callback:V,cargoTemplateToUse:_}=e,[H,W,z]=Object(d.a)([b.a.IInternationalization,A.a.ICargoPortVsPortCallTimelineDNDController,A.a.ICreateCargoController]),{model:G,common:$}=(Object(l.j)(),H.getLanguageFile()),[Y,X]=Object(r.useState)(_||(e=>{var t;const a=new m.a({currencyCode:(null==e?void 0:e.voyageCurrency)?e.voyageCurrency.currencyCode:"USD"}),r=new g.a({measurementCode:"MT"}),o=(null===(t=null==e?void 0:e.voyageHeader)||void 0===t?void 0:t.leg)?new p.a(e.voyageHeader.leg):null;return new u.a({cargoMeasurement:r,freightCurrency:a,leg:o})})(B)),[J,Z]=Object(r.useState)(0),[ee,te]=Object(r.useState)(!1),[ae,re]=Object(r.useState)(_?N.a.setCargoPortStateFromTemplate(_):N.a.getDefaultCargoPortState(null==B?void 0:B.vessel)),[oe,ne]=Object(r.useState)(B?new I.a(B):null),le=Object(U.a)(),{isOpenedFromFas:ie}=Object(K.b)();Object(r.useEffect)(()=>{if(_&&oe){let e=Array.from(null==oe?void 0:oe.partOfSchedule);for(const t of _.cargoPorts){const{pcs:a}=w.a.handleAdd(e,t,oe);e=a}ne(new I.a(Object.assign(Object.assign({},oe),{partOfSchedule:e})))}},[]),Object(r.useEffect)(()=>{!Object(F.a)(Y.cargoPorts)&&ee&&X(N.a.updateCargoWithCargoPortState(Y,ae)),te(!1)},[Y,ae,ee]);const se=Object(r.useCallback)(()=>{_&&z.deleteCopiedCoaTemplate(_),D()},[z,D,_]),ce=Object(r.useCallback)((e,t)=>{re(Object.assign(Object.assign({},ae),{[e]:t})),te(!0)},[ae]),de=Object(r.useCallback)((e,t)=>{X(a=>new u.a(Object.assign(Object.assign({},a),{[e]:t})))},[]),ue=Object(r.useCallback)((e,t)=>{const a=N.a.getPortToDelete(Y.cargoPorts.filter(t=>{var a;return(null===(a=t.reasonForCall)||void 0===a?void 0:a.reasonForCall)===e}),t),r={cargo:Y,portTerminals:t,rfc:e},{updatedCargoWithCP:o,newCargoPort:n}=N.a.handleUpdate(r),{updatedCargoWithLink:l,updatedPortCalls:i}=w.a.handleUpdate(n,oe,Object(F.a)(t),e,a,o);if(oe)X(l),ne(new I.a(Object.assign(Object.assign({},oe),{partOfSchedule:i})));else{const t=R.a.updateTimelineCargoPorts(o.cargoPorts,Y.cargoPorts,e,J,a);X(Object.assign(Object.assign({},o),{cargoPorts:t}))}te(!0)},[Y,J,oe]),me=Object(r.useMemo)(()=>({updateCargoPortState:ce}),[ce]),pe=Object(r.useMemo)(()=>function(e,t,a,r,o,n,l){const{model:i}=o.getLanguageFile(),{getPortTerminalLabel:s}=x.a,c=E.a.getCargoPortsByReasonForCall(t,"L").map(e=>{const{terminal:t,port:a}=e;return{port:a,terminal:t,label:s(a,t),key:t?Number(`${null==a?void 0:a.key}${t.key}`):null==a?void 0:a.key}}),d=E.a.getCargoPortsByReasonForCall(t,"D").map(e=>{const{terminal:t,port:a}=e,r=s(a,t),o=t?Number(`${null==a?void 0:a.key}${t.key}`):null==a?void 0:a.key;return{port:e.port,terminal:null==e?void 0:e.terminal,label:r,key:o}}),m={reactKeyPrefix:e,disableUpdate:!0,fieldOptions:[{fieldName:"port",overrideFieldType:"multiple",label:i.loadPorts,multipleValuesInputProps:{options:n,optionLabelField:"label",selectedValues:c},formControlProps:{required:!0},onUpdateOverride:a.bind(null,"L"),overrideType:f.a.cargoport,overrideObject:new P.a({}),autoFocus:!0},{fieldName:"port",overrideFieldType:"multiple",label:i.dischargePorts,multipleValuesInputProps:{options:l,optionLabelField:"label",selectedValues:d},formControlProps:{required:!0},onUpdateOverride:a.bind(null,"D"),overrideType:f.a.cargoport,overrideObject:new P.a({})}],object:new u.a(t),type:f.a.cargo,userLocale:r};return Object(v.a)(m)}(t,Y,ue,Q,H,q.a.filteredPortTerminals(B,"L",le),q.a.filteredPortTerminals(B,"D",le)),[Y,H,ue,le,t,Q,B]),ge=Object(r.useMemo)(()=>function(e,t,a,r,o,n,{updateCargoPortState:l}){var i;const{model:s}=o.getLanguageFile(),c=null!==(i=h.a.findCargoPort(t,"D"))&&void 0!==i?i:new P.a({}),d={reactKeyPrefix:e,disableUpdate:!0,fieldOptions:[{fieldName:"charterer",typeaheadProps:{shouldPreload:!0,objectPaths:j.b.businessPartner,fields:j.a.businessPartner,query:T.b},onUpdateOverride:a.bind(null,"charterer")},{fieldName:"bookedQuantity",label:s.quantity,InputProps:{endAdornment:Object(k.a)(t,"cargoMeasurement.measurementCode","MT")},numberInputProps:{maskSettings:C.a.mask5},onUpdateOverride:e=>l("cargoQuantity",e),overrideObject:t.isLumpsum?t:new P.a({})},{fieldName:"commodity",typeaheadProps:{shouldPreload:!0,objectPaths:["commodityName"],fields:{weightFactorSo:"*",stowageFactor:"*",commodityName:"*",commodityMeasurement:{measurementCode:"*"}}},onUpdateOverride:e=>{var t,r,o;a("commodity",e),a("cargoMeasurement",null!==(t=e.commodityMeasurement)&&void 0!==t?t:{measurementCode:"MT"}),a("stowageFactor",null!==(r=e.stowageFactor)&&void 0!==r?r:0),a("weightFactor",null!==(o=e.weightFactorSo)&&void 0!==o?o:0)}},{fieldName:"cargoMeasurement",typeaheadProps:{shouldPreload:!0,objectPaths:["measurementCode"]},onUpdateOverride:a.bind(null,"cargoMeasurement")},{fieldName:"freightRate",breakpoints:L.h,InputProps:{endAdornment:Object(k.a)(t,"freightCurrency.currencyCode",void 0)},numberInputProps:{maskSettings:C.a.mask19},onUpdateOverride:e=>t.isLumpsum?a.bind(null,"freightRate"):l("freightRate",e),overrideObject:t.isLumpsum?t:new P.a(c),overrideType:t.isLumpsum?f.a.cargo:f.a.cargoport},{fieldName:"freightCurrency",breakpoints:L.f,typeaheadProps:{shouldPreload:!0},onUpdateOverride:a.bind(null,"freightCurrency")},{fieldName:"isWorldscale",breakpoints:L.f,label:s.rule,overrideFieldType:"object",typeaheadProps:{options:Object(S.a)(o),defaultSelectedOptions:Object(S.d)(o,t)},onUpdateOverride:e=>{a("isWorldscale",Object(S.b)(o,e).isWorldscale);const{isLumpsum:r}=Object(S.b)(o,e);a("isLumpsum",r),r?(a("freightRate",n.freightRate),l("freightRate",0)):(l("freightRate",t.freightRate),a("freightRate",0))}},{fieldName:"commissionBroker",InputProps:{endAdornment:"%"},numberInputProps:{maskSettings:C.a.mask7,onChange:a.bind(null,"commissionBroker")}},{fieldName:"commissionAddress",InputProps:{endAdornment:"%"},numberInputProps:{maskSettings:C.a.mask7,onChange:a.bind(null,"commissionAddress")}}],object:new u.a(t),type:f.a.cargo,userLocale:r};return Object(v.a)(d)}(t,Y,de,Q,H,ae,me),[Y,ae,me,H,de,t,Q]),be=Object(r.useCallback)(e=>{var t;if(oe){const{updatedCargo:t,updatedVoyage:a}=W.onDragEnd(e,Y,oe);X(t),ne(a)}else{const a=null!==(t=R.a.onDragEnd(Y.cargoPorts,e))&&void 0!==t?t:[];X(new u.a(Object.assign(Object.assign({},Y),{cargoPorts:a}))),Z(a.length)}},[Y,W,oe]),ye=B?[4,4,4]:[5,5,2],Ce=Object(r.useCallback)(()=>{z.createCargo(Y,oe,ie,_,V),D()},[z,Y,oe,ie,_,V,D]);return o.a.createElement(s.a,{reactKeyPrefix:t,title:`${$.create} ${G.cargo}`,open:a,maxWidth:"xl",fullWidth:!0,confirmBtnName:$.create,onCloseModal:se,onConfirm:Ce,disableConfirmBtn:z.isConfirmBtnDisabled(Y),disableDraggable:!0},o.a.createElement(n.a,{container:!0,spacing:2},o.a.createElement(n.a,{item:!0,lg:ye[0],xs:12},o.a.createElement(c.a,{heightFitsContainer:!0},o.a.createElement(y.a,{reactKeyPrefix:t+"-cargo-port-list",key:t+"-cargo-port-list",items:pe,breakpoints:L.e}),o.a.createElement("div",{style:{paddingTop:"10px"}},o.a.createElement(y.a,{reactKeyPrefix:t+"-list-1",key:t+"-list-1",items:ge,breakpoints:L.h})))),o.a.createElement(n.a,{item:!0,lg:ye[1],xs:12},o.a.createElement(c.a,{heightFitsContainer:!0},o.a.createElement(O,{cargo:Y,onChange:de,userLocale:Q,i:H,reactKeyPrefix:t+"-list-2",cargoPortState:ae,contextData:me}))),o.a.createElement(n.a,{item:!0,lg:ye[2],xs:12},o.a.createElement(c.a,{heightFitsContainer:!0},oe?o.a.createElement(i.a,{voyage:oe,selectedCargo:Y,reactKeyPrefix:t+"-cargo-port-vs-port-call-timeline",onDropped:be,hasTemplateCargo:!!_,enableDragOnLeftSide:!0,hideToolbar:!0}):o.a.createElement(M.a,{cargo:Y,reactKeyPrefix:t+"-cargo-port-timeline",onDropped:be})))))}const V=Object(D.a)(e=>({userLocale:B.a.getUserLocale(e)}),Object(r.memo)(Q))},575:function(e,t,a){"use strict";a.d(t,"a",(function(){return g}));a(268),a(269);var r=a(50),o=a(1426),n=a(81),l=a(130),i=a(0),s=a.n(i),c=a(716),d=a(323),u=a(68);function m(e){const{portCalls:t,stateCargoPort:a,selectedCargoPort:o,isUnallocated:n}=e;return n||!o||r.a.isPortAndRfcEqual(t,a)}function p(e,t){var a,r,o,n;const l=(null===(a=e.port)||void 0===a?void 0:a.key)===(null===(r=t.port)||void 0===r?void 0:r.key);return t.terminal?l&&(null===(o=e.terminal)||void 0===o?void 0:o.key)===(null===(n=t.terminal)||void 0===n?void 0:n.key):l&&!e.terminal}const g={canSaveCargoPortOnPortCall:m,isPortEqual:function(e,t){return e.some(e=>{var a,n;return(null===(a=e.port)||void 0===a?void 0:a.key)===(null===(n=t.port)||void 0===n?void 0:n.key)&&Object(o.a)(e.terminal)&&Object(o.a)(t.terminal)&&r.a.compareRFC(e.reasonForCall,t.reasonForCall)})},isCargoPortPortAndTerminalEqual:p,howManyPortTerminalRfcMatches:function(e,t){const a=e.filter(e=>r.a.compareRFC(e.reasonForCall,t.reasonForCall)),n=a.filter(e=>p(e,t)).length;return n||Number(a.some(e=>{var a,r;return Object(o.a)(e.terminal)&&(null===(a=e.port)||void 0===a?void 0:a.key)===(null===(r=t.port)||void 0===r?void 0:r.key)}))},CargoPortsLayoutLeft:function({obj:e}){var t,a;return e?s.a.createElement(s.a.Fragment,null,s.a.createElement(l.a,{sx:c.a.top,variant:"subtitle2",color:e.key<1?"primary":void 0},null===(t=e.port)||void 0===t?void 0:t.portName),e.terminal&&s.a.createElement(l.a,{variant:"subtitle2"},null===(a=e.terminal)||void 0===a?void 0:a.terminalName),s.a.createElement(d.a,{sx:c.a.textContainerLeftCard},s.a.createElement(l.a,{color:"textSecondary"},Object(n.a)(e,"reasonForCall.reasonForCallDesc")))):null},updatePortCallsWithCargoPorts:function(e,t){return e.map(e=>{const a=e.cargoPorts.flatMap(e=>t.filter(t=>e.key===t.key));return new u.a(Object.assign(Object.assign({},e),{cargoPorts:a}))})},isConfirmButtonDisabled:function(e,t){var a;return!t.reasonForCall||!t.port||!!(null===(a=e.stateCargoPort)||void 0===a?void 0:a.portCall)&&!m(e)},getReasonForCall:function(e,t){return e.find(e=>e.reasonForCall===t)}}},595:function(e,t,a){"use strict";a.d(t,"a",(function(){return g}));a(10),a(11);var r=a(892),o=a(64),n=a(74),l=a(221),i=a(147),s=a(58),c=a(181);const d=new(a(271).a);function u(e,t,a,n){let l,s=null;if(e.length>t.length){const{updatedCargoPorts:r,newCargoPort:c}=function(e,t,a,r){const n=t,l=e[e.length-1];let s=null;l&&(s=function(e,t,a){return new o.a({port:e.port,terminal:e.terminal,reasonForCall:t,key:-Math.abs(d.getNextKey()),cargoPortSequence:a})}(l,a,i.a.getNextSequenceNo(t,a)),n.push(s));if(null==r?void 0:r.cargoPorts){m(r.cargoPorts.filter(e=>{var t;return a.reasonForCall===(null===(t=e.reasonForCall)||void 0===t?void 0:t.reasonForCall)}),n)}return{updatedCargoPorts:n,newCargoPort:s}}(e,t,a,null!=n?n:void 0);l=r,s=c}else l=function(e,t){if(Object(r.a)(e))return[];const a=p(t,e);if(a){const e=t.findIndex(e=>{var t;return e.key===(null===(t=a[0])||void 0===t?void 0:t.key)});e>-1&&t.splice(e,1)}return t}(e,t);return i.a.updateCargoPortSequence(l),{updatedCargoPorts:l,newCargoPort:s}}function m(e,t){const a=e.filter(e=>!t.includes(e,0)),r=t.filter(t=>!e.includes(t,0));for(let e=0;e<a.length&&e<r.length;e++)for(let o=0;o<t.length;o++)t[o].key===r[e].key&&(t[o].key=a[e].key,t[o].cargoPortSequence=a[e].cargoPortSequence)}function p(e,t){return e.filter(e=>!t.some(t=>{var a,r,o,n;const l=!t.sequence||e.cargoPortSequence===t.sequence;return(null===(a=e.port)||void 0===a?void 0:a.key)===(null===(r=t.port)||void 0===r?void 0:r.key)&&(null===(o=e.terminal)||void 0===o?void 0:o.key)===(null===(n=t.terminal)||void 0===n?void 0:n.key)&&l}))}const g={getPortToDelete:p,handlePorts:u,handleUpdate:function(e){return"L"===e.rfc?function(e){const{cargo:t,portTerminals:a}=e,r=new l.a({reasonForCall:"L",reasonForCallDesc:"Loading"}),o=s.a.getDischargingPorts(t),i=s.a.getLoadingPorts(t),{updatedCargoPorts:c,newCargoPort:d}=u(a,i,r);return{updatedCargoWithCP:new n.a(Object.assign(Object.assign({},t),{cargoPorts:[...c,...o]})),newCargoPort:d}}(e):"D"===e.rfc?function(e){const{cargo:t,portTerminals:a}=e,r=new l.a({reasonForCall:"D",reasonForCallDesc:"Discharging"}),o=s.a.getDischargingPorts(t),i=s.a.getLoadingPorts(t),{updatedCargoPorts:c,newCargoPort:d}=u(a,o,r);return{updatedCargoWithCP:new n.a(Object.assign(Object.assign({},t),{cargoPorts:[...i,...c]})),newCargoPort:d}}(e):{updatedCargoWithCP:e.cargo,newCargoPort:null}},setCargoPortStateFromTemplate:function(e){var t,a;const r=null!==(t=s.a.findCargoPort(e,"L"))&&void 0!==t?t:new o.a({}),n=null!==(a=s.a.findCargoPort(e,"D"))&&void 0!==a?a:new o.a({});return{cargoQuantity:e.isLumpsum?e.cargoQuantity:r.cargoQuantity,freightRate:e.isLumpsum?0:n.freightRate,loadLaytimeTermsValue:null==r?void 0:r.laytimeTermsValue,loadLaytimeTermsMeasurement:null==r?void 0:r.laytimeTermsMeasurement,loadLaytimeTerms:null==r?void 0:r.laytimeTerms,dischargeLaytimeTermsValue:null==n?void 0:n.laytimeTermsValue,dischargeLaytimeTermsMeasurement:null==n?void 0:n.laytimeTermsMeasurement,dischargeLaytimeTerms:null==n?void 0:n.laytimeTerms}},getDefaultCargoPortState:e=>({cargoQuantity:0,freightRate:0,loadLaytimeTermsValue:0,loadLaytimeTermsMeasurement:c.a.getDefaultLaytimeTermsMeasurementFromVessel(e),loadLaytimeTerms:null,dischargeLaytimeTermsValue:0,dischargeLaytimeTermsMeasurement:c.a.getDefaultLaytimeTermsMeasurementFromVessel(e),dischargeLaytimeTerms:null}),updateCargoWithCargoPortState:function(e,t){var a;const r=e.cargoPorts,{cargoQuantity:o,freightRate:l,loadLaytimeTermsValue:i,loadLaytimeTermsMeasurement:s,loadLaytimeTerms:c,dischargeLaytimeTermsValue:d,dischargeLaytimeTermsMeasurement:u,dischargeLaytimeTerms:m}=t;for(const e of r)1===e.cargoPortSequence&&(e.cargoQuantity=o),"L"===(null===(a=e.reasonForCall)||void 0===a?void 0:a.reasonForCall)?("MTD"===(null==s?void 0:s.laytimeTermsMeasurementCode)||"MTH"===(null==s?void 0:s.laytimeTermsMeasurementCode)?e.laytimeTermsValue=i:e.laytimeTermsValue=1===e.cargoPortSequence?i:0,e.laytimeTermsMeasurement=s,e.laytimeTerms=c):(e.freightRate=l,"MTD"===(null==u?void 0:u.laytimeTermsMeasurementCode)||"MTH"===(null==u?void 0:u.laytimeTermsMeasurementCode)?e.laytimeTermsValue=d:e.laytimeTermsValue=1===e.cargoPortSequence?d:0,e.laytimeTermsMeasurement=u,e.laytimeTerms=m);return new n.a(Object.assign(Object.assign({},e),{cargoPorts:r}))},connectToCoaCargoPorts:m}},734:function(e,t,a){"use strict";a.d(t,"e",(function(){return w})),a.d(t,"d",(function(){return I})),a.d(t,"a",(function(){return A})),a.d(t,"b",(function(){return R})),a.d(t,"c",(function(){return B}));a(109),a(163);var r,o,n,l,i,s,c,d,u=a(9),m=a(31),p=a(1196),g=a(4),b=a(16),y=a(1),C=a(152),f=a(7),h=a(237),v=a(29),P=a(669),O=a(927),k=a(388),j=a(192),T=a(3),S=a(1401),L=a(299),D=a(642),E=a(1197),x=a(184),F=function(e,t,a,r){var o,n=arguments.length,l=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,a):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,r);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(l=(n<3?o(l):n>3?o(t,a,l):o(t,a))||l);return n>3&&l&&Object.defineProperty(t,a,l),l},N=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},M=function(e,t){return function(a,r){t(a,r,e)}};const w="PORT_CALL_SELECTOR_PORT_CALLS",I="PORT_CALL_SELECTOR_BOL",A="BUNKER_ORDER_MODAL_BUNKER_TYPES",R="BUNKER_ORDER_STATUS_TYPES";let B=class{constructor(e,t,a,r,o,n,l,i){this.store=e,this.tsmodelActions=t,this.selectedBunkerOrderActions=a,this.selectedPortCallActions=r,this.selectedVesselActions=o,this.i=n,this.keyGen=l,this.keySetActions=i,this.getVesselKeyFromPortCall=e=>{const t=!!e.voyage&&!!e.voyage.vessel&&e.voyage.vessel.key;t&&this.loadVesselAndSetAsSelected(t)}}loadAllBunkerStatuses(){const e=[];e.push({field:"statusClass.statusClassCode",filterGroupCode:"bunkerOrderStatusTypeFilter",operator:g.c.EQUALS,queryParamName:"statusClass.statusClassCode",type:g.d.STRING,value:"BO"}),this.tsmodelActions.loadMultipleAction({fields:L.b,filters:e,headers:{},identifier:R,type:y.a.statustype})}loadEstimateBunkerOrderLines(e){this.store.dispatch(this.keySetActions.setKeysAction({identifier:I,keys:[]})),this.tsmodelActions.loadMultipleAction({fields:p.a,headers:{},identifier:I,middlewares:[e=>e.map(e=>(e._key=this.keyGen.getNextKey(),e))],type:{class:y.a.bunkerorderline.class,name:y.a.bunkerorderline.name+"/getEstimateBunkerOrderLines/"+e}})}loadPortCallAndSetAsSelected(e){this.tsmodelActions.loadSingleAction({fields:E.b,identifier:"PORT_CALL_SELECTOR_PORT_CALL",key:e,middlewares:[this.getVesselKeyFromPortCall],type:y.a.portcall}),this.store.dispatch(this.selectedPortCallActions.setAction(e)),this.loadEstimateBunkerOrderLines(e)}setPortCallAndLoadBunkerOrderLines(e){this.store.dispatch(this.selectedPortCallActions.setAction(e)),this.loadEstimateBunkerOrderLines(e)}loadVesselAndSetAsSelected(e){this.tsmodelActions.loadSingleAction({fields:{vesselName:"*"},identifier:"VESSEL_SELECTOR_VESSEL",key:e,type:y.a.vessel}),this.store.dispatch(this.selectedVesselActions.setAction(e)),this.loadPortCallsForVessel(e)}loadPortCallsForVessel(e){if(null!==e){const t=`filter=voyage.vessel.key(EQ)${e}\n                &filter=voyage.voyageHeader.voyageStatus.statusTypeCode(IN)((OPR,NOM))\n                &filter=voyage.voyageHeader.isTemplate(EQ)0\n                &filter=voyage.voyageHeader.isEstimate(EQ)0\n                &filter=voyage.voyageHeader.isUnallocated(EQ)0\n                &filter=voyage.fleetPlanVoyages.fleetPlan.fleetPlanCode(EQ)MASTER\n                &filter=eventLogs.event.eventCode(EQ)ARR\n                &sort=eventLogs.eventLogDate(AS)`;this.tsmodelActions.loadMultipleAction({fields:x.g,headers:{},identifier:w,query:t.replace(/\s+/g,""),type:y.a.portcall})}}clearPortCallsState(){this.store.dispatch(this.keySetActions.setKeysAction({identifier:w,keys:[]}))}setSelectedVessel(e){this.store.dispatch(this.selectedVesselActions.setAction(e))}deselectVessel(){this.store.dispatch(this.selectedVesselActions.setAction(null)),this.clearPortCallsState()}deselectPortCall(){this.store.dispatch(this.keySetActions.setKeysAction({identifier:I,keys:[]})),this.store.dispatch(this.selectedPortCallActions.setAction(null))}loadBunkerTypes(){const e=[{field:"bunkerTypeDesc",groupCode:"bunkerTypes",operator:b.b.ASC,queryParamName:"bunkerTypeDesc"}];this.tsmodelActions.loadMultipleAction({fields:D.a,headers:{},identifier:A,sorts:e,type:y.a.bunkertype})}createBunkerOrder(e,t,a){const r=C.b.generateBunkerOrder(e);this.tsmodelActions.createAction({callback:t,data:r,fields:a?L.a:L.c,middlewares:[e=>(this.store.dispatch(this.selectedBunkerOrderActions.setAction(e.key)),e)],type:y.a.bunkerorder})}};B=F([Object(u.injectable)(),M(0,Object(u.inject)(f.a.Store)),M(1,Object(u.inject)(f.a.ITSModelActionsAsync)),M(2,Object(u.inject)(f.a.ISelectedBunkerOrderActions)),M(3,Object(u.inject)(f.a.ISelectedPortCallActions)),M(4,Object(u.inject)(f.a.ISelectedVesselActions)),M(5,Object(u.inject)(T.a.IInternationalization)),M(6,Object(u.inject)(T.a.IKeyGen)),M(7,Object(u.inject)(f.a.KeySetActions)),N("design:paramtypes",["function"==typeof(r=void 0!==m.Store&&m.Store)?r:Object,"function"==typeof(o=void 0!==v.ITSModelActionsAsync&&v.ITSModelActionsAsync)?o:Object,"function"==typeof(n=void 0!==P.ISelectedBunkerOrderActions&&P.ISelectedBunkerOrderActions)?n:Object,"function"==typeof(l=void 0!==O.ISelectedPortCallActions&&O.ISelectedPortCallActions)?l:Object,"function"==typeof(i=void 0!==k.ISelectedVesselActions&&k.ISelectedVesselActions)?i:Object,"function"==typeof(s=void 0!==j.IInternationalization&&j.IInternationalization)?s:Object,"function"==typeof(c=void 0!==S.IKeyGen&&S.IKeyGen)?c:Object,"function"==typeof(d=void 0!==h.IKeySetActions&&h.IKeySetActions)?d:Object])],B)},876:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var r=a(5);const o={getHeaders:function(e){const{model:t}=e.getLanguageFile();return[{content:t.noOfParcels,contentType:r.a.NUMBER},{content:t.bookedQuantity,contentType:r.a.NUMBER,numberFormatOptions:{minDecimals:3,maxDecimals:3}},{content:t.unitOfMeasurement,contentType:r.a.TEXT},{content:t.commodity,contentType:r.a.TEXT},{content:t.freightRate,contentType:r.a.NUMBER,numberFormatOptions:{minDecimals:3,maxDecimals:3}},{content:t.cargoText,contentType:r.a.TEXT}]},rowContentProperties:["noOfParcels","bookedQuantity","subCargoMeasurement.measurementCode","commodity.commodityName","freightRate","cargoText"]}},879:function(e,t,a){"use strict";a.d(t,"a",(function(){return o})),a.d(t,"b",(function(){return n}));var r=a(126);const o=Object(r.a)((e,t)=>{const{blClass:a,table:r,field:o,isConsecutive:n=!1}=e;return{blClass:a?a.key:null,table:r?r.key:null,field:o?o.key:null,isConsecutive:n,entityRelease:t?t.key:null}}),n=Object(r.a)(e=>{const{blClass:t,field:a,table:r}=e;return!t||!a||!r})},880:function(e,t,a){"use strict";a.d(t,"a",(function(){return o})),a.d(t,"b",(function(){return n}));var r=a(126);const o=Object(r.a)((e,t)=>{const{className:a}=e;return{className:a,entityRelease:t?t.key:null}}),n=Object(r.a)(e=>!e.className)},881:function(e,t,a){"use strict";a.d(t,"a",(function(){return o})),a.d(t,"b",(function(){return n}));var r=a(126);const o=Object(r.a)((e,t)=>{const{blClass:a}=e;return{blClass:a?a.key:null,entityRelease:t?t.key:null}}),n=Object(r.a)(e=>{const{blClass:t}=e;return!t})},942:function(e,t,a){"use strict";a.d(t,"a",(function(){return L}));a(10),a(11),a(268),a(269),a(118);var r,o,n,l,i,s=a(9),c=a(316),d=a(20),u=a(1),m=a(7),p=a(29),g=a(50),b=a(81),y=a(122),C=a(89),f=a(68),h=a(64),v=a(389),P=a(674),O=a(74),k=a(223),j=function(e,t,a,r){var o,n=arguments.length,l=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,a):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,r);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(l=(n<3?o(l):n>3?o(t,a,l):o(t,a))||l);return n>3&&l&&Object.defineProperty(t,a,l),l},T=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},S=function(e,t){return function(a,r){t(a,r,e)}};let L=class{constructor(e,t,a,r,o){this.tsModelActions=e,this.ctrlVoyage=t,this.ctrlPortCall=a,this.ctrlCargoPort=r,this.ctrlCargo=o}createPortCallAndUpdateCargoPort(e,t){var a;const r=Object(C.a)(new f.a(null!==(a=e.portCall)&&void 0!==a?a:{}));delete r.cargoPorts,delete r.key,r.eventLogs=g.a.getDefaultEventLogs(),r.reasonForCall=Object(b.a)(r,"reasonForCall.reasonForCall"),this.updateCargoPort(e,r,t)}updateExistingCargoPortOnPortCall(e,t){var a,r,o,n,l,i,s,c,d,m,p,g,b,C,f,h;if(e.portCall){const v={port:null===(r=null===(a=e.portCall)||void 0===a?void 0:a.port)||void 0===r?void 0:r.key,terminal:null!==(l=null===(n=null===(o=e.portCall)||void 0===o?void 0:o.terminal)||void 0===n?void 0:n.key)&&void 0!==l?l:null,cargoPorts:[{cargoQuantity:e.cargoQuantity,demurrageRate:e.demurrageRate,despatchRate:e.despatchRate,freightRate:e.freightRate,handlingCostCurrency:null===(i=e.handlingCostCurrency)||void 0===i?void 0:i.key,handlingCostRate:e.handlingCostRate,hcMeasurement:null===(s=e.hcMeasurement)||void 0===s?void 0:s.key,indexRate:e.indexRate,isCargoQuantityFixed:e.isCargoQuantityFixed,isFreeDespatch:e.isFreeDespatch,isHandlingCostLumpsum:e.isHandlingCostLumpsum,isWorking:e.isWorking,key:e.key,laytimeTerms:null===(c=e.laytimeTerms)||void 0===c?void 0:c.key,laytimeTermsMeasurement:null===(d=e.laytimeTermsMeasurement)||void 0===d?void 0:d.key,laytimeTermsValue:e.laytimeTermsValue,laytimeUsed:e.laytimeUsed,port:null===(m=e.port)||void 0===m?void 0:m.key,portCall:e.portCall.key,tcRateIndex:null!==(g=null===(p=e.tcRateIndex)||void 0===p?void 0:p.key)&&void 0!==g?g:null,terminal:null!==(C=null===(b=e.terminal)||void 0===b?void 0:b.key)&&void 0!==C?C:null},...(null!==(h=null===(f=e.portCall)||void 0===f?void 0:f.cargoPorts)&&void 0!==h?h:[]).flatMap(t=>t.key!==e.key?{key:t.key}:[])]};this.tsModelActions.updateSingleAction({callback:()=>this.ctrlCargo.refreshCargo(t,!0),data:v,fields:y.j,key:e.portCall.key,type:u.a.portcall})}}updateCargoPort(e,t,a){const r=Object(C.a)(new h.a(Object.assign({},e)));r.portCall=t,this.tsModelActions.updateSingleAction({callback:()=>this.ctrlCargo.refreshCargo(a,!0),data:r,fields:{port:"*",terminal:"*",portCall:"*",cargoPortSequence:"*"},key:e.key,type:u.a.cargoport})}onConfirmCreate(e,t,a,r){var o,n;const l=g.a.hasPortCallSequenceChanged(null!==(n=null===(o=e.voyage)||void 0===o?void 0:o.partOfSchedule.sort(g.a.sortByVesselPcSequence))&&void 0!==n?n:[],t),{portCall:i}=a,s=t.find(e=>e.key<0),c=null!=s?s:l&&i?Object.assign(Object.assign({},i),{portCallSequence:i.portCallSequence}):void 0,d=c?this.ctrlPortCall.generatePostablePortCall(c):void 0;this.createCargoPort(a,r,e,d)}getPostableUpdateCargoPort(e){const t=Object(C.a)(new h.a(e));return t.reasonForCall=Object(b.a)(e,"reasonForCall.reasonForCall"),t}createCargoPort(e,t,a,r){if(r){const e=this.ctrlCargoPort.generatePostableCargoPorts(t,null,r);this.ctrlCargoPort.updateCargoCargoPorts(e,a)}else{const r=Object(C.a)(new O.a({cargoPorts:t,voyage:a.voyage}));r.cargoPorts=r.cargoPorts.map(r=>{var o;return r.key?(r.cargoPortSequence=null===(o=t.find(e=>e.key===r.key))||void 0===o?void 0:o.cargoPortSequence,r):this.getPostableCargoPort(a,e)}),this.ctrlCargoPort.createCargoPortAndUpdateCargo(r,a.key)}}getPostableCargoPort(e,t){var a,r,o,n,l;t.cargo=new O.a({key:e.key,voyage:null!==(r=null===(a=e.voyage)||void 0===a?void 0:a.key)&&void 0!==r?r:null});const i=Object(C.a)(new h.a(t));return i.reasonForCall=null===(o=t.reasonForCall)||void 0===o?void 0:o.reasonForCall,i.laytimeTermsMeasurement=null===(n=t.laytimeTermsMeasurement)||void 0===n?void 0:n.laytimeTermsMeasurementCode,i.cargoPortSequence=t.cargoPortSequence,null===(l=i.portCall)||void 0===l||delete l.cargoPorts,e.voyage&&!i.portCall.key&&(i.portCall.eventLogs=g.a.getDefaultEventLogs(),i.portCall.reasonForCall=Object(b.a)(i,"portCall.reasonForCall.key")),i}};L=j([Object(s.injectable)(),S(0,Object(s.inject)(m.a.ITSModelActionsAsync)),S(1,Object(s.inject)(d.a.ICargoDrawerControllerVoyage)),S(2,Object(s.inject)(d.a.ICargoDrawerControllerPortCall)),S(3,Object(s.inject)(d.a.ICargoDrawerControllerCargoPort)),S(4,Object(s.inject)(d.a.ICargoDrawerController)),T("design:paramtypes",["function"==typeof(r=void 0!==p.ITSModelActionsAsync&&p.ITSModelActionsAsync)?r:Object,"function"==typeof(o=void 0!==c.ICargoDrawerControllerVoyage&&c.ICargoDrawerControllerVoyage)?o:Object,"function"==typeof(n=void 0!==v.ICargoDrawerControllerPortCall&&v.ICargoDrawerControllerPortCall)?n:Object,"function"==typeof(l=void 0!==P.ICargoDrawerControllerCargoPort&&P.ICargoDrawerControllerCargoPort)?l:Object,"function"==typeof(i=void 0!==k.ICargoDrawerController&&k.ICargoDrawerController)?i:Object])],L)},943:function(e,t,a){"use strict";a.d(t,"a",(function(){return F}));a(118);var r,o,n,l,i,s,c=a(9),d=a(316),u=a(20),m=a(1),p=a(7),g=a(29),b=a(50),y=a(389),C=a(674),f=a(942),h=a(336),v=a(58),P=a(223),O=a(2092),k=a(89),j=a(74),T=a(68),S=a(146),L=a(242),D=function(e,t,a,r){var o,n=arguments.length,l=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,a):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,r);else for(var i=e.length-1;i>=0;i--)(o=e[i])&&(l=(n<3?o(l):n>3?o(t,a,l):o(t,a))||l);return n>3&&l&&Object.defineProperty(t,a,l),l},E=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},x=function(e,t){return function(a,r){t(a,r,e)}};let F=class{constructor(e,t,a,r,o,n){this.tsModelActions=e,this.ctrlVoyage=t,this.ctrlPortCall=a,this.ctrlCargoPort=r,this.ctrlCargo=o,this.ctrlCreateCP=n}onConfirmEdit(e,t,a,r,o){var n,l;if(b.a.hasPortCallSequenceChanged(null!==(l=null===(n=a.voyage)||void 0===n?void 0:n.partOfSchedule.sort(b.a.sortByVesselPcSequence))&&void 0!==l?l:[],r)&&r.length)this.updateCargoPortsAfterSequenceChange(t,o,e,a);else{const e=Object(k.a)(new j.a({cargoPorts:o}));e.cargoPorts=e.cargoPorts.map(e=>{var a;return e.key===t.key?this.ctrlCreateCP.getPostableUpdateCargoPort(t):(e.cargoPortSequence=null===(a=o.find(t=>t.key===e.key))||void 0===a?void 0:a.cargoPortSequence,e)}),this.updateCargoPortAndPortCall(t,a,e)}}updateCargoPortsAfterSequenceChange(e,t,a,r){var o,n,l;if(r.voyage&&e.portCall){const i=t.map(e=>e.portCall);let s;this.ctrlPortCall.setNewPortCallSequenceOnCargoPortPortCall(i,e),e.portCall&&e.portCall.key<0?(e.portCall.voyage=null!==(n=null===(o=e.cargo)||void 0===o?void 0:o.voyage)&&void 0!==n?n:null,e.portCall.port=e.port,e.portCall.terminal=e.terminal,e.portCall.reasonForCall=e.reasonForCall,s=this.ctrlPortCall.generatePostablePortCall(null!==(l=e.portCall)&&void 0!==l?l:new T.a({}),void 0,!0)):s=void 0;const c=this.ctrlCargoPort.generatePostableCargoPorts(t,a,s,e.portCall.key).map(e=>(null!==e.portCall&&void 0!==e.portCall&&(e.portCall.eventLogs=[Object(k.a)(new S.a({event:new L.a({eventCode:"ARR"}),eventLogDate:new Date})),Object(k.a)(new S.a({event:new L.a({eventCode:"BRT"}),eventLogDate:new Date})),Object(k.a)(new S.a({event:new L.a({eventCode:"DEP"}),eventLogDate:new Date}))]),e));this.ctrlCargoPort.updateCargoCargoPorts(c,r)}}updateCargoPortAndPortCall(e,t,a){e.portCall?e.portCall.key>0?this.ctrlCreateCP.updateExistingCargoPortOnPortCall(e,t):e.portCall.key<0&&this.ctrlCreateCP.createPortCallAndUpdateCargoPort(e,t):this.tsModelActions.updateSingleAction({data:a,key:t.key,type:m.a.cargo,fields:{cargoPorts:{port:"*",terminal:"*",cargoPortSequence:"*"}},callback:()=>this.ctrlCargo.refreshCargo(t,!0)})}addPortCallToSchedule(e,t,a){var r;let o=b.a.addPortCall(e,Array.from(t));const n=v.a.getLastDischargeCargoPort(a.cargoPorts),l=null===(r=null==n?void 0:n.portCall)||void 0===r?void 0:r.portCallSequence;if(l){o=h.a.reorder(o,o.length-1,l-1);for(let e=0;e<o.length;e++)o[e].portCallSequence=e+1}return o}updateStateCargoPorts(e,t){const a=[];if(Array.from(t.cargoPorts).forEach(t=>{t.key===e.key?a.push(e):t.key>0&&a.push(t)}),0===e.key){const r=Object(O.a)(t.cargoPorts,t=>{var a,r;return(null===(a=t.reasonForCall)||void 0===a?void 0:a.reasonForCall)===(null===(r=e.reasonForCall)||void 0===r?void 0:r.reasonForCall)})+1;a.splice(r||t.cargoPorts.length,0,e)}return a}};F=D([Object(c.injectable)(),x(0,Object(c.inject)(p.a.ITSModelActionsAsync)),x(1,Object(c.inject)(u.a.ICargoDrawerControllerVoyage)),x(2,Object(c.inject)(u.a.ICargoDrawerControllerPortCall)),x(3,Object(c.inject)(u.a.ICargoDrawerControllerCargoPort)),x(4,Object(c.inject)(u.a.ICargoDrawerController)),x(5,Object(c.inject)(u.a.ICreateCargoPortController)),E("design:paramtypes",["function"==typeof(r=void 0!==g.ITSModelActionsAsync&&g.ITSModelActionsAsync)?r:Object,"function"==typeof(o=void 0!==d.ICargoDrawerControllerVoyage&&d.ICargoDrawerControllerVoyage)?o:Object,"function"==typeof(n=void 0!==y.ICargoDrawerControllerPortCall&&y.ICargoDrawerControllerPortCall)?n:Object,"function"==typeof(l=void 0!==C.ICargoDrawerControllerCargoPort&&C.ICargoDrawerControllerCargoPort)?l:Object,"function"==typeof(i=void 0!==P.ICargoDrawerController&&P.ICargoDrawerController)?i:Object,"function"==typeof(s=void 0!==f.ICreateCargoPortController&&f.ICreateCargoPortController)?s:Object])],F)},951:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var r=a(1330),o=a(503);function n(e,t){const a=t.map(t=>{var a,o,n,l;const i=(null===(a=t.port)||void 0===a?void 0:a.portName)?t.port:null!==(n=Object(r.a)(e,{key:null===(o=t.port)||void 0===o?void 0:o.key}))&&void 0!==n?n:null;return{port:i,terminal:t,label:(null==i?void 0:i.portName)+" - "+t.terminalName,key:Number(`${null!==(l=null==i?void 0:i.key)&&void 0!==l?l:""}${t.key}`)}});return e.map(e=>({port:e,terminal:null,label:null==e?void 0:e.portName,key:e.key})).concat(a)}const l={mergePortsTerminals:n,filteredPortTerminals:function(e,t,a){var r;if(!(null==e?void 0:e.isTc))return a;const l=[],i=[];return(null!==(r=e.partOfSchedule)&&void 0!==r?r:[]).filter(e=>{var a;return t===(null===(a=e.reasonForCall)||void 0===a?void 0:a.reasonForCall)}).forEach(({port:e,terminal:t})=>{e&&t?i.push(t):e&&l.push(e)}),n(Object(o.a)(l,"key"),Object(o.a)(i,"key"))}}},955:function(e,t,a){"use strict";a.d(t,"a",(function(){return m}));var r=a(892),o=a(742),n=a(68),l=a(50),i=a(60);const s=new(a(271).a);function c(e,t,a){var r;const i=null!==(r=l.a.getPortAndTerminalEqual(e,t))&&void 0!==r?r:l.a.getPortAndRfcEqualWithOneTerminal(e,t);if(i)t.portCall=i;else{const r=function(e,t){var a,r;return new n.a({key:-Math.abs(s.getNextKey()),port:e.port,terminal:e.terminal,reasonForCall:e.reasonForCall,voyage:null==t?void 0:t.key,portCallSequence:u(e.reasonForCall,t),vesselPcSequence:(null!==(r=null===(a=Object(o.a)(t.partOfSchedule,"vesselPcSequence"))||void 0===a?void 0:a.vesselPcSequence)&&void 0!==r?r:0)+1,eventLogs:l.a.getDefaultEventLogs(),cargoPorts:[e]})}(t,a),i=(e=l.a.addPortCall(r,e)).find(e=>e.key===(null==r?void 0:r.key));t.portCall=null!=i?i:null}return{cp:t,pcs:e}}function d(e,t,a,o){if(e){const e=t.filter(e=>{var t;return!(e.key<0&&(null===(t=e.reasonForCall)||void 0===t?void 0:t.reasonForCall)===a)});t=l.a.resequencePortCalls(e)}else if(o[0]){const e=t.filter(e=>!Object(r.a)(e.cargoPorts.filter(({key:e})=>e===o[0].key)));e[0]&&(t=l.a.removePortCall(t,e[0].key))}return t}function u(e,{partOfSchedule:t}){if("L"===(null==e?void 0:e.reasonForCall)||"D"===(null==e?void 0:e.reasonForCall)){return i.a.getLastPortCallWithRFC(t,e.reasonForCall).portCallSequence+1}return i.a.getLastPortCall(t).portCallSequence+1}const m={handleUpdate:function(e,t,a,r,o,n){let l=t?Array.from(t.partOfSchedule):null;if(e&&l&&t){const{cp:a,pcs:r}=c(l,e,t);e=a,l=r;const o=n.cargoPorts.findIndex(({key:t})=>t===(null==e?void 0:e.key));o>-1&&(n.cargoPorts[o]=e)}else l&&(l=d(a,l,r,o));return{updatedCargoWithLink:n,updatedPortCalls:l}},handleAdd:c,handleDelete:d}}}]);