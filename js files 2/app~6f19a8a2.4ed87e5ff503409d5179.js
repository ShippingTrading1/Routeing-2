(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{1672:function(e,t,o){"use strict";o.d(t,"a",(function(){return F}));var a,i,s,n,l,r=o(9),c=o(114),d=o(0),g=o.n(d),y=o(130),h=o(3),p=o(192),u=o(20),v=o(939),f=o(317),m=o(472),S=o(1),b=o(310),C=o(206),O=o(7),A=o(31),k=o(1429),V=o(984),M=o(107),w=o(60),j=function(e,t,o,a){var i,s=arguments.length,n=s<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,o):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,a);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(n=(s<3?i(n):s>3?i(t,o,n):i(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n},I=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},T=function(e,t){return function(o,a){t(o,a,e)}};let F=class{constructor(e,t,o,a,i){this.store=e,this.i=t,this.controller=o,this.drawerStatusController=a,this.scenarioActions=i}changeStatus(e,t,o,a,i,s){var n,l;let r=!0;const c=null===(l=null===(n=t.voyageHeader)||void 0===n?void 0:n.voyageStatus)||void 0===l?void 0:l.statusTypeCode;if(c){switch(e.statusTypeCode){case"EST":"NOM"===c&&(o(e),r=!1);break;case"SCU":"SCH"===c&&(o(e),r=!1);break;case"SCH":if(["SCU","EST"].includes(c)){this.precheckToAllocated(t)&&a(e),r=!1}break;case"NOM":if(["EST","SCH"].includes(c)){this.precheckToAllocated(t,!0)&&i(),r=!1}}r&&this.controller.updateVoyageHeaderField("voyageStatus",e.statusTypeCode,t,void 0,M.n).then(()=>{var e;if(s){const o=null===(e=t.vessel)||void 0===e?void 0:e.key;this.scenarioActions.refreshScenarioFleetPlanData([null!=o?o:0])}})}}changeOptionStatus(e,t){this.controller.changeOptionStatus(e,t)}precheckToAllocated(e,t){var o,a,i,s;const{common:n,model:l,voyages:r}=this.i.getLanguageFile(),{cargos:d}=e,h=!!(null===(o=e.voyageHeader)||void 0===o?void 0:o.businessUnit),p=!!(null===(a=e.voyageHeader)||void 0===a?void 0:a.company),u=d.every(e=>!!e.charterer),v=d.every(e=>!!e.commodity),f=!t&&!(h&&p)||!(u&&v),m=w.a.getPerformanceCargo(e.cargos),S=m.isOption&&"Declared"!==(null===(i=m.optionStatus)||void 0===i?void 0:i.statusTypeDesc),b={listItem:{display:"list-item",listStyleType:"disc",marginLeft:3}};return t&&S?(Object(c.a)(n.warning,n.cantNominate,"",n.ok,!0,"xs"),!1):f?(Object(c.a)(t?r.nominateVoyage:r.allocateVoyage,g.a.createElement(g.a.Fragment,null,f&&g.a.createElement(y.a,{variant:"subtitle2"},r.requiredValuesMustBeSet),g.a.createElement(k.a,null,!t&&!h&&g.a.createElement(V.a,{sx:b.listItem},l.businessUnit),!t&&!p&&g.a.createElement(V.a,{sx:b.listItem},l.company),!u&&g.a.createElement(V.a,{sx:b.listItem},r.eachCargoCharterer," "),!v&&g.a.createElement(V.a,{sx:b.listItem},r.eachCargoCommodity))),"",n.ok,!0,"xs"),!1):null!==(null===(s=e.tcs[0])||void 0===s?void 0:s.charterer)||(Object(c.a)(r.nominateVoyage,g.a.createElement(g.a.Fragment,null,g.a.createElement(y.a,null,r.chartererMandatory)),"",n.ok,!0,"xs"),!1)}getOverrideAllowedStatuses(e){var t,o;if((null===(t=null==e?void 0:e.voyageHeader)||void 0===t?void 0:t.isBudget)||(null===(o=null==e?void 0:e.voyageHeader)||void 0===o?void 0:o.isTemplate)){const e=["EST","FIN"];return this.drawerStatusController.getStatuses(S.a.voyage).filter(t=>!e.includes(t.statusTypeCode))}if(!b.a.isMasterScenario(Object(m.a)(null==e?void 0:e.scenarios))){const e=["SCU","SCH"];return this.drawerStatusController.getStatuses(S.a.voyage).filter(t=>!e.includes(t.statusTypeCode))}return[]}getOverrideAllowedOptionStatuses(e,t){if(t.isOption){const e=["NOT","DCL","FOR"];return this.drawerStatusController.getStatusesByClassCode("OPT").filter(t=>!e.includes(t.statusTypeCode))}return[]}};F=j([Object(r.injectable)(),T(0,Object(r.inject)(O.a.Store)),T(1,Object(r.inject)(h.a.IInternationalization)),T(2,Object(r.inject)(u.a.IVoyageDrawerController)),T(3,Object(r.inject)(u.a.IDrawerStatusController)),T(4,Object(r.inject)(O.a.IScenarioActions)),I("design:paramtypes",["function"==typeof(a=void 0!==A.Store&&A.Store)?a:Object,"function"==typeof(i=void 0!==p.IInternationalization&&p.IInternationalization)?i:Object,"function"==typeof(s=void 0!==v.IVoyageDrawerController&&v.IVoyageDrawerController)?s:Object,"function"==typeof(n=void 0!==f.IDrawerStatusController&&f.IDrawerStatusController)?n:Object,"function"==typeof(l=void 0!==C.IScenarioActions&&C.IScenarioActions)?l:Object])],F)},1673:function(e,t,o){"use strict";o.d(t,"a",(function(){return S}));o(10),o(11);var a,i,s=o(9),n=o(1330),l=o(2358),r=o(7),c=o(29),d=o(1),g=o(107),y=o(131),h=o(318),p=o(48),u=o(68),v=function(e,t,o,a){var i,s=arguments.length,n=s<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,o):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,a);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(n=(s<3?i(n):s>3?i(t,o,n):i(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n},f=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},m=function(e,t){return function(o,a){t(o,a,e)}};let S=class{constructor(e,t){this.tsmodelActionsAsync=e,this.tsmodelActions=t}sortByRoutingSequence(e,t){if(void 0===e.routingSequenceNo||void 0===t.routingSequenceNo)return 1;const o=e.routingSequenceNo,a=t.routingSequenceNo;return o>a?1:o<a?-1:0}updatePortCall(e,t,o,a){const i=Object(h.h)((null==o?void 0:o.partOfSchedule)||[]);i&&this.tsmodelActionsAsync.updateSingleAction({data:{[e]:t},fields:{voyage:g.n},key:i.key,type:d.a.portcall,callback:a})}addRoutingPoint(e,t){this.tsmodelActionsAsync.updateSingleAction({data:{routingPoints:[...t.routingPoints.map(({key:e})=>({key:e})),e]},key:t.key,type:d.a.portcall,fields:{voyage:g.n}})}removeRoutingPoint(e,t){var o,a;const i=Object(n.a)(e,({routingPoints:e})=>Object(l.a)(e,{key:t})),s=null!==(o=null==i?void 0:i.routingPoints.filter(e=>e.key!==t))&&void 0!==o?o:[];this.tsmodelActionsAsync.updateSingleAction({data:{routingPoints:s.map(({key:e})=>({key:e}))},key:null!==(a=null==i?void 0:i.key)&&void 0!==a?a:0,type:d.a.portcall,callback:()=>{var e;return this.tsmodelActions.addMultipleAction(new u.a({key:null!==(e=null==i?void 0:i.key)&&void 0!==e?e:0,routingPoints:s}))},fields:{voyage:g.n}})}loadOverlappingRoute(e){this.tsmodelActionsAsync.loadSingleAction({key:e,type:d.a.voyage,fields:{partOfSchedule:{portCallSequence:"*",portCallRoutes:{geoJson:"*",isSelected:"*"}}}})}reloadVoyage(e,t){this.tsmodelActionsAsync.loadSingleAction({callback:t||void 0,fields:g.n,key:e,type:d.a.voyage,headers:Object(p.b)()?y.a.serializeCache:void 0})}};S=v([Object(s.injectable)(),m(0,Object(s.inject)(r.a.ITSModelActionsAsync)),m(1,Object(s.inject)(r.a.ITSModelActions)),f("design:paramtypes",["function"==typeof(a=void 0!==c.ITSModelActionsAsync&&c.ITSModelActionsAsync)?a:Object,"function"==typeof(i=void 0!==c.ITSModelActions&&c.ITSModelActions)?i:Object])],S)},2050:function(e,t,o){"use strict";o.d(t,"a",(function(){return Ie}));o(59),o(10),o(11),o(109);var a=o(149),i=o.n(a),s=o(274),n=o.n(s),l=o(1805),r=o.n(l),c=o(1784),d=o.n(c),g=o(81),y=o(472),h=o(0),p=o.n(h),u=o(97),v=o(831),f=o(107),m=o(46),S=o(40),b=o(598),C=o(44),O=o(6),A=o(47),k=o(1),V=o(108),M=o(62),w=o(33),j=o(21),I=o(372),T=o(1815),F=o(240),P=o(651),D=o(42),E=o(7),H=o(66),x=o(30),N=o(310),R=o(60),L=o(3),K=o(82),B=o(15),U=o(27),W=o(174),z=o(1800),_=o(1951),q=o(2064),$=o(1785),Q=o(1803),J=o(1802),G=o(411),X=o(20),Y=o(1806),Z=o(1814),ee=o(2005),te=o(1234),oe=o(1812),ae=o(2065),ie=o(1917),se=o(2067),ne=o(695),le=o(32),re=o(111),ce=o(2066),de=o(1213),ge=o(105),ye=o(1901),he=o(531),pe=o(450),ue=o(122),ve=o(74),fe=o(296),me=o(1804),Se=o.n(me),be=o(341),Ce=o(331),Oe=o(2533),Ae=o(2534),ke=function(e,t,o,a){return new(o||(o=Promise))((function(i,s){function n(e){try{r(a.next(e))}catch(e){s(e)}}function l(e){try{r(a.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,l)}r((a=a.apply(e,t||[])).next())}))};function Ve(e){var t;const{reactKeyPrefix:o,voyage:a,onClose:i,showDeleteModal:s,onConfirmDelete:n}=e,[l,r]=Object(O.a)([X.a.IVoyageDrawerController,L.a.IInternationalization]),{common:c,model:d}=r.lang(),[g,y]=Object(h.useState)(void 0),u=null!==(t=null==a?void 0:a.voyageHeader)&&void 0!==t?t:new V.a({}),v=Object(h.useCallback)(()=>ke(this,void 0,void 0,(function*(){const e=yield l.getFleetplanVoyagesForTemplate(a);y(0===e.length)})),[l,a]);return Object(h.useEffect)(()=>{u.isTemplate?v():y(!0)},[]),p.a.createElement(C.a,{reactKeyPrefix:o+"-delete-modal",open:s,onCloseModal:i,onConfirm:n,hideConfirmBtn:!g,title:c.delete,cancelBtnName:g?c.cancel:c.close,maxWidth:"xs",fullWidth:!0},p.a.createElement("p",null,g?c.deleteConfirmation+d.voyage+"? ":c.deleteTemplateVoyage),(a.cargos.length>0||u.offhires.length>0)&&g?p.a.createElement(Oe.a,{severity:"warning"},p.a.createElement(Ae.a,null,c.deleteVoyageWithCargoesOrOffhires),p.a.createElement("p",null,a.cargos.length>0?c.deleteVoyageWithCargoAlert(a.cargos.length):""),p.a.createElement("p",null,u.offhires.length>0?c.deleteVoyageWithOffhireAlert(u.offhires.length):"")):"")}var Me=function(e,t,o,a){return new(o||(o=Promise))((function(i,s){function n(e){try{r(a.next(e))}catch(e){s(e)}}function l(e){try{r(a.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,l)}r((a=a.apply(e,t||[])).next())}))};const we="doc-common-components-drawer-voyage-drawer";class je extends p.a.Component{constructor(e){super(e),this.onClickOverlappingChip=e=>{this.props.history&&this.props.location&&U.a.openDrawer(e,B.a.voyageDrawer,this.props.location,this.props.history)},this.state=Object.assign(Object.assign({},e.state),{allocateModalStatus:void 0,showDeleteModal:!1,unallocateModalStatus:void 0,showVoyageRefModal:!1,showVoyageIntakeCalculationModal:!1,showCopyVoyageModal:!1,showDateWarning:!1,showVoyageSensitivityAnalysis:!1,openedFromFas:this.isOpenedFromFas(e),openedFromBudgets:this.isOpenedFromBudgets(e),overlappingVoyages:[],overlappingVoyageColourMap:new Map,allocateModalFromMoveVoyage:!1,showConvertToTemplateModal:!1,showPrintSOAModal:!1,showNominateModal:!1,fullscreen:!1,voyageId:void 0}),this.showAllocateModal=this.showAllocateModal.bind(this),this.showUnallocateModal=this.showUnallocateModal.bind(this),this.toggleDateWarningModal=this.toggleDateWarningModal.bind(this),this.showDeleteModal=this.showDeleteModal.bind(this),this.toggleVoyageRefModal=this.toggleVoyageRefModal.bind(this),this.closeAllocateModal=this.closeAllocateModal.bind(this),this.closeDeleteModal=this.closeDeleteModal.bind(this),this.closeUnallocateModal=this.closeUnallocateModal.bind(this),this.closeVoyageSensitivityAnalysisModal=this.closeVoyageSensitivityAnalysisModal.bind(this),this.showVoyageSensitivityAnalysisModal=this.showVoyageSensitivityAnalysisModal.bind(this),this.allocateVoyage=this.allocateVoyage.bind(this),this.unallocateVoyage=this.unallocateVoyage.bind(this),this.deleteVoyage=this.deleteVoyage.bind(this),this.loadVoyage=this.loadVoyage.bind(this),this.getVoyageId=this.getVoyageId.bind(this),this.toggleShowVoyageIntakeCalculationModal=this.toggleShowVoyageIntakeCalculationModal.bind(this),this.toggleCopyVoyageModalVisible=this.toggleCopyVoyageModalVisible.bind(this),this.onCopyVoyage=this.onCopyVoyage.bind(this),this.callbackForCopyVoyage=this.callbackForCopyVoyage.bind(this),this.onChangeStatus=this.onChangeStatus.bind(this),this.onChangeOptionStatus=this.onChangeOptionStatus.bind(this),this.checkOverlappingVoyagesExist=this.checkOverlappingVoyagesExist.bind(this),this.setOverlapChipColourMap=this.setOverlapChipColourMap.bind(this),this.getOverlappingChips=this.getOverlappingChips.bind(this),this.onClickOverlappingChip=this.onClickOverlappingChip.bind(this),this.openVesselDrawer=this.openVesselDrawer.bind(this),this.toggleConvertToTemplate=this.toggleConvertToTemplate.bind(this),this.togglePrintSOAModal=this.togglePrintSOAModal.bind(this),this.closePrintSOAModal=this.closePrintSOAModal.bind(this),this.closeNominateModal=this.closeNominateModal.bind(this),this.showNominateModal=this.showNominateModal.bind(this),this.onClickPorts=this.onClickPorts.bind(this),this.refreshFas=this.refreshFas.bind(this),this.setIsFullScreen=this.setIsFullScreen.bind(this),this.onClickCompare=this.onClickCompare.bind(this)}componentWillUnmount(){const{deps:[,,,,,,e]}=this.props;this.resetChipColourMap(),e.setAction(fe.a,null)}isOpenedFromFas(e){return Object(be.d)(e.match.path,Ce.a)}isOpenedFromBudgets(e){return e.match.path.includes(w.a.budgets.url)}UNSAFE_componentWillMount(){var e;this.getVoyageId(this.props.match),this.checkOverlappingVoyagesExist(null!==(e=this.state.voyage)&&void 0!==e?e:new M.a({}))}UNSAFE_componentWillReceiveProps(e){this.getVoyageId(e.match),this.setState(Object.assign(Object.assign({},e.state),{openedFromFas:this.isOpenedFromFas(e)}),()=>{this.checkOverlappingVoyagesExist(e.state.voyage)}),this.resetChipColourMap()}loadVoyage(){var e,t;const{deps:[o,,,,,,a]}=this.props;this.state.voyageId&&this.state.voyageId!==this.props.state.skipLoadingDrawerKey?o.dispatchLoadVoyageAction(this.state.voyageId):this.state.voyageId&&(o.dispatchSelectedVoyage(this.state.voyageId),o.loadTcsOfVessel(null!==(t=null===(e=this.state.voyage)||void 0===e?void 0:e.vessel)&&void 0!==t?t:new re.a({})),o.loadSelectedCargo(this.state.selectedCargo.key)),a.setAction(F.a,null)}refreshFas(){const{deps:[e]}=this.props,{voyage:t,openedFromBudgets:o,openedFromFas:a}=this.state;t&&e.refreshFas(t,o,a)}getVoyageId(e){if(e){const t=e.params.drawerId?e.params.drawerId:"0",o=parseInt(t,10);o!==this.state.voyageId&&this.setState({voyageId:o},this.loadVoyage)}}allocateVoyage(e,t,o,a,i){return Me(this,void 0,void 0,(function*(){const{deps:[s]}=this.props,{voyage:n,allocateModalStatus:l,openedFromFas:r}=this.state;if(n&&l&&e&&t){const c={refreshFleetPlan:r,reloadAllData:!0,status:l};i?yield s.moveVoyage(n,e,i,t,c.refreshFleetPlan,f.n,o):yield s.allocateVoyage(n,e,t,o,a,c)}this.closeAllocateModal()}))}showAllocateModal(e){var t,o;this.state.voyage&&this.setState({allocateModalStatus:null!==(o=null!=e?e:null===(t=this.state.voyage.voyageHeader)||void 0===t?void 0:t.voyageStatus)&&void 0!==o?o:void 0})}showNominateModal(){this.setState({showNominateModal:!this.state.showNominateModal})}closeNominateModal(){this.state.voyage&&this.setState({showNominateModal:!1})}showAllocateModalForMove(e){var t,o;this.state.voyage&&this.setState({allocateModalStatus:null!==(o=null!=e?e:null===(t=this.state.voyage.voyageHeader)||void 0===t?void 0:t.voyageStatus)&&void 0!==o?o:void 0,allocateModalFromMoveVoyage:!0})}closePrintSOAModal(){this.setState({showPrintSOAModal:!1})}closeAllocateModal(){const{deps:[e]}=this.props;this.setState({allocateModalStatus:void 0,allocateModalFromMoveVoyage:!1}),e.dispatchSetSelectedVesselActions(-1)}closeVoyageSensitivityAnalysisModal(){this.setState({showVoyageSensitivityAnalysis:!1})}showVoyageSensitivityAnalysisModal(){this.setState({showVoyageSensitivityAnalysis:!0})}showUnallocateModal(e){this.state.voyage&&this.setState({unallocateModalStatus:e})}showDeleteModal(){this.setState({showDeleteModal:!0})}toggleConvertToTemplate(){this.setState({showConvertToTemplateModal:!this.state.showConvertToTemplateModal})}togglePrintSOAModal(){this.setState({showPrintSOAModal:!this.state.showPrintSOAModal})}toggleDateWarningModal(){this.setState({showDateWarning:!this.state.showDateWarning})}closeUnallocateModal(){const{deps:[e]}=this.props;this.setState({unallocateModalStatus:void 0}),e.dispatchSetSelectedVesselActions(-1)}closeDeleteModal(){this.setState({showDeleteModal:!1})}toggleShowVoyageIntakeCalculationModal(){this.setState({showVoyageIntakeCalculationModal:!this.state.showVoyageIntakeCalculationModal})}toggleVoyageRefModal(){this.state.voyage&&this.setState({showVoyageRefModal:!this.state.showVoyageRefModal})}onClickCompare(){const[,,,,,,,e]=this.props.deps;this.state.voyageId&&(this.props.dispatchAction(e.setAction([this.state.voyageId])),this.props.history.push(w.a.voyages.url+"/comparison/"+this.state.voyageId))}unallocateVoyage(e,t){const{deps:[o]}=this.props,{voyage:a,unallocateModalStatus:i,openedFromFas:s}=this.state;if(a&&i&&e){const n={refreshFleetPlan:s,reloadAllData:!0,status:i,ballastPort:t};o.unallocateVoyage(a,e,n),this.closeUnallocateModal()}}deleteVoyage(){const{deps:[e]}=this.props,{voyage:t,openedFromFas:o}=this.state;t&&(this.props.history.goBack(),e.deleteVoyage(t,o))}toggleCopyVoyageModalVisible(){this.setState({showCopyVoyageModal:!this.state.showCopyVoyageModal})}onCopyVoyage(){const{deps:[e]}=this.props,{openedFromFas:t,voyage:o}=this.state;e.copyVoyage(o,t,this.callbackForCopyVoyage),this.toggleCopyVoyageModalVisible()}callbackForCopyVoyage(e,t){const{deps:[,,,o]}=this.props;if(t&&t.key){const{openedFromFas:e}=this.state,{location:a,history:i}=this.props;U.a.openDrawer(t.key,B.a.voyageDrawer,a,i),e?o.loadVoyages(t.scenarios[0].key):m.a.next()}}toggleIsOptional(e){const{deps:[t]}=this.props;t.toggleIsOption(e)}setIsFullScreen(e){this.setState({fullscreen:e})}getActionMenus(){const{deps:[,,e]}=this.props,{common:t,voyages:o}=e.getLanguageFile();return[{data:[{disabled:!1,onClick:this.showVoyageSensitivityAnalysisModal,text:o.voyageSensitivityAnalysis},{disabled:!1,onClick:this.toggleShowVoyageIntakeCalculationModal,text:o.voyageIntakeCalculation}],icon:d.a,tooltipText:t.functions}]}onClickPorts(e){const{deps:[,,,,t]}=this.props;this.props.dispatchAction(t.putFilterAction(e))}getTabs(){var e,t,o;const{voyage:a,userLocale:i}=this.state,{deps:[,,s]}=this.props,{menu:n,common:l,model:r,voyages:c}=s.getLanguageFile(),d=Object(H.a)([x.a.InvoicesPAGE],this.state.user);if(!a)return[];const g=null===(e=null==a?void 0:a.voyageHeader)||void 0===e?void 0:e.isTemplate;return[{id:"overview",content:()=>a.key!==this.state.voyageId?p.a.createElement(p.a.Fragment,null):p.a.createElement($.a,{reactKeyPrefix:we+"-voyage-overview",voyage:a,userLocale:this.state.userLocale,user:this.state.user,openedFromFas:this.state.openedFromFas,toggleDateWarningModal:this.toggleDateWarningModal,restrictedAreas:this.state.restrictedAreas,overlappingVoyageColourMap:this.state.overlappingVoyageColourMap,onClickOverlappingChip:this.onClickOverlappingChip,onClickPorts:this.onClickPorts,refreshFas:this.refreshFas,isFullscreen:this.state.fullscreen}),label:l.overview},{id:"cargo",content:()=>p.a.createElement(z.a,{reactKeyPrefix:we+"-cargo-table",userLocale:this.state.userLocale,voyageKey:a.key}),label:r.cargo},{id:"bunkers",content:()=>p.a.createElement(ie.a,{reactKeyPrefix:we+"-bunker-details",userLocale:i,voyageKey:a.key}),label:r.bunkers},{id:"various-cost-revenue",content:()=>p.a.createElement(J.a,{voyageKey:a.key,currency:a.voyageCurrency,reactKeyPrefix:we+"-various",userLocale:i}),label:l.variousCostRevenue},...g?[{id:"scheduled-voyages",content:()=>p.a.createElement(q.a,{reactKeyPrefix:we+"-scheduled-voyages",userLocale:i,voyage:a}),label:"MASTER"===(null===(t=a.scenarios[0])||void 0===t?void 0:t.scenarioCode)?r.scheduledVoyages:c.budgetedVoyages}]:[],{id:"organisational-data",content:()=>p.a.createElement(ae.a,{voyageKey:a.key,reactKeyPrefix:we+"-organisational-data",userLocale:i}),label:l.organisationalData},...d&&!(null===(o=a.voyageHeader)||void 0===o?void 0:o.isEstimate)?[{id:"invoices",content:()=>p.a.createElement(ye.a,{reactKeyPrefix:we+"-invoices",voyage:a,userLocale:i}),label:n.invoices}]:[],{id:"related",content:()=>p.a.createElement(Q.a,{reactKeyPrefix:we+"-related",voyage:a,user:this.state.user,userLocale:i}),label:l.related}]}getSecondaryActions(e,t,o){var a,i,s,n,l,r,c,d;const{deps:[,,g]}=this.props,{fas:y,common:h}=g.getLanguageFile(),p=(null===(a=e.tcs)||void 0===a?void 0:a.length)>0,u=[{disabled:!t||(null===(i=e.voyageHeader)||void 0===i?void 0:i.isUnallocated),onClick:()=>this.showAllocateModalForMove(),text:y.moveTripleDot},{disabled:!1,onClick:this.toggleVoyageRefModal,text:R.a.getIsNominatedOrHigher(e)?h.editVoyageNumberAction:y.editVoyageReferenceAction},{disabled:!(null===(s=e.voyageHeader)||void 0===s?void 0:s.isEstimate)||(null===(n=e.voyageHeader)||void 0===n?void 0:n.isTemplate),onClick:this.toggleConvertToTemplate,text:h.convertToTemplateDots},{disabled:!Object(H.a)([x.a.SOAVoyageGET],o)||p,onClick:this.togglePrintSOAModal,text:h.printStatementOfAccount(!0),tooltipText:p?h.openContractToPrintSOA:""}];if(!(null===(l=e.voyageHeader)||void 0===l?void 0:l.isTemplate)){const t=R.a.getPerformanceCargo(e.cargos);t.key&&u.push({disabled:["NOM","OPR","OPC","INV","FIN"].includes(null!==(d=null===(c=null===(r=e.voyageHeader)||void 0===r?void 0:r.voyageStatus)||void 0===c?void 0:c.statusTypeCode)&&void 0!==d?d:""),onClick:()=>this.toggleIsOptional(e),text:t.isOption?h.removeOptionalMark:h.markAsOptional})}return u}getPrimaryActions(e){const{deps:[t,,o]}=this.props,{common:a}=o.getLanguageFile();return[{disabled:!t.canDelete(e),icon:i.a,label:a.delete,onClick:this.showDeleteModal},{disabled:!1,icon:n.a,label:a.copyVoyage,onClick:this.toggleCopyVoyageModalVisible},{disabled:!1,icon:Se.a,label:a.compare,onClick:this.onClickCompare},{disabled:!1,icon:r.a,label:a.printVoyage,onClick:()=>{var e,o;return t.printVoyage(this.state.dataloyProperties,null!==(e=this.state.voyage)&&void 0!==e?e:new M.a({}),null!==(o=this.state.user.key)&&void 0!==o?o:0)}}]}onChangeStatus(e){const{deps:[,t]}=this.props,{voyage:o,openedFromFas:a}=this.state;o&&t.changeStatus(e,o,this.showUnallocateModal,this.showAllocateModal,this.showNominateModal,a)}onChangeOptionStatus(e){var t;const{deps:[,o]}=this.props,{voyage:a}=this.state,i=R.a.getPerformanceCargo(null!==(t=null==a?void 0:a.cargos)&&void 0!==t?t:[]);o.changeOptionStatus(e,i)}resetChipColourMap(){b.c.forEach((e,t)=>{b.c.set(t,!1)}),this.setState({overlappingVoyages:[],overlappingVoyageColourMap:new Map})}setOverlapChipColourMap(e){const{overlappingVoyageColourMap:t}=this.state;if(void 0===e)throw new Error("key undefined for overlapping voyage");t.has(e)||t.set(e,Object(b.b)(b.c))}checkOverlappingVoyagesExist(e){const{deps:[t]}=this.props,{overlappingVoyages:o}=this.state;let a=[];null!==e&&0===o.length&&(a=R.a.getOverlappingVoyagesLinkedToAVoyage(e));const i=a.length>0;i&&a.forEach(e=>Me(this,void 0,void 0,(function*(){var o,a;if(this.setOverlapChipColourMap(e.key),!e.voyageHeader){const i=yield t.getRefNoFromKey(e.key);e.voyageHeader=i.voyageHeader,null!==e.voyageHeader&&(null!==(o=(a=e.voyageHeader).referenceNo)&&void 0!==o||(a.referenceNo=""))}}))),i&&this.setState({overlappingVoyages:a})}getOverlappingChips(){return this.state.overlappingVoyageColourMap?this.state.overlappingVoyages.filter(({voyageHeader:e})=>!!(null==e?void 0:e.referenceNo)).map(e=>{var t,o;return p.a.createElement("div",{key:e.key},p.a.createElement(b.a,{className:this.props.classes.textCss,voyageId:e.key,label:null===(t=e.voyageHeader)||void 0===t?void 0:t.referenceNo,chipColour:null!==(o=this.state.overlappingVoyageColourMap.get(e.key))&&void 0!==o?o:"grey",onClickChip:this.onClickOverlappingChip}))}):[]}getVoyageStatus(){const{deps:[,e]}=this.props,{voyage:t}=this.state;if(t)return{statusObject:Object(g.a)(t,"voyageHeader.voyageStatus"),type:W.b.TRANSITION,overrideAllowedStatuses:e.getOverrideAllowedStatuses(t),onClick:this.onChangeStatus}}getVoyageOptionStatus(e){var t;const{deps:[,o]}=this.props,{voyage:a}=this.state;if(a&&e&&(null===(t=e.voyage)||void 0===t?void 0:t.key)===a.key)return{statusObject:Object(g.a)(e,"optionStatus"),type:W.b.TRANSITION,overrideAllowedStatuses:o.getOverrideAllowedOptionStatuses(a,e),onClick:this.onChangeOptionStatus}}openVesselDrawer(){const{location:e,history:t}=this.props,{voyage:o}=this.state;(null==o?void 0:o.vessel)&&U.a.openDrawer(o.vessel.key,B.a.vesselDrawer,e,t)}getOptionStatusDropdown(e){const{deps:[,,t]}=this.props,{model:o}=t.getLanguageFile();if(e&&e.isOption)return Object(de.a)(this.getVoyageOptionStatus(e),k.a.cargo,void 0,ge.a.getOptionalStatusPriority,o.optional+" - ")}getSubjectComponent(e){var t;const{deps:[,,o],classes:a}=this.props,{model:i}=o.getLanguageFile(),{voyage:s}=this.state;if("left"===e){const e=Object(g.a)(s,"vessel.vesselName"),t=Object(g.a)(s,"voyageHeader.leg.legCode");return p.a.createElement(p.a.Fragment,null,e&&p.a.createElement(S.a,{label:e,rounded:!0,onClick:this.openVesselDrawer,pointer:!0}),t&&p.a.createElement(S.a,{label:t,rounded:!0}),e||t?" ":void 0)}if("right"===e){const e=Object(g.a)(s,"voyageHeader.isTemplate"),o=this.state.overlappingVoyages.length?p.a.createElement("div",{className:a.leftBorder},p.a.createElement("span",null,i.overlapping)):void 0,n=R.a.getPerformanceCargo(null!==(t=null==s?void 0:s.cargos)&&void 0!==t?t:[]);return p.a.createElement(p.a.Fragment,null,e?p.a.createElement(S.a,{label:i.template}):void 0,o,this.getOverlappingChips(),e?void 0:this.getOptionStatusDropdown(n))}}render(){var e,t;const{deps:[,,o]}=this.props,{allocateModalStatus:a,unallocateModalStatus:i,showVoyageRefModal:s,showVoyageSensitivityAnalysis:n,showDateWarning:l,showDeleteModal:r,showCopyVoyageModal:c,showVoyageIntakeCalculationModal:d,showConvertToTemplateModal:g,user:h,showPrintSOAModal:u,showNominateModal:v}=this.state,f=null!==(e=this.state.voyage)&&void 0!==e?e:new M.a({}),m=null!==(t=f.voyageHeader)&&void 0!==t?t:new V.a({}),{referenceNo:S}=m,{common:b,model:O,alerts:A}=o.getLanguageFile(),w=N.a.isMasterScenario(Object(y.a)(f.scenarios));return this.state.voyageId?p.a.createElement(p.a.Fragment,null,p.a.createElement(K.a,{size:"large",reactKeyPrefix:we,subject:O.voyage,subjectName:S,subjectLoaded:f.key===this.state.voyageId,drawerRoute:B.a.voyageDrawer,drawerKey:this.state.voyageId,primaryActions:this.getPrimaryActions(f),secondaryActions:this.getSecondaryActions(f,w,h),actionsMenu:this.getActionMenus(),key:B.a.voyageDrawer+this.state.voyageId,tsModelType:k.a.voyage,tabs:this.getTabs(),tabId:this.props.match.params.tabId,status:this.getVoyageStatus(),onChangeFullscreen:this.setIsFullScreen,subjectComponentLeft:this.getSubjectComponent("left"),enableFullscreen:!0,subjectComponentRight:this.getSubjectComponent("right")}),u&&p.a.createElement(te.a,{reactKeyPrefix:we+"-print-soa-modal",onClose:this.closePrintSOAModal,open:u,voyageKey:f.key}),a&&p.a.createElement(Y.a,{reactKeyPrefix:we+"-allocate-move-modal",selectedVoyage:f,onClose:this.closeAllocateModal,onAllocate:this.allocateVoyage,userLocale:this.state.userLocale,toStatus:a}),v&&p.a.createElement(ee.a,{reactKeyPrefix:we+"-allocate-move-modal",selectedVoyage:f,onClose:this.closeNominateModal,open:v,userLocale:this.state.userLocale,i:o,refreshFleetPlan:this.state.openedFromFas}),i&&p.a.createElement(oe.a,{reactKeyPrefix:we+"-unallocate-modal",selectedVoyage:f,showModal:!!i,onClose:this.closeUnallocateModal,onUnallocate:this.unallocateVoyage}),s&&p.a.createElement(ce.a,{reactKeyPrefix:we+"-edit-ref-modal",voyage:f,open:s,onClose:this.toggleVoyageRefModal,i:o}),n&&p.a.createElement(se.a,{reactKeyPrefix:we+"-sensitivity-analysis",voyage:f,open:n,onClose:this.closeVoyageSensitivityAnalysisModal}),l&&p.a.createElement(C.a,{reactKeyPrefix:we+"-date-warning-modal",open:l,title:b.invalidDates,onCloseModal:this.toggleDateWarningModal,hideConfirmBtn:!0},A.cancellingAfterCommencement),r&&p.a.createElement(Ve,{reactKeyPrefix:we,voyage:f,showDeleteModal:r,onClose:this.closeDeleteModal,onConfirmDelete:this.deleteVoyage}),c&&p.a.createElement(C.a,{reactKeyPrefix:we+"-copy-voyage-modal",open:c,onCloseModal:this.toggleCopyVoyageModalVisible,onConfirm:this.onCopyVoyage,title:b.copyVoyage,maxWidth:"xs",fullWidth:!0},b.copyVoyageWarning),d&&p.a.createElement(_.a,{reactKeyPrefix:we+"-intake-calculation",storeVoyage:f,userLocale:this.state.userLocale,open:d,onCloseModal:this.toggleShowVoyageIntakeCalculationModal}),g&&p.a.createElement(Z.a,{open:g,onClose:this.toggleConvertToTemplate,reactKeyPrefix:we+"-convert-to-template",voyage:f})):null}}const Ie=Object(A.a)(e=>{var t,o,a,i;const s=T.a.getSelectedVoyage({fields:Object.assign(Object.assign({},f.r),{voyageHeader:Object.assign(Object.assign({},f.p.voyageHeader),f.j)})})(e),n=D.a.getUserLocale(e),l=I.a.getSelectedAreaReport(e),r=null==l?void 0:l.key,c=P.a.get(e),d=null!==(a=null!==(t=pe.a.get(e))&&void 0!==t?t:R.a.getPerformanceCargo(null!==(o=null==s?void 0:s.cargos)&&void 0!==o?o:[]).key)&&void 0!==a?a:-1;return{selectedCargo:null!==(i=j.a.getTSModelBuilt(e,k.a.cargo,d,ue.c))&&void 0!==i?i:new ve.a({}),restrictedAreas:j.a.getAllTSModelsBuilt(e,k.a.restrictedarea,v.a),selectedAreaReportId:r,userLocale:n,voyage:s,user:Object(le.a)(e),skipLoadingDrawerKey:c,dataloyProperties:j.a.getAllTSModelsBuilt(e,k.a.dataloyproperty,he.a)}},Object(O.b)([X.a.IVoyageDrawerController,X.a.IVoyageDrawerControllerStatus,L.a.IInternationalization,E.a.IFasVoyageApi,E.a.IFilterActions,E.a.IScenarioActions,E.a.ISimpleReducerActions,E.a.IVoyageComparison],Object(u.k)(Object(ne.a)(G.c)(je))))},411:function(e,t,o){"use strict";o.d(t,"b",(function(){return l})),o.d(t,"c",(function(){return r})),o.d(t,"a",(function(){return c}));var a=o(213),i=o(187),s=o(245),n=o(38);const l=Object(a.a)(e=>Object(i.a)({container:{backgroundColor:Object(s.a)(e.palette.primary.main,.05),borderRadius:e.spacing(1.25),padding:"20px"},containerTitle:{flexDirection:"column"},scheduleTable:{marginTop:e.spacing(2)},ballastPort:{marginBottom:e.spacing(1)},leftBorder:{marginLeft:"2px",borderLeftWidth:"thin",borderLeftStyle:"solid",borderLeftColor:"rgb(97 97 97 / 58%)",display:"inline-flex",alignItems:"center","& > *":{marginLeft:e.spacing(.5)},fontSize:"0.875rem"},textCss:{fontSize:"0.875rem"}})),r=e=>Object(i.a)({leftBorder:{marginLeft:"2px",borderLeftWidth:"thin",borderLeftStyle:"solid",borderLeftColor:"rgb(97 97 97 / 58%)",display:"inline-flex",alignItems:"center","& > *":{marginLeft:e.spacing(.5)},fontSize:"0.875rem"},textCss:{fontSize:"0.875rem"}}),c=Object(a.a)(e=>Object(i.a)({label:{fontSize:".786rem",color:n.b.bergenRain.secondary[7]},labelPlacementTop:{marginLeft:0,marginRight:0,transform:"translate(0, -1.5px)",marginBottom:e.spacing(-1.5)}}))},939:function(e,t,o){"use strict";o.d(t,"b",(function(){return ne}));o(59),o(10),o(11),o(109),o(163);var a,i,s,n,l,r,c,d,g,y,h,p,u=o(9),v=o(31),f=o(83),m=o(104),S=o(497),b=o(460),C=o(107),O=o(1),A=o(29),k=o(388),V=o(494),M=o(7),w=o(808),j=o(131),I=o(87),T=o(732),F=o(16),P=o(32),D=o(14),E=o(206),H=o(48),x=o(90),N=o(3),R=o(2356),L=o(940),K=o(470),B=o(1280),U=o(89),W=o(46),z=o(20),_=o(317),q=o(60),$=o(114),Q=o(192),J=o(21),G=o(315),X=o(528),Y=o(450),Z=o(449),ee=o(296),te=o(670),oe=function(e,t,o,a){var i,s=arguments.length,n=s<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,o):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,a);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(n=(s<3?i(n):s>3?i(t,o,n):i(t,o))||n);return s>3&&n&&Object.defineProperty(t,o,n),n},ae=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ie=function(e,t){return function(o,a){t(o,a,e)}},se=function(e,t,o,a){return new(o||(o=Promise))((function(i,s){function n(e){try{r(a.next(e))}catch(e){s(e)}}function l(e){try{r(a.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,l)}r((a=a.apply(e,t||[])).next())}))};let ne=class extends w.a{constructor(e,t,o,a,i,s,n,l,r,c,d,g){super(e,t,o,a,i,s,l),this.store=e,this.selectedVoyageActions=t,this.selectedVesselActions=o,this.voyageApi=a,this.voyageHeaderApi=i,this.tsmodelActions=s,this.objectApi=n,this.scenarioActions=l,this.drawerStatusController=r,this.http=c,this.i=d,this.simpleReducerActions=g,this.onChangeSpeed=(e,t,o)=>{if(e){const a=[],i=Object(G.get)(o,"_key");for(const o of e.partOfSchedule)o.key&&(o.isBallast===t?a.push({key:o.key,speedRef:i}):a.push({key:o.key}));this.updateVoyageField("partOfSchedule",a,e.key)}}}dispatchSetSelectedVesselActions(e){this.store.dispatch(this.selectedVesselActions.setAction(e))}loadVoyageCallback(e,t){this.dispatchSelectedVoyage(t?t.key:null),(null==t?void 0:t.vessel)&&this.loadTcsOfVessel(t.vessel)}dispatchSelectedVoyage(e){this.store.dispatch(this.selectedVoyageActions.setAction(e))}dispatchLoadVoyageAction(e){this.tsmodelActions.loadSingleAction({callback:(e,t)=>{var o,a,i,s;this.dispatchSelectedVoyage(t?t.key:null),(null==t?void 0:t.vessel)&&this.loadTcsOfVessel(t.vessel);const n=null!==(s=null!==(a=null===(o=null==t?void 0:t.cargos.find(e=>e.key===Y.a.get(this.store.getState())))||void 0===o?void 0:o.key)&&void 0!==a?a:q.a.getPerformanceCargo(null!==(i=null==t?void 0:t.cargos)&&void 0!==i?i:[]).key)&&void 0!==s?s:-1;this.loadSelectedCargo(n),this.simpleReducerActions.setAction(ee.a,n)},fields:C.q,key:e,type:O.a.voyage,headers:Object(H.b)()?j.a.serializeCache:void 0})}dispatchLoadReferenceNoAction(e){this.tsmodelActions.loadSingleAction({fields:C.s,key:e.key,type:O.a.voyage})}dispatchLoadSpeedFieldsAction(e){this.tsmodelActions.loadSingleAction({fields:C.v,key:e,type:O.a.voyage,callback:(e,t)=>{this.store.dispatch(this.selectedVoyageActions.setAction(t?t.key:null))}})}loadSelectedCargo(e){e&&this.tsmodelActions.loadSingleAction({fields:C.g,key:e,type:O.a.cargo})}loadVariouses(e,t){this.tsmodelActions.loadSingleAction({fields:C.u,key:e,type:O.a.voyage,callback:(e,o)=>{!e&&t&&o&&t(o)}})}loadCargos(e,t){this.tsmodelActions.loadSingleAction({fields:C.o,key:e,type:O.a.voyage,callback:(e,o)=>{!e&&t&&o&&t(o)}})}updateVoyage(e,t,o){return this.tsmodelActions.updateSingleAction({data:e,key:e.key,type:O.a.voyage,headers:o?void 0:Object.assign({},j.a.smartJson),fields:o||{},query:t})}updateOrganisationalData(e){return this.tsmodelActions.updateSingleAction({fields:C.d,data:Object(U.a)(e),key:e.key,type:O.a.voyageheader})}loadBunkerStocks(e,t){this.tsmodelActions.loadSingleAction({fields:C.k,key:e,type:O.a.voyage,callback:(e,o)=>{!e&&t&&t(o.voyageHeader.bunkerStocks)}})}loadOrganisationalData(e,t){this.tsmodelActions.loadSingleAction({fields:C.d,key:e,type:O.a.voyage,callback:(e,o)=>{!e&&t&&o&&t(o)}})}updateVoyageField(e,t,o){const a={key:o,[e]:t};this.updateVoyage(a)}updateBallastPortField(e,t,o){const a={key:o,[e]:t};this.updateVoyage(a,void 0,C.n)}updateVoyageHeaderField(e,t,o,a,i){if(o.voyageHeader){const s={key:o.key,voyageHeader:{key:o.voyageHeader.key,[e]:t}};return this.updateVoyage(s,a,i)}return Promise.reject()}copyVoyage(e,t,o,a){var i;if(null==e?void 0:e.key){const s=t?"SCU":"EST";this.tsmodelActions.copySingleAction({callback:o,data:{voyageStatus:"T",voyageHeader:{voyageStatus:s,isEstimate:!t,isUnallocated:t,isTemplate:!1,voyageNo:0,templateVoyageHeader:t?null===(i=null==e?void 0:e.voyageHeader)||void 0===i?void 0:i.key:null}},key:e.key,type:O.a.voyage,fields:a||void 0})}}copyTemplateMultipleVoyages(e,t,o){var a,i,s,n,l;return se(this,void 0,void 0,(function*(){if(null==e?void 0:e.key){const r=Object(P.a)(this.store.getState()).authdata||"",c=Object(R.a)(null!==(a=t.intervalsFromDate)&&void 0!==a?a:new Date,{months:t.intervalsMonths}),d=Object(L.a)(c,null!==(i=t.intervalsFromDate)&&void 0!==i?i:new Date)+t.intervalsDays,g=["fromDate="+Object(K.a)(null!==(s=t.endpointsFromDate)&&void 0!==s?s:new Date,"yyyy-MM-dd'T'HH:mm:ss"),"toDate="+Object(K.a)(null!==(n=t.endpointsToDate)&&void 0!==n?n:new Date,"yyyy-MM-dd'T'HH:mm:ss"),"laycanSpread="+t.endpointsLayCanSpread,"noOfVoyages="+t.endpointsNumberOfVoyages],y=["fromDate="+Object(K.a)(null!==(l=t.intervalsFromDate)&&void 0!==l?l:new Date,"yyyy-MM-dd'T'HH:mm:ss"),"laycanSpread="+t.intervalsLayCanSpread,"noOfDaysBetween="+d,"noOfVoyages="+t.intervalsNumberOfVoyages],h=H.a.API_BASE_URL+"/Voyage",p="endpoints"===o?`${h}/multipleVoyageFromTemplateFixedEndDate/${e.key}?${g.join("&")}`:`${h}/multipleVoyageFromTemplateFixedInterval/${e.key}?${y.join("&")}`;try{yield this.http.post(p,{},{headers:new Headers({authorization:r,"content-type":"application/json"})})}catch(e){throw e instanceof Error?new Error(e.message):new Error("API call failed")}}}))}loadTc(e,t){return se(this,void 0,void 0,(function*(){return this.tsmodelActions.loadSingleAction({fields:Object(I.a)(["charterer.businessPartnerName","company.companyName","owner.businessPartnerName","isTcIn"]),key:e,type:O.a.tc,callback:(e,o)=>{!e&&o&&t&&t(o)}})}))}loadTcsOfVessel(e){this.tsmodelActions.loadMultipleAction({type:O.a.tc,query:["filter=isTcIn(EQ)true","filter=vesselCode.vessel(EQ)"+e.key].join("&"),fields:Object(I.a)(["key","owner.businessPartnerName","vesselCode.vessel.key","cpDate","currency"]),identifier:B.a,overwriteKeysOnLoad:!0})}changeVessel(e,t){return se(this,void 0,void 0,(function*(){e.vessel&&t&&t.key!==e.vessel.key&&this.updateVoyageField("vessel",t.key,e.key),this.loadTcsOfVessel(t)}))}updateBunkerStockPrice(e,t,o){return se(this,void 0,void 0,(function*(){let a=[];if(e.voyageHeader){const o=["filter=voyageHeader.key(EQ)"+e.voyageHeader.key,"filter=description(LKIC)Opening balance","filter=bunkerCategory.bunkerCategoryCode(EQ)"+t].join("&");yield this.tsmodelActions.loadMultipleAction({query:o,fields:Object.assign({},C.a),type:O.a.bunkerstock}).then(e=>{a=e.entities})}for(const e of a)yield this.tsmodelActions.updateSingleAction({data:{price:o},key:e.key,type:O.a.bunkerstock,headers:Object.assign({},j.a.smartJson)})}))}getVoyagesLinkedToATemplate(e,t){if(e){const o=[{field:"voyageHeader.voyageStartDate",groupCode:T.a+"_SORT",operator:F.b.ASC,queryParamName:"voyageHeader.voyageStartDate"}];this.tsmodelActions.loadMultipleAction({type:O.a.voyage,query:[`filter=voyageHeader.templateVoyageHeader(EQ)(${e.key})`,"filter=voyageHeader.voyageStatus.statusTypeCode(NE)EST","filter=voyageHeader.voyage.scenarios(NOTNULL)"].join("&"),fields:T.b,sorts:o,identifier:T.a,overwriteKeysOnLoad:!0,callback:t})}}getFleetplanVoyagesForTemplate(e){var t,o,a;return(null===(t=null==e?void 0:e.voyageHeader)||void 0===t?void 0:t.key)?this.objectApi.getMultiple({type:O.a.fleetplanvoyage,query:`filter=voyage.voyageHeader.templateVoyageHeader(EQ)(${null===(o=null==e?void 0:e.voyageHeader)||void 0===o?void 0:o.key})&${Object(Z.a)(1,1)}`,authdata:null!==(a=Object(P.a)(this.store.getState()).authdata)&&void 0!==a?a:""}).then(e=>e).catch(()=>[]):Promise.reject()}getRefNoFromKey(e){const t=D.a.get(M.a.Store);return e?this.objectApi.getSingle({type:O.a.voyage,authdata:Object(P.a)(t.getState()).authdata||"",fields:{voyageHeader:{key:"*",referenceNo:"*"}},key:e}):Promise.reject()}getDocumentCurrencies(e,t){return se(this,void 0,void 0,(function*(){const o=["filter=documentLines.tc.key(EQ)"+e,"filter=documentType.documentType(IN)(INO,INI,CRI,CRO)"].join("&");this.tsmodelActions.loadMultipleAction({type:O.a.document,fields:{documentCurrency:{currencyCode:"*"}},query:o,identifier:"SOA_TC_DOCUMENTS",overwriteKeysOnLoad:!0,callback:e=>{if(!e&&t){const e=J.a.getTSModelsBuilt(this.store.getState(),O.a.document,{documentCurrency:{currencyCode:"*"}},"SOA_TC_DOCUMENTS");t(Object(G.uniq)(e.map(e=>{var t;return null===(t=e.documentCurrency)||void 0===t?void 0:t.currencyCode})))}}})}))}refreshFas(e,t,o){var a,i,s,n;if(o&&(null===(a=null==e?void 0:e.vessel)||void 0===a?void 0:a.key))if(t)W.a.next();else{const t=null!==(n=null===(s=null===(i=null==e?void 0:e.voyageHeader)||void 0===i?void 0:i.voyageStatus)||void 0===s?void 0:s.statusTypeCode)&&void 0!==n?n:"",o=["EST","SCU"].includes(t);this.scenarioActions.refreshScenarioFleetPlanData([e.vessel.key],!0,o)}}findNewSpeed(e,t){const o=t.filter(t=>!e.some(e=>Object(G.get)(e,"_key")===Object(G.get)(t,"_key")));return o.length?o[0]:null}addNewSpeedToVoyage(e,t){if(e){const o="B"===t.speedType,a={key:e.key,speeds:e.speeds.map(e=>({key:e.key})).concat(Object(U.a)(t)),[o?"speedBallast":"speedLoaded"]:t.speed};this.tsmodelActions.updateSingleAction({type:O.a.voyage,key:e.key,data:a,fields:{speeds:C.h},callback:(t,a)=>{if(!t&&a&&a.speeds){const t=this.findNewSpeed(e.speeds,a.speeds);t&&this.onChangeSpeed(e,o,t)}}})}}toggleIsOption(e){var t;return se(this,void 0,void 0,(function*(){const o=q.a.getPerformanceCargo(e.cargos),{common:a}=this.i.getLanguageFile();if(o.key){const e=this.drawerStatusController.getStatusesByClassCode("OPT").find(e=>"NOT"===e.statusTypeCode);return this.tsmodelActions.updateSingleAction({data:{isOption:!o.isOption,optionStatus:o.isOption?null==e?void 0:e.key:null===(t=o.optionStatus)||void 0===t?void 0:t.key},key:o.key,type:O.a.cargo})}Object($.a)(a.warning,a.cantMarkAsOptional,"",a.ok,!0,"xs")}))}updateOptionStatus(e,t,o){var a;return se(this,void 0,void 0,(function*(){const i=o.map(e=>e).join("&key=");try{yield this.http.put(`${H.a.API_BASE_URL}/Cargo/bulkUpdate?key=${i}`,JSON.stringify({isOption:e,optionStatus:null==t?void 0:t.key}),{headers:new Headers({authorization:null!==(a=Object(P.a)(this.store.getState()).authdata)&&void 0!==a?a:"","content-type":"application/json"})})}catch(e){throw new Error("Error with PUT on /Cargo/bulkUpdate.")}}))}changeOptionStatus(e,t){if(e&&t)return this.tsmodelActions.updateSingleAction({data:{optionStatus:e.key},key:t.key,type:O.a.cargo,fields:{optionStatus:"*"}})}printSoa(e,t,o){var a,i;return se(this,void 0,void 0,(function*(){const{authdata:s}=Object(P.a)(this.store.getState()),n=yield this.http.get(`${H.a.API_BASE_URL}/Report/generateSOA/Tc/${e.key}?out=${t}&currencyCode=${o}&companyId=${null===(a=e.company)||void 0===a?void 0:a.key}`,{headers:new Headers({authorization:null!=s?s:""})}),l=t?e.charterer:e.owner;Object(X.a)("SOA_"+(null!==(i=null==l?void 0:l.businessPartnerName)&&void 0!==i?i:"").replace(" ","_"),yield n.text())}))}printVoyage(e,t,o){if(e.length>0){const a=q.a.getVoyageBirtReportUrl(e,t,o);if(""!==a)return void window.open(a,"_blank")}throw new Error("Error with getting the report")}};ne=oe([Object(u.injectable)(),ie(0,Object(u.inject)(M.a.Store)),ie(1,Object(u.inject)(M.a.ISelectedVoyageActions)),ie(2,Object(u.inject)(M.a.ISelectedVesselActions)),ie(3,Object(u.inject)(f.a.IVoyageApi)),ie(4,Object(u.inject)(f.a.IVoyageHeaderApi)),ie(5,Object(u.inject)(M.a.ITSModelActionsAsync)),ie(6,Object(u.inject)(f.a.ITSModelApi)),ie(7,Object(u.inject)(M.a.IScenarioActions)),ie(8,Object(u.inject)(z.a.IDrawerStatusController)),ie(9,Object(u.inject)(N.a.IHttp)),ie(10,Object(u.inject)(N.a.IInternationalization)),ie(11,Object(u.inject)(M.a.ISimpleReducerActions)),ae("design:paramtypes",["function"==typeof(a=void 0!==v.Store&&v.Store)?a:Object,"function"==typeof(i=void 0!==V.ISelectedVoyageActions&&V.ISelectedVoyageActions)?i:Object,"function"==typeof(s=void 0!==k.ISelectedVesselActions&&k.ISelectedVesselActions)?s:Object,"function"==typeof(n=void 0!==b.IVoyageApi&&b.IVoyageApi)?n:Object,"function"==typeof(l=void 0!==S.IVoyageHeaderApi&&S.IVoyageHeaderApi)?l:Object,"function"==typeof(r=void 0!==A.ITSModelActionsAsync&&A.ITSModelActionsAsync)?r:Object,"function"==typeof(c=void 0!==m.ITSModelApi&&m.ITSModelApi)?c:Object,"function"==typeof(d=void 0!==E.IScenarioActions&&E.IScenarioActions)?d:Object,"function"==typeof(g=void 0!==_.IDrawerStatusController&&_.IDrawerStatusController)?g:Object,"function"==typeof(y=void 0!==x.IHttp&&x.IHttp)?y:Object,"function"==typeof(h=void 0!==Q.IInternationalization&&Q.IInternationalization)?h:Object,"function"==typeof(p=void 0!==te.ISimpleReducerActions&&te.ISimpleReducerActions)?p:Object])],ne)}}]);