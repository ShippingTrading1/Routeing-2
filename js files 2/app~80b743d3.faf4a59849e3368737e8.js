(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{1155:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));const o={partOfSchedule:{arrivalFixed:"*",daysAtSea:"*",portCallSequence:"*",eventLogs:{eventLogDate:"*",event:{eventCode:"*"}},previousPortCall:{port:{portName:"*"}},port:{portName:"*"},voyage:{voyageCurrency:{currencyCode:"*"},tcResultDay:"*",milesBallast:"*",milesLoaded:"*",daysTotal:"*",ballastPort:{portName:"*"},voyageResult:"*"},portCallRoutes:{description:"*",days:"*",distance:"*",seaMargin:"*",isSelected:"*",geoJson:"*"}}}},1585:function(e,t,a){"use strict";a.d(t,"a",(function(){return S}));a(59);var o,r,n,l,i,c=a(9),s=a(31),d=a(1),u=a(104),m=a(83),p=a(32),g=a(29),b=a(7),y=a(48),v=a(131),f=a(90),h=a(3),C=a(107),O=a(1155),x=function(e,t,a,o){var r,n=arguments.length,l=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,a):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,o);else for(var i=e.length-1;i>=0;i--)(r=e[i])&&(l=(n<3?r(l):n>3?r(t,a,l):r(t,a))||l);return n>3&&l&&Object.defineProperty(t,a,l),l},k=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},P=function(e,t){return function(a,o){t(a,o,e)}},j=function(e,t,a,o){return new(a||(a=Promise))((function(r,n){function l(e){try{c(o.next(e))}catch(e){n(e)}}function i(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(l,i)}c((o=o.apply(e,t||[])).next())}))};const E={portCall:{voyage:{voyageCurrency:{currencyCode:"*"},tcResultDay:"*",milesBallast:"*",milesLoaded:"*",daysTotal:"*",voyageResult:"*"}}};let S=o=class{constructor(e,t,a,o){this.tsmodelActions=e,this.store=t,this.objectApi=a,this.http=o}static getBasicHeader(e){return{headers:new Headers({authorization:e,"content-type":"application/json"})}}fetchVoyage(e,t){return j(this,void 0,void 0,(function*(){yield this.tsmodelActions.loadSingleAction({fields:t?O.a:C.n,type:d.a.voyage,key:e})}))}putSelectedRoutes(e,t){var a;return j(this,void 0,void 0,(function*(){const r=e.map(e=>"key="+e).join("&");yield this.http.put(`${y.a.API_BASE_URL}/PortCallRoute/bulkUpdate?${r}`,JSON.stringify({isSelected:!0}),Object.assign(Object.assign({},o.getBasicHeader(null!==(a=Object(p.a)(this.store.getState()).authdata)&&void 0!==a?a:"")),v.a.smartJson)).then(()=>this.fetchVoyage(t,!1))}))}onTempChangeSelectedRoute(e){var t;return j(this,void 0,void 0,(function*(){return yield this.objectApi.put({authdata:null!==(t=Object(p.a)(this.store.getState()).authdata)&&void 0!==t?t:"",data:{isSelected:!0},fields:E,key:e,query:"doNotStore=true",type:d.a.portcallroute})}))}};S=o=x([Object(c.injectable)(),P(0,Object(c.inject)(b.a.ITSModelActionsAsync)),P(1,Object(c.inject)(b.a.Store)),P(2,Object(c.inject)(m.a.ITSModelApi)),P(3,Object(c.inject)(h.a.IHttp)),k("design:paramtypes",["function"==typeof(r=void 0!==g.ITSModelActionsAsync&&g.ITSModelActionsAsync)?r:Object,"function"==typeof(n=void 0!==s.Store&&s.Store)?n:Object,"function"==typeof(l=void 0!==u.ITSModelApi&&u.ITSModelApi)?l:Object,"function"==typeof(i=void 0!==f.IHttp&&f.IHttp)?i:Object])],S)},1787:function(e,t,a){"use strict";a.d(t,"a",(function(){return g}));a(10),a(11);var o=a(0),r=a.n(o),n=a(37),l=a(12),i=a(71),c=a(19),s=a(6),d=a(1),u=a(199),m=a(3);function p(e){const{voyage:t,userLocale:a,deps:[o],reactKeyPrefix:s,user:m}=e,p=o.getLanguageFile(),{model:g}=p;if(t){const e=Object(u.a)(m,[{fieldName:"comments",label:g.comment,textInputProps:{multiline:!0,rows:2}}]),o=Object(c.a)({fieldOptions:e,object:t,parentData:{key:t.key,type:d.a.voyage},type:d.a.voyage,userLocale:a,reactKeyPrefix:s,smartResponse:!0});return r.a.createElement(i.a,null,r.a.createElement(n.a,{reactKeyPrefix:s+"horizontal_list",key:s+"horizontal_list",items:o,breakpoints:l.e}))}return null}const g=Object(s.b)([m.a.IInternationalization],r.a.memo(p))},1881:function(e,t,a){"use strict";a.d(t,"a",(function(){return Fe}));a(10),a(11);var o=a(0),r=a.n(o),n=a(97),l=a(2008),i=a(37),c=a(12),s=a(6),d=a(3),u=a(15),m=a(27),p=(a(1003),a(427)),g=a(44),b=a(213),y=a(187);const v=Object(b.a)(e=>Object(y.a)({main:{display:"flex",flexDirection:"row",borderTop:"solid 2px "+e.palette.grey[200],width:`calc(100vw - ${e.spacing(12)})`,height:`calc(100vh - ${e.spacing(24)})`},leftContainer:{display:"flex",flexDirection:"column",width:"25%",borderRight:"solid 2px "+e.palette.grey[200],"& > *:not(:last-child)":{paddingBottom:e.spacing(2),borderBottom:"solid 2px "+e.palette.grey[200],height:"75%"}},timeline:{marginTop:e.spacing(2),overflow:"scroll"},rightContainer:{width:"75%"},modalMapContainer:{position:"relative",top:"0",width:"100%",height:"100%"},modalMap:{borderRadius:"5px",bottom:"15px",left:"0px",outline:"block",position:"absolute",right:"0px",top:"0"},modalMapFullscreenButton:{height:"34px",width:"34px",borderRadius:"2px",border:"2px solid rgba(0,0,0,0.2)",backgroundColor:e.palette.common.white,"&:hover":{cursor:"pointer"}},leftContainerBottom:{display:"flex",flexDirection:"column",paddingTop:e.spacing(2)}}));var f=a(375),h=a(1),C=a(852),O=a(724),x=a(214),k=a(81),P=a(169),j=a(843),E=a(20);function S(e){const[t,a]=Object(s.a)([d.a.IInternationalization,E.a.IVoyageMapController]),n=v({}),{reactKeyPrefix:l,voyage:i}=e,{common:c,canals:u}=t.getLanguageFile(),m=Object(k.a)(i,"portCallsFromVoyage[0]",{}),[p,g]=Object(o.useState)(Object(k.a)(m,"ecaAvoidanceFactor",3)),[b,y]=Object(o.useState)(Object(k.a)(m,"hraAvoidanceFactor",1)),[f,h]=Object(o.useState)(Object(k.a)(m,"allowPc",!1)),[C,O]=Object(o.useState)(Object(k.a)(m,"allowSc",!1)),[S,w]=Object(o.useState)(Object(k.a)(m,"allowKc",!1)),[D,N]=Object(o.useState)(Object(k.a)(m,"allowNep",!0)),[R,L]=Object(o.useState)(Object(k.a)(m,"allowNwp",!0)),[T,A]=Object(o.useState)(Object(k.a)(m,"allowTs",!0)),[I,F]=Object(o.useState)(Object(k.a)(m,"allowCc",!0)),M=Object(o.useCallback)((e,t)=>{a.updatePortCall(e,t,i)},[a,i]),B=Object(o.useCallback)(()=>{M("ecaAvoidanceFactor",p)},[p,M]),K=Object(o.useCallback)(()=>{M("hraAvoidanceFactor",b)},[b,M]),V=Object(o.useCallback)(()=>{h(!f),M("allowPc",!f)},[f,M]),$=Object(o.useCallback)(()=>{O(!C),M("allowSc",!C)},[C,M]),z=Object(o.useCallback)(()=>{w(!S),M("allowKc",!S)},[S,M]),H=Object(o.useCallback)(()=>{N(!D),M("allowNep",!D)},[D,M]),U=Object(o.useCallback)(()=>{L(!R),M("allowNwp",!R)},[R,M]),W=Object(o.useCallback)(()=>{A(!T),M("allowTs",!T)},[T,M]),_=Object(o.useCallback)(()=>{F(!I),M("allowCc",!I)},[I,M]),q=Object(o.useCallback)((e,t,a,o)=>r.a.createElement(j.a,{value:t||1,label:e,onChange:e=>a(e),onBlur:o,reactKeyPrefix:l+"allow-"+{label:e}}),[l]),J=Object(o.useCallback)((e,t,a)=>r.a.createElement(P.a,{reactKeyPrefix:l+"allow-"+{label:e},checked:t,onInputChange:a,label:`${c.allow} ${e}`,color:"primary"}),[c.allow,l]);return r.a.createElement(x.a,{container:!0,className:n.leftContainerBottom},q(c.eca,p,g,B),q(c.hra,b,y,K),J(u.pc,f,V),J(u.sc,C,$),J(u.kc,S,z),J(u.ts,T,W),J(u.ts,I,_),J(u.nep,D,H),J(u.nwp,R,U))}function w(e){const{reactKeyPrefix:t,open:a,voyage:n,restrictedAreas:l,userLocale:i,onCloseModal:c,onOpenFullscreen:u}=e,m=v({}),[b]=Object(s.a)([d.a.IInternationalization]),{model:y}=b.getLanguageFile(),x=Object(o.useCallback)(()=>{c()},[c]),k=Object(o.useCallback)(()=>O.a.getVoyageData(n,0,i,t,0,!0,!0,!0),[t,i,n]);return r.a.createElement(g.a,{reactKeyPrefix:t,open:a,title:y.routing,onCloseModal:x,hideConfirmBtn:!0,hideCancelBtn:!0,maxWidth:"xl",disableDraggable:!0},r.a.createElement("div",{className:m.main},r.a.createElement("div",{className:m.leftContainer},r.a.createElement("div",{className:m.timeline},r.a.createElement(f.a,{reactKeyPrefix:t+"timeline-fullscreen-modal",data:k(),userLocale:i,LeftContainerLayout:p.a,RightContainerLayout:p.b,type:h.a.portcall})),r.a.createElement(S,{reactKeyPrefix:t,voyage:n})),r.a.createElement("div",{className:m.rightContainer},r.a.createElement(C.a,{restrictedAreas:l,showFullscreen:a,onOpenFullscreen:u,onCloseFullscreen:c,voyage:n,mapId:"voyage_map_modal",worldCopyJump:!0,enableZoom:!0,reactKeyPrefix:t+"-voyage-map-modal",userLocale:i,showRoutingPoints:!0}))))}const D=r.a.memo(w);var N=a(19),R=a(108);var L=a(411),T=(a(118),a(245)),A=a(130),I=a(2379),F=a(2380),M=a(2530),B=a(246),K=a(218),V=a(1794),$=a.n(V),z=a(1796),H=a.n(z),U=a(315),W=a(38),_=a(1795),q=a.n(_),J=a(28);const G={eventLogs:{eventLogDate:"*",event:{eventCode:"*"}},ownedByVoyage:{partOfSchedule:{eventLogs:{eventLogDate:"*",event:{eventCode:"*"}}},voyageHeader:{voyageEndDate:"*"},daysTotal:"*",co2Laden:"*",daysExtraInPort:"*",foConsumption:"*",ladenConsumption:"*",milesBallast:"*",milesLoaded:"*",tcHireNet:"*",tcResultDay:"*",voyageResult:"*",portCost:"*",canalCost:"*"},cargoPorts:{eventLogs:"*"},positionReports:"*",daysExtraInPort:"*",foInPort:"*",availableForCargo:"*",bunkerReduction:"*",daysInPort:"*",euEtsEmissions:"*",foRobArrival:"*",foRobDeparture:"*",isLaytimeUsedFixed:"*",laytimeUsed:"*",portCost:"*",portCostCurrency:"*"};var Q=a(715),X=a(60),Z=a(68),Y=a(450),ee=a(47),te=a(50);const ae=Object(b.a)(()=>Object(y.a)({label:{fontSize:".786rem",color:W.b.bergenRain.secondary[7],marginBottom:-6},labelPlacementTop:{marginLeft:0,marginRight:0,paddingBottom:1,transform:"translate(0, -1.7px)"}})),oe={mt:0,"&:first-child":{borderTopLeftRadius:e=>e.shape.borderRadius,borderTopRightRadius:e=>e.shape.borderRadius},"&:last-child":{borderBottomWidth:1,borderBottomLeftRadius:e=>e.shape.borderRadius,borderBottomRightRadius:e=>e.shape.borderRadius}};var re;!function(e){e.SOME_EXPANDED="some_expanded",e.ALL_EXPANDED="all_expanded",e.ALL_COLLAPSED="all_collapsed"}(re||(re={}));const ne=({reactKeyPrefix:e,voyage:t,selectedCargo:a,userLocale:n,refreshFas:l,state:{persistedCargo:u}})=>{var m;const p=null!==(m=u?t.cargos.find(e=>e.key===u):a)&&void 0!==m?m:a,[g,b]=Object(o.useState)(p.cargoPorts.map(e=>{var t,a;return null!==(a=null===(t=null==e?void 0:e.portCall)||void 0===t?void 0:t.key)&&void 0!==a?a:-1})),[y,v]=Object(o.useState)(),[f,C]=Object(o.useState)(""),O=ae({}),[k,P]=Object(s.a)([d.a.IInternationalization,E.a.IVoyageOverviewCargoController,E.a.IEditCargoPortController]),{voyages:j}=k.getLanguageFile(),{pcList:S,pcListKeys:w}=Object(o.useMemo)(()=>{const{pcList:e}=Object(Q.b)(X.a.getAllCargoPorts(t),t.partOfSchedule);e.sort(te.a.sortByVesselPcSequence);const a=e.map(e=>{var t;return null!==(t=null==e?void 0:e.key)&&void 0!==t?t:-1});return{pcList:e,pcListKeys:a}},[t]),D=Object(o.useCallback)(e=>()=>{e&&b(Object(U.xor)(g,[e.key]))},[g]),R=Object(o.useCallback)(()=>{y===re.ALL_EXPANDED?b([]):y===re.ALL_COLLAPSED?b(p.cargoPorts.map(e=>{var t,a;return null!==(a=null===(t=e.portCall)||void 0===t?void 0:t.key)&&void 0!==a?a:-1})):y===re.SOME_EXPANDED&&b(w)},[y,w,p.cargoPorts]),L=Object(o.useCallback)(()=>{y===re.ALL_EXPANDED?b([]):b(w)},[y,w]);Object(o.useEffect)(()=>{const e=y===re.ALL_EXPANDED;S.length===g.length?(v(re.ALL_EXPANDED),C(j.collapseAll)):0===g.length&&t.cargos.length>1?(v(re.ALL_COLLAPSED),C(j.expandSelected)):e||(v(re.SOME_EXPANDED),C(j.expandAll))},[S.length,g,t.cargos.length,j.collapseAll,j.expandAll,j.expandSelected]),Object(o.useEffect)(()=>{const e=y===re.ALL_EXPANDED;1===t.cargos.length?(b(w),v(re.ALL_EXPANDED)):e||(b(p.cargoPorts.map(e=>{var t,a;return null!==(a=null===(t=e.portCall)||void 0===t?void 0:t.key)&&void 0!==a?a:-1})),v(re.SOME_EXPANDED))},[w,p,p.cargoPorts,t.cargos.length]);const V=Object(o.useCallback)(e=>{e.cargoQuantity?P.onChangeQuantity(p,e):P.onChangeCargoPort(p,e,t.key,p.isPerformanceCargo?l:void 0)},[P,l,p,t.key]),z=Object(o.useMemo)(()=>S.filter(e=>null!==e).map(t=>{var a;const o=null!==(a=t.cargoPorts.find(e=>{var t;return(null===(t=null==e?void 0:e.cargo)||void 0===t?void 0:t.key)===(null==p?void 0:p.key)}))&&void 0!==a?a:null,l=p.cargoPorts.some(e=>{var a,o;return null!==(o=(null===(a=e.portCall)||void 0===a?void 0:a.key)===t.key)&&void 0!==o?o:-1}),s=(({indicated:e})=>({accordion:{border:"1px solid",borderColor:e=>e.palette.grey[400],borderBottomWidth:0},accordionSummary:{verticalAlign:"center",minHeight:e=>e.spacing(4),maxHeight:e=>e.spacing(4),borderColor:e=>e.palette.grey[400],borderLeft:e?"0.25rem solid":"0px",borderLeftColor:e?e=>e.palette.primary.main:e=>e.palette.grey[400],backgroundColor:e?e=>Object(T.a)(e.palette.primary.main,e.palette.action.selectedOpacity):e=>e.palette.action.hover,"&.Mui-expanded":{minHeight:e=>e.spacing(4),maxHeight:e=>e.spacing(4),borderBottom:"1px solid",borderBottomColor:e=>e.palette.grey[400]}},accordionSummaryTypography:{ml:e?"-0.25rem":"inherit"},accordionDetails:{verticalAlign:"center",paddingRight:1,paddingLeft:1,paddingTop:1,marginBottom:e?-1:0,fontSize:"0.875rem"},fieldList:[{"& > :nth-of-type(2)":{borderRight:"0.1em solid",borderImage:e=>`linear-gradient(transparent 25%, ${e.palette.grey[400]} 25% 86%, transparent 86%) 0 1 0 0 / 1px`}},{"& .MuiGrid-root":{marginLeft:-1/8,marginRight:-.5,paddingRight:-1.5,justifyContent:"space-between"}},{"& > :nth-of-type(-n+3):nth-child(n+1)":{marginBottom:-2}},{"& > :nth-of-type(-n+2):nth-child(n+1)":{marginRight:0}},{"& > :nth-of-type(-n+6):nth-child(n+4)":{marginRight:0}}]}))({indicated:l}),{portCallFields:d,cargoPortFields:u}=function(e,t,a,o,r,n,l,i){const{model:c,common:s}=n.getLanguageFile(),d={"& .Mui-grid":{mt:0,padding:0,paddingBottom:1/4},height:"1.786rem !important","& .MuiInputBase-input":{fontSize:"0.875rem",boxSizing:"inherit",padding:0}},u={"& .MuiAutocomplete-inputRoot":{padding:0,alignContent:"center",height:"1.786rem !important"},"& .MuiInputBase-input":{fontSize:"0.875rem",marginRight:-1.5,boxSizing:"inherit"},"& .MuiInput-root .MuiInput-input":{padding:0}},m=[{fieldName:"portCostCurrency",label:c.portCost,numberInputProps:{maskSettings:J.a.mask2,reactKeyPrefix:e+"-portCostCurrency"},InputProps:{sx:Object.assign({},d)},overrideObject:a,overrideType:h.a.portcall,breakpoints:{xl:5,lg:5,md:5,sm:5,xs:5}},{fieldName:"laytimeUsed",label:c.daysLoadingDischarging,numberInputProps:{maskSettings:J.a.mask2,reactKeyPrefix:e+"-layTimeUsed"},InputProps:{sx:Object.assign({},d)},disabled:!a.isLaytimeUsedFixed,overrideObject:a,overrideType:h.a.portcall,breakpoints:{xl:4,lg:4,md:4,sm:4,xs:4},secondaryFieldOption:{fieldName:"isLaytimeUsedFixed",label:s.fix,overrideObject:a,overrideType:h.a.portcall,formControlLabelProps:{classes:l,labelPlacement:"top"}}},{fieldName:"daysExtraInPort",label:s.extra,numberInputProps:{maskSettings:J.a.mask2,reactKeyPrefix:e+"-daysExtraInPort"},InputProps:{sx:Object.assign({},d)},overrideObject:a,overrideType:h.a.portcall,breakpoints:{xl:3,lg:3,md:3,sm:3,xs:3}}],p=[];i&&t&&p.push({fieldName:"cargoQuantity",label:c.quantity,numberInputProps:{maskSettings:J.a.mask17,reactKeyPrefix:e+"-cargoQuantity"},InputProps:{sx:Object.assign({},d)},breakpoints:{xl:3,lg:3,md:3,sm:3,xs:3},onUpdateOverride:e=>o({key:null==t?void 0:t.key,cargoQuantity:e})},{fieldName:"laytimeTermsValue",label:c.ldRate,numberInputProps:{maskSettings:J.a.mask2,reactKeyPrefix:e+"-laytimeTermsValue"},InputProps:{sx:Object.assign({},d)},breakpoints:{xl:3,lg:3,md:3,sm:3,xs:3},onUpdateOverride:e=>o({key:null==t?void 0:t.key,laytimeTermsValue:e})},{fieldName:"laytimeTermsMeasurement",label:c.rule,typeaheadProps:{objectPaths:["laytimeTermsMeasurementName"],shouldPreload:!0,reactKeyPrefix:e+"-load-laytimetermsmeasurement",isClearable:!1,sxProps:Object.assign({},u)},breakpoints:{xl:3,lg:3,md:3,sm:3,xs:3},onUpdateOverride:({key:e})=>o({key:null==t?void 0:t.key,laytimeTermsMeasurement:{key:e}})},{fieldName:"laytimeTerms",label:c.laytimeTerm,typeaheadProps:{objectPaths:["laytimeTerms"],shouldPreload:!0,reactKeyPrefix:e+"-load-laytimeterms",formControlProps:{sx:{height:"1rem"}},sxProps:Object.assign({},u)},breakpoints:{xl:3,lg:3,md:3,sm:3,xs:3},onUpdateOverride:({key:e})=>o({key:null==t?void 0:t.key,laytimeTerms:{key:e}})});const g={reactKeyPrefix:e,fieldOptions:m,object:a,type:h.a.portcall,updateResponseFields:G,userLocale:r},b={reactKeyPrefix:e,fieldOptions:p,object:t,type:h.a.cargoport,userLocale:r,smartResponse:!0};return{portCallFields:Object(N.a)(g),cargoPortFields:Object(N.a)(b)}}(e,o,null!=t?t:new Z.a({}),V,n,k,O,l);return r.a.createElement(I.a,{key:t.key,defaultExpanded:g.some(e=>e===t.key),expanded:g.some(e=>e===t.key),onChange:D(t),sx:s.accordion,disableGutters:!0},r.a.createElement(F.a,{expandIcon:r.a.createElement($.a,null),sx:s.accordionSummary},r.a.createElement(A.a,{sx:s.accordionSummaryTypography},(e=>{var t,a,o,n;return r.a.createElement(A.a,null,`${null!==(a=null===(t=null==e?void 0:e.port)||void 0===t?void 0:t.portName)&&void 0!==a?a:""} (${null!==(n=null===(o=null==e?void 0:e.reasonForCall)||void 0===o?void 0:o.reasonForCall)&&void 0!==n?n:""})`)})(t))),r.a.createElement(M.a,{sx:s.accordionDetails},r.a.createElement(i.a,{reactKeyPrefix:""+(e+"-"+t.key),items:[...d,...u],sx:s.fieldList,breakpoints:c.a})))}),[O,D,k,V,S,e,p.cargoPorts,null==p?void 0:p.key,g,n]);return r.a.createElement(x.a,{id:e+"-edit-schedule-box",sx:oe,container:!0,direction:"row"},r.a.createElement(x.a,{xs:12,sx:{display:"flex",justifyContent:"flex-end"}},r.a.createElement(B.a,{key:e+"-unfold-more-button",onClick:1===t.cargos.length?L:R},r.a.createElement(K.a,{title:f,placement:"left"},y===re.ALL_EXPANDED?r.a.createElement(q.a,null):r.a.createElement(H.a,null)))),r.a.createElement(x.a,{xs:12},z))},le=Object(ee.a)(e=>({persistedCargo:Y.a.get(e)}),Object(o.memo)(ne));var ie=a(71),ce=a(7),se=a(913),de=a(1797),ue=(a(59),a(268),a(269),a(230)),me=a(2080),pe=a(473),ge=(a(109),a(163),a(209));const be={padding:.5,justifySelf:"center"},ye=r.a.memo(({reactKeyPrefix:e,voyage:t,userLocale:a})=>{var o,n;const[l]=Object(s.a)([d.a.IInternationalization]),{common:i,model:c}=l.getLanguageFile(),{isoCode:u}=a,m=null!==(n=null===(o=t.voyageCurrency)||void 0===o?void 0:o.currencyCode)&&void 0!==n?n:"",p=l.formatNumber(t.tcResultDay,{maxDecimals:0,locale:u}),g=l.formatNumber(t.voyageResult,{maxDecimals:0,locale:u}),b=l.formatNumber(t.milesBallast+t.milesLoaded,{maxDecimals:0,minDecimals:0,locale:u}),y=l.formatNumber(t.daysTotal,{maxDecimals:2,minDecimals:2,locale:u}),v=[{primaryTitle:{text:c.tce,sx:be},primaryText:{text:`${p} ${m}`,sx:be}},{primaryTitle:{text:c.result,sx:be},primaryText:{text:`${g} ${m}`,sx:be}},{primaryTitle:{text:c.distanceTotal.replace("Distance","Dist."),sx:be},primaryText:{text:`${b} ${i.nm}`,sx:be}},{primaryTitle:{text:c.daysTotal,sx:be},primaryText:{text:""+y,sx:be}}];return r.a.createElement(ge.a,{reactKeyPrefix:e.concat("-routing-tile-group"),data:v,breakpoints:{xs:6,sm:6,md:6,lg:6,xl:6}})});var ve=a(1155),fe=a(21),he=a(137),Ce=a(2471),Oe=a(62),xe=(a(93),a(323)),ke=a(272),Pe=a.n(ke),je=a(258),Ee=a.n(je),Se=a(373);function we({portCallRoute:e,reactKeyPrefix:t,i:a,userLocale:n,showAlternatives:l,portCall:i,setHighlight:c,onClickRoute:s,originalRoute:d,tempVoyage:u}){var m,p,g,v,f,h,C,O,k,P,j,E,S,w,D,N,R,L,M,B,V,$,z,H,U;const[W,_]=Object(o.useState)(!1),{common:q,model:J}=a.getLanguageFile(),G=n.isoCode,Q=Object(o.useRef)(null),[X,Z]=Object(o.useState)(!1),Y=Object(Se.a)();Object(o.useEffect)(()=>{const e=Q.current;e&&Z(e.offsetWidth<e.scrollWidth)},[Y.width]);const ee=Object(b.a)(e=>Object(y.a)({accordion:Object.assign({boxShadow:"none",border:"1px solid",borderColor:e.palette.grey[400],borderRadius:e.shape.borderRadius,"&:hover":{backgroundColor:e.palette.action.hover}},c&&l&&{backgroundColor:Object(T.a)(e.palette.primary.main,e.palette.action.selectedOpacity)}),expandIcon:{"& .MuiAccordionSummary-expandIconWrapper":{marginTop:"-8px"}}}))({}),ae={label:{fontSize:"0.786rem",color:"text.secondary",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},value:{fontSize:"0.875rem",color:"text.primary",whiteSpace:"nowrap"},title:{fontSize:"1rem"}},oe=null!==(m=e.description)&&void 0!==m?m:q.original,re=a.formatNumber(e.seaMargin,{maxDecimals:0,locale:G}),ne=null!==(v=null===(g=null===(p=i.voyage)||void 0===p?void 0:p.voyageCurrency)||void 0===g?void 0:g.currencyCode)&&void 0!==v?v:"",le=a.formatNumber(null!==(f=e.distance)&&void 0!==f?f:0,{maxDecimals:0,locale:G}),ie=Math.round((null!==(h=null==u?void 0:u.tcResultDay)&&void 0!==h?h:0)-(null!==(O=null===(C=null==i?void 0:i.voyage)||void 0===C?void 0:C.tcResultDay)&&void 0!==O?O:0)),ce=ie>0?"+":ie<0?"-":"",se=e.isSelected?a.formatNumber(null!==(P=null===(k=i.voyage)||void 0===k?void 0:k.tcResultDay)&&void 0!==P?P:0,{maxDecimals:0,locale:G}):ce+a.formatNumber(Math.abs(ie),{maxDecimals:0,locale:G}),de=a.formatNumber(null!==(j=null==e?void 0:e.days)&&void 0!==j?j:0,{maxDecimals:2,minDecimals:2}),ue=a.formatNumber((null!==(S=null===(E=i.voyage)||void 0===E?void 0:E.milesBallast)&&void 0!==S?S:0)+(null!==(D=null===(w=i.voyage)||void 0===w?void 0:w.milesLoaded)&&void 0!==D?D:0),{maxDecimals:0,locale:G}),me=a.formatNumber(null!==(R=null===(N=i.voyage)||void 0===N?void 0:N.daysTotal)&&void 0!==R?R:0,{maxDecimals:2,minDecimals:2,locale:G}),pe=te.a.getEventLogDateFromPC(i,"ARR"),ge=pe?pe.toLocaleDateString(G,{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"}).replace(",",""):"",be=1===i.portCallSequence?null!==(B=null===(M=null===(L=i.voyage)||void 0===L?void 0:L.ballastPort)||void 0===M?void 0:M.portName)&&void 0!==B?B:"":null!==(z=null===($=null===(V=i.previousPortCall)||void 0===V?void 0:V.port)||void 0===$?void 0:$.portName)&&void 0!==z?z:"",ye=null!==(U=null===(H=i.port)||void 0===H?void 0:H.portName)&&void 0!==U?U:"",ve=Object(o.useCallback)(e=>{e.stopPropagation(),_(!W)},[W]),fe=Object(o.useCallback)(t=>{l?(t.stopPropagation(),s(e,i)):ve(t)},[s,i,e,l,ve]),he=e.isSelected&&r.a.createElement(xe.a,{display:"flex"},r.a.createElement(A.a,{sx:ae.title},be),r.a.createElement(xe.a,{sx:{px:1}},r.a.createElement(Ee.a,null)),r.a.createElement(A.a,{sx:ae.title},ye)),Ce=r.a.createElement(x.a,{direction:"row",container:!0,xs:12},r.a.createElement(x.a,{item:!0,xs:3,sx:{mr:-.5}},r.a.createElement(A.a,{sx:ae.label},q.description),r.a.createElement(A.a,{sx:ae.value},oe)),r.a.createElement(x.a,{item:!0,xs:3,sx:{mr:1}},r.a.createElement(A.a,{sx:ae.label},J.estDistance),r.a.createElement(A.a,{sx:ae.value},le+" "+q.nm)),r.a.createElement(x.a,{item:!0,xs:3,sx:{mr:1}},r.a.createElement(A.a,{sx:ae.label},J.seaMargin),r.a.createElement(A.a,{sx:ae.value},re+"%")),r.a.createElement(x.a,{item:!0,xs:3,sx:{mr:-1.5}},r.a.createElement(A.a,{sx:ae.label},e.isSelected?J.tce:J.tceDiff),r.a.createElement(A.a,{sx:ae.value},se+" "+ne))),Oe=d?J.distTotalDiff:J.distTotal,ke=d?J.daysTotalDiff:J.daysTotal,je=r.a.createElement(x.a,{direction:"row",container:!0,xs:12,sx:{px:1,pb:.5}},r.a.createElement(x.a,{item:!0,xs:3,sx:{mr:-1.25}},r.a.createElement(A.a,{sx:ae.label},J.daysAtSea),r.a.createElement(A.a,{sx:ae.value},de)),r.a.createElement(x.a,{item:!0,xs:3,sx:{mr:.25}},r.a.createElement(K.a,{disableHoverListener:!X,title:Oe},r.a.createElement(A.a,{ref:Q,sx:ae.label},Oe)),r.a.createElement(A.a,{sx:ae.value},(d?(()=>{if(d){const t=(null==d?void 0:d.distance)-(null==e?void 0:e.distance),o=t>0?"-":"+";return 0===t?"0":`${o}${a.formatNumber(Math.abs(t),{maxDecimals:0,locale:G})}`}})():ue)+" "+q.nm)),r.a.createElement(x.a,{item:!0,xs:3,sx:{mr:.25}},r.a.createElement(K.a,{disableHoverListener:!X,title:ke},r.a.createElement(A.a,{sx:ae.label},ke)),r.a.createElement(A.a,{sx:ae.value},d?(()=>{if(d){const t=(null==d?void 0:d.days)-(null==e?void 0:e.days),o=t>0?"-":"+";return 0===t?"0":`${o}${a.formatNumber(Math.abs(t),{maxDecimals:2,minDecimals:2,locale:G})}`}})():me)),r.a.createElement(x.a,{item:!0,xs:3},r.a.createElement(A.a,{sx:ae.label},q.eta),r.a.createElement(A.a,{sx:ae.value},ge)));return r.a.createElement(r.a.Fragment,null,he,r.a.createElement(I.a,{disableGutters:!0,className:ee.accordion,key:t,expanded:W,onClick:e=>fe(e)},r.a.createElement(F.a,{sx:{px:1,maxHeight:51},className:ee.expandIcon,expandIcon:r.a.createElement(Pe.a,{onClick:e=>ve(e)})},Ce),je))}const De=r.a.memo(we);var Ne=a(2383);function Re({reactKeyPrefix:e,isSelected:t}){return r.a.createElement(r.a.Fragment,null,t&&r.a.createElement(Ne.a,{key:e+"title",variant:"rectangular",width:180,height:25,sx:{borderRadius:1,mb:.5}}),r.a.createElement(Ne.a,{key:e+"route-card",sx:{borderRadius:1},variant:"rectangular",height:51}))}var Le=function(e,t,a,o){return new(a||(a=Promise))((function(r,n){function l(e){try{c(o.next(e))}catch(e){n(e)}}function i(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(l,i)}c((o=o.apply(e,t||[])).next())}))};const Te=({reactKeyPrefix:e,voyage:t,userLocale:a,state:{partOfSchedule:n},setShowLargeMap:l,onChangeSelectedRoutes:i,selectedRoutes:c,showAlternatives:u,setShowAlternatives:m,clickedMapRoute:p})=>{const[g,b]=Object(s.a)([d.a.IInternationalization,ce.a.IRoutingTabController]),{model:y,common:v}=g.getLanguageFile(),[f,h]=Object(o.useState)(t),[C,O]=Object(o.useState)(),[k,P]=Object(o.useState)(!1),[j,E]=Object(o.useState)(!0),[S,w]=Object(o.useState)(n.some(e=>{var t;return null===(t=null==e?void 0:e.portCallRoutes[0])||void 0===t?void 0:t.days})),[D,N]=Object(o.useState)(!1),R=Object(o.useRef)(!1),L=Object(me.a)(he.a.breakpoints.down("sm"),{noSsr:!0});Object(o.useEffect)(()=>{R.current||(R.current=!0,m(!1),Le(void 0,void 0,void 0,(function*(){yield b.fetchVoyage(t.key,!0),E(!0),h(t),setTimeout(()=>{w(!0),R.current=!1},100)})))},[n]),Object(o.useEffect)(()=>()=>{m(!1),l(!1)},[m,l]),Object(o.useEffect)(()=>{const e=!Object.entries(c).some(([e,{route:t}])=>!t.isSelected);P(e)},[c]);const T=Object(o.useCallback)(()=>{n.forEach(e=>{const t=e.portCallRoutes.find(e=>e.isSelected);t&&i(t,0,e.key)})},[i,n]),A=Object(o.useCallback)(()=>Le(void 0,void 0,void 0,(function*(){const e=[];for(const[t,{route:a}]of Object.entries(c))a.isSelected||e.push(a.key);yield b.putSelectedRoutes(e,t.key),m(!1)})),[b,c,m,t.key]),I=Object(o.useCallback)(()=>Le(void 0,void 0,void 0,(function*(){N(!1);const e=n.flatMap(e=>e.portCallRoutes.map(a=>Le(void 0,void 0,void 0,(function*(){const o=a.isSelected||e.arrivalFixed?t:yield b.onTempChangeSelectedRoute(a.key).then(e=>{var t;return null===(t=null==e?void 0:e.portCall)||void 0===t?void 0:t.voyage});O(e=>Object.assign(Object.assign({},e),{[a.key]:o}))}))));yield Promise.all(e),N(!0),E(!1)})),[n,b,t]),F=Object(o.useCallback)(()=>Le(void 0,void 0,void 0,(function*(){u?h(t):j&&I(),L||l(!u),T(),m(!u)})),[j,I,L,T,m,l,u,t]),M=Object(o.useCallback)((e,t)=>{const{updatedVoyage:a,tceDiff:o}=function(e,t,a,o,r){const n=new Oe.a(a);let l=0;if(e.voyage&&r){const i=o[e.key].route.distance;n.milesLoaded=a.milesLoaded-i+t.distance;const c=o[e.key].route.days;n.daysTotal=a.daysTotal-c+t.days,l=r.tcResultDay-a.tcResultDay,n.tcResultDay=a.tcResultDay+l;const s=r.voyageResult-a.voyageResult;n.voyageResult=a.voyageResult+s}return{updatedVoyage:n,tceDiff:l}}(t,e,f,c,C&&C[e.key]);i(e,o,t.key),h(a)},[f,c,C,i]);Object(o.useEffect)(()=>{if(p){const{routeKey:e,pcKey:t}=p,a=n.find(e=>e.key===t),o=c[t].route.key===e?null==a?void 0:a.portCallRoutes.find(e=>e.isSelected):null==a?void 0:a.portCallRoutes.find(t=>t.key===e);o&&a&&M(o,a)}},[p]);const B=Object(o.useMemo)(()=>r.a.createElement(pe.a,{onClick:A,fullWidth:!0,disabled:k,variant:"contained",color:"primary"},v.apply),[v.apply,k,A]),K=Object(o.useMemo)(()=>function(e,t,a,o,n,l,i,c,s,d){return e.flatMap((u,m)=>{if(u.portCallRoutes.length){const p=u.arrivalFixed?[u.portCallRoutes.find(e=>e.isSelected)]:u.portCallRoutes.sort((e,t)=>Number(t.isSelected)-Number(e.isSelected));return p.flatMap((g,b)=>{var y;if(g&&(0===b||t&&!u.arrivalFixed)){const v=p.length-1===b,f=e.length-1===m&&v?0:t&&v||!t?3:1,h=!t&&!a||t&&0!==b&&!o;return r.a.createElement(Ce.a,{sx:{pb:f},key:`${s}-route-card-${g.key}`},h?r.a.createElement(Re,{reactKeyPrefix:`${s}-skeleton-${g.key}`,isSelected:g.isSelected}):r.a.createElement(De,{portCallRoute:g,tempVoyage:n&&n[g.key],reactKeyPrefix:`${s}-route-card-${g.key}`,userLocale:l,i:d,showAlternatives:t,portCall:u,setHighlight:(null===(y=i[u.key])||void 0===y?void 0:y.route.key)===g.key,onClickRoute:c,originalRoute:0===b?void 0:p[0]}))}})}})}(n,u,S,D,C,a,c,M,e,g),[n,u,S,D,C,a,c,M,e,g]);return r.a.createElement(x.a,{container:!0},r.a.createElement(x.a,{item:!0,xs:12},r.a.createElement(ye,{reactKeyPrefix:e,voyage:f,userLocale:a})),r.a.createElement(x.a,{item:!0,xs:12,textAlign:"right",sx:{pt:1.5,pb:.5}},r.a.createElement(ue.a,{reactKeyPrefix:e+"alternative-routes-selector",selected:u,label:y.showAlternatives,onClick:F,isClearable:!0,disabled:!S})),r.a.createElement(x.a,{item:!0,xs:12,sx:{"&::-webkit-scrollbar":{display:"none"},overflowY:"auto",maxHeight:u?"55vh":void 0,overscrollBehavior:"contain"}},K),r.a.createElement(x.a,{item:!0,xs:12,sx:{pt:2}},u&&B))},Ae=Object(ee.a)((e,t)=>{var a;const o=fe.a.getTSModelBuilt(e,h.a.voyage,t.voyage.key,ve.a);return{partOfSchedule:null!==(a=null==o?void 0:o.partOfSchedule)&&void 0!==a?a:[]}},Object(o.memo)(Te));function Ie(e){const{voyage:t,userLocale:a,reactKeyPrefix:p,overlappingVoyageColourMap:g,onClickOverlappingChip:b,openedFromFas:y,onClickPorts:v,refreshFas:f,selectedCargo:C,user:O,setShowLargeMap:x,onChangeSelectedRoute:k,selectedRoutes:P,showAlternatives:j,setShowAlternatives:S,clickedMapRoute:w,state:{selectedTab:T}}=e,[A,I]=Object(s.a)([d.a.IInternationalization,ce.a.ISimpleReducerActions]),{model:F,voyages:M}=A.getLanguageFile(),B=Object(L.b)({}),K=Object(L.a)({}),[V,$]=Object(o.useState)(!1),z=function(e){return e.forEach(e=>{e.restrictedAreaDefs=e.restrictedAreaDefs.filter(e=>e.seq>0)}),e}(e.restrictedAreas),H=Object(n.g)(),U=Object(n.h)(),W=Object(o.useCallback)(()=>{$(!0)},[]),_=Object(o.useCallback)(()=>{$(!1)},[]),q=Object(o.useMemo)(()=>function(e,t,a,o){var r,n,l,i;const[c,u]=Object(s.a)([d.a.IInternationalization,E.a.IVoyageDrawerController]),{common:m,model:p}=c.getLanguageFile(),g=e.voyageHeader?e.voyageHeader:new R.a({}),b=null!==(l=null===(n=null===(r=e.voyageHeader)||void 0===r?void 0:r.voyageStatus)||void 0===n?void 0:n.statusTypeCode)&&void 0!==l?l:"",y=["EST","SCU"].includes(b),v=[{disabled:!y&&!g.isVoyageStartFixed,fieldName:"voyageStartDate",dateInputProps:{showTime:!0,clearable:!1},overrideObject:g,overrideType:h.a.voyageheader,onUpdateOverride:t=>u.updateVoyageHeaderField("voyageStartDate",t,e),breakpoints:{xs:7,sm:7,md:7,lg:7,xl:7},secondaryFieldOption:{disabled:y,fieldName:"isVoyageStartFixed",label:m.lock,overrideObject:g,overrideType:h.a.voyageheader,onUpdateOverride:t=>u.updateVoyageHeaderField("isVoyageStartFixed",t,e),formControlLabelProps:{classes:o,labelPlacement:"top",checked:null===(i=e.voyageHeader)||void 0===i?void 0:i.isVoyageStartFixed}}},{fieldName:"daysWaiting",disabled:!e.isDaysWaitingFixed,label:p.daysWaiting,breakpoints:{xs:5,sm:5,md:5,lg:5,xl:5},onUpdateOverride:t=>u.updateVoyageField("daysWaiting",t,e.key),secondaryFieldOption:{fieldName:"isDaysWaitingFixed",label:m.lock,onUpdateOverride:t=>u.updateVoyageField("isDaysWaitingFixed",t,e.key),formControlLabelProps:{classes:o,labelPlacement:"top",checked:e.isDaysWaitingFixed}}}];return Object(N.a)({fieldOptions:v,object:e,parentData:{key:e.key,type:h.a.voyage},type:h.a.voyage,userLocale:a,reactKeyPrefix:t,smartResponse:!0})}(t,p,a,K),[t,p,a,K]),J=Object(o.useCallback)(e=>{m.a.openDrawer(e,u.a.portCallDrawer,U,H)},[H,U]),G=[{id:"schedule",label:F.schedule,content:()=>r.a.createElement(r.a.Fragment,null,r.a.createElement(i.a,{reactKeyPrefix:p+"horizontal_list",key:p+"horizontal_list",items:q,breakpoints:c.a,className:B.ballastPort}),r.a.createElement(l.a,{voyage:t,reactKeyPrefix:p,onClickRow:J,onClickRowTouchLabel:A.lang().portCall.viewPortCall,overlappingVoyageColourMap:g,onClickOverlappingChip:b,user:O,onClickPorts:v,refreshFas:f}),V&&r.a.createElement(D,{restrictedAreas:z,onCloseModal:_,open:V,reactKeyPrefix:"voyage-map-fullscreen",onOpenFullscreen:W,voyage:t,userLocale:a}))},...C&&t.partOfSchedule.length?[{id:"edit-schedule",label:M.editSchedule,content:()=>r.a.createElement(le,{reactKeyPrefix:p,voyage:t,selectedCargo:C,userLocale:a,refreshFas:f})},{id:"routing",label:F.routing,content:()=>r.a.createElement(Ae,{reactKeyPrefix:p,voyage:t,userLocale:a,setShowLargeMap:x,onChangeSelectedRoutes:k,selectedRoutes:P,showAlternatives:j,setShowAlternatives:S,clickedMapRoute:w})}]:[]];return r.a.createElement(ie.a,{reactKeyPrefix:p+"-schedule-section",tabs:G,onTabChange:e=>{I.setAction(se.a,e)},selectedTab:T})}const Fe=Object(ee.a)(e=>{var t;return{selectedTab:null!==(t=de.a.get(e))&&void 0!==t?t:0}},Object(o.memo)(Ie))},1920:function(e,t,a){"use strict";a.d(t,"a",(function(){return I}));a(10),a(11);var o=a(218),r=a(246),n=a(1327),l=a(0),i=a.n(l),c=a(6),s=a(3),d=a(1798),u=a.n(d),m=a(180);var p=a(245),g=a(323),b=a(2375),y=a(214),v=a(12),f=a(210),h=a(38),C=a(135);function O({profitLossRow:e,item:t,children:a}){var o,r;return i.a.createElement(y.a,{xs:null!==(o=t.breakPoints)&&void 0!==o?o:12/e.row.length,item:!0,display:"flex",paddingLeft:t.header?0:2,sx:[t.header?Object.assign(Object.assign(Object.assign({},k(null!==(r=t.isBold)&&void 0!==r&&r,t)),x.headerField),t.isPositionStart?{alignContent:"start"}:{}):Object.assign(Object.assign(Object.assign({},e.isHighlighted?k(e.isHighlighted,t):x.regularField),{mt:t.inputProps||Object(l.isValidElement)(t.value)?"2px":0}),t.isPositionStart&&{justifyContent:"flex-start"}),...Array.isArray(t.sx)?t.sx:[t.sx]]},a)}const x={regularField:{justifyContent:"end",flexFlow:"wrap",alignContent:"flex-end"},headerField:{flexFlow:"wrap",alignItems:"end",flexDirection:"column",justifyContent:"space-between"},highlightedField:{bgcolor:Object(p.a)(h.b.greenSea.secondary[2],.4),paddingBottom:.5,alignItems:"end",border:"1px solid "+h.b.bergenRain.secondary[4],borderWidth:"1px 0 1px 0"},boldField:{fontWeight:"fontWeightBold",color:"text.primary"}},k=(e,t)=>Object.assign(Object.assign({},t.isBold&&x.boldField),e&&{paddingBottom:.5}),P=Object(l.memo)(({items:e,reactKeyPrefix:t,userLocale:a,sx:o})=>{const r={padding:0,height:"1.786rem"};return i.a.createElement(y.a,{container:!0,item:!0,spacing:.5,sx:Object.assign({ml:-2,mr:-2,mt:-1,width:e=>"calc(100% + "+e.spacing(4)+")"},o&&o)},e.map((e,o)=>i.a.createElement(y.a,Object.assign({key:t+"-"+o,item:!0,container:!0},v.e,{direction:"row",paddingRight:3,paddingTop:.5,paddingBottom:1/4,sx:e.isHighlighted?x.highlightedField:x.regularField,justifyContent:"space-between"}),e.row.map((n,l)=>{var c,s,d,u;return n.header?i.a.createElement(O,{profitLossRow:e,item:n},i.a.createElement(g.a,{sx:{ml:n.isPositionStart?-.5:0}},i.a.createElement(b.a,{sx:Object.assign(Object.assign({},k(!1,n)),{transformOrigin:"right"}),shrink:!0},n.header)),i.a.createElement("div",null,n.value)):n.inputProps?i.a.createElement(O,{profitLossRow:e,item:n},i.a.createElement(f.a,{maskSettings:n.inputProps.maskSetting,InputProps:{sx:Object.assign({},r),disabled:null===(c=n.inputProps)||void 0===c?void 0:c.disabled},reactKeyPrefix:t+Object(C.b)(null!==(s=n.label)&&void 0!==s?s:""+l),inputLabelProps:{sx:Object.assign({transformOrigin:"top right",top:0,right:0,left:"auto"},n.isBold&&x.boldField)},userLocale:a,label:null!==(d=n.label)&&void 0!==d?d:"",value:Number(n.value),onBlur:null===(u=n.inputProps)||void 0===u?void 0:u.onUpdateOverride})):n.label?i.a.createElement(i.a.Fragment,null,i.a.createElement(y.a,{key:o+"-"+l,xs:6,item:!0,paddingLeft:2,display:"flex",sx:Object.assign({},k(!1,n))},n.label),i.a.createElement(y.a,{key:o+"-"+l+1,xs:6,justifyContent:"flex-end",item:!0,display:"flex",sx:Object.assign({},k(!1,n))},n.value)):i.a.createElement(O,{profitLossRow:e,item:n},n.value)}))))});var j=a(28),E=a(144),S=a(20);var w=a(411),D=a(169),N=a(62),R=a(60);var L=a(1799),T=a.n(L),A=a(7);const I=e=>{var t;const{reactKeyPrefix:a,voyage:d,userLocale:p,isBreakdownOpen:b,toggleBreakdownChart:y,isAnalysisOpen:v}=e,[h,C]=Object(c.a)([s.a.IInternationalization,A.a.IVoyageController]),{common:O,model:x}=h.getLanguageFile(),k=Object(l.useCallback)((e,t)=>{e.stopPropagation(),y(t)},[y]),L=Object(l.useCallback)(e=>{C.updateVoyage(e,"inReverseMode=true")},[C]),I=Object(w.a)({}),F=((e,t)=>{const{freight:a,adjustment:o,variousCost:r,variousRevenue:n,demurrage:l,commission:i,despatch:c,portCost:s,canalCost:d,ilohcTcOut:u,ilohcTcIn:m,handlingCost:p,freightCost:g,ballastBonusRevenue:b,cveTcOut:y,grossFreight:v,netFreight:f,ballastEuEtsCost:h,ladenEuEtsCost:C}=e,{model:O,common:x}=t.getLanguageFile();return e.isTc?[{row:[{label:O.hire,value:""+t.formatNumber(a,{maxDecimals:0}),isBold:!0}]},{row:[{label:O.adjustment,value:""+t.formatNumber(o,{maxDecimals:3})}]},{row:[{label:O.ballastBonus,value:""+t.formatNumber(b,{maxDecimals:0})}]},{row:[{label:O.cve,value:""+t.formatNumber(y,{maxDecimals:0})}]},{row:[{label:O.ilohc,value:""+t.formatNumber(u,{maxDecimals:0})}]},{row:[{label:x.various,value:""+t.formatNumber(n,{maxDecimals:0})}]},{isHighlighted:!0,row:[{label:O.grossHire,value:""+t.formatNumber(v,{maxDecimals:0}),isBold:!0}]},{row:[{label:O.commission,value:""+t.formatNumber(i,{maxDecimals:0})}]},{isHighlighted:!0,row:[{label:x.netHire,value:""+t.formatNumber(f,{maxDecimals:0}),isBold:!0}]},{row:[{label:O.portCost,value:""+t.formatNumber(s,{maxDecimals:0})}]},{row:[{label:O.canalCost,value:""+t.formatNumber(d,{maxDecimals:0})}]},{row:[{label:O.ilohc,value:""+t.formatNumber(m,{maxDecimals:0})}]},{row:[{label:x.various,value:""+t.formatNumber(r,{maxDecimals:0})}]}]:[{row:[{label:O.freight,value:""+t.formatNumber(a,{maxDecimals:0}),isBold:!0}]},{row:[{label:O.adjustment,value:""+t.formatNumber(o,{maxDecimals:3})}]},{row:[{label:x.various,value:""+t.formatNumber(n,{maxDecimals:0})}]},{row:[{label:O.demurrage,value:""+t.formatNumber(l,{maxDecimals:0})}]},{isHighlighted:!0,row:[{label:O.grossRevenue,value:""+t.formatNumber(v,{maxDecimals:0}),isBold:!0}]},{row:[{label:O.commission,value:""+t.formatNumber(i,{maxDecimals:0})}]},{row:[{label:O.despatch,value:""+t.formatNumber(c,{maxDecimals:0})}]},{isHighlighted:!0,row:[{label:x.netRevenue,value:""+t.formatNumber(f,{maxDecimals:0}),isBold:!0}]},{row:[{label:O.portCost,value:""+t.formatNumber(s,{maxDecimals:0})}]},{row:[{label:O.canalCost,value:""+t.formatNumber(d,{maxDecimals:0})}]},{row:[{label:O.ilohc,value:""+t.formatNumber(m,{maxDecimals:0})}]},{row:[{label:O.handlingCost,value:""+t.formatNumber(p,{maxDecimals:0})}]},{row:[{label:x.various,value:""+t.formatNumber(r,{maxDecimals:0})}]},{row:[{label:O.freightCost,value:""+t.formatNumber(g,{maxDecimals:0})}]}]})(d,h),[M,B]=((e,t)=>{var a,o,r,n,l;const{foPrice:i,dlPrice:s,flPrice:d,doPrice:u,foConsumption:m,flConsumption:p,doConsumption:g,dlConsumption:b,foCost:y,flCost:v,dlCost:f,doCost:h}=e,[C]=Object(c.a)([S.a.IVoyageDrawerController]),{model:O,common:x}=t.getLanguageFile(),k=y+v+h+f,P=null!==(o=null===(a=null==e?void 0:e.voyageCurrency)||void 0===a?void 0:a.currencyCode)&&void 0!==o?o:"",w=null!==(l=null===(n=null===(r=null==e?void 0:e.voyageHeader)||void 0===r?void 0:r.voyageStatus)||void 0===n?void 0:n.statusTypeCode)&&void 0!==l?l:"",D=(null==e?void 0:e.euaPrice)*(null==e?void 0:e.euEtsEmissions),N=["EST","SCU"].includes(w);return[[{row:[{value:O.fo,isPositionStart:!0},{label:`${O.price} (${P})`,value:i,inputProps:{disabled:!N,maskSetting:j.a.mask2,onUpdateOverride:t=>C.updateBunkerStockPrice(e,E.a.FO,t)}},{header:`${x.cons} (${x.mt})`,value:""+t.formatNumber(m,{maxDecimals:0})},{header:O.cost,value:""+t.formatNumber(y,{maxDecimals:0})}]},{row:[{value:O.lsmgo,isPositionStart:!0},{value:s,inputProps:{disabled:!N,maskSetting:j.a.mask2,onUpdateOverride:t=>C.updateBunkerStockPrice(e,E.a.DL,t)}},{value:""+t.formatNumber(b,{maxDecimals:0})},{value:""+t.formatNumber(f,{maxDecimals:0})}]},{row:[{value:O.mgo,isPositionStart:!0},{value:u,inputProps:{disabled:!N,maskSetting:j.a.mask2,onUpdateOverride:t=>C.updateBunkerStockPrice(e,E.a.DO,t)}},{value:""+t.formatNumber(g,{maxDecimals:0})},{value:""+t.formatNumber(h,{maxDecimals:0})}]},{row:[{value:O.lsfo,isPositionStart:!0},{value:d,inputProps:{disabled:!N,maskSetting:j.a.mask2,onUpdateOverride:t=>C.updateBunkerStockPrice(e,E.a.FL,t)}},{value:""+t.formatNumber(p,{maxDecimals:0})},{value:""+t.formatNumber(v,{maxDecimals:0})}]},{row:[{value:O.euEts,isPositionStart:!0},{value:e.euaPrice,inputProps:{maskSetting:j.a.mask2,onUpdateOverride:t=>C.updateVoyageField("euaPrice",t,e.key)}},{value:""+t.formatNumber(null==e?void 0:e.euEtsEmissions,{maxDecimals:0})},{value:""+t.formatNumber(D,{maxDecimals:0})}]}],[{row:[{value:""+t.formatNumber(k,{maxDecimals:0}),isBold:!0,label:O.bunkerCost}]}]]})(d,h),K=((e,t,a,o,r,n)=>{var l,s,d;const{tcResultDay:u,isInReverseMode:m,tcHireNet:p,ballastBonusNet:b,cveTcIn:y,voyageResult:v,daysTotal:h,tcResult:C}=e,[O]=Object(c.a)([S.a.IVoyageDrawerController]),{model:x,common:k,voyages:P}=t.getLanguageFile(),E=""+(0!==h&&0!==Math.round(v)?t.formatNumber(v/h,{maxDecimals:0}):0),w="EST"===(null===(s=null===(l=e.voyageHeader)||void 0===l?void 0:l.voyageStatus)||void 0===s?void 0:s.statusTypeCode);return[{isHighlighted:!0,row:[{isBold:!0,breakPoints:8,value:i.a.createElement("div",{style:{display:"flex",alignItems:"end"}},i.a.createElement(g.a,{sx:{pr:4}},x.tce),i.a.createElement(f.a,{inputLabelProps:{sx:{fontWeight:"fontWeightBold",color:"text.primary"}},value:u,reactKeyPrefix:a+"-tcResultDay",userLocale:o,maskSettings:j.a.mask4,InputProps:{disabled:!w,sx:{padding:0,height:"1.786rem"}},onBlur:t=>{Math.round(t)!==Math.round(e.tcResultDay)&&n(new N.a({key:e.key,tcResultDay:t}))}}),i.a.createElement(D.a,{reactKeyPrefix:a+"-tce_lock",label:k.lock,onInputChange:t=>O.updateVoyageField("isInReverseMode",t,e.key),checked:m,formControlLabelProps:{classes:r,labelPlacement:"top",checked:null===(d=e.voyageHeader)||void 0===d?void 0:d.isLastVoyage},sx:{mt:-.5}}))},{isBold:!0,header:x.contribution,value:t.formatNumber(C,{maxDecimals:0}),breakPoints:4},{value:e.daysOffhire>0?P.exclOffhire:"",breakPoints:3,sx:{pt:.5}},{value:e.daysOffhire>0?t.formatNumber(R.a.getTceExlOffhire(e),{maxDecimals:0}):"",breakPoints:4,sx:{pt:.5,pr:2,justifyContent:"end"}},{value:"",breakPoints:5}]},{row:[{label:x.hirePayable,isPositionStart:!0,value:t.formatNumber(p,{maxDecimals:0})}]},{row:[{label:x.ballastBonus,isPositionStart:!0,value:t.formatNumber(b,{maxDecimals:0})}]},{row:[{label:x.cve,value:t.formatNumber(y,{maxDecimals:0})}]},{isHighlighted:!0,row:[{value:x.resultDay,isBold:!0,isPositionStart:!0},{value:E,isBold:!0},{label:x.result,value:v,isBold:!0,inputProps:{disabled:!w,maskSetting:j.a.mask4,onUpdateOverride:t=>{Math.round(t)!==Math.round(e.voyageResult)&&n(new N.a({key:e.key,voyageResult:t}))}}}]}]})(d,h,a,p,I,L);return i.a.createElement(m.a,{title:O.profitLossSummary(null===(t=null==d?void 0:d.voyageCurrency)||void 0===t?void 0:t.currencyCode),disableHeaderElementSpacing:!0,headerElements:i.a.createElement(i.a.Fragment,null,i.a.createElement(o.a,{title:x.resultChart},i.a.createElement(r.a,{onClick:e=>k(e,!0),sx:{ml:e=>e.spacing(.5)},id:a+"-open-breakdown-chart"},i.a.createElement(u.a,{color:b?"primary":void 0,fontSize:"large"}))),i.a.createElement(o.a,{title:O.analysis},i.a.createElement(r.a,{onClick:e=>k(e,!1),id:a+"-open-analysis",sx:{ml:e=>e.spacing(-.5)}},i.a.createElement(T.a,{color:v?"primary":void 0,fontSize:"large"})))),reactKeyPrefix:a+"-profit-loss-title"},i.a.createElement(P,{reactKeyPrefix:a+"-profit-loss-section",items:F,userLocale:p}),i.a.createElement(n.a,{sx:{my:1}}),i.a.createElement(P,{reactKeyPrefix:a+"consumption-items",items:M,userLocale:p}),i.a.createElement(n.a,{sx:{my:1}}),i.a.createElement(P,{reactKeyPrefix:a+"bunker-cost-item",items:B,userLocale:p,sx:{mb:1}}),i.a.createElement(P,{reactKeyPrefix:a+"result-items",items:K,userLocale:p}))}},1921:function(e,t,a){"use strict";a.d(t,"a",(function(){return me}));a(59),a(10),a(11);var o=a(0),r=a.n(o),n=a(97),l=a(37),i=a(12),c=a(180),s=a(6),d=a(60),u=a(3),m=a(214),p=a(218),g=a(2104),b=a(842),y=a.n(b),v=a(15),f=a(27),h=a(245),C=a(2357),O=a(323),x=a(130),k=a(147);const P=({reactKeyPrefix:e,cargo:t,renderCargoPort:a})=>{const n=k.a.sortByCargoPortSequence(t.cargoPorts).map((n,l)=>{var i,c,s;return a?a(n,l,t.cargoPorts.length):r.a.createElement(o.Fragment,{key:e+"-cargo-port-"+n.key},r.a.createElement(x.a,{key:e+"-cargo-port-"+n.key,sx:{display:"flex",flexDirection:"row",gap:.5}},null===(i=n.port)||void 0===i?void 0:i.portName," ",(null===(c=n.reasonForCall)||void 0===c?void 0:c.reasonForCall)?r.a.createElement(x.a,{color:"GrayText"},`(${null===(s=null==n?void 0:n.reasonForCall)||void 0===s?void 0:s.reasonForCall})`):null),l+1!==t.cargoPorts.length?r.a.createElement(y.a,{sx:{verticalAlign:"middle",ml:1,mr:1}}):null)});return r.a.createElement(o.Fragment,null,n)},j=({reactKeyPrefix:e,cargos:t,selectedCargo:a,onClickCargo:n})=>r.a.createElement(o.Fragment,null,null==t?void 0:t.map(t=>{const o=(({selected:e})=>({stack:{display:"flex",alignItems:"center",justifyContent:"space-between",flex:"auto",height:"2.5rem",border:"1px solid",borderColor:e=>e.palette.grey[400],borderBottomWidth:0,"&:nth-child(2)":{mt:2,borderTopLeftRadius:e=>e.shape.borderRadius,borderTopRightRadius:e=>e.shape.borderRadius},"&:last-child":{borderBottomWidth:1,borderBottomLeftRadius:e=>e.shape.borderRadius,borderBottomRightRadius:e=>e.shape.borderRadius},":hover":{backgroundColor:e=>e.palette.action.hover,cursor:"pointer"},backgroundColor:e?e=>Object(h.a)(e.palette.primary.main,e.palette.action.selectedOpacity):void 0},overview:{display:"flex",flexDirection:"row",ml:1,mr:1,alignItems:"center"}}))({selected:a.key===t.key}),l=e+"-cargo-"+(null==t?void 0:t.key);return r.a.createElement(C.a,{key:l,direction:"row",spacing:2,alignItems:"center",sx:o.stack,onClick:n.bind(null,t)},r.a.createElement(O.a,{sx:o.overview},r.a.createElement(P,{reactKeyPrefix:l,cargo:t})))}));var E=a(63),S=a(199),w=a(19),D=a(64),N=a(58),R=a(7),L=a(1227),T=a(28),A=a(20),I=a(1),F=a(85),M=a(301),B=a(945),K=a(86),V=a(96),$=a(30),z=a(1329),H=a(957);var U=a(100),W=a.n(U),_=a(246),q=a(243),J=a(534);function G(e){const{reactKeyPrefix:t,voyage:a,anchorElement:n,onClose:l,children:i}=e,[c]=Object(s.a)([u.a.IInternationalization]),{common:d,cargoes:m}=c.getLanguageFile(),[g,b]=Object(o.useState)(!1),y=()=>b(!g);return r.a.createElement(r.a.Fragment,null,r.a.createElement(q.a,{reactKeyPrefix:t+"-cargo-selector",anchorEl:n,open:!!n,onCloseActionMenu:l,showCloseButton:!1,position:q.b.BelowAlignLeft,paddingTop:!0,fitWidthToContent:!0},r.a.createElement(O.a,{sx:{minWidth:160}},r.a.createElement(x.a,{variant:"h6"},d.selectCargo),r.a.createElement(O.a,{sx:{position:"absolute",top:e=>e.spacing(1),right:e=>e.spacing(1)}},r.a.createElement(p.a,{title:m.createCargo,enterDelay:300,disableFocusListener:!0},r.a.createElement(_.a,{id:t+"-create-btn",onClick:y,color:"primary"},r.a.createElement(W.a,null))))),i),g&&r.a.createElement(J.a,{reactKeyPrefix:t+"-create-cargo",showModal:g,onCloseModal:y,voyage:a}))}var Q=a(1283),X=a(74),Z=a(296),Y=a(450),ee=a(47),te=a(122),ae=a(21),oe=a(473),re=a(1232),ne=a.n(re),le=a(1174),ie=a.n(le);function ce(e){var t;const{reactKeyPrefix:a,selectedCargo:n,openCargoDrawer:l,cargoLabel:i,disableIcon:c,onClick:s}=e;return r.a.createElement(o.Fragment,null,r.a.createElement(oe.a,{variant:"text",color:"inherit",onClick:s,disabled:c,id:a+"-open-cargo-popover",sx:{mx:-1,my:-3/4,":disabled":{color:"inherit"}}},r.a.createElement(x.a,{sx:{display:"flex",flexDirection:"row"},variant:"h4"},i,r.a.createElement(x.a,{marginLeft:1,variant:"subtitle1"},null!==(t=n.cargoReference)&&void 0!==t?t:n.key)),!c&&r.a.createElement(ie.a,{sx:{my:-1,ml:1}})),r.a.createElement(_.a,{id:a+"-open-cargo-drawer-icon",onClick:e=>{l(null==n?void 0:n.key),e.stopPropagation()}},r.a.createElement(ne.a,null)))}var se=a(373),de=function(e,t,a,o){return new(a||(a=Promise))((function(r,n){function l(e){try{c(o.next(e))}catch(e){n(e)}}function i(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(l,i)}c((o=o.apply(e,t||[])).next())}))};function ue(e){var t;const{voyage:a,userLocale:d,reactKeyPrefix:b,user:h,refreshFas:C,setSelectedOverviewCargo:O,toggleDateWarningModal:x,state:{selectedCargo:k}}=e,[U,W,_,q]=Object(s.a)([u.a.IInternationalization,R.a.ISimpleReducerActions,R.a.ITSModelActionsAsync,A.a.IVoyageDrawerController]),{common:J,model:X}=U.getLanguageFile(),Y=Object(n.h)(),ee=Object(n.g)(),ae=Object(se.a)(),[oe,re]=Object(o.useState)(null),[ne,le]=Object(o.useState)(null),ie=b+"-horizontal-list",ue=Object(o.useMemo)(()=>function(e,t,a,o,n,l,c){var d,m,p,g,b,y,h,C,O,x;const[k,P,j]=Object(s.a)([u.a.IInternationalization,A.a.IVoyageOverviewCargoController,R.a.ICargoQuantityActions]),{model:U,alerts:W}=k.getLanguageFile();if(!e||0===e.cargos.length)return[];if(0===t.key)return[];const _=N.a.getFirstLoadCargoPort(t.cargoPorts)||new D.a({}),q=N.a.getFirstDischargeCargoPort(t.cargoPorts)||new D.a({}),J=Object(L.a)(t,_,q),G=t.subCargos.length>0,Q=t.freightRates.length>0,X=N.a.cargoPortsHaveDifferentFreightRates(t),Z=N.a.isTranshipPreshipTransferOrRelet(t),Y={cargoQuantity:J||G,freightRate:G||X||Q,variousCost:!e.variousCostFixed},ee=t.isWorldscale?"USD":null!==(m=null===(d=e.voyageCurrency)||void 0===d?void 0:d.currencyCode)&&void 0!==m?m:"",[te]=Object(z.a)(null==e?void 0:e.tcs,"key").slice(-1),ae=e.isTc?te:t,oe=null!==(p=t.laycanMissedBy)&&void 0!==p?p:0,re=Object(S.a)(a,[{fieldName:"charterer",label:Z?U.owner:U.charterer,typeaheadProps:{shouldPreload:!0,objectPaths:K.b.businessPartner,fields:K.a.businessPartner,query:V.b},openObject:{permissions:[$.a.BusinessPartnerGET],onOpen:f.a.openDrawer.bind(null,null===(g=t.charterer)||void 0===g?void 0:g.key,v.a.businessPartnerDrawer)},breakpoints:i.e},{InputProps:{disabled:Y.cargoQuantity,endAdornment:null!==(y=null===(b=t.cargoMeasurement)||void 0===b?void 0:b.measurementCode)&&void 0!==y?y:""},fieldName:"cargoQuantity",label:U.actualQuantity,numberInputProps:{maskSettings:T.a.mask18},onUpdateOverride:e=>j.onChangeActualQuantity(e,t)},{fieldName:"commodity",label:U.commodity,typeaheadProps:{shouldPreload:!0,defaultSelectedOptions:t.commodity,fields:{commodityMeasurement:{measurementCode:"*"},commodityName:"*"},objectPaths:["commodityName"]},openObject:{permissions:[$.a.CommodityGET],onOpen:f.a.openDrawer.bind(null,null!==(C=null===(h=t.commodity)||void 0===h?void 0:h.key)&&void 0!==C?C:-1,v.a.commodityDrawer)},onUpdateOverride:e=>P.onChangeCommodity(t.key,e)},{InputProps:{disabled:Y.freightRate,endAdornment:null!==(x=null===(O=t.freightCurrency)||void 0===O?void 0:O.currencyCode)&&void 0!==x?x:ee},fieldName:"freightRate",numberInputProps:{maskSettings:T.a.mask19},breakpoints:i.h,onUpdateOverride:e=>P.onChangeFreightRate(t,e)},{fieldName:"isWorldscale",overrideFieldType:"object",label:U.rule,typeaheadProps:{options:Object(M.a)(k),defaultSelectedOptions:Object(M.d)(k,t),isClearable:!1},breakpoints:i.f,onUpdateOverride:e=>P.update(t.key,Object(M.c)(k,e,t))},t.isWorldscale?{fieldName:"flatRate",label:U.flatRate,breakpoints:i.f,typeaheadProps:{shouldPreload:!0}}:{fieldName:"freightCurrency",label:U.currency,breakpoints:i.f,typeaheadProps:{shouldPreload:!0,isClearable:!1,objectPaths:["currencyCode"]}},{label:U.brokerCom,fieldName:"commissionBroker",InputProps:{endAdornment:E.a.Percent},breakpoints:i.f,numberInputProps:{validation:[{type:F.a.RANGE,max:100}],maskSettings:T.a.mask2}},{label:U.addressCom,fieldName:"commissionAddress",InputProps:{endAdornment:E.a.Percent},breakpoints:i.f,numberInputProps:{validation:[{type:F.a.RANGE,max:100}],maskSettings:T.a.mask2}},{label:U.variousCost,fieldName:"variousCost",InputProps:{endAdornment:ee},overrideObject:e,overrideType:I.a.voyage,breakpoints:i.h,disabled:Y.variousCost,numberInputProps:{maskSettings:T.a.mask4}},{overrideComponent:r.a.createElement(H.a,{cargo:t,userLocale:o,missedBy:oe,i:k}),breakpoints:i.e}]),ne=[{fieldName:"laycanFrom",dateInputProps:{error:!!ae.laycanTo&&!ae.laycanFrom,showTime:!0,showShortDate:!0},formHelperText:ae.laycanTo&&!ae.laycanFrom?W.bothDatesRequiredLaycan:void 0,label:U.laydaysCommences,overrideObject:ae,overrideType:e.isTc?I.a.tc:I.a.cargo,onUpdateOverride:t=>P.onChangeLaycan(t,B.a.FROM,ae,e.key,l,c),breakpoints:i.h},{fieldName:"laycanTo",dateInputProps:{error:!!ae.laycanFrom&&!ae.laycanTo,showTime:!0,showShortDate:!0},formHelperText:ae.laycanFrom&&!ae.laycanTo?W.bothDatesRequiredLaycan:void 0,label:U.laydaysCancelling,overrideObject:ae,overrideType:e.isTc?I.a.tc:I.a.cargo,onUpdateOverride:t=>P.onChangeLaycan(t,B.a.TO,ae,e.key,l,c),breakpoints:i.h}],le=Object(S.a)(a,[...re,...0!==t.key||e.isTc?ne:[]]);return Object(w.a)({fieldOptions:le,object:t,parentData:{key:e.key,type:I.a.voyage},type:I.a.cargo,userLocale:o,reactKeyPrefix:n,smartResponse:!0})}(a,k,h,d,ie,x,C),[a,k,h,d,ie,x,C]),me=Object(o.useMemo)(()=>k.cargoPorts.some(e=>e.key),[k]),pe=()=>re(null),ge=Object(o.useCallback)(e=>{var t;q.loadSelectedCargo(e.key),W.setAction(Z.a,null!==(t=e.key)&&void 0!==t?t:null),O(e),pe()},[q,O,W]),be=Object(o.useCallback)(e=>{f.a.openDrawer(null!=e?e:-1,v.a.cargoDrawer,Y,ee),pe()},[ee,Y]),ye=Object(o.useCallback)(e=>_.loadSingleAction({type:I.a.cargoport,key:e,fields:te.d,callback:(e,t)=>{t&&le(t)}}),[_]),ve=Object(o.useMemo)(()=>r.a.createElement(l.a,{reactKeyPrefix:ie,key:b+"horizontal_list",items:ue,breakpoints:i.h}),[ue,b,ie]);return r.a.createElement(o.Fragment,null,r.a.createElement(c.a,{title:r.a.createElement(ce,{reactKeyPrefix:b,selectedCargo:k,openCargoDrawer:be,onClick:e=>{e.stopPropagation(),re(e.currentTarget)},cargoLabel:X.cargo,disableIcon:!me||(null!==(t=null==ae?void 0:ae.width)&&void 0!==t?t:0)>600}),reactKeyPrefix:b+"-performance-cargo-section"},r.a.createElement(m.a,{container:!0,sx:{mt:-2.5,mb:1}},r.a.createElement(P,{reactKeyPrefix:b,cargo:k,renderCargoPort:(e,t,a)=>{var o,n;return r.a.createElement(m.a,{xs:"auto",sx:{display:"flex",flexDirection:"row"}},r.a.createElement(p.a,{title:`${J.edit} ${X.cargoPort}`,placement:"bottom"},r.a.createElement(g.a,{sx:{display:"flex",flexDirection:"row","&:hover":{cursor:"pointer"},mt:1/8},onClick:t=>de(this,void 0,void 0,(function*(){ye(e.key),t.stopPropagation()}))},`${null===(o=e.port)||void 0===o?void 0:o.portName} (${null===(n=null==e?void 0:e.reasonForCall)||void 0===n?void 0:n.reasonForCall})`)),t+1!==a?r.a.createElement(y.a,{sx:{alignSelf:"center",mx:.5,fontSize:"1.3rem"}}):null)}})),ve),!!oe&&me&&r.a.createElement(G,{reactKeyPrefix:b+"-cargo-selector",voyage:a,anchorElement:oe,onClose:pe},r.a.createElement(j,{reactKeyPrefix:b+"-cargoes-list",cargos:a.cargos,selectedCargo:k,onClickCargo:ge})),!!ne&&r.a.createElement(Q.a,{reactKeyPrefix:b,showModal:!!ne,closeDialog:()=>le(null),cargo:k,selectedCargoPort:ne}))}const me=Object(ee.a)((e,t)=>{var a,o,r,n,l;const i=null!==(n=null!==(a=Y.a.get(e))&&void 0!==a?a:d.a.getPerformanceCargo(null!==(r=null===(o=t.voyage)||void 0===o?void 0:o.cargos)&&void 0!==r?r:[]).key)&&void 0!==n?n:-1;return{selectedCargo:null!==(l=ae.a.getTSModelBuilt(e,I.a.cargo,i,te.c))&&void 0!==l?l:new X.a({})}},Object(o.memo)(ue))},2007:function(e,t,a){"use strict";a.d(t,"a",(function(){return W}));a(10),a(11);var o=a(0),r=a.n(o),n=a(47),l=a(180),i=a(450),c=a(60),s=a(21),d=a(1),u=a(122),m=a(74),p=a(6),g=a(3),b=a(97),y=a(214),v=a(130),f=a(27),h=a(15),C=a(245),O=a(323),x=a(842),k=a.n(x),P=a(38),j=a(147),E=a(274),S=a.n(E),w=a(1232),D=a.n(w),N=a(685),R=a(46),L=a(20),T=a(296),A=a(7);const I=e=>{const{reactKeyPrefix:t,cardRef:a,cargo:n,isOpenedFromFas:l}=e,[i,c,s]=Object(p.a)([g.a.IInternationalization,L.a.ICargoDrawerController,A.a.ISimpleReducerActions]),d=Object(b.g)(),u=Object(b.h)(),m={toolbar:{position:"absolute",right:22,"& *:first-of-type button":{borderRadius:e=>e.spacing(.5,0,0,.5)},"& *:last-of-type button":{borderRadius:e=>e.spacing(0,.5,.5,0)}}},y=Object(o.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),n&&c.copyCargo(n,(e,t)=>{var a;t&&(f.a.openDrawer(t.key,h.a.cargoDrawer,u,d),R.a.next(),s.setAction(T.a,null!==(a=t.key)&&void 0!==a?a:null),!n.voyage&&l&&c.refreshCargoCommitments())})},[n,c,d,l,u,s]),v=Object(o.useCallback)(e=>{var t;e.stopPropagation(),e.preventDefault(),f.a.openDrawer(n.key,h.a.cargoDrawer,u,d),s.setAction(T.a,null!==(t=n.key)&&void 0!==t?t:null)},[n.key,d,u,s]);return r.a.createElement(O.a,{component:"div",sx:m.toolbar,ref:a,style:{paddingTop:"1px"}},r.a.createElement(N.a,{tooltip:i.lang().cargoes.copyCargo,onClick:y,disabled:!1,reactKeyPrefix:t+"-copy-btn"},r.a.createElement(S.a,null)),r.a.createElement(N.a,{tooltip:i.lang().cargoes.goToCargo,onClick:v,disabled:!1,reactKeyPrefix:t+"-open-drawer-btn"},r.a.createElement(D.a,null)))};var F=a(331);const M=({children:e})=>r.a.createElement(v.a,{sx:{color:Object(C.a)(P.b.bergenRain.secondary[12],.65)},variant:"body2"},e);function B({cargo:e,isSelected:t,onClick:a,reactKeyPrefix:n}){var l,i,c,s,d,u,m,b,f,h;const[x]=Object(p.a)([g.a.IInternationalization]),{common:P}=x.lang(),[E,S]=Object(o.useState)(!1),w=Object(o.useRef)(null),D=Object(o.useCallback)(()=>{a(e)},[e,a]),N=(({selected:e})=>({card:{border:"1px solid",borderLeft:t=>e?t.spacing(.5)+" solid":t.spacing(.125)+" solid",borderColor:e=>e.palette.grey[400],borderLeftColor:e?e=>e.palette.primary.main:e=>e.palette.grey[400],display:"flex",flexDirection:"row",flexFlow:"wrap",px:1,py:.5,borderRadius:1,width:"inherit",":hover":{backgroundColor:e=>e.palette.action.hover,cursor:"pointer"},backgroundColor:e?e=>Object(C.a)(e.palette.primary.main,e.palette.action.selectedOpacity):e=>e.palette.background.paper}}))({selected:t}),R=Object(o.useMemo)(()=>e.cargoPorts.length>0&&e.cargoPorts[0].portCall?j.a.sortByPortCallSequence(e.cargoPorts):j.a.sortByCargoPortSequence(e.cargoPorts),[e.cargoPorts]),{isOpenedFromFas:L}=Object(F.b)(),T=Object(o.useCallback)(()=>{setTimeout(()=>S(!0),100)},[]),A=Object(o.useCallback)(()=>{setTimeout(()=>S(!1),100)},[]);return r.a.createElement(O.a,{sx:N.card,id:n+"-cargo-card",onClick:D,onMouseEnter:T,onMouseLeave:A},r.a.createElement(y.a,{container:!0,sx:{marginBottom:1/4}},R.map((t,a)=>{var o,n;return r.a.createElement(y.a,{item:!0,key:t.key,xs:"auto",sx:{display:"flex",flexDirection:"row"}},r.a.createElement(v.a,{sx:{my:1/4},variant:"body2"},`${null===(o=t.port)||void 0===o?void 0:o.portName} (${null===(n=null==t?void 0:t.reasonForCall)||void 0===n?void 0:n.reasonForCall})`),a+1!==e.cargoPorts.length?r.a.createElement(k.a,{sx:{alignSelf:"center",mx:.5,fontSize:"1.3rem",pb:1/4}}):null)})),r.a.createElement(y.a,{item:!0},E&&r.a.createElement(I,{reactKeyPrefix:n,cardRef:w,cargo:e,isOpenedFromFas:L})),r.a.createElement(y.a,{container:!0},r.a.createElement(y.a,{item:!0,xs:7},r.a.createElement(M,null,null!==(i=null===(l=null==e?void 0:e.charterer)||void 0===l?void 0:l.businessPartnerName)&&void 0!==i?i:P.noCharterer)),r.a.createElement(y.a,{item:!0,xs:5},r.a.createElement(M,null,x.formatNumber(e.freightRate,{maxDecimals:0})+` ${null!==(s=null===(c=e.freightCurrency)||void 0===c?void 0:c.currencyCode)&&void 0!==s?s:""}/${null!==(u=null===(d=e.cargoMeasurement)||void 0===d?void 0:d.measurementCode)&&void 0!==u?u:""}`))),r.a.createElement(y.a,{container:!0},r.a.createElement(y.a,{item:!0,xs:7},r.a.createElement(M,null,null!==(b=null===(m=null==e?void 0:e.commodity)||void 0===m?void 0:m.commodityName)&&void 0!==b?b:P.noCommodity)),r.a.createElement(y.a,{item:!0,xs:5},r.a.createElement(M,null,null!==(h=x.formatNumber(e.cargoQuantity,{maxDecimals:0})+" "+(null===(f=e.cargoMeasurement)||void 0===f?void 0:f.measurementCode))&&void 0!==h?h:""))))}var K=a(635),V=a(100),$=a.n(V),z=a(81),H=a(1233);function U(e){const{reactKeyPrefix:t,voyage:a,state:{selectedCargo:n},setSelectedOverviewCargo:i}=e,[c,s,d]=Object(p.a)([g.a.IInternationalization,A.a.ISimpleReducerActions,L.a.IVoyageDrawerController]),u=Object(b.h)(),m=Object(b.g)(),{cargoes:C,common:O,model:x}=c.lang(),[k,P]=Object(o.useState)(!1),[j,E]=Object(o.useState)(!1),[S,w]=Object(o.useState)(null),[D,N]=Object(o.useState)(!1),R=Object(o.useCallback)(e=>{const t=f.a.getCurrentlyOpenedDrawers();(null==e?void 0:e.voyage)&&t.some(e=>e.hash===h.a.voyageDrawer)&&d.refreshVoyage(e.voyage)},[d]),I=Object(o.useCallback)(()=>{E(!j)},[j]),F=Object(o.useCallback)(()=>{P(!k)},[k]),M=Object(o.useCallback)(()=>{N(!D)},[D]),V=Object(o.useCallback)(()=>{w(null),I()},[I]),U=Object(o.useMemo)(()=>{const{partOfSchedule:e}=a;let t=!1,o=!1;return e&&e.forEach(e=>{const a=Object(z.a)(e,"reasonForCall.reasonForCall",null);a&&"L"===a?t=!0:a&&"D"===a&&(o=!0)}),t&&o},[a]),W=Object(o.useCallback)(e=>f.a.openDrawer(e,h.a.cargoDrawer,u,m),[m,u]),_=Object(o.useCallback)(e=>{var t,a;m.location.pathname.includes("cargo-drawer")&&!m.location.pathname.includes(e.key.toString())?W(null!==(t=e.key)&&void 0!==t?t:null):n.key!==e.key&&d.loadSelectedCargo(e.key),s.setAction(T.a,null!==(a=e.key)&&void 0!==a?a:null),i(e)},[d,m.location.pathname,W,n,i,s]),q=Object(o.useCallback)(e=>{R(e),w(e),M(),I()},[R,M,I]),J=Object(o.useCallback)(e=>{R(e),_(e),W(e.key)},[_,W,R]),G=Object(o.useMemo)(()=>[{onClick:a.isTc&&!U?F:I,text:C.createCargo},{onClick:M,text:C.createCargoFromCoaTemplate,disabled:a.isTc}],[C.createCargo,C.createCargoFromCoaTemplate,U,M,I,F,a.isTc]),Q=Object(o.useCallback)(()=>{F()},[F]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(l.a,{title:r.a.createElement(y.a,{container:!0,spacing:2},r.a.createElement(y.a,{xs:10.5,item:!0},r.a.createElement(v.a,{sx:{display:"flex",flexDirection:"row",marginTop:1},variant:"h4"},C.cargoList)),r.a.createElement(y.a,{xs:1.5,item:!0},r.a.createElement(K.a,{key:t+"_action_index",reactKeyPrefix:t+"-action-index",actions:G,Icon:$.a,iconButtonProps:{color:"primary","aria-label":`${O.create} ${x.cargo}`},label:`${O.create} ${x.cargo}`}))),reactKeyPrefix:t+"-section"},r.a.createElement(y.a,{container:!0,spacing:.5},a.cargos.map((e,a)=>r.a.createElement(y.a,{key:t+"-"+a,item:!0,container:!0,direction:"row",paddingTop:.5,paddingBottom:.5},r.a.createElement(B,{cargo:e,isSelected:n.key===e.key,reactKeyPrefix:t+"-card-"+a,onClick:_}))))),r.a.createElement(H.a,{reactKeyPrefix:t+"-create-cargo",cargoTemplateToUse:S,voyage:a,onCreateCargo:J,onCreateCargoFromCoa:q,onCloseCreateCargoFromCoaModal:M,onCloseCreateCargoModal:V,onCloseErrorModal:Q,showCreateModal:j,showCreateCargoFromCoaModal:D,showErrorModal:k}))}const W=Object(n.a)((e,t)=>{var a,o,r,n,l;const p=null!==(n=null!==(a=i.a.get(e))&&void 0!==a?a:c.a.getPerformanceCargo(null!==(r=null===(o=t.voyage)||void 0===o?void 0:o.cargos)&&void 0!==r?r:[]).key)&&void 0!==n?n:-1;return{selectedCargo:null!==(l=s.a.getTSModelBuilt(e,d.a.cargo,p,u.c))&&void 0!==l?l:new m.a({})}},Object(o.memo)(U))},2064:function(e,t,a){"use strict";a.d(t,"a",(function(){return V}));a(59),a(10),a(11);var o=a(100),r=a.n(o),n=a(149),l=a.n(n),i=a(250),c=a.n(i),s=a(1325),d=a(2383),u=a(130),m=a(81),p=a(0),g=a.n(p),b=a(97),y=a(51),v=a(105),f=a(40),h=a(44),C=a(5),O=a(67),x=a(6),k=a(47),P=a(74),j=a(1),E=a(21),S=a(60),w=a(35),D=a(3),N=a(15),R=a(27),L=a(19);function T(e,t,a,o,r){var n;const{model:l}=r.lang(),i=!t.isOption&&"NOT"!==(null===(n=t.optionStatus)||void 0===n?void 0:n.statusTypeCode),c={reactKeyPrefix:e,disableUpdate:!0,fieldOptions:[{fieldName:"isOption",label:l.optional,onUpdateOverride:a.bind(null,"isOption")},{fieldName:"optionStatus",disabled:!t.isOption,label:l.optionStatus,typeaheadProps:{fields:{statusTypeDesc:"*",statusTypeCode:"*"},query:"filter=statusClass.statusClassCode(EQ)OPT",shouldPreload:!0,isClearable:!1},onUpdateOverride:a.bind(null,"optionStatus"),breakpoints:{xs:12,sm:12,md:12,lg:8,xl:8},formHelperText:i?l.declaredAndForfeitedNotApplicable:"",formControlProps:{error:i}}],object:t,type:j.a.cargo,userLocale:o};return Object(L.a)(c)}var A=a(732),I=a(20),F=a(1967),M=function(e,t,a,o){return new(a||(a=Promise))((function(r,n){function l(e){try{c(o.next(e))}catch(e){n(e)}}function i(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(l,i)}c((o=o.apply(e,t||[])).next())}))};const B=new P.a({});function K(e){var t;const{reactKeyPrefix:a,userLocale:o,voyage:n,state:{voyages:i}}=e,[k,P,E]=Object(x.a)([D.a.IInternationalization,I.a.IVoyageDrawerController,I.a.IDrawerStatusController]),{common:L,model:A,voyages:K}=k.getLanguageFile(),V=Object(b.g)(),$=Object(b.h)(),[z,H]=Object(p.useState)(!1),[U,W]=Object(p.useState)([]),[_,q]=Object(p.useState)(!1),[J,G]=Object(p.useState)(!1),[Q,X]=Object(p.useState)(!1),Z=Object(p.useCallback)(e=>M(this,void 0,void 0,(function*(){e.voyageHeader&&P.getVoyagesLinkedToATemplate(e.voyageHeader,()=>X(!0))})),[P]),Y=null!==(t=E.getStatusesByClassCode("OPT").find(e=>"NOT"===e.statusTypeCode))&&void 0!==t?t:null;Object(p.useEffect)(()=>{Z(n)},[]);const ee=[{content:A.vessel,contentType:C.a.TEXT},{content:A.referenceNumber,contentType:C.a.TEXT},{content:A.voyageStartDate,contentType:C.a.DATE,dateTimeFormatOptions:w.a.longLocalizedDate},{content:A.laycanFrom,sortDirection:C.e.ASCENDING,contentType:C.a.DATE,dateTimeFormatOptions:w.a.longLocalizedDate},{content:A.laycanTo,contentType:C.a.DATE,dateTimeFormatOptions:w.a.longLocalizedDate},{content:A.voyageStatus,contentType:C.a.ELEMENT},{content:A.optional,contentType:C.a.ELEMENT},{content:A.optionStatus,contentType:C.a.ELEMENT},{content:A.comments,contentType:C.a.TEXT}],te=Object(p.useMemo)(()=>{var e,t,a;const o=[];if(i&&i.length>0)for(const r of i){const n=Object(m.a)(r,"vessel.vesselName",""),l=Object(m.a)(r,"voyageHeader.referenceNo",""),i=null===(e=r.voyageHeader)||void 0===e?void 0:e.voyageStartDate,c=S.a.getPerformanceCargo(r.cargos),{laycanFrom:d,laycanTo:u}=c,p=Object(m.a)(r,"voyageHeader.voyageStatus.statusTypeDesc",""),b=null!==(a=null===(t=c.optionStatus)||void 0===t?void 0:t.statusTypeDesc)&&void 0!==a?a:A.notDeclared,y={content:[n,l,i,d,u,g.a.createElement(f.a,{label:p,priority:v.a.getStatusPriority(p,j.a.voyage),"data-cell-value":p}),g.a.createElement(s.a,{checked:c.isOption,disabled:!0,"data-cell-value":c.isOption}),g.a.createElement(f.a,{label:b,priority:v.a.getOptionalStatusPriority(b),"data-cell-value":b}),Object(m.a)(r,"comments","")],id:r.key};o.push(y)}return o},[i,A.notDeclared]),ae=Object(p.useCallback)(e=>{R.a.openDrawer(e,N.a.voyageDrawer,$,V)},[V,$]),oe=Object(p.useCallback)(()=>M(this,void 0,void 0,(function*(){Z(n)})),[Z,n]),re=Object(p.useCallback)(()=>{var e;P.copyVoyage(n,!(null===(e=null==n?void 0:n.voyageHeader)||void 0===e?void 0:e.isBudget),oe)},[oe,P,n]),ne=Object(p.useCallback)(()=>M(this,void 0,void 0,(function*(){H(!z)})),[z]),le=Object(p.useMemo)(()=>[{disabled:!1,onClick:()=>{},icon:r.a,iconButtonProps:{color:"primary","aria-label":`${L.add} ${K.budgetedVoyage}`},label:""+L.add,reactKeyPrefix:a+"-primary-actions",secondaryActions:[{onClick:re,text:K.addVoyage},{onClick:ne,text:K.addMultipleVoyages}]}],[L.add,re,a,ne,K]),ie=Object(p.useCallback)(()=>{q(e=>!e)},[]),ce=Object(p.useCallback)(e=>{W(e),ie()},[ie]),se=Object(p.useCallback)(e=>{W(e),G(!0)},[]),de=Object(p.useCallback)(()=>G(!1),[]),ue=Object(p.useMemo)(()=>[{reactKeyPrefix:a+"-option-status-selected-action",label:A.editOptionStatus,icon:c.a,onClick:se},{icon:l.a,iconButtonProps:{"aria-label":L.delete},label:L.delete,onClick:ce,reactKeyPrefix:a+"-delete-selected-action"}],[L.delete,A.editOptionStatus,se,ce,a]),me=Object(p.useCallback)(()=>M(this,void 0,void 0,(function*(){ie(),yield P.deleteVoyages(U),Z(n)})),[P,Z,U,ie,n]),pe=Object(p.useCallback)(e=>M(this,void 0,void 0,(function*(){G(!1),yield P.updateOptionStatus(e.isOption,e.optionStatus,i.filter(e=>U.includes(e.key)).map(e=>S.a.getPerformanceCargo(e.cargos).key)).then(oe)})),[oe,P,i,U]),ge=Object(p.useCallback)(e=>{var t;return!e.isOption&&"NOT"!==(null===(t=e.optionStatus)||void 0===t?void 0:t.statusTypeCode)},[]),be=Object(p.useMemo)(()=>{var e,t,a;const o=i.filter(e=>U.includes(e.key)),r=(null===(t=null===(e=o[0])||void 0===e?void 0:e.cargos)||void 0===t?void 0:t.length)?S.a.getPerformanceCargo(o[0].cargos):null;return{optionStatus:null!==(a=null==r?void 0:r.optionStatus)&&void 0!==a?a:Y,isOption:null==r?void 0:r.isOption}},[Y,i,U]);return g.a.createElement(g.a.Fragment,null,Q?g.a.createElement(O.a,{headers:ee,data:te,reactKeyPrefix:a+"-table",userLocale:o,customisation:{responsive:!0},onRowClick:ae,primaryActions:le,selectable:!0,selectedActions:ue}):g.a.createElement(d.a,{variant:"rectangular",height:95.5}),z&&g.a.createElement(F.a,{open:z,onClose:ne,onConfirm:ne,onSuccess:oe,voyage:n,reactKeyPrefix:a+"-create-multiple-voyages"}),_&&g.a.createElement(h.a,{reactKeyPrefix:a+"-delete-selected",open:_,onCloseModal:ie,onConfirm:me,title:L.delete,confirmBtnName:L.delete,maxWidth:"xs"},g.a.createElement(u.a,null,L.deleteConfirmationVoyages)),J&&g.a.createElement(y.a,{modalProps:{reactKeyPrefix:a+"edit-scheduled-voyages-option-status-modal",open:J,maxWidth:"xs",title:A.editOptionStatus,onCloseModal:de,confirmBtnName:L.save},getColSpec:T,propertiesToSet:be,updateProps:{objToUpdate:B,type:j.a.cargo},overrideOnConfirm:pe,isConfirmDisabled:ge}))}const V=Object(k.a)(e=>({voyages:E.a.getTSModelsBuilt(e,j.a.voyage,A.b,A.a)}),Object(p.memo)(K))},2074:function(e,t,a){"use strict";a.d(t,"a",(function(){return f}));a(10),a(11);var o=a(0),r=a.n(o),n=a(323),l=a(63),i=a(19),c=a(1),s=a(62),d=a(50),u=a(181);var m=a(37),p=a(12),g=a(6),b=a(3),y=a(20),v=a(180);const f=e=>{const{reactKeyPrefix:t,voyage:a,userLocale:o}=e,[f,h]=Object(g.a)([b.a.IInternationalization,y.a.IVoyageDrawerController]),{model:C}=f.getLanguageFile();return r.a.createElement(v.a,{title:C.speedAndConsumption,reactKeyPrefix:t+"-speed-and-consumption-section",defaultCollapsed:!0},r.a.createElement(m.a,{reactKeyPrefix:t+"field-list",items:(e=>{const{voyage:t,reactKeyPrefix:a,userLocale:o,i:m,controller:p}=e,{model:g,common:b,vessel:y}=m.getLanguageFile(),v=d.a.getSpeedRef(t.partOfSchedule,!0),f=d.a.getSpeedRef(t.partOfSchedule,!1),h=u.a.getSpeeds(t.vessel,!0),C=u.a.getSpeeds(t.vessel,!1),O={reactKeyPrefix:a,fieldOptions:[{fieldName:"speed",label:g.speedBallast,overrideFieldType:"object",typeaheadProps:{defaultSelectedOptions:v||{text:b.multiple},options:h,isClearable:!1,resolver:e=>v?e.speed+" "+l.a.Knot+" "+e.foConsumption+" "+l.a.Weight:e.text,noOptionsMessage:()=>y.noSpeedOption},overrideObject:v||{text:b.multiple},overrideType:c.a.speed,disabled:!v,onUpdateOverride:e=>p.onChangeSpeed(t,!0,e)},{fieldName:"speed",label:g.speedLaden,overrideFieldType:"object",typeaheadProps:{defaultSelectedOptions:f||{text:b.multiple},options:C,isClearable:!1,resolver:e=>f?e.speed+" "+l.a.Knot+" "+e.foConsumption+" "+l.a.Weight:e.text,noOptionsMessage:()=>y.noSpeedOption},overrideObject:f||{text:b.multiple},overrideType:c.a.speed,disabled:!f,onUpdateOverride:e=>p.onChangeSpeed(t,!1,e)},{fieldName:"doAtSea",label:g.mgoAtSea,InputProps:{endAdornment:b.mt}},{fieldName:"",overrideComponent:r.a.createElement(n.a,null)},{fieldName:"foInPort",label:g.foPortIdle,InputProps:{endAdornment:b.mtDay}},{fieldName:"foInPortWorking",label:g.foPortWorking,InputProps:{endAdornment:b.mtDay}},{fieldName:"doInPort",label:g.mgoPortIdle,InputProps:{endAdornment:b.mtDay}},{fieldName:"doInPortWorking",label:g.mgoPortWorking,InputProps:{endAdornment:b.mtDay}},{fieldName:"foHeating",label:g.heating,InputProps:{endAdornment:b.mtDay}},{fieldName:"daysHeating",label:b.days},{fieldName:"foInerting",formControlProps:{required:!1},InputProps:{endAdornment:b.mtDay}},{fieldName:"daysInertingFo",label:b.days,formControlProps:{required:!1}},{fieldName:"foCleaning",label:g.cleaning,InputProps:{endAdornment:b.mtDay}},{fieldName:"daysCleaning",label:b.days},{fieldName:"doInerting",label:g.mgoInerting,formControlProps:{required:!1},InputProps:{endAdornment:b.mtDay}},{fieldName:"daysInertingDo",label:b.days,formControlProps:{required:!1}}],object:new s.a(t),type:c.a.voyage,userLocale:o,smartResponse:!0};return Object(i.a)(O)})({reactKeyPrefix:t,voyage:a,userLocale:o,i:f,controller:h}),breakpoints:p.h}))}},2075:function(e,t,a){"use strict";a.d(t,"a",(function(){return M}));a(10),a(11);var o=a(371),r=a.n(o),n=a(246),l=a(1329),i=a(0),c=a.n(i),s=a(97),d=a(37),u=a(12),m=a(180),p=a(6),g=a(3),b=a(15),y=a(27),v=(a(59),a(107)),f=a(1),h=a(199),C=a(19),O=a(63),x=a(85),k=a(276),P=a(220),j=a(7),E=a(84),S=a(86),w=a(198),D=a(96),N=a(530),R=a(30),L=a(131),T=function(e,t,a,o){return new(a||(a=Promise))((function(r,n){function l(e){try{c(o.next(e))}catch(e){n(e)}}function i(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(l,i)}c((o=o.apply(e,t||[])).next())}))};function A(e,t,a,o,r){return T(this,void 0,void 0,(function*(){const n=null==o?void 0:o.portCallsFromVoyage.find(e=>{var a;return(null===(a=e.reasonForCall)||void 0===a?void 0:a.reasonForCall)===t}),l="DEL"===t?"deliveryPort":"redeliveryPort";try{n&&(yield e.updateSingleAction({type:f.a.portcall,key:n.key,data:{port:r}}),yield e.updateSingleAction({type:f.a.tc,key:a.key,data:{[l]:r}}),(null==o?void 0:o.key)&&(yield e.loadSingleAction({type:f.a.voyage,key:null==o?void 0:o.key,fields:v.n})))}catch(e){E.a.error(e)}}))}function I(e,t,a,o,r,n){var i,c,s,d,u,m,E,T,I,F,M;const[B,K]=Object(p.a)([g.a.IInternationalization,j.a.ITSModelActionsAsync]);if(!e)return[];const V=null!==(i=Object(l.a)(e.tcDurations,"sequenceNo")[0])&&void 0!==i?i:new k.a({}),$=null!==(c=Object(l.a)(V.tcRates,"sequenceNo")[0])&&void 0!==c?c:new P.a({}),z=null!==(d=null===(s=e.tcDurations[0])||void 0===s?void 0:s.tcDurationTimeUnit)&&void 0!==d?d:w.b.DAY,H=null!==(E=null===(m=null===(u=null==o?void 0:o.voyageHeader)||void 0===u?void 0:u.voyageStatus)||void 0===m?void 0:m.statusTypeCode)&&void 0!==E?E:"",U=["EST","SCU","SCH"].includes(H),W=e.tcDurations.length>1,_=void 0!==e.tcDurations.find(e=>e.tcRates.length>1),q=0===$.key||!["EST","SCU"].includes(H)||W||_,J=Object(h.a)(t,[{fieldName:"deliveryPort",label:B.lang().model.deliveryPort,typeaheadProps:{query:D.d},onUpdateOverride:t=>A(K,"DEL",e,o,t.key)},{fieldName:"redeliveryPort",label:B.lang().model.redeliveryPort,typeaheadProps:{query:D.d},onUpdateOverride:t=>A(K,"RED",e,o,t.key)},{fieldName:"charterer",label:B.lang().model.charterer,typeaheadProps:{shouldPreload:!0,objectPaths:S.b.businessPartner,query:D.b},openObject:{permissions:[R.a.BusinessPartnerGET],onOpen:y.a.openDrawer.bind(null,null===(T=e.charterer)||void 0===T?void 0:T.key,b.a.businessPartnerDrawer)},breakpoints:{xs:10,sm:10,md:10,lg:10,xl:10}},{fieldName:"isBareboat",label:B.lang().model.bareboat,formControlLabelProps:{classes:n,labelPlacement:"top"},breakpoints:{xs:2,sm:2,md:2,lg:2,xl:2}},{fieldName:"tcRateDuration",label:B.lang().model.duration,disabled:q,overrideObject:$,overrideType:f.a.tcrate,InputProps:{endAdornment:Object(N.a)(B)[z]},onUpdateOverride(e){(e=>{e&&$.key&&K.updateSingleAction({type:f.a.tcrate,key:$.key,data:{tcRateDuration:e},headers:L.a.smartJson,callback:()=>{(null==o?void 0:o.key)&&K.loadSingleAction({type:f.a.voyage,key:o.key,fields:{partOfSchedule:{eventLogs:v.b}}})}})})(e)}},{fieldName:"tcRate",label:B.lang().model.rate,disabled:q,overrideObject:$,overrideType:f.a.tcrate,InputProps:{endAdornment:null===(I=e.currency)||void 0===I?void 0:I.currencyCode}},{fieldName:"commissionBroker",label:B.lang().model.commissionBroker,disabled:(null===(F=null==e?void 0:e.commissions)||void 0===F?void 0:F.length)>0,InputProps:{endAdornment:O.a.Percent},numberInputProps:{validation:[{type:x.a.RANGE,min:0,max:100}],maskSettings:{decimalScale:2,allowNegative:!1}}},{fieldName:"commissionAddress",label:B.lang().model.commissionAddress,InputProps:{endAdornment:O.a.Percent},numberInputProps:{validation:[{type:x.a.RANGE,min:0,max:100}],maskSettings:{decimalScale:2,allowNegative:!1}}},{fieldName:"calculateProfitLoss",label:B.lang().model.calculateProfitLoss,disabled:!U,formControlLabelProps:{classes:n,labelPlacement:"top"}}]);return Object(C.a)({fieldOptions:J,object:e,parentData:{key:null!==(M=null==o?void 0:o.key)&&void 0!==M?M:-1,type:f.a.voyage},type:f.a.tc,userLocale:a,reactKeyPrefix:r,smartResponse:!0})}var F=a(411);const M=c.a.memo(e=>{const{voyage:t,userLocale:a,reactKeyPrefix:o,user:v}=e,f=Object(s.g)(),h=Object(s.h)(),[C]=Object(p.a)([g.a.IInternationalization]),O=Object(F.a)({}),[x]=Object(l.a)(null==t?void 0:t.tcs,"key").slice(-1),k=I(x,v,a,t,o,O),P=Object(i.useCallback)(e=>{e.stopPropagation(),y.a.openDrawer(null==x?void 0:x.key,b.a.tcDrawer,h,f)},[f,h,x]);return c.a.createElement(m.a,{title:C.lang().model.tcContract,reactKeyPrefix:o+"-section",headerElements:c.a.createElement(n.a,{onClick:P,id:o+"-open-contract",sx:{my:-1}},c.a.createElement(r.a,null))},c.a.createElement(d.a,{reactKeyPrefix:o+"horizontal_list",key:o+"horizontal_list",items:k,breakpoints:u.h}))})},318:function(e,t,a){"use strict";a.d(t,"b",(function(){return v})),a.d(t,"a",(function(){return f})),a.d(t,"i",(function(){return O})),a.d(t,"k",(function(){return x})),a.d(t,"l",(function(){return k})),a.d(t,"g",(function(){return E})),a.d(t,"d",(function(){return S})),a.d(t,"e",(function(){return w})),a.d(t,"f",(function(){return D})),a.d(t,"j",(function(){return R})),a.d(t,"h",(function(){return L})),a.d(t,"c",(function(){return I}));a(59),a(10),a(11),a(268),a(269),a(118);var o=a(265),r=a(125),n=a.n(r),l=a(6),i=a(3),c=a(26),s=a(68),d=a(60),u=a(81),m=a(91),p=a(123),g=a(50),b=a(38),y=function(e,t,a,o){return new(a||(a=Promise))((function(r,n){function l(e){try{c(o.next(e))}catch(e){n(e)}}function i(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(l,i)}c((o=o.apply(e,t||[])).next())}))};const v="remove-button-id-voyage-rp-",f="map-pop-up-divider";function h(e){return v+e}function C(e,t){return n.a.divIcon({className:t,iconSize:[20,20],iconAnchor:[0,20],popupAnchor:[1,-20],html:`<div style="color:white;transform:rotate(45deg);display:inline-block;min-width:21px">${e}</div>`})}function O(e,t,a,o){var r;const[n]=Object(l.a)([i.a.IInternationalization]),d=[];let u=t.portCallMarker;const m=e.partOfSchedule.find(e=>1===e.portCallSequence),p=e.ballastPort&&m&&m.port&&m.port.key===e.ballastPort.key;if(e){if(e.ballastPort&&!p){const a=j(e,new s.a({}),{portCallMarker:u,popup:t.popup},n);d.push(...a)}(null!==(r=e.partOfSchedule)&&void 0!==r?r:[]).forEach(r=>{var l,i,s;if(r.port){u=function(e,t){var a,o;return null!==e.ownedByVoyage&&e.ownedByVoyage.key!==(null===(a=e.voyage)||void 0===a?void 0:a.key)&&(null===(o=e.voyage)||void 0===o?void 0:o.key)===t.key}(r,e)?Object(c.default)(t.portCallMarker,t[null!==(s=a[null!==(i=null===(l=null==r?void 0:r.ownedByVoyage)||void 0===l?void 0:l.key)&&void 0!==i?i:0])&&void 0!==s?s:""]):t.portCallMarker;const m=j(e,r,{portCallMarker:u,popup:t.popup},n,o);d.push(...m)}})}return d}function x({voyage:e,routingPoints:t,classNames:a,i:r,userLocale:n},l,i,c){const s=N(e);return t.flatMap(e=>o.a.getMarkerCoordinates(e).map(t=>{const o="add-button-id-"+e.key,d=P({i:r,userLocale:n,coordinate:t,routingPointPort:e,isVoyageRoutingPoint:!1,classNames:a,addButtonId:o,showAddButton:!0,onClickAdd:l}).on("mouseover",()=>{d.setRadius(8),d.bringToFront()}).on("mouseout",()=>{d.setRadius(5)}).on("click",()=>{i(s),c(s[0])});return d}))}function k({voyageRoutingPoints:e,routingPointMarkers:t,onClickAdd:a,onClickRemove:r},n,l){const{voyage:i,routingPoints:c,classNames:s,i:d,userLocale:u}=t;return e.flatMap(t=>o.a.getMarkerCoordinates(t).map(o=>{var p;const b="add-button-id-voyage-rp-"+t.key,y=null!==(p=c.find(e=>e.latitude===t.latitude&&e.longitude===t.longitude))&&void 0!==p?p:new m.a({}),v=N(i,t),f=function(e,t,a){const o=Array.from(e.partOfSchedule.sort(g.a.sortByPortCallSequence)),r=o.filter(e=>e.routingPoints.some(e=>{var o;return(null!==(o=t.find(t=>t.latitude===e.latitude&&t.longitude===e.longitude))&&void 0!==o?o:new m.a({})).key===a.key}));if(r)return r.map(t=>{var r,n,l,i;const c=o.indexOf(t);return 0===c?{from:null!==(r=e.ballastPort)&&void 0!==r?r:new m.a({}),to:null!==(n=o[c].port)&&void 0!==n?n:new m.a({}),portCall:o[c],port:a}:{from:null!==(l=o[o.indexOf(t)-1].port)&&void 0!==l?l:new m.a({}),to:null!==(i=t.port)&&void 0!==i?i:new m.a({}),portCall:t,port:a}});return}(i,c,y);let C="";f&&(C=function(e,t,a,o){const r=[];return o.forEach((o,n)=>{var l,i,c,s,d,u;const m=h(null!==(i=null===(l=o.portCall.routingPoints.find(e=>e.latitude===o.port.latitude&&e.longitude===o.port.longitude))||void 0===l?void 0:l.key)&&void 0!==i?i:""),{arrivalFixed:p}=o.portCall;null==r||r.push(`\n        <p id="route-direction-paragraph">${n+1} - ${null!==(s=null===(c=o.from)||void 0===c?void 0:c.portName)&&void 0!==s?s:""}-${null!==(u=null===(d=o.to)||void 0===d?void 0:d.portName)&&void 0!==u?u:""}</p>\n        <button id=${m} class=${p?a:t}>${e.getLanguageFile().common.remove}</button>\n        `)}),r.join("")}(d,s.markerButton,s.disabledButton,f));const O=P({i:d,userLocale:u,coordinate:o,routingPointPort:y,isVoyageRoutingPoint:!0,classNames:s,addButtonId:b,showAddButton:!!(null==v?void 0:v.length),adjacentPortsHTML:C,onClickAdd:a,onClickRemove:r,voyageRoutingPoints:e,adjacentPorts:f}).on("mouseover",()=>{O.setRadius(8),O.bringToFront()}).on("mouseout",()=>{O.setRadius(5)}).on("click",()=>{n(v),l(v[0])});return O}))}function P({i:e,userLocale:t,coordinate:a,routingPointPort:o,isVoyageRoutingPoint:r,classNames:l,addButtonId:i,showAddButton:c,adjacentPortsHTML:s,onClickAdd:d,onClickRemove:u,voyageRoutingPoints:m,adjacentPorts:g}){const{routingPoint:y}=e.getLanguageFile();return n.a.circleMarker(a,{color:r?b.b.bergenRain.primary:b.b.orangeSky.secondary[3],fillColor:r?"white":b.b.sunriseYellow.secondary[2],fillOpacity:.9,radius:5,weight:r?2:1}).bindPopup(function({port:e,i:t,userLocale:a,className:o,isVoyageRoutingPoint:r,addButtonId:n,showAddButton:l,adjacentPortsHTML:i}){const{common:c}=t.lang(),s=e=>p.a.formatNumberLocalized(e,a.isoCode,{maxDecimals:6,minDecimals:1}),d=e=>p.a.formatNumberLocalized(e,a.isoCode,{maxDecimals:1,minDecimals:0});return`\n        <table width=100%>\n        <tr><th colspan="2" style="text-align:start">\n        ${null==e?void 0:e.portName}</th></tr>\n                    <tr>\n                        <td style="text-align:start">${c.latitude}:</td>\n                        <td style="padding-left:8px;font-weight:bold;text-align:end">${s(null==e?void 0:e.latitude)}\n                        </td>\n                    </tr>                    \n                    <tr>\n                    <td style="text-align:start">${c.longitude}:</td>\n                    <td style="padding-left:8px;font-weight:bold;text-align:end">${s(null==e?void 0:e.longitude)}</td>\n                    </tr>\n                    <tr>\n                    <td style="text-align:start">${c.gmtOffset}:</td>\n                        <td style="padding-left:8px;font-weight:bold;text-align:end">${(null==e?void 0:e.timezoneOffset)>0?"+"+d(null==e?void 0:e.timezoneOffset):d(null==e?void 0:e.timezoneOffset)}</td>\n                            </tr>                     \n                            <tr>\n                            <td style="text-align:start">${c.rpCode}:</td>\n                        <td style="padding-left:8px;font-weight:bold;text-align:end">${null==e?void 0:e.rpCode}</td>\n                        </tr>                                                     \n                        </table>\n                        ${l?`<button id=${n} class=${o}>${c.addToRoute}</button>`:""}\n                        ${r&&i?`<hr id=${f}>\n                                ${i}`:""}`}({port:o,i:e,userLocale:t,className:l.markerButton,isVoyageRoutingPoint:r,addButtonId:i,showAddButton:c,adjacentPortsHTML:s}),{autoClose:!1,closeButton:!1,autoPan:!1,className:l.popup}).addEventListener("popupopen",()=>{var e;null===(e=document.getElementById(i))||void 0===e||e.addEventListener("click",()=>d(o)),m&&u&&m.forEach(e=>{var t,a,r,n,l,i,c;const s=h(null!==(t=e.key)&&void 0!==t?t:""),d=null==g?void 0:g.find(t=>t.portCall.routingPoints.find(t=>t.key===e.key)),m=d?y.removeRoutingPointMessage((null!==(a=null==g?void 0:g.indexOf(d))&&void 0!==a?a:0)+1,null!==(r=o.portName)&&void 0!==r?r:"",null!==(n=null==d?void 0:d.from.portName)&&void 0!==n?n:"",null!==(l=null==d?void 0:d.to.portName)&&void 0!==l?l:""):null!==(i=o.portName)&&void 0!==i?i:"";null===(c=document.getElementById(s))||void 0===c||c.addEventListener("click",()=>{(null==d?void 0:d.portCall.arrivalFixed)||u(e,m)})})})}function j(e,t,a,r,l){var i;const c=[];let s=[];if(e.ballastPort&&!t.portCallSequence){s=o.a.getMarkerCoordinates(e.ballastPort);for(const t of s)c.push(n.a.marker(t,{icon:C("B",a.portCallMarker),riseOnHover:!0,rotationAngle:-45,opacity:.9}).bindPopup(e.ballastPort.portName,{closeButton:!1,className:a.popup}))}else t.portCallSequence&&(null!==(i=e.partOfSchedule)&&void 0!==i?i:[]).forEach(e=>{if(e.port&&e===t){s=o.a.getMarkerCoordinates(e.port);const t=function(e,t){var a;const o=function(e,t){var a,o,r,n,l,i;const{model:c}=t.lang();return[{data:[{label:c.voyageNo,value:null!==(r=null===(o=null===(a=e.ownedByVoyage)||void 0===a?void 0:a.voyageHeader)||void 0===o?void 0:o.referenceNo)&&void 0!==r?r:""},{label:c.reasonForCall,value:null!==(l=null===(n=e.reasonForCall)||void 0===n?void 0:n.reasonForCall)&&void 0!==l?l:void 0},{label:c.portCost,value:null!==(i=e.portCost)&&void 0!==i?i:void 0},{label:c.daysInPort,value:e.daysInPort?A(e.daysInPort,t):void 0}]}]}(e,t);return`\n                <table>\n                    <tr><th colspan="2" style="text-align:start">\n                    ${null===(a=null==e?void 0:e.port)||void 0===a?void 0:a.portName}</th></tr>\n                    ${o[0].data.map(({label:e,value:t})=>`\n                                <tr>\n                                    <td style="text-align:start">${e}</td>\n                                    <td style="padding-left:8px;font-weight:bold;text-align:end">${t}</td>\n                                </tr>`).join("")}\n                </table>\n            `}(e,r);for(const o of s)c.push(n.a.marker(o,{icon:C(e.portCallSequence,a.portCallMarker),riseOnHover:!0,rotationAngle:-45,opacity:.9}).bindPopup(t,{closeButton:!1,className:a.popup}).on("click",()=>{l&&l(e)}))}});return c}const E=e=>e.partOfSchedule.sort(g.a.sortByPortCallSequence).flatMap(e=>e.portCallRoutes.filter(e=>e.isSelected).flatMap(e=>e.geoJson)),S=e=>{if(e.length)return e.flatMap(e=>{const t=JSON.parse(atob(e)),a=Object(u.a)(t,"paths",null);if(a){return{type:"Feature",geometry:{type:"LineString",coordinates:o.a.increaseLongitudeInArrayIfBelowZero(a[0].points.coordinates)}}}})},w=(e,t,a,o,r,l)=>{const i=new n.a.LayerGroup;return e.partOfSchedule.sort(g.a.sortByPortCallSequence).forEach(c=>{c.portCallRoutes.forEach(s=>{if(!s.isSelected&&!c.arrivalFixed){const d=n.a.geoJSON(S([s.geoJson]),{style:{color:b.b.bergenRain.secondary[6],weight:5}});t[c.key].route.key===s.key&&(d.setStyle({color:b.b.navigator.primary}),d.bindPopup(((e,t,a,o)=>{var r,n;const{common:l,model:i}=o.getLanguageFile(),c=o.formatNumber(e.distance,{maxDecimals:0}),s=((t=Math.round(t))>0?"+":t<0?"-":"")+o.formatNumber(Math.abs(t),{maxDecimals:0}),d=null!==(n=null===(r=a.voyageCurrency)||void 0===r?void 0:r.currencyCode)&&void 0!==n?n:"",u=document.createElement("div");u.style.display="flex",u.style.flexDirection="column",u.style.whiteSpace="nowrap";const m=document.createElement("div");m.style.display="flex";const p=document.createElement("div");p.style.flex="1",p.style.paddingRight="10px",p.textContent=i.estDistance;const g=document.createElement("div");g.style.flex="1",g.style.textAlign="right",g.textContent=c+" "+l.nm,m.appendChild(p),m.appendChild(g);const b=document.createElement("div");b.style.display="flex";const y=document.createElement("div");y.style.flex="1",y.style.paddingRight="10px",y.textContent=i.tceDiff;const v=document.createElement("div");return v.style.flex="1",v.style.textAlign="right",v.textContent=s+" "+d,b.appendChild(y),b.appendChild(v),u.appendChild(m),u.appendChild(b),u.outerHTML})(t[c.key].route,t[c.key].tceDiff,e,a),{closeButton:!1,className:o}),l&&l===s.key&&d.on("add",()=>{d.openPopup()})),d.on("click",()=>{r(s.key,c.key)}),i.addLayer(d)}})}),i};function D(e){if(e&&e.partOfSchedule){const t=new Map;return d.a.getOverlappingVoyagesLinkedToAVoyage(e).forEach(e=>y(this,void 0,void 0,(function*(){const a=E(e);if(a.length>0){const r=a.flatMap(e=>{const t=JSON.parse(atob(e)),a=Object(u.a)(t,"paths",null);if(a)return{type:"LineString",coordinates:o.a.increaseLongitudeInArrayIfBelowZero(a[0].points.coordinates)}});t.set(e.key,r)}}))),t}}function N(e,t){const a=e.partOfSchedule.filter(e=>!e.arrivalFixed);if(t){a.unshift(new s.a({port:e.ballastPort}));const o=a.filter(e=>e.routingPoints.every(e=>e.longitude!==t.longitude&&e.latitude!==t.latitude));return o.slice(1,o.length).map((t,r)=>{var n,l;const i=a.indexOf(t);return{label:r+1+" - "+(null!==(n=Object(u.a)(a,`[${i}].previousPortCall.port.portName`))&&void 0!==n?n:null===(l=e.ballastPort)||void 0===l?void 0:l.portName)+"–"+Object(u.a)(a,`[${i}].port.portName`),value:o[r+1].key}})}return a.unshift(new s.a({port:e.ballastPort})),a.slice(0,a.length-1).map((t,o)=>{var r,n;return{label:o+1+" - "+(null!==(r=Object(u.a)(a,`[${o+1}].previousPortCall.port.portName`))&&void 0!==r?r:null===(n=e.ballastPort)||void 0===n?void 0:n.portName)+"–"+Object(u.a)(a,`[${o+1}].port.portName`),value:a[o+1].key}})}function R(e,t){const a=[],o=e.portCallsFromVoyage.find(e=>1===e.portCallSequence),r=e.ballastPort&&o&&o.port&&o.port.key===e.ballastPort.key;if(e){if(e.ballastPort&&!r){const o=T(e.ballastPort,"B",t);if(o.length>0)for(const e of o)a.push(e)}e.partOfSchedule&&e.partOfSchedule.forEach(e=>{if(e.port){const o=T(e.port,e.portCallSequence,t);if(o.length>0)for(const e of o)a.push(e)}})}return a}function L(e){return e.sort(g.a.sortByPortCallSequence).find(e=>!e.arrivalFixed)}function T(e,t,a){const r=o.a.getMarkerCoordinates(e),l=[];for(const o of r)l.push(n.a.popup({autoClose:!1,closeButton:!1,autoPan:!1,className:a}).setLatLng(o).setContent(`${t}. ${e.portName}`));return l}function A(e,t){return t.formatNumber(e,{maxDecimals:2,minDecimals:2})}const I=e=>{const t={};for(const[a,o]of e)t[a]=o;return t}},732:function(e,t,a){"use strict";a.d(t,"a",(function(){return o})),a.d(t,"b",(function(){return r}));const o="VOYAGE_DRAWER_SCHEDULED_VOYAGES_LIST",r={key:"*",voyageHeader:{voyageStartDate:"*",voyageStatus:{statusTypeDesc:"*"},referenceNo:"*"},cargos:{cargoQuantity:"*",cargoType:{cargoTypeCode:"*"},isPerformanceCargo:"*",laycanFrom:"*",laycanTo:"*",reletOfCargo:"*",tsOfCargoPort:{cargo:"*",reasonForCall:{reasonForCall:"*"}},voyage:"*",isOption:"*",optionStatus:{statusTypeDesc:"*",statusTypeCode:"*"}},vessel:{vesselName:"*"},comments:"*"}},852:function(e,t,a){"use strict";a.d(t,"a",(function(){return ee}));a(59),a(10),a(11),a(268),a(269);var o=a(1789),r=a.n(o),n=a(1788),l=a.n(n),i=a(1323),c=a(977),s=a(26),d=a(125),u=a.n(d),m=(a(1372),a(2304),a(981)),p=a(472),g=a(0),b=a.n(g),y=a(203),v=a.n(y),f=a(1205),h=a(102),C=a(114),O=a(44),x=a(6),k=a(47),P=a(68),j=a(1),E=a(21),S=(a(1003),a(137)),w=a(38),D=a(164),N=a(1316),R=a(60),L=a(3),T=a(213),A=a(187),I=a(81),F=a(135),M=a(230),B=a(169),K=a(243),V=a(843),$=a(20),z=a(130),H=a(23),U=a(107),W=a(318);const _=Object(T.a)(e=>Object(A.a)({flex:{display:"flex"}})),q=e=>{const{reactKeyPrefix:t,voyageKey:a,updateRestrictedAreas:o}=e,[r,n]=Object(x.a)([L.a.IInternationalization,$.a.IVoyageMapController]),l=Object(H.a)(E.a.getTSModelBuilt,j.a.voyage,a,{partOfSchedule:U.e}),i=localStorage.getItem("showOlra"),c=!i||JSON.parse(i),d=localStorage.getItem("showEca"),u=!d||JSON.parse(d),{model:m,common:p,canals:y}=r.getLanguageFile(),[v,f]=Object(g.useState)(null),[h,C]=Object(g.useState)(null),[O,k]=Object(g.useState)(null),[P,S]=Object(g.useState)(null),[w,D]=Object(g.useState)(!1),[N,R]=Object(g.useState)(!1),T=_({}),A=Object(W.h)((null==l?void 0:l.partOfSchedule)||[]),[q,J]=Object(g.useState)({ecaAvoidanceFactor:Object(I.a)(A,"ecaAvoidanceFactor",3),hraAvoidanceFactor:Object(I.a)(A,"hraAvoidanceFactor",1),allowPc:Object(I.a)(A,"allowPc",!1),allowSc:Object(I.a)(A,"allowSc",!1),allowKc:Object(I.a)(A,"allowKc",!1),allowNep:Object(I.a)(A,"allowNep",!0),allowNwp:Object(I.a)(A,"allowNwp",!0),allowTs:Object(I.a)(A,"allowTs",!0),allowCc:Object(I.a)(A,"allowCc",!0),showOlra:c,showEca:u});Object(g.useEffect)(()=>{var e;const t=null!==(e=!(null==l?void 0:l.partOfSchedule.some(e=>!e.arrivalFixed)))&&void 0!==e&&e;R(t)},[null==l?void 0:l.partOfSchedule]);const G=Object(g.useCallback)((e,t)=>{l&&(D(!0),n.updatePortCall(e,t,l,()=>D(!1)))},[n,l]),Q=Object(g.useCallback)((e,t)=>{try{localStorage.setItem(e,JSON.stringify(t)),o(e,t)}catch(e){}},[o]),X=Object(g.useCallback)((e,t)=>{J(a=>Object.assign(Object.assign({},a),{[e]:t})),["showOlra","showEca"].includes(e)?Q(e,!!t):["ecaAvoidanceFactor","hraAvoidanceFactor"].includes(e)||G(e,t)},[G,Q]),Z=Object(g.useCallback)(e=>{k(t=>null===t&&e?e.current:null)},[]),Y=Object(g.useCallback)(e=>{S(t=>null===t&&e?e.current:null)},[]),ee=Object(g.useCallback)(e=>{f(t=>null===t&&e?e.current:null)},[]),te=Object(g.useCallback)(e=>{C(t=>null===t&&e?e.current:null)},[]),ae=Object(g.useCallback)((e,a,o,r)=>b.a.createElement(V.a,{maxValue:"ecaAvoidanceFactor"===a?10:void 0,value:o||1,label:e,onChange:e=>X(a,e),onCommit:e=>G(a,e),onBlur:()=>{},disabled:r,reactKeyPrefix:t+"allow-"+Object(F.b)(e)}),[X,t]),oe=Object(g.useCallback)((e,a,o,r)=>b.a.createElement(B.a,{reactKeyPrefix:t+"allow-"+Object(F.b)(e),checked:o,onInputChange:e=>{X(a,e)},label:e,color:"primary",disabled:r}),[X,t]);return b.a.createElement("div",{className:Object(s.default)(T.flex)},b.a.createElement(z.a,{sx:{pr:1}},b.a.createElement(M.a,{items:[],label:m.restrictedAreas,onClickClear:()=>{},onClickOpen:e=>{Y(e)},reactKeyPrefix:t+"-restricted-areas-select-chip",selected:!1,selectedItems:[],filled:!0})),b.a.createElement(z.a,{sx:{pr:1}},b.a.createElement(M.a,{items:[],label:p.ecaAvoidance,onClickClear:()=>{},onClickOpen:e=>{ee(e)},reactKeyPrefix:t+"-eca-avoidence-select-chip",selected:!1,selectedItems:[],filled:!0})),b.a.createElement(z.a,{sx:{pr:1}},b.a.createElement(M.a,{items:[],label:p.hraAvoidance,onClickClear:()=>{},onClickOpen:e=>{te(e)},reactKeyPrefix:t+"-hra-avoidence-select-chip",selected:!1,selectedItems:[],filled:!0})),b.a.createElement(M.a,{items:[],label:p.allowance,onClickClear:()=>{},onClickOpen:e=>{Z(e)},reactKeyPrefix:t+"-allowance-select-chip",selected:!1,selectedItems:[],filled:!0}),b.a.createElement(K.a,{reactKeyPrefix:t+"-ECA-slider-action-menu",anchorEl:v,open:Boolean(v),title:p.eca,onCloseActionMenu:()=>{ee(null)}},ae(p.eca,"ecaAvoidanceFactor",q.ecaAvoidanceFactor,N||w)),b.a.createElement(K.a,{reactKeyPrefix:t+"-HRA-slider-action-menu",anchorEl:h,open:Boolean(h),title:p.hra,onCloseActionMenu:()=>{te(null)}},ae(p.hra,"hraAvoidanceFactor",q.hraAvoidanceFactor,N||w)),b.a.createElement(K.a,{reactKeyPrefix:t+"-slider-action-menu",anchorEl:O,open:Boolean(O),title:p.allowance,onCloseActionMenu:()=>{Z(null)}},oe(p.allow+" "+y.pc,"allowPc",q.allowPc,w),oe(p.allow+" "+y.sc,"allowSc",q.allowSc,w),oe(p.allow+" "+y.kc,"allowKc",q.allowKc,w),oe(p.allow+" "+y.ts,"allowTs",q.allowTs,w),oe(p.allow+" "+y.cc,"allowCc",q.allowCc,w),oe(p.allow+" "+y.nep,"allowNep",q.allowNep,w),oe(p.allow+" "+y.nwp,"allowNwp",q.allowNwp,w)),b.a.createElement(K.a,{reactKeyPrefix:t+"-restricted-areas-action-menu",anchorEl:P,open:Boolean(P),title:m.restrictedAreas,onCloseActionMenu:()=>{Y(null)}},oe(m.emissionControlAreas,"showEca",q.showEca,!1),oe(m.openLoopRestrictedAreas,"showOlra",q.showOlra,!1)))},J=Object(T.a)(e=>Object(A.a)({container:{maxHeight:"90vh",minHeight:240,position:"relative",top:0,width:"100%"},modalMapContainer:{position:"relative",top:"0",width:"100%",height:"100%"},map:{borderRadius:e.spacing(1.25),bottom:0,left:0,outline:"block",position:"absolute",right:0,top:0},fullscreenButton:{"&:hover":{cursor:"pointer"}},portCallMarker:{borderRadius:"50% 50% 50% 0",padding:"0 3px 3px 0",background:e.palette.grey[800],position:"absolute",left:"50%",top:"50%",margin:"-2.2em 0 0 -1.3em",boxShadow:"-1px 1px 4px rgba(0, 0, 0, .5)",WebkitBoxShadow:"-1px 1px 4px rgba(0, 0, 0, .5)",MozBoxShadow:"-1px 1px 4px rgba(0, 0, 0, .5)",textAlign:"center"},popupMain:{"&:hover":{zIndex:100},"& > *:first-child":{backgroundColor:e.palette.grey[800],color:"white"},"& > *:last-child":{"& > *:first-child":{backgroundColor:e.palette.grey[800]}}},popup:{"& .leaflet-popup-content-wrapper":{borderRadius:"4px"},"& button":{width:"100%"},[`& button:not([id*="${W.b}"])`]:{backgroundColor:e.palette.primary.main,color:"white"},["& #"+W.a]:{borderTop:"1px solid "+e.palette.grey[400],borderBottom:"none",borderLeft:"none",borderRight:"none",borderRadius:"1px",width:"100%",marginTop:"16px",marginBottom:"0px"},"& #route-direction-paragraph":{marginTop:"16px",marginBottom:"0px",fontWeight:"bold"}},routePopup:{"& .leaflet-popup-content-wrapper":{borderRadius:"4px",width:"auto !important",transform:"translateX(-40%)"},"& .leaflet-popup-content":{width:"auto !important",margin:"2px"}},markerButton:{display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",backgroundColor:"transparent",outline:0,marginTop:"4px",cursor:"pointer",userSelect:"none",verticalAlign:"middle",textDecoration:"none",fontFamily:"'Roboto','Helvetica','Arial', 'sans-serif'",fontWeight:500,fontSize:"0.875rem",lineHeight:1.75,letterSpacing:"0.02857em",textTransform:"uppercase",minWidth:"64px",padding:"5px 15px",borderRadius:"4px",transition:"background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms",border:"1px solid rgba(25, 118, 210, 0.5)",color:"#1976d2"},disabledButton:{display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",backgroundColor:"transparent",outline:0,marginTop:"4px",userSelect:"none",verticalAlign:"middle",textDecoration:"none",fontFamily:"'Roboto','Helvetica','Arial', 'sans-serif'",fontWeight:500,fontSize:"0.875rem",lineHeight:1.75,letterSpacing:"0.02857em",textTransform:"uppercase",minWidth:"64px",padding:"5px 15px",borderRadius:"4px",border:"1px solid "+e.palette.grey[400],color:e.palette.grey[400]},hide:{display:"none"},darkGreen:{background:w.b.greenSea.secondary[3]},indigo:{background:w.b.shipping.secondary[7]},violet:{background:w.b.shipping.secondary[4]},indigoBlue:{background:w.b.navigator.secondary[5]},orangeBrown:{background:w.b.orangeSky.secondary[3]}})),G={config:{zoom:1.5,zoomLargeMap:10},preventZoom:{zoomControl:!1,doubleClickZoom:!1,closePopupOnClick:!1,dragging:!1,touchZoom:!1,scrollWheelZoom:!1,boxZoom:!1}};var Q=function(e,t,a,o){return new(a||(a=Promise))((function(r,n){function l(e){try{c(o.next(e))}catch(e){n(e)}}function i(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(l,i)}c((o=o.apply(e,t||[])).next())}))};const X={style:{color:"#2A86B0",weight:2,opacity:.65,dashArray:[5,7]}},Z={style:{color:"#EF6C00",weight:2,opacity:.65,dashArray:[5,7]}};function Y(e){var t;const{showFullscreen:a=!1,mapId:o,worldCopyJump:n,enableZoom:d=!1,showLargeMap:y=!1,setShowLargeMap:f,onOpenFullscreen:k,onCloseFullscreen:j,hideMapControls:E=!1,calculateHeight:D,voyage:T,restrictedAreas:A,reactKeyPrefix:I,startingPosition:F,overlappingVoyageColourMap:M,userLocale:B,selectedRoutes:K,showAlternatives:V,lastSelectedKey:z,onClickMapRoute:H,state:{routingPoints:U}}=e,_=J({}),[Y,ee]=Object(x.a)([$.a.IVoyageMapController,L.a.IInternationalization]),{common:te}=ee.getLanguageFile(),[ae,oe]=Object(g.useState)(),re=Object(g.useRef)(!1),[ne,le]=Object(g.useState)(!1),[ie,ce]=Object(g.useState)(),se=Object(g.useRef)([]),de=Object(g.useRef)(),ue="sliderButtons"+o,me="closeFullscreenButton"+o,pe="displayFullscreenButton"+o,{olra:ge,eca:be}=Object(g.useMemo)(()=>N.a.filterRestrictedAreas(A),[A]),ye=Object(g.useCallback)(e=>se.current=e,[]),ve=Object(g.useMemo)(()=>be.map(e=>e.geoJson?N.a.createAreaDuplicates(e.geoJson):void 0),[be]),fe=Object(g.useMemo)(()=>ge.map(e=>e.geoJson?N.a.createAreaDuplicates(e.geoJson):void 0),[ge]),he=Object(g.useMemo)(()=>(a||y)&&null!=U?U:[],[U,a,y]),Ce=Object(g.useMemo)(()=>{const e=Object(W.g)(T);return Object(W.d)(e)},[T.partOfSchedule]),Oe=Object(g.useMemo)(()=>T.partOfSchedule.map(e=>{var t;return null===(t=e.ownedByVoyage)||void 0===t?void 0:t.key}).toString(),[T.partOfSchedule]),xe=Object(g.useMemo)(()=>R.a.getOverlappingVoyagesLinkedToAVoyage(T),[Oe]);Object(g.useEffect)(()=>{xe.forEach(e=>Q(this,void 0,void 0,(function*(){Y.loadOverlappingRoute(e.key)})))},[xe]);const ke=Object(g.useMemo)(()=>Object(W.f)(T),[T.partOfSchedule]),Pe=Object(g.useMemo)(()=>{if(V&&K&&H)return Object(W.e)(T,K,ee,_.routePopup,H,z)},[K,V,T.partOfSchedule]),je=Object(g.useMemo)(()=>Object(W.c)(null!=M?M:new Map),[M]),Ee=Object(g.useMemo)(()=>Object(W.j)(T,_.popupMain),[_.popupMain,T.ballastPort,T.partOfSchedule,T.portCallsFromVoyage]);const Se=Object(g.useRef)(void 0),we=Object(g.useRef)(void 0),De=Object(g.useRef)(new u.a.LayerGroup),Ne=Object(g.useRef)(void 0),Re=Object(g.useRef)(new u.a.LayerGroup),Le=Object(g.useRef)(new u.a.LayerGroup),Te=Object(g.useRef)(void 0),[Ae,Ie]=Object(g.useState)(null===(t=Se.current)||void 0===t?void 0:t.getZoom());Object(g.useMemo)(()=>{fe.length!==Le.current.getLayers().length&&fe.forEach(e=>Le.current.addLayer(u.a.geoJSON(e,Z)))},[fe]),Object(g.useMemo)(()=>{ve.length!==Re.current.getLayers().length&&ve.forEach(e=>Re.current.addLayer(u.a.geoJSON(e,X)))},[ve]);const Fe=Object(g.useMemo)(()=>{const e=T.partOfSchedule.flatMap(e=>e.routingPoints);return he.filter(t=>.7*(null!=Ae?Ae:1)>=t.zoomLevel||e.some(e=>t.latitude===e.latitude&&t.longitude===e.longitude))},[he,Ae,T.partOfSchedule]),Me=Object(g.useCallback)(e=>{if(ke&&e.ownedByVoyage&&ke.get(e.ownedByVoyage.key)&&Se.current){const t=u.a.geoJSON(ke.get(e.ownedByVoyage.key),{style:{color:null==M?void 0:M.get(e.ownedByVoyage.key)}});if(Te.current&&Object(m.a)(t.toGeoJSON(),Te.current.toGeoJSON()))return void Te.current.clearLayers();Te.current&&!Object(m.a)(t.toGeoJSON(),Te.current.toGeoJSON())&&Te.current.clearLayers(),Te.current=t.addTo(Se.current)}},[M,ke]),Be=Object(g.useCallback)(()=>{le(!ne)},[ne]),Ke=Object(g.useCallback)(e=>{ce(e),Be()},[Be]),Ve=Object(g.useCallback)((e,t)=>{Object(C.a)(te.removeFromRoute,te.removeRoutingPointConfirmation(t),te.remove).then(t=>{t&&T.partOfSchedule&&Y.removeRoutingPoint(T.partOfSchedule,e.key)})},[te,Y,T.partOfSchedule]),$e=Object(g.useCallback)(()=>{var e,t,a,o;const{routingPoints:r}=null!==(e=T.partOfSchedule.find(e=>de.current===e.key))&&void 0!==e?e:new P.a({}),n=r.length>0?r[r.length-1].sequence:0;Y.addRoutingPoint({latitude:null!==(t=null==ie?void 0:ie.latitude)&&void 0!==t?t:0,longitude:null!==(a=null==ie?void 0:ie.longitude)&&void 0!==a?a:0,sequence:n+1},{routingPoints:r,key:null!==(o=de.current)&&void 0!==o?o:0}),Be()},[Y,null==ie?void 0:ie.latitude,null==ie?void 0:ie.longitude,Be,T.partOfSchedule]),ze=Object(g.useCallback)(e=>{e&&(de.current=e.value)},[]),He=Object(g.useMemo)(()=>Object(W.i)(T,_,je,Me),[_,je,Me,T.partOfSchedule,T.ballastPort]),Ue=Object(g.useMemo)(()=>Object(W.k)({voyage:T,routingPoints:Fe,classNames:{popup:_.popup,markerButton:_.markerButton,disabledButton:_.disabledButton},i:ee,userLocale:B},Ke,ye,ze),[Fe,_.popup,_.markerButton,ee,B]),We=Object(g.useMemo)(()=>Object(W.l)({voyageRoutingPoints:T.partOfSchedule.flatMap(e=>e.routingPoints),routingPointMarkers:{routingPoints:Fe,classNames:{popup:_.popup,markerButton:_.markerButton,disabledButton:_.disabledButton},i:ee,userLocale:B,voyage:T},onClickAdd:Ke,onClickRemove:Ve},ye,ze),[_.markerButton,_.popup,ee,Ke,Ve,T.partOfSchedule,Fe,B]),_e=Object(g.useMemo)(()=>[...He,...Ue,...We],[He,Ue,We]),qe=Object(g.useCallback)((e,t)=>{const a=document.querySelector("#"+e);null==a||a.classList.toggle(_.hide,!t)},[_.hide]),Je=Object(g.useCallback)(()=>{qe(me,!0),qe(pe,!1),qe(ue,!0)},[me,pe,ue,qe]),Ge=Object(g.useCallback)(()=>{qe(me,!1),qe(pe,!0),qe(ue,!1)},[me,pe,ue,qe]),Qe=Object(g.useCallback)(()=>{qe(me,!1),qe(pe,!1),qe(ue,!0)},[me,pe,ue,qe]),Xe=Object(g.useCallback)(()=>{Je(),k&&k(),f&&f(!0)},[k,Je,f]),Ze=Object(g.useCallback)(()=>{Ge(),j&&j(),f&&f(!1)},[j,Ge,f]);Object(g.useEffect)(()=>{E?Qe():y?Je():Ge()},[_.hide,E,Ge,Qe,Je,y]);const Ye=u.a.Control.extend({options:{position:"topleft"},onAdd:function(){const e=u.a.DomUtil.create("div","full-screen-button");return v.a.render(b.a.createElement(i.a,{theme:S.a},b.a.createElement("div",{className:Object(s.default)(_.fullscreenButton),id:pe},b.a.createElement(l.a,{style:{height:"34px",width:"34px",borderRadius:"2px",border:"2px solid rgba(0,0,0,0.2)",backgroundColor:"white",marginTop:-10,visibility:E?"hidden":"visible"}}))),e),e.addEventListener("click",Xe),e}}),et=u.a.Control.extend({options:{position:"topleft"},onAdd:function(){const e=u.a.DomUtil.create("div","close-full-screen-button");return v.a.render(b.a.createElement(i.a,{theme:S.a},b.a.createElement("div",{className:Object(s.default)(_.fullscreenButton,_.hide),id:me},b.a.createElement(r.a,{style:{height:"34px",width:"34px",borderRadius:"2px",border:"2px solid rgba(0,0,0,0.2)",backgroundColor:"white",visibility:E?"hidden":"visible"}}))),e),e.addEventListener("click",Ze),e}}),tt=Object(g.useCallback)((e,t)=>{if(Se.current){const a="showOlra"===e?Le.current:Re.current;t?a.addTo(Se.current):a.removeFrom(Se.current)}},[]),at=Object(g.useMemo)(()=>u.a.Control.extend({options:{position:"topright"},onAdd:function(){const e=u.a.DomUtil.create("div","sliders");return v.a.render(b.a.createElement(c.a,{injectFirst:!0},b.a.createElement(i.a,{theme:S.a},b.a.createElement("div",{className:Object(s.default)(_.hide),id:ue},b.a.createElement(q,{voyageKey:T.key,reactKeyPrefix:I,updateRestrictedAreas:tt})))),e),e}}),[_.hide,ue,T.key,I,tt]),ot=Object(g.useCallback)(()=>{var e,t,a;const o=null!==(a=null===(t=null===(e=Se.current)||void 0===e?void 0:e.zoomControl.getContainer())||void 0===t?void 0:t.children)&&void 0!==a?a:new HTMLCollection;[...Array(o.length).keys()].forEach(e=>{o.item(e)&&u.a.DomEvent.addListener(o.item(e),"click",()=>re.current=!0)})},[]),rt=Object(g.useMemo)(()=>d?{worldCopyJump:n,scrollWheelZoom:!1}:G.preventZoom,[d,n]),nt=Object(g.useCallback)(()=>{we.current&&Ne.current&&Se.current&&(we.current.clearLayers(),Ne.current.clearLayers(),De.current.removeFrom(Se.current))},[]),lt=Object(g.useCallback)(()=>{var e,t;oe(D?null===(e=Se.current)||void 0===e?void 0:e.getSize().x:void 0),null===(t=Se.current)||void 0===t||t.invalidateSize(!0)},[D]),it=Object(g.useCallback)(()=>{if(lt(),Se.current){if(nt(),Se.current.on("dblclick",()=>re.current=!0),Se.current.on("zoomend",()=>{var e;const t=null===(e=Se.current)||void 0===e?void 0:e.getZoom();void 0!==t&&t!==Ae&&(a||y)&&Ie(t)}),Pe&&(De.current=Pe.addTo(Se.current)),Ce&&(we.current=u.a.geoJSON(Ce,{style:{color:w.b.sunriseYellow.primary}}).addTo(Se.current)),_e.length>0&&Se.current.getZoom()<=12&&(Ne.current=u.a.layerGroup(_e).addTo(Se.current)),Ee.length>0&&Se.current.getZoom()>12&&(Ne.current=u.a.layerGroup(Ee).addTo(Se.current)),we.current&&!re.current){const e=we.current.getBounds();!!e.getSouthWest()&&Se.current.fitBounds(e,{padding:[5,10]})}F&&Se.current.setView([F.latitude,F.longitude],12)}},[lt,nt,Ce,Pe,_e,Ee,F,Ae,a,y]);return Object(g.useEffect)(()=>{if(Se.current)it();else{const e=u.a.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>&copy; <a href="https://carto.com/attributions">CARTO</a>'});Se.current=u.a.map(o,Object.assign(Object.assign({},rt),{maxBounds:[[-90,-270],[90,360]],layers:[e],preferCanvas:!0,renderer:u.a.canvas({tolerance:3})})),F?Se.current.setView([F.latitude,F.longitude],12):Se.current.setView([50,-50],G.config.zoom),Se.current.addControl(new at),Se.current.addControl(new et),Se.current.addControl(new Ye),ot(),it();const t=localStorage.getItem("showEca");(!t||JSON.parse(t))&&Re.current.addTo(Se.current);const a=localStorage.getItem("showOlra");(!a||JSON.parse(a))&&Le.current.addTo(Se.current)}return()=>{nt(),it()}},[et,Ye,a,T,_,o,n,rt,_.popupMain,Ee,void 0,nt,it,y,at,E,F,ot]),b.a.createElement("div",{className:Object(s.default)({[_.container]:!a,[_.modalMapContainer]:a}),style:{height:ae,zIndex:0}},b.a.createElement(O.a,{reactKeyPrefix:I+"-add-routing-point-modal",open:ne,onCloseModal:Be,maxWidth:"xs",fullWidth:!0,title:te.addRoutingPoint,confirmBtnName:te.add,onConfirm:$e,disableConfirmBtn:!se.current.length},b.a.createElement(h.a,{label:te.betweenPortCalls,options:se.current,defaultSelectedOptions:Object(p.a)(se.current),resolver:e=>e.label,reactKeyPrefix:I+"-port-call",onChange:ze,isClearable:!1})),b.a.createElement("div",{className:_.map,id:""+o}))}const ee=Object(k.a)((e,{showRoutingPoints:t})=>({routingPoints:t?E.a.getTSModelsBuilt(e,j.a.port,f.a,D.f):[]}),Object(g.memo)(Y))},945:function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return f}));a(59),a(10),a(11);var o,r,n,l=a(9),i=a(7),c=a(29),s=a(1),d=a(131),u=a(3),m=a(192),p=a(58),g=function(e,t,a,o){var r,n=arguments.length,l=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,a):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,o);else for(var i=e.length-1;i>=0;i--)(r=e[i])&&(l=(n<3?r(l):n>3?r(t,a,l):r(t,a))||l);return n>3&&l&&Object.defineProperty(t,a,l),l},b=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},y=function(e,t){return function(a,o){t(a,o,e)}},v=function(e,t,a,o){return new(a||(a=Promise))((function(r,n){function l(e){try{c(o.next(e))}catch(e){n(e)}}function i(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(l,i)}c((o=o.apply(e,t||[])).next())}))};!function(e){e.FROM="laycanFrom",e.TO="laycanTo"}(n||(n={}));let f=class{constructor(e,t){this.tsmodelActions=e,this.i=t}refreshEventlogDates(e){this.tsmodelActions.loadSingleAction({fields:{partOfSchedule:{eventLogs:{eventLogDate:"*"}}},key:e,type:s.a.voyage})}update(e,t,a,o){return v(this,void 0,void 0,(function*(){e&&(yield this.tsmodelActions.updateSingleAction({callback:o,data:t,key:e,type:s.a.cargo,headers:Object.assign({},d.a.smartJson)}).then(()=>{a&&this.refreshEventlogDates(a)}))}))}onChangeCargoPort(e,t,a,o){const r=e.cargoPorts.map(({key:e})=>t.key===e?t:{key:e});this.update(e.key,{cargoPorts:r},a,o)}onChangeDaysExtraInPort(e,t,a){if(t){const o=t.map(e=>e.key),r=[];for(const t of e.cargoPorts)t.portCall&&o.includes(t.portCall.key)?r.push({key:t.key,portCall:{key:t.portCall.key,daysExtraInPort:a}}):r.push({key:t.key});const n={cargoPorts:r};this.update(e.key,n)}}onChangeFreightRate(e,t){const a=t>9999;let o=[];o=a?p.a.getPostableFreightRateForCargoPorts(e,0,!1):p.a.getPostableFreightRateForCargoPorts(e,t,!0);const r={freightRate:a?t:0,isLumpsum:a,cargoPorts:o.length>0?o:void 0};this.update(e.key,r)}onChangeCommodity(e,t){var a,o,r;const n=null!==(o=null===(a=null==t?void 0:t.commodityMeasurement)||void 0===a?void 0:a.measurementCode)&&void 0!==o?o:this.i.getLanguageFile().common.mt;e&&this.tsmodelActions.updateSingleAction({data:{commodity:null!==(r=null==t?void 0:t.key)&&void 0!==r?r:null,cargoMeasurement:n},key:e,fields:{commodity:"*",cargoMeasurement:"*"},type:s.a.cargo,headers:Object.assign({},d.a.smartJson)})}onChangeLaycan(e,t,a,o,r,l){a.laycanFrom&&t===n.TO&&a.laycanFrom>e||a.laycanTo&&t===n.FROM&&e>a.laycanTo?r():this.update(a.key,{[t]:e},o,l)}refreshQuantity(e){this.tsmodelActions.loadSingleAction({fields:{cargoQuantity:"*",cargoPorts:{cargoQuantity:"*"},voyage:{partOfSchedule:{eventLogs:{eventLogDate:"*"},laytimeUsed:"*"}}},key:e.key,type:s.a.cargo})}onChangeQuantity(e,t){t.key&&this.tsmodelActions.updateSingleAction({callback:()=>this.refreshQuantity(e),data:t,key:t.key,type:s.a.cargoport,headers:Object.assign({},d.a.smartJson)})}};f=g([Object(l.injectable)(),y(0,Object(l.inject)(i.a.ITSModelActionsAsync)),y(1,Object(l.inject)(u.a.IInternationalization)),b("design:paramtypes",["function"==typeof(o=void 0!==c.ITSModelActionsAsync&&c.ITSModelActionsAsync)?o:Object,"function"==typeof(r=void 0!==m.IInternationalization&&m.IInternationalization)?r:Object])],f)}}]);