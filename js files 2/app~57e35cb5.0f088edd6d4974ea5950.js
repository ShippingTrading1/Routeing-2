(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{1718:function(e,t,n){"use strict";n.d(t,"a",(function(){return A}));n(59),n(10),n(11);var a,o,i,l,r,s,c=n(9),d=n(81),u=n(31),y=n(83),v=n(104),p=n(107),g=n(936),f=n(173),m=n(1),b=n(32),h=n(206),O=n(29),j=n(21),k=n(7),P=n(168),S=function(e,t,n,a){var o,i=arguments.length,l=i<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,n):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,a);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(l=(i<3?o(l):i>3?o(t,n,l):o(t,n))||l);return i>3&&l&&Object.defineProperty(t,n,l),l},C=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},F=function(e,t){return function(n,a){t(n,a,e)}},w=function(e,t,n,a){return new(n||(n=Promise))((function(o,i){function l(e){try{s(a.next(e))}catch(e){i(e)}}function r(e){try{s(a.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,r)}s((a=a.apply(e,t||[])).next())}))};let A=class{constructor(e,t,n,a,o,i){this.store=e,this.objectApi=t,this.tsmodelApi=n,this.tsmodelActions=a,this.scenarioActions=o,this.documentLinesController=i}onNominate(e,t,n,a){var o,i;return w(this,void 0,void 0,(function*(){const{vessel:l,voyageHeader:r}=e,s=Object(d.a)(e.scenarios[0],"fleetPlan.fleetPlanCode",null),c=Object(d.a)(e.scenarios[0],"fleetPlan.key",null),u=a||(yield this.getLastFleetPlanVoyageOnFleetPlan(l,c,e)),y="MASTER"===s,v=null!==(o=null==r?void 0:r.isVoyageStartFixed)&&void 0!==o&&o;yield this.nominateVoyage(e,(null!==(i=null==u?void 0:u.sequence)&&void 0!==i?i:0)+1,v,c,t,y,n)}))}nominateVoyage(e,t,n,a,o,i,l){return w(this,void 0,void 0,(function*(){if(e.voyageHeader&&e.vessel&&a){const{company:r,businessUnit:s,charteringResponsible:c,operator:d,accountantResponsible:u}=e.voyageHeader,{tcs:y}=e,{refreshFleetPlan:v}=o,g={voyageHeader:{key:e.voyageHeader.key,voyageStatus:"NOM",isVoyageStartFixed:n,company:null==r?void 0:r.key,businessUnit:null==s?void 0:s.key,charteringResponsible:null==c?void 0:c.key,operator:null==d?void 0:d.key,accountantResponsible:null==u?void 0:u.key,isEstimate:!1,isUnallocated:!1},tcs:l?[...Object(P.d)(y).filter(e=>e!==l.key),{key:l.key,laycanFrom:l.laycanFrom,laycanTo:l.laycanTo}]:void 0,fleetPlanVoyages:[{fleetPlan:a,voyage:e.key,sequence:t,vessel:e.vessel.key}]};return this.tsmodelActions.updateSingleAction({data:g,key:e.key,type:m.a.voyage,fields:p.c,callback:()=>this.onNominateCallback(v,i,e)})}}))}nominateToMaster(e,t,n,a){const o=j.a.getTSModelsBuilt(this.store.getState(),m.a.fleetplan,{key:"*",fleetPlanCode:"*"}).find(e=>"MASTER"===e.fleetPlanCode);if(!o)throw new Error("Failed to fetch master fleet plan.");this.nominateVoyage(e,t,!0,o.key,n,!0,a)}getLastFleetPlanVoyageOnFleetPlan(e,t,n){return w(this,void 0,void 0,(function*(){let a=["fleetPlan.key(EQ)"+t,"vessel(EQ)"+(null==e?void 0:e.key)].join("&filter=");n&&(a=a+"&filter=voyage(NE)"+(null==n?void 0:n.key));const o=yield this.objectApi.getMultiple({authdata:Object(b.a)(this.store.getState()).authdata||"",fields:{sequence:"*",fleetPlan:"*",voyage:{portCallsFromVoyage:{reasonForCall:{reasonForCall:"*"},portCallSequence:"*",port:{portName:"*"}},voyageEndDateGMT:"*"}},type:m.a.fleetplanvoyage,query:`filter=${a}&sort=sequence(DSI)&pageNumber=1&limit=1`});return null!==o&&1===o.length?o[0]:null}))}refreshVoyageHeaderReferenceNo(e){this.tsmodelActions.loadSingleAction({fields:{voyageHeader:{referenceNo:"*",isVoyageStartFixed:"*"}},key:e.key,type:m.a.voyage})}loadCargosData(e){return w(this,void 0,void 0,(function*(){const t="filter=voyage.key(EQ)"+e.key;yield this.tsmodelActions.loadMultipleAction({type:m.a.cargo,query:t,fields:{laycanTo:"*",laycanFrom:"*",cargoReference:"*"}})}))}onNominateCallback(e,t,n){e&&this.scenarioActions.refreshScenarioFleetPlanData(),n&&this.refreshVoyageHeaderReferenceNo(n)}getVesselCodes(e){var t,n;return w(this,void 0,void 0,(function*(){const{authdata:a}=Object(b.a)(this.store.getState());return(null===(t=null==e?void 0:e.vessel)||void 0===t?void 0:t.key)?this.tsmodelApi.getMultiple({authdata:null!=a?a:"",type:m.a.vesselcode,query:"filter=vessel.key(EQ)"+(null===(n=null==e?void 0:e.vessel)||void 0===n?void 0:n.key),fields:{vesselCodes:{vesselCode:"*"}}}).then(e=>e).catch(()=>[]):Promise.reject()}))}};A=S([Object(c.injectable)(),F(0,Object(c.inject)(k.a.Store)),F(1,Object(c.inject)(y.a.ITSModelApi)),F(2,Object(c.inject)(y.a.ITSModelApi)),F(3,Object(c.inject)(k.a.ITSModelActionsAsync)),F(4,Object(c.inject)(k.a.IScenarioActions)),F(5,Object(c.inject)(f.a.IPendingDocumentLinesGroupController)),C("design:paramtypes",["function"==typeof(a=void 0!==u.Store&&u.Store)?a:Object,"function"==typeof(o=void 0!==v.ITSModelApi&&v.ITSModelApi)?o:Object,"function"==typeof(i=void 0!==v.ITSModelApi&&v.ITSModelApi)?i:Object,"function"==typeof(l=void 0!==O.ITSModelActionsAsync&&O.ITSModelActionsAsync)?l:Object,"function"==typeof(r=void 0!==h.IScenarioActions&&h.IScenarioActions)?r:Object,"function"==typeof(s=void 0!==g.IPendingDocumentLinesGroupController&&g.IPendingDocumentLinesGroupController)?s:Object])],A)},2005:function(e,t,n){"use strict";n.d(t,"a",(function(){return U}));n(59),n(10),n(11);var a=n(1329),o=n(0),i=n.n(o),l=n(37),r=n(12),s=n(44),c=n(6),d=n(172),u=n(108),y=n(62),v=n(168),p=n(60),g=n(20),f=n(130),m=n(2533),b=n(202),h=n(19),O=n(1);var j=n(114),k=n(273),P=n(134),S=n(148),C=n(1429),F=n(984),w=n(81),A=n(58),E=n(3);const M={display:"list-item",listStyleType:"disc",marginLeft:3},N=Object(o.memo)(({cargos:e,tc:t,errorMessage:n})=>{const[a]=Object(c.a)([E.a.IInternationalization]),{model:o,common:l,voyages:r}=a.getLanguageFile(),s=e.filter(e=>!e.laycanFrom||!e.laycanTo),d=s.length<=3,u=t?i.a.createElement(i.a.Fragment,null):d?i.a.createElement(C.a,null,s.map(e=>i.a.createElement(F.a,{key:e.key,sx:M},(e=>{const t=Object(w.a)(A.a.getFirstLoadCargoPort(e.cargoPorts),"port.portName",""),n=Object(w.a)(A.a.getFirstDischargeCargoPort(e.cargoPorts),"port.portName","");return`${o.reference}: ${e.cargoReference}, ${o.loadPort}: ${t}, ${o.dischargePortShortened}: ${n}`})(e)))):i.a.createElement("span",null,l.references+": ",s.map(e=>e.cargoReference).join(", "));return i.a.createElement(i.a.Fragment,null,(!t&&s.length||!!n)&&i.a.createElement(b.a,null),n&&i.a.createElement(m.a,{severity:"error",sx:{mb:1}},n),!t&&!!s.length&&i.a.createElement(i.a.Fragment,null,i.a.createElement(f.a,{variant:"h6"},r.cargoesWithMissingLaycan),u))});var T=function(e,t,n,a){return new(n||(n=Promise))((function(o,i){function l(e){try{s(a.next(e))}catch(e){i(e)}}function r(e){try{s(a.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,r)}s((a=a.apply(e,t||[])).next())}))};function U({reactKeyPrefix:e,onClose:t,selectedVoyage:n,userLocale:C,open:F,i:w,refreshFleetPlan:A}){var E,M;const[U]=Object(c.a)([g.a.INominateVoyageModalController]),{common:L,voyages:R}=w.getLanguageFile(),[I,x]=Object(o.useState)(),[V,D]=Object(o.useState)(null!==(E=n.voyageHeader)&&void 0!==E?E:new u.a({})),[H,q]=Object(o.useState)(!1),[B,K]=Object(o.useState)(!1),[W,$]=Object(o.useState)(!1),{isTc:G}=n,Q=Object(k.a)({companyRequired:!0,businessUnitRequired:!0}),z=Object(o.useMemo)(()=>({refreshFleetPlan:A}),[A]),[J,Y]=Object(o.useState)(!1),[X,Z]=Object(o.useState)(!0),_=n.cargos.filter(e=>!e.laycanFrom||!e.laycanTo||!e.cargoReference);Object(o.useEffect)(()=>{(()=>{T(this,void 0,void 0,(function*(){var e,t,a;const o=yield U.getVesselCodes(n),i=null!==(e=o[0])&&void 0!==e&&e&&o[0].vesselCode!==String(null!==(a=null===(t=n.vessel)||void 0===t?void 0:t.key)&&void 0!==a?a:"");Z(i),K(_.length>0||!X)}))})()},[]);const ee=Object(o.useCallback)(()=>T(this,void 0,void 0,(function*(){_.length>0&&(yield U.loadCargosData(n).then(()=>{Promise.resolve(!0).then(e=>{Y(e)})}))})),[U,_.length,n]);Object(o.useEffect)(()=>{_.length>0&&!J?ee():J&&K(_.length>0||!X)},[J,X,_.length,ee]),Object(o.useEffect)(()=>{if(G){const[e]=Object(a.a)(null==n?void 0:n.tcs,"key").slice(-1);x(e),q(!e.laycanFrom||!e.laycanTo),$(e.calculateProfitLoss)}},[U,G,n.key,null==n?void 0:n.tcs]);const te=Object(o.useCallback)(e=>{e&&(V.isVoyageStartFixed=!0,U.onNominate(new y.a(Object.assign(Object.assign({},n),{voyageHeader:V})),z,I),K(!1),t())},[U,t,n,I,z,V]),ne=Object(o.useCallback)((e,t)=>{I&&"companyBusinessUnit"!==e?x(n=>new d.a(Object(v.e)(null!=n?n:I,e,t))):D("companyBusinessUnit"===e?e=>new u.a(Object.assign(Object.assign({},e),{company:new P.a({key:null==t?void 0:t.company}),businessUnit:new S.a({key:null==t?void 0:t.businessUnit})})):n=>new u.a(Object(v.e)(n,e,t)))},[I]),ae=Object(o.useCallback)(()=>T(this,void 0,void 0,(function*(){var e,a,o,i,l,r,s;const c=null===(a=null===(e=null==n?void 0:n.scenarios[0])||void 0===e?void 0:e.fleetPlan)||void 0===a?void 0:a.key,d=c?yield U.getLastFleetPlanVoyageOnFleetPlan(n.vessel,c,n):null;d?(null===(r=null===(l=p.a.getOpenPositionPortCall(null!==(i=null===(o=null==d?void 0:d.voyage)||void 0===o?void 0:o.portCallsFromVoyage)&&void 0!==i?i:[]))||void 0===l?void 0:l.port)||void 0===r?void 0:r.key)!==(null===(s=null==n?void 0:n.ballastPort)||void 0===s?void 0:s.key)?Object(j.a)(L.warning,R.voyageDrawerNominateLockStartDateWarning,L.nominate,L.cancel).then(e=>te(e)):(V.isVoyageStartFixed=!1,U.onNominate(new y.a(Object.assign(Object.assign({},n),{voyageHeader:V})),z,I,null!=d?d:void 0),K(!1),t()):te(!0)})),[L.cancel,L.nominate,L.warning,U,te,t,n,I,z,V,R.voyageDrawerNominateLockStartDateWarning]),oe=!!V.company&&!!V.businessUnit&&(null!=Q?Q:[]).some(({company:e,businessUnit:t})=>{var n,a;return e===(null===(n=null==V?void 0:V.company)||void 0===n?void 0:n.key)&&t===(null===(a=null==V?void 0:V.businessUnit)||void 0===a?void 0:a.key)}),ie=!(V.company&&V.businessUnit&&oe&&X),le=Object(o.useMemo)(()=>((e,t,n,a,o,{isTcLaycanMissing:l,companyBusinessUnits:s,tc:c},d)=>{var y,v;const{model:p,common:g}=t.getLanguageFile(),j=null!==(y=a.voyageHeader)&&void 0!==y?y:new u.a({}),k=null!==(v=null==s?void 0:s.find(e=>{var t,n,a;return e.company===(null===(t=null==j?void 0:j.company)||void 0===t?void 0:t.key)&&e.businessUnit===(null!==(a=null===(n=null==j?void 0:j.businessUnit)||void 0===n?void 0:n.key)&&void 0!==a?a:void 0)}))&&void 0!==v?v:null,P=[{fieldName:"company",formControlProps:{required:!0},label:g.companyBusinessUnit,breakpoints:r.e,typeaheadProps:{options:null!=s?s:[],defaultSelectedOptions:k,resolver:e=>null==e?void 0:e.label},onUpdateOverride:o.bind(null,"companyBusinessUnit")},{fieldName:"charteringResponsible",label:p.responsibleCharterer,typeaheadProps:{shouldPreload:!0},onUpdateOverride:o.bind(null,"charteringResponsible")},{fieldName:"operator",label:p.responsibleOperator,typeaheadProps:{shouldPreload:!0},onUpdateOverride:o.bind(null,"operator")},{fieldName:"accountantResponsible",label:p.responsibleAccountant,typeaheadProps:{shouldPreload:!0},onUpdateOverride:o.bind(null,"accountantResponsible")}];return c&&l&&P.push({overrideComponent:i.a.createElement(b.a,null)},{overrideComponent:i.a.createElement(f.a,{variant:"h6"},g.timeCharterLaycan)},{overrideObject:c,overrideType:O.a.tc,fieldName:"laycanFrom",label:p.laydaysCommences,breakpoints:r.h,onUpdateOverride:o.bind(null,"laycanFrom")},{fieldName:"laycanTo",overrideObject:c,overrideType:O.a.tc,label:p.laydaysCancelling,onUpdateOverride:o.bind(null,"laycanTo"),breakpoints:r.h}),c&&!d&&P.push({overrideComponent:i.a.createElement(m.a,{severity:"warning"},g.profitLossWarnings)}),Object(h.a)({fieldOptions:P,object:j,type:O.a.voyageheader,userLocale:n,reactKeyPrefix:e,disableUpdate:!0})})(e,w,C,new y.a(Object.assign(Object.assign({},n),{voyageHeader:V})),ne,{isTcLaycanMissing:H,companyBusinessUnits:Q,tc:I},W),[e,w,C,n,V,ne,H,Q,I,W]);return i.a.createElement(s.a,{reactKeyPrefix:e,open:F,title:L.nominate,confirmBtnName:L.nominate,fullWidth:!0,onConfirm:ae,onCloseModal:t,maxWidth:"sm",disableConfirmBtn:ie},i.a.createElement(l.a,{reactKeyPrefix:e+"-modal-fields",items:le,breakpoints:r.e}),B&&i.a.createElement(N,{tc:I,cargos:null!==(M=n.cargos)&&void 0!==M?M:[],errorMessage:X?void 0:R.vesselCodeNotSet}))}},2036:function(e,t,n){"use strict";n.d(t,"a",(function(){return g}));n(10),n(11);var a=n(0),o=n.n(a),i=n(51),l=n(12),r=n(6),s=n(1),c=n(3),d=n(19),u=n(28),y=n(70),v=n(85);function p(e,t,n,a,o){const{model:i}=o.getLanguageFile(),l={reactKeyPrefix:e,disableUpdate:!0,fieldOptions:[{fieldName:"percentage",label:i.percentage,formControlProps:{required:!1},numberInputProps:{maskSettings:{disableThousandSeparator:!0,fixedDecimalScale:!1,allowNegative:!1},validation:[{type:v.a.RANGE,min:0,max:100}]},onUpdateOverride:n.bind(null,"percentage")},{fieldName:"year",numberInputProps:{validation:y.b.Year,maskSettings:u.a.mask9},onUpdateOverride:n.bind(null,"year")}],object:t,type:s.a.phaseinpercentage,userLocale:a};return Object(d.a)(l)}function g(e){const[t]=Object(r.a)([c.a.IInternationalization]),{common:n}=t.getLanguageFile(),{reactKeyPrefix:d,closeModal:u,showModal:y,onCreate:v}=e,g=Object(a.useCallback)(e=>!e.year,[]);return o.a.createElement(i.a,{modalProps:{reactKeyPrefix:d+"-create-compliance-percentage-modal",maxWidth:"xs",onCloseModal:u,open:y,title:n.createPhaseInPercentage,confirmBtnName:n.create},getColSpec:p,breakpoints:l.e,createProps:{callback:v,type:s.a.phaseinpercentage},isConfirmDisabled:g})}}}]);